<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon-apple.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Tachiu Lam">
  <meta name="keywords" content="">
  <title>go net/httpçš„å°æ€»ç»“ - Tachiu Lam</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_fmb4a04yx8h.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">




<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>TachiuLam's emmm...</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">
              <i class="iconfont icon-home-fill"></i>
              é¦–é¡µ</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">
              <i class="iconfont icon-archive-fill"></i>
              å½’æ¡£</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">
              <i class="iconfont icon-category-fill"></i>
              åˆ†ç±»</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">
              <i class="iconfont icon-tags-fill"></i>
              æ ‡ç­¾</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">
              <i class="iconfont icon-user-fill"></i>
              å…³äº</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/go2.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <div class="mt-3 post-meta">
                  <i class="iconfont icon-date-fill" aria-hidden="true"></i>
                  <time datetime="2023-08-08 23:24">
                    2023å¹´8æœˆ8æ—¥ æ™šä¸Š
                  </time>
                </div>
              

              <div class="mt-1">
                
                  
                  <span class="post-meta mr-2">
                    <i class="iconfont icon-chart"></i>
                    2.1k å­—
                  </span>
                

                
                  
                  <span class="post-meta mr-2">
                      <i class="iconfont icon-clock-fill"></i>
                    
                    
                    36
                     åˆ†é’Ÿ
                  </span>
                

                
              </div>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
              <p class="note note-info">
                
                  æœ¬æ–‡æœ€åæ›´æ–°äºï¼š2023å¹´8æœˆ8æ—¥ æ™šä¸Š
                
              </p>
            
            <article class="markdown-body">
              <h2 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h2><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><pre><code class="hljs golang"><span class="hljs-keyword">type</span> Handler <span class="hljs-keyword">interface</span> &#123;
   ServeHTTP(ResponseWriter, *Request)
&#125;

<span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> &#123;
   Addr <span class="hljs-keyword">string</span>
   
   <span class="hljs-comment">// è·¯ç”±å¤„ç†å™¨</span>
   Handler Handler <span class="hljs-comment">// handler to invoke, http.DefaultServeMux if nil</span>

   TLSConfig *tls.Config
   ReadTimeout time.Duration
   ReadHeaderTimeout time.Duration
   WriteTimeout time.Duration
   IdleTimeout time.Duration
   MaxHeaderBytes <span class="hljs-keyword">int</span>
   TLSNextProto <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(*Server, *tls.Conn, Handler)</span></span>
   ConnState <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(net.Conn, ConnState)</span></span>
   ErrorLog *log.Logger
   BaseContext <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(net.Listener)</span> <span class="hljs-title">context</span>.<span class="hljs-title">Context</span></span>
   ConnContext <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, c net.Conn)</span> <span class="hljs-title">context</span>.<span class="hljs-title">Context</span></span>

   inShutdown atomicBool <span class="hljs-comment">// true when server is in shutdown</span>

   disableKeepAlives <span class="hljs-keyword">int32</span>     <span class="hljs-comment">// accessed atomically.</span>
   nextProtoOnce     sync.Once <span class="hljs-comment">// guards setupHTTP2_* init</span>
   nextProtoErr      error     <span class="hljs-comment">// result of http2.ConfigureServer if used</span>

   mu         sync.Mutex
   listeners  <span class="hljs-keyword">map</span>[*net.Listener]<span class="hljs-keyword">struct</span>&#123;&#125;
   activeConn <span class="hljs-keyword">map</span>[*conn]<span class="hljs-keyword">struct</span>&#123;&#125;
   doneChan   <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;
   onShutdown []<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>

   listenerGroup sync.WaitGroup
&#125;

<span class="hljs-comment">// Handler è·¯ç”±å¤„ç†å™¨çš„å®ç°</span>
<span class="hljs-keyword">type</span> ServeMux <span class="hljs-keyword">struct</span> &#123;
   mu    sync.RWMutex
   m     <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]muxEntry
   es    []muxEntry <span class="hljs-comment">// slice of entries sorted from longest to shortest.</span>
   hosts <span class="hljs-keyword">bool</span>       <span class="hljs-comment">// whether any patterns contain hostnames</span>
&#125;

<span class="hljs-keyword">type</span> muxEntry <span class="hljs-keyword">struct</span> &#123;
   h       Handler 
   pattern <span class="hljs-keyword">string</span>
&#125;</code></pre>
<h4 id="ServeMux"><a href="#ServeMux" class="headerlink" title="ServeMux"></a>ServeMux</h4><ul>
<li>m     map[string]muxEntryï¼šç»´æŠ¤pathå’Œhandlerçš„æ˜ å°„å…³ç³»</li>
<li>es    []muxEntry ç”¨äºè·¯ç”±å‰ç¼€åŒ¹é…</li>
<li>muxEntryï¼š åœ¨handlerå¤–ï¼Œå†—ä½™ä¿å­˜äº†pathè·¯å¾„ä¿¡æ¯</li>
</ul>
<h3 id="handlerå’Œè·¯ç”±æ³¨å†Œè¿‡ç¨‹"><a href="#handlerå’Œè·¯ç”±æ³¨å†Œè¿‡ç¨‹" class="headerlink" title="handlerå’Œè·¯ç”±æ³¨å†Œè¿‡ç¨‹"></a>handlerå’Œè·¯ç”±æ³¨å†Œè¿‡ç¨‹</h3><h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><pre><code class="hljs golang">http.HandleFunc(<span class="hljs-string">"/ping"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(writer http.ResponseWriter, request *http.Request)</span></span> &#123;
   _, _ = writer.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"pong"</span>))
&#125;)</code></pre>

<h4 id="HandleFunc"><a href="#HandleFunc" class="headerlink" title="HandleFunc"></a>HandleFunc</h4><p>è¡¥å……å†…éƒ¨å•ä¾‹å®ç°çš„ServeMux</p>
<pre><code class="hljs golang"><span class="hljs-comment">// DefaultServeMux is the default ServeMux used by Serve.</span>
<span class="hljs-keyword">var</span> DefaultServeMux = &amp;defaultServeMux <span class="hljs-comment">// å•ä¾‹</span>

<span class="hljs-keyword">var</span> defaultServeMux ServeMux

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HandleFunc</span><span class="hljs-params">(pattern <span class="hljs-keyword">string</span>, handler <span class="hljs-keyword">func</span>(ResponseWriter, *Request)</span>)</span> &#123;
   DefaultServeMux.HandleFunc(pattern, handler)
&#125;</code></pre>
<h4 id="ServeMux-HandleFunc"><a href="#ServeMux-HandleFunc" class="headerlink" title="ServeMux.HandleFunc"></a>ServeMux.HandleFunc</h4><p>å°†demoä¸­ä¼ å…¥çš„handleræ–¹æ³•ï¼ŒåŒ…è£…æˆHandlerFunc è¯¥ç±»å‹å®ç°äº†ä¸Šè¿°çš„ ServeHTTP(w ResponseWriter, r *Request) æ¥å£ï¼Œå®ç°é€»è¾‘æ˜¯å‡½æ•°è‡ªèº«çš„è°ƒç”¨</p>
<pre><code class="hljs golang"><span class="hljs-comment">// HandleFunc registers the handler function for the given pattern.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">HandleFunc</span><span class="hljs-params">(pattern <span class="hljs-keyword">string</span>, handler <span class="hljs-keyword">func</span>(ResponseWriter, *Request)</span>)</span> &#123;
   <span class="hljs-keyword">if</span> handler == <span class="hljs-literal">nil</span> &#123;
      <span class="hljs-built_in">panic</span>(<span class="hljs-string">"http: nil handler"</span>)
   &#125;
   mux.Handle(pattern, HandlerFunc(handler))
&#125;

<span class="hljs-keyword">type</span> HandlerFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ResponseWriter, *Request)</span> // å®ç°<span class="hljs-title">Handler</span> è¯·æ±‚å¤„ç†æ¥å£</span>

<span class="hljs-comment">// ServeHTTP calls f(w, r).</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f HandlerFunc)</span> <span class="hljs-title">ServeHTTP</span><span class="hljs-params">(w ResponseWriter, r *Request)</span></span> &#123;
   f(w, r) <span class="hljs-comment">// è°ƒç”¨handlerè‡ªèº«</span>
&#125;</code></pre>

<h4 id="ServeMux-Handle"><a href="#ServeMux-Handle" class="headerlink" title="ServeMux.Handle"></a>ServeMux.Handle</h4><p>è·¯ç”±åŠæ–¹æ³•çš„æ³¨å†Œ<br>å¦‚æœæ³¨å†Œçš„è·¯å¾„patternæ˜¯ä»¥ /  ç»“å°¾ï¼Œåˆ™æ”¾å…¥esä¸­çš„åˆé€‚ä½ç½®ï¼Œç”¨äºè·¯å¾„å‰ç¼€åŒ¹é…</p>
<pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">Handle</span><span class="hljs-params">(pattern <span class="hljs-keyword">string</span>, handler Handler)</span></span> &#123;
   mux.mu.Lock()
   <span class="hljs-keyword">defer</span> mux.mu.Unlock()

   <span class="hljs-keyword">if</span> pattern == <span class="hljs-string">""</span> &#123;
      <span class="hljs-built_in">panic</span>(<span class="hljs-string">"http: invalid pattern"</span>)
   &#125;
   <span class="hljs-keyword">if</span> handler == <span class="hljs-literal">nil</span> &#123;
      <span class="hljs-built_in">panic</span>(<span class="hljs-string">"http: nil handler"</span>)
   &#125;
   <span class="hljs-keyword">if</span> _, exist := mux.m[pattern]; exist &#123;
      <span class="hljs-built_in">panic</span>(<span class="hljs-string">"http: multiple registrations for "</span> + pattern)
   &#125;

   <span class="hljs-keyword">if</span> mux.m == <span class="hljs-literal">nil</span> &#123;
      mux.m = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]muxEntry)
   &#125;
   e := muxEntry&#123;h: handler, pattern: pattern&#125;
   mux.m[pattern] = e
   <span class="hljs-keyword">if</span> pattern[<span class="hljs-built_in">len</span>(pattern)<span class="hljs-number">-1</span>] == <span class="hljs-string">'/'</span> &#123;
      mux.es = appendSorted(mux.es, e)
   &#125;

   <span class="hljs-keyword">if</span> pattern[<span class="hljs-number">0</span>] != <span class="hljs-string">'/'</span> &#123;
      mux.hosts = <span class="hljs-literal">true</span>
   &#125;
&#125;</code></pre>

<h3 id="æœåŠ¡å¯åŠ¨è¿‡ç¨‹"><a href="#æœåŠ¡å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="æœåŠ¡å¯åŠ¨è¿‡ç¨‹"></a>æœåŠ¡å¯åŠ¨è¿‡ç¨‹</h3><h4 id="ListenAndServe"><a href="#ListenAndServe" class="headerlink" title="ListenAndServe"></a>ListenAndServe</h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ListenAndServe</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, handler Handler)</span> <span class="hljs-title">error</span></span> &#123;
   server := &amp;Server&#123;Addr: addr, Handler: handler&#125;
   <span class="hljs-keyword">return</span> server.ListenAndServe()
&#125;</code></pre>
<h4 id="srv-Server-ListenAndServe"><a href="#srv-Server-ListenAndServe" class="headerlink" title="(srv *Server) ListenAndServe()"></a>(srv *Server) ListenAndServe()</h4><p>è°ƒç”¨netåŒ…ï¼Œç›‘å¬ç«¯å£</p>
<pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(srv *Server)</span> <span class="hljs-title">ListenAndServe</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
   <span class="hljs-keyword">if</span> srv.shuttingDown() &#123;
      <span class="hljs-keyword">return</span> ErrServerClosed
   &#125;
   addr := srv.Addr
   <span class="hljs-keyword">if</span> addr == <span class="hljs-string">""</span> &#123;
      addr = <span class="hljs-string">":http"</span>
   &#125;
   ln, err := net.Listen(<span class="hljs-string">"tcp"</span>, addr)
   <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
      <span class="hljs-keyword">return</span> err
   &#125;
   <span class="hljs-keyword">return</span> srv.Serve(ln)
&#125;</code></pre>

<h4 id="srv-Server-Serve"><a href="#srv-Server-Serve" class="headerlink" title="(srv *Server) Serve"></a>(srv *Server) Serve</h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(srv *Server)</span> <span class="hljs-title">Serve</span><span class="hljs-params">(l net.Listener)</span> <span class="hljs-title">error</span></span> &#123;
   <span class="hljs-comment">// ...</span>

   ctx := context.WithValue(baseCtx, ServerContextKey, srv)
   <span class="hljs-keyword">for</span> &#123;
      rw, err := l.Accept() <span class="hljs-comment">// è°ƒç”¨tcp çš„acceptæ–¹æ³•</span>
   
    <span class="hljs-comment">// ... </span>

      c := srv.newConn(rw)
    <span class="hljs-comment">// ... </span>
      <span class="hljs-keyword">go</span> c.serve(connCtx)
   &#125;
&#125;</code></pre>

<ul>
<li>l.Accept()ï¼šåœ¨forå¾ªç¯ä¸­ï¼Œä¼šä½¿ç”¨netåŒ…çš„tcp acceptæ–¹æ³•ï¼ŒåŸç†æ˜¯epollå¤šè·¯å¤ç”¨æŠ€æœ¯Linux ï¼Œä¸ä¼šæŒç»­çš„è‡ªæ—‹å ç”¨cpuæ—¶é—´ç‰‡ï¼Œè€Œæ˜¯æœ‰è¯·æ±‚åˆ°æ¥æ—¶ï¼Œæ‰ç”±å†…æ ¸ç²¾å‡†å”¤é†’</li>
<li>newConn ï¼š å°è£…httpè¯·æ±‚</li>
<li>go c.serve(connCtx)ï¼š ä½¿ç”¨goroutineå¤„ç†è¯·æ±‚</li>
</ul>
<h4 id="c-conn-serve"><a href="#c-conn-serve" class="headerlink" title="(c *conn) serve"></a>(c *conn) serve</h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *conn)</span> <span class="hljs-title">serve</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;
<span class="hljs-comment">// ...</span>
    serverHandler&#123;c.server&#125;.ServeHTTP(w, w.req) <span class="hljs-comment">// è°ƒç”¨ServeHTTPæ–¹æ³•</span>
<span class="hljs-comment">//...</span>
&#125;
sh serverHandler) ServeHTTP
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(sh serverHandler)</span> <span class="hljs-title">ServeHTTP</span><span class="hljs-params">(rw ResponseWriter, req *Request)</span></span> &#123;
   handler := sh.srv.Handler
   <span class="hljs-keyword">if</span> handler == <span class="hljs-literal">nil</span> &#123;
      handler = DefaultServeMux <span class="hljs-comment">// ä¸ä¼ ä¼šè¡¥å……å•ä¾‹çš„DefaultServeMux</span>
   &#125;
   <span class="hljs-keyword">if</span> req.RequestURI == <span class="hljs-string">"*"</span> &amp;&amp; req.Method == <span class="hljs-string">"OPTIONS"</span> &#123;
      handler = globalOptionsHandler&#123;&#125;
   &#125;

   <span class="hljs-keyword">if</span> req.URL != <span class="hljs-literal">nil</span> &amp;&amp; strings.Contains(req.URL.RawQuery, <span class="hljs-string">";"</span>) &#123;
      <span class="hljs-keyword">var</span> allowQuerySemicolonsInUse <span class="hljs-keyword">int32</span>
      req = req.WithContext(context.WithValue(req.Context(), silenceSemWarnContextKey, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
         atomic.StoreInt32(&amp;allowQuerySemicolonsInUse, <span class="hljs-number">1</span>)
      &#125;))
      <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
         <span class="hljs-keyword">if</span> atomic.LoadInt32(&amp;allowQuerySemicolonsInUse) == <span class="hljs-number">0</span> &#123;
            sh.srv.logf(<span class="hljs-string">"http: URL query contains semicolon, which is no longer a supported separator; parts of the query may be stripped when parsed; see golang.org/issue/25192"</span>)
         &#125;
      &#125;()
   &#125;

   handler.ServeHTTP(rw, req) <span class="hljs-comment">// handleræ˜¯ServeMuxï¼Œæ‰€ä»¥ä¼šèµ°åˆ°ServeMuxçš„å®ç°</span>
&#125;</code></pre>

<h4 id="mux-ServeMux-ServeHTTP"><a href="#mux-ServeMux-ServeHTTP" class="headerlink" title="(mux *ServeMux) ServeHTTP"></a>(mux *ServeMux) ServeHTTP</h4><ul>
<li>æ‰¾åˆ°è·¯å¾„å¯¹åº”çš„hanlder</li>
<li>è°ƒç”¨è¯¥handler</li>
</ul>
<pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">ServeHTTP</span><span class="hljs-params">(w ResponseWriter, r *Request)</span></span> &#123;
   <span class="hljs-keyword">if</span> r.RequestURI == <span class="hljs-string">"*"</span> &#123;
      <span class="hljs-keyword">if</span> r.ProtoAtLeast(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) &#123;
         w.Header().Set(<span class="hljs-string">"Connection"</span>, <span class="hljs-string">"close"</span>)
      &#125;
      w.WriteHeader(StatusBadRequest)
      <span class="hljs-keyword">return</span>
   &#125;
   h, _ := mux.Handler(r) <span class="hljs-comment">// è¿™é‡ŒğŸ‘‡</span>
   h.ServeHTTP(w, r)
&#125;</code></pre>

<h4 id="mux-ServeMux-Handler"><a href="#mux-ServeMux-Handler" class="headerlink" title="(mux *ServeMux) Handler("></a>(mux *ServeMux) Handler(</h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">Handler</span><span class="hljs-params">(r *Request)</span> <span class="hljs-params">(h Handler, pattern <span class="hljs-keyword">string</span>)</span></span> &#123;

   <span class="hljs-comment">// CONNECT requests are not canonicalized.</span>
   <span class="hljs-keyword">if</span> r.Method == <span class="hljs-string">"CONNECT"</span> &#123;
      <span class="hljs-comment">// If r.URL.Path is /tree and its handler is not registered,</span>
      <span class="hljs-comment">// the /tree -&gt; /tree/ redirect applies to CONNECT requests</span>
      <span class="hljs-comment">// but the path canonicalization does not.</span>
      <span class="hljs-keyword">if</span> u, ok := mux.redirectToPathSlash(r.URL.Host, r.URL.Path, r.URL); ok &#123;
         <span class="hljs-keyword">return</span> RedirectHandler(u.String(), StatusMovedPermanently), u.Path
      &#125;

      <span class="hljs-keyword">return</span> mux.handler(r.Host, r.URL.Path)
   &#125;

   <span class="hljs-comment">// All other requests have any port stripped and path cleaned</span>
   <span class="hljs-comment">// before passing to mux.handler.</span>
   host := stripHostPort(r.Host)
   path := cleanPath(r.URL.Path)

   <span class="hljs-comment">// If the given path is /tree and its handler is not registered,</span>
   <span class="hljs-comment">// redirect for /tree/.</span>
   <span class="hljs-keyword">if</span> u, ok := mux.redirectToPathSlash(host, path, r.URL); ok &#123;
      <span class="hljs-keyword">return</span> RedirectHandler(u.String(), StatusMovedPermanently), u.Path
   &#125;

   <span class="hljs-keyword">if</span> path != r.URL.Path &#123;
      _, pattern = mux.handler(host, path)
      u := &amp;url.URL&#123;Path: path, RawQuery: r.URL.RawQuery&#125;
      <span class="hljs-keyword">return</span> RedirectHandler(u.String(), StatusMovedPermanently), pattern
   &#125;

   <span class="hljs-keyword">return</span> mux.handler(host, r.URL.Path)
&#125;</code></pre>

<pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">handler</span><span class="hljs-params">(host, path <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(h Handler, pattern <span class="hljs-keyword">string</span>)</span></span> &#123;
   mux.mu.RLock()
   <span class="hljs-keyword">defer</span> mux.mu.RUnlock()

   <span class="hljs-comment">// Host-specific pattern takes precedence over generic ones</span>
   <span class="hljs-keyword">if</span> mux.hosts &#123;
      h, pattern = mux.match(host + path) <span class="hljs-comment">// è¡¥å……å·¦æ–œæ </span>
   &#125;
   <span class="hljs-keyword">if</span> h == <span class="hljs-literal">nil</span> &#123;
      h, pattern = mux.match(path)
   &#125;
   <span class="hljs-keyword">if</span> h == <span class="hljs-literal">nil</span> &#123;
      h, pattern = NotFoundHandler(), <span class="hljs-string">""</span>
   &#125;
   <span class="hljs-keyword">return</span>
&#125;</code></pre>
<pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">match</span><span class="hljs-params">(path <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(h Handler, pattern <span class="hljs-keyword">string</span>)</span></span> &#123;
   <span class="hljs-comment">// Check for exact match first.</span>
   v, ok := mux.m[path] <span class="hljs-comment">// ç²¾å‡†åŒ¹é…ï¼Œå‘½ä¸­å³è¿”å›å¯¹åº”çš„handler</span>
   <span class="hljs-keyword">if</span> ok &#123;
      <span class="hljs-keyword">return</span> v.h, v.pattern
   &#125;

   <span class="hljs-comment">// Check for longest valid match.  mux.es contains all patterns</span>
   <span class="hljs-comment">// that end in / sorted from longest to shortest.</span>
   <span class="hljs-comment">// æ¨¡ç³ŠåŒ¹é…ï¼Œesæ˜¯æŒ‰patternä»é•¿åˆ°çŸ­æ’åºï¼ŒåŒ¹é…ä¹Ÿæ˜¯ä»é•¿åˆ°çŸ­</span>
   <span class="hljs-keyword">for</span> _, e := <span class="hljs-keyword">range</span> mux.es &#123;
      <span class="hljs-keyword">if</span> strings.HasPrefix(path, e.pattern) &#123;
         <span class="hljs-keyword">return</span> e.h, e.pattern <span class="hljs-comment">// å¦‚æœå‘½ä¸­patternçš„å‰ç¼€ï¼Œå°±è¿”å›å¯¹åº”handler</span>
      &#125;
   &#125;
   <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-string">""</span>
&#125;</code></pre>
<p>è·¯ç”±åŒ¹é…æœºåˆ¶<br>æ‰€ä»¥å®é™…net/httpåŒ…å®ç°çš„è·¯ç”±åŒ¹é…æœºåˆ¶æ¯”è¾ƒç²—ç³™ï¼Œ</p>
<ol>
<li>ç²¾å‡†åŒ¹é…ï¼Œå‘½ä¸­mapä¸­çš„pattern å³è¿”å›å¯¹åº”çš„handler</li>
<li>æ¨¡ç³ŠåŒ¹é…ï¼Œåœ¨esåˆ—è¡¨ä¸­ï¼ˆæŒ‰patterné•¿åº¦ä»é•¿åˆ°çŸ­ï¼‰è¿›è¡Œå‰ç¼€æ¨¡ç³ŠåŒ¹é…ï¼Œå‘½ä¸­å³è¿”å›å¯¹åº”çš„handler</li>
</ol>
<h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><h3 id="æ•°æ®ç»“æ„-1"><a href="#æ•°æ®ç»“æ„-1" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>åŒæ ·æœ‰é»˜è®¤çš„å•ä¾‹å®ç°</p>
<pre><code class="hljs golang"><span class="hljs-keyword">type</span> Client <span class="hljs-keyword">struct</span> &#123;
   Transport RoundTripper <span class="hljs-comment">// é€šä¿¡æ¨¡å—</span>

   Jar CookieJar
   
   CheckRedirect <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(req *Request, via []*Request)</span> <span class="hljs-title">error</span></span>
   
   Timeout time.Duration
&#125;</code></pre>
<h3 id="Transport"><a href="#Transport" class="headerlink" title="Transport"></a>Transport</h3><p>RoundTripper çš„å®ç°</p>
<pre><code class="hljs golang"><span class="hljs-keyword">type</span> Transport <span class="hljs-keyword">struct</span> &#123;
   idleMu       sync.Mutex
   closeIdle    <span class="hljs-keyword">bool</span>                                <span class="hljs-comment">// user has requested to close all idle conns</span>
   <span class="hljs-comment">// æ”¾ç½®ç©ºé—²è¿æ¥çš„mapï¼Œç”¨äºå¤ç”¨ï¼ˆè¿æ¥åˆ°åŒä¸€æœåŠ¡ç«¯çš„ï¼‰</span>
   idleConn     <span class="hljs-keyword">map</span>[connectMethodKey][]*persistConn <span class="hljs-comment">// most recently used at end</span>
   idleConnWait <span class="hljs-keyword">map</span>[connectMethodKey]wantConnQueue  <span class="hljs-comment">// waiting getConns</span>
   idleLRU      connLRU

   reqMu       sync.Mutex
   reqCanceler <span class="hljs-keyword">map</span>[cancelKey]<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(error)</span></span>

   altMu    sync.Mutex   <span class="hljs-comment">// guards changing altProto only</span>
   altProto atomic.Value <span class="hljs-comment">// of nil or map[string]RoundTripper, key is URI scheme</span>

   connsPerHostMu   sync.Mutex
   connsPerHost     <span class="hljs-keyword">map</span>[connectMethodKey]<span class="hljs-keyword">int</span>
   connsPerHostWait <span class="hljs-keyword">map</span>[connectMethodKey]wantConnQueue <span class="hljs-comment">// waiting getConns</span>

   Proxy <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(*Request)</span> <span class="hljs-params">(*url.URL, error)</span></span>
    <span class="hljs-comment">// æ–°è¿æ¥ç”Ÿæˆå™¨</span>
   DialContext <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, network, addr <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(net.Conn, error)</span></span>

   Dial <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(network, addr <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(net.Conn, error)</span></span>

   DialTLSContext <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, network, addr <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(net.Conn, error)</span></span>

   DialTLS <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(network, addr <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(net.Conn, error)</span></span>

   TLSClientConfig *tls.Config

   TLSHandshakeTimeout time.Duration

   DisableKeepAlives <span class="hljs-keyword">bool</span>

   DisableCompression <span class="hljs-keyword">bool</span>

   MaxIdleConns <span class="hljs-keyword">int</span>
   MaxIdleConnsPerHost <span class="hljs-keyword">int</span>
   MaxConnsPerHost <span class="hljs-keyword">int</span>
   IdleConnTimeout time.Duration
   ResponseHeaderTimeout time.Duration
   ExpectContinueTimeout time.Duration
   TLSNextProto <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(authority <span class="hljs-keyword">string</span>, c *tls.Conn)</span> <span class="hljs-title">RoundTripper</span></span>
   ProxyConnectHeader Header
   GetProxyConnectHeader <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, proxyURL *url.URL, target <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(Header, error)</span></span>
   MaxResponseHeaderBytes <span class="hljs-keyword">int64</span>

   WriteBufferSize <span class="hljs-keyword">int</span>

   <span class="hljs-comment">// ReadBufferSize specifies the size of the read buffer used</span>
   <span class="hljs-comment">// when reading from the transport.</span>
   <span class="hljs-comment">// If zero, a default (currently 4KB) is used.</span>
   ReadBufferSize <span class="hljs-keyword">int</span>

   <span class="hljs-comment">// nextProtoOnce guards initialization of TLSNextProto and</span>
   <span class="hljs-comment">// h2transport (via onceSetNextProtoDefaults)</span>
   nextProtoOnce      sync.Once
   h2transport        h2Transport <span class="hljs-comment">// non-nil if http2 wired up</span>
   tlsNextProtoWasNil <span class="hljs-keyword">bool</span>        <span class="hljs-comment">// whether TLSNextProto was nil when the Once fired</span>

   <span class="hljs-comment">// ForceAttemptHTTP2 controls whether HTTP/2 is enabled when a non-zero</span>
   <span class="hljs-comment">// Dial, DialTLS, or DialContext func or TLSClientConfig is provided.</span>
   <span class="hljs-comment">// By default, use of any those fields conservatively disables HTTP/2.</span>
   <span class="hljs-comment">// To use a custom dialer or TLS config and still attempt HTTP/2</span>
   <span class="hljs-comment">// upgrades, set this to true.</span>
   ForceAttemptHTTP2 <span class="hljs-keyword">bool</span>
&#125;</code></pre>
<h3 id="å‘èµ·tcpè¿æ¥çš„æ­¥éª¤"><a href="#å‘èµ·tcpè¿æ¥çš„æ­¥éª¤" class="headerlink" title="å‘èµ·tcpè¿æ¥çš„æ­¥éª¤"></a>å‘èµ·tcpè¿æ¥çš„æ­¥éª¤</h3><ul>
<li>æ„é€ httpè¯·æ±‚å‚æ•°</li>
<li>è·å–tcpè¿æ¥</li>
<li>é€šè¿‡tcpè¿æ¥å‘é€æ•°æ®</li>
<li>é€šè¿‡tcpè¿æ¥æ¥å—æ•°æ®</li>
</ul>
<h4 id="t-Transport-roundTrip-req-Request-Response-error"><a href="#t-Transport-roundTrip-req-Request-Response-error" class="headerlink" title="(t Transport) roundTrip(req *Request)(Response, error)"></a>(t <em>Transport) roundTrip(req *Request)(</em>Response, error)</h4><pre><code class="hljs golang"><span class="hljs-comment">// roundTrip implements a RoundTripper over HTTP.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *Transport)</span> <span class="hljs-title">roundTrip</span><span class="hljs-params">(req *Request)</span> <span class="hljs-params">(*Response, error)</span></span> &#123;
    <span class="hljs-comment">// ...</span>

   <span class="hljs-keyword">for</span> &#123;
     <span class="hljs-comment">// ... </span>
      pconn, err := t.getConn(treq, cm) <span class="hljs-comment">// è·å–tcpè¿æ¥ï¼Œä¼šä»ç©ºé—²æ± ä¼˜å…ˆè·å–</span>
      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
         t.setReqCanceler(cancelKey, <span class="hljs-literal">nil</span>)
         req.closeBody()
         <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
      &#125;

      <span class="hljs-keyword">var</span> resp *Response
      <span class="hljs-keyword">if</span> pconn.alt != <span class="hljs-literal">nil</span> &#123;
         <span class="hljs-comment">// HTTP/2 path.</span>
         t.setReqCanceler(cancelKey, <span class="hljs-literal">nil</span>) <span class="hljs-comment">// not cancelable with CancelRequest</span>
         resp, err = pconn.alt.RoundTrip(req)  <span class="hljs-comment">// tcpçš„è¿æ¥</span>
      &#125; <span class="hljs-keyword">else</span> &#123;
         resp, err = pconn.roundTrip(treq) <span class="hljs-comment">// tcpçš„è¿æ¥</span>
      &#125;
      <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;
         resp.Request = origReq
         <span class="hljs-keyword">return</span> resp, <span class="hljs-literal">nil</span>
      &#125;

        <span class="hljs-comment">// ... </span>
   &#125;
&#125;</code></pre>

<h4 id="æ„é€ è¿æ¥-t-Transport-dialConn-ctx-context-Context-cm-connectMethod-pconn-persistConn-err-error"><a href="#æ„é€ è¿æ¥-t-Transport-dialConn-ctx-context-Context-cm-connectMethod-pconn-persistConn-err-error" class="headerlink" title="æ„é€ è¿æ¥ (t *Transport) dialConn(ctx context.Context, cm connectMethod) (pconn *persistConn, err error)"></a>æ„é€ è¿æ¥ (t *Transport) dialConn(ctx context.Context, cm connectMethod) (pconn *persistConn, err error)</h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *Transport)</span> <span class="hljs-title">dialConn</span><span class="hljs-params">(ctx context.Context, cm connectMethod)</span> <span class="hljs-params">(pconn *persistConn, err error)</span></span> &#123;
   pconn = &amp;persistConn&#123;
      t:             t,
      cacheKey:      cm.key(),
      reqch:         <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> requestAndChan, <span class="hljs-number">1</span>), <span class="hljs-comment">// è¯»channel</span>
      writech:       <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> writeRequest, <span class="hljs-number">1</span>), <span class="hljs-comment">// å†™channel</span>
      closech:       <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;),
      writeErrCh:    <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> error, <span class="hljs-number">1</span>),
      writeLoopDone: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;),
   &#125;
   <span class="hljs-comment">// ...</span>
   conn, err := t.dial(ctx, <span class="hljs-string">"tcp"</span>, cm.addr())
    <span class="hljs-comment">// ...</span>
   pconn.conn = conn

    <span class="hljs-comment">// ...</span>

   <span class="hljs-keyword">go</span> pconn.readLoop() <span class="hljs-comment">// å°†tcpè¿æ¥ä¸­è¯»å–çš„æ•°æ®æ”¾å…¥è¯»channel</span>
   <span class="hljs-keyword">go</span> pconn.writeLoop()<span class="hljs-comment">// å°†éœ€è¦å†™å…¥çš„tcpè¿æ¥çš„æ•°æ®æ”¾å…¥å†™channel</span>
   <span class="hljs-keyword">return</span> pconn, <span class="hljs-literal">nil</span>
&#125;</code></pre>
<h4 id="ä¸‰ä¸ªloop-goroutine"><a href="#ä¸‰ä¸ªloop-goroutine" class="headerlink" title="ä¸‰ä¸ªloop goroutine"></a>ä¸‰ä¸ªloop goroutine</h4><ul>
<li>pconn.readLoop() ï¼šå°†tcpæœåŠ¡ç«¯çš„å“åº”æ”¾å…¥read channelä¸­ï¼šç”Ÿäº§è¯»channel</li>
<li>pconn.writeLoop()ï¼š å°†éœ€è¦å†™å…¥çš„tcpè¿æ¥çš„æ•°æ®æ”¾å…¥å†™channelï¼šæ¶ˆè´¹å†™channel</li>
<li>ä¸»goroutineï¼šå¤„ç†ç¨‹åºçš„è¯·æ±‚å’Œå“åº”åŠ¨ä½œï¼Œå¤„ç†å¦å¤–ä¸¤ä¸ªgoroutineçš„channelçš„æ•°æ®ï¼ˆæ¶ˆè´¹è¯»channelæ•°æ®ï¼Œ ç”Ÿäº§å†™channelæ•°æ®ï¼‰<br>é€šè¿‡channelï¼Œå®ç°ä¸‰ä¸ªgoroutineçš„é€šä¿¡ï¼Œ è§£è€¦å•ä¸ªè¿æ¥é€šé“çš„é˜»å¡ï¼Œé¿å…æ¯ä¸ªè¯·æ±‚éƒ½è¦é˜»å¡ç­‰å¾…æœåŠ¡ç«¯å“åº”ï¼Œä½¿è¯»å†™äº’ä¸å¹²æ‰°</li>
</ul>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Go/">Go</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Go/">Go</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0åè®®</a> ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2023/04/26/drpc%E7%9A%84%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AE%80%E5%8D%95%E6%94%B9%E9%80%A0/">
                        <span class="hidden-mobile">drpcçš„ä»£ç ç”Ÿæˆå·¥å…·çš„ç®€å•æ”¹é€ </span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("05/22/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å‹‰å¼ºå®‰å…¨è¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>






<!-- Plugins -->


  

  

  
    <!-- Tencent Analytics -->
    <script defer>
      var _mtac = {};
      (function () {
        var mta = document.createElement("script");
        mta.src = "//pingjs.qq.com/h5/stats.js?v2.0.4";
        mta.setAttribute("name", "MTAH5");
        mta.setAttribute("sid", "500720703");
        
        mta.setAttribute("cid", "500720705");
        
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(mta, s);
      })();
    </script>
  

  

  

  



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "go net/httpçš„å°æ€»ç»“&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>


















</body>
</html>
